C51 COMPILER V9.60.0.0   USB                                                                           12/20/2023 01:45:44 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE USB
OBJECT MODULE PLACED IN .\Obj\USB.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE lib\USB.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(..\) DEBUG CODE PRINT(.\Obj\USB.ls
                    -t) PAGEWIDTH(132) PAGELENGTH(5000) TABS(2) PREPRINT(.\Obj\USB.i) OBJECT(.\Obj\USB.obj)

line level    source

   1          /************************************** INFO ***********************************
   2          * File Name          : USB.c
   3          * Author             : PushEAX
   4          * Description        : USB Mass Storage Device & HID Device on CH552
   5          *******************************************************************************/
   6          #include <stdio.h>
   7          #include "CH554.H"
   8          #include "DEBUG.H"
   9          #include "USB.h"
  10          #include "flash.h"
  11          #include "keyValue.h"
  12          #include <string.h>
  13          #pragma  NOAREGS
  14          
  15          
  16          
  17          #define THIS_ENDP0_SIZE     DEFAULT_ENDP0_SIZE
  18          #define UsbSetupBuf     ((PUSB_SETUP_REQ)Ep0Buffer)
  19          
  20          UINT8X  Ep0Buffer[THIS_ENDP0_SIZE+2]    _at_ 0x0000;                                      //Endpoint 0
  21          UINT8X  Ep1Buffer[2 * MAX_PACKET_SIZE]  _at_ THIS_ENDP0_SIZE + 2 + MAX_PACKET_SIZE;       //Endpoint 1 USB Mass Storage D
             -evice
  22          UINT8X  Ep2Buffer[2 * MAX_PACKET_SIZE]  _at_ THIS_ENDP0_SIZE + 2 + 4 * MAX_PACKET_SIZE;   //Endpoint 2 HID Keyboard
  23          
  24          UINT8   UsbConfig = 0;
  25          UINT8   IsHIDDataSent   = 0;
  26          
  27          extern UINT8 USBReady,ExecBadUSB,AttackEnabled;
  28          
  29          UINT8 HIDData[] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}; //ÊåâÈîÆÊï∞ÊçÆÊä•Êñá
  30          UINT8C HIDReportDescriptor[] =  //HIDÊèèËø∞Á¨¶
  31          {
  32              0x05, 0x01, 0x09, 0x06, 0xa1, 0x01, 0x05, 0x07,
  33              0x19, 0xe0, 0x29, 0xe7, 0x15, 0x00, 0x25, 0x01,
  34              0x75, 0x01, 0x95, 0x08, 0x81, 0x02, 0x95, 0x01,
  35              0x75, 0x08, 0x81, 0x01, 0x95, 0x03, 0x75, 0x01,
  36              0x05, 0x08, 0x19, 0x01, 0x29, 0x03, 0x91, 0x02,
  37              0x95, 0x05, 0x75, 0x01, 0x91, 0x01, 0x95, 0x06,
  38              0x75, 0x08, 0x15, 0x00, 0x25, 0x65, 0x05, 0x07,
  39              0x19, 0x00, 0x29, 0x65, 0x81, 0x00, 0xc0     
  40          };
  41          
  42          UINT8C  MyDevDescr[] =      // ËÆæÂ§áÊèèËø∞Á¨¶
  43          {
  44              0x12, 0x01, 0x10, 0x01,
  45              0x00, 0x00, 0x00, THIS_ENDP0_SIZE,
  46              0x44, 0x33, 0x33, 0x35,                                 // ÂéÇÂïÜIDÂíå‰∫ßÂìÅID
  47              0x00, 0x01, 0x01, 0x02,
  48              0x00, 0x01
  49          };
  50          
  51          UINT8C  MyCfgDescr[] =      // ÈÖçÁΩÆÊèèËø∞Á¨¶, Êé•Âè£ÊèèËø∞Á¨¶, Á´ØÁÇπÊèèËø∞Á¨¶
  52          {
  53              0x09, 0x02, 0x39, 0x00, 0x02, 0x01, 0x00, 0x80, 0x64,   // ÈÖçÁΩÆÊèèËø∞Á¨¶
  54            
  55              0x09, 0x04, 0x00, 0x00, 0x02, 0x08, 0x06, 0x50, 0x00,   // UÁõòÊé•Âè£ÊèèËø∞Á¨¶
  56              0x07, 0x05, 0x01, 0x02, 0x40, 0x00, 0x00,               // ÊâπÈáè‰∏ã‰º†Á´ØÁÇπ
  57              0x07, 0x05, 0x81, 0x02, 0x40, 0x00, 0x00,               // ÊâπÈáè‰∏ä‰º†Á´ØÁÇπ
  58             
  59              0x09, 0x04, 0x01, 0x00, 0x01, 0x03, 0x01, 0x01, 0x00,                         //ÈîÆÁõòÊé•Âè£ÊèèËø∞Á¨¶
  60              0x09, 0x21, 0x11, 0x01, 0x00, 0x01, 0x22, sizeof(HIDReportDescriptor), 0x00,  //HIDÁ±ªÊèèËø∞Á¨¶
  61              0x07, 0x05, 0x82, 0x03, sizeof(HIDData), 0x00, 0x00                           //Á´ØÁÇπÊèèËø∞Á¨¶
  62          };
  63          
  64          UINT8C  MyLangDescr[] =     // ËØ≠Ë®ÄÊèèËø∞Á¨¶
  65          {
  66              4, 0x03, 0x09, 0x04
  67          };
  68          
  69          UINT8C  MyManuInfo[] =      // ÂéÇÂÆ∂‰ø°ÊÅØ
  70          {
  71              14, 0x03, 'U', 0, 'S', 0, 'B', 0, '2', 0, '.', 0, '0', 0
  72          };
  73          
  74          UINT8C  MyProdInfo[] =      // ‰∫ßÂìÅ‰ø°ÊÅØ
  75          {
  76              12, 0x03, 'U', 0, 'S', 0, 'B', 0, ' ', 0, ' ', 0
  77          };
  78          
  79          // Mass Storage
  80          UINT8C  MAX_LUN[] = { 0 };
  81          
  82          UINT8C  DBINQUITY_CD_ROM[] =       //CD-ROM INQUIRY inform
  83            {
  84              0x05,          /* 05:CD-ROM Device*/
  85              0x00,          /* 00:DRIVE_FIXED*/
  86              0x04,          /* Version: No conformance claim to standard 04 02*/
  87              0x02,
  88          
  89              0x1f,          /* Additional Length */
  90              0x00,          /* SCCS = 1: Storage Controller Component */
  91              0x00,
  92              0x00,
  93              /* Vendor Identification */
  94              ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ',       /* Manufacturer: 8 bytes */
  95              /* Product Identification */
  96              'U', 'l', 't', 'r', 'a', ' ', 'U', 'S',       /* Product : 16 Bytes */
  97              'B', '2', '.', '0', ' ', ' ', ' ', ' ',
  98              /* Product Revision Level */
  99              '2', '.', '0', ' '                            /* Version : 4 Bytes */
 100            };
 101          
 102          UINT8C  DBINQUITY_USB_Drive[] =       //USB Drive INQUIRY inform
 103            {
 104              0x00,          /* 00:Direct Access Device*/
 105              0x80,          /* 80:DRIVE_REMOVABLE*/
 106              0x04,          /* Version: No conformance claim to standard 04 02*/
 107              0x02,
 108          
 109              0x1f,          /* Additional Length */
 110              0x00,          /* SCCS = 1: Storage Controller Component */
 111              0x00,
 112              0x00,
 113              /* Vendor Identification */
 114              ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ',       /* Manufacturer: 8 bytes */
 115              /* Product Identification */
 116              'U', 'l', 't', 'r', 'a', ' ', 'U', 'S',       /* Product : 16 Bytes */
 117              'B', '2', '.', '0', ' ', ' ', ' ', ' ',
 118              /* Product Revision Level */
 119              '2', '.', '0', ' '                            /* Version : 4 Bytes */
 120            };
 121          
 122          
 123          
 124          
 125          
 126          UINT8C  DBCAPACITY[] =      // ‰º™Ë£ÖÁöÑÂÆπÈáèÊä•Êñá
 127          {
 128              (DISK_SEC_LAST >> 24) & 0xFF, (DISK_SEC_LAST >> 16) & 0xFF, (DISK_SEC_LAST >> 8) & 0xFF, DISK_SEC_LAST & 0xFF, (DI
             -SK_SEC_LEN >> 24) & 0xFF, (DISK_SEC_LEN >> 16) & 0xFF, (DISK_SEC_LEN >> 8) & 0xFF, DISK_SEC_LEN & 0xFF
 129          };
 130          
 131          UINT8C  modesense3F[] =     // Áâ©ÁêÜÊâáÂå∫Êï∞
 132          {
 133              0x0b, 0x00, 0x00, 0x08, (DISK_SEC_NUM >> 24) & 0xFF, (DISK_SEC_NUM >> 16) & 0xFF, (DISK_SEC_NUM >> 8) & 0xFF, DISK
             -_SEC_NUM & 0xFF, 00, 00, 02, 00
 134          };
 135          
 136          UINT8C  mode5sense3F[] =    // Áâ©ÁêÜÊâáÂå∫Êï∞
 137          {
 138              0x00, 0x06, 0x00, 0x00, 0x08, 0x00, 0x00, 0x08, (DISK_SEC_NUM >> 24) & 0xFF, (DISK_SEC_NUM >> 16) & 0xFF, (DISK_SE
             -C_NUM >> 8) & 0xFF, DISK_SEC_NUM & 0xFF, 00, 00, 02, 00
 139          };
 140          
 141          typedef union _CBWCB
 142          {
 143              unsigned char buf1[16];
 144          } CBWCB;
 145          
 146          typedef  union _MASS_PARA
 147          {
 148              unsigned char buf[64];
 149              struct  _SENSE
 150              {
 151                  unsigned char ErrorCode;
 152                  unsigned char Reserved1;
 153                  unsigned char SenseKey;
 154                  unsigned char Information[4];
 155                  unsigned char AddSenseLength;
 156                  unsigned char Reserved2[4];
 157                  unsigned char AddSenseCode;
 158                  unsigned char AddSenseCodeQua;
 159                  unsigned char Reserved3[4];
 160              } Sense;
 161              struct  _CBW
 162              {
 163                  unsigned char dCBWsig[4];
 164                  unsigned char dCBWTag[4];
 165                  unsigned long dCBWDatL;
 166                  unsigned char bmCBWFlags;
 167                  unsigned char bCBWLUN;
 168                  unsigned char bCBWCBLength;
 169                  CBWCB        cbwcb;
 170              } cbw;
 171          } MASS_PARA;
 172          
 173          enum _HOST_DEV_DISAGREE
 174          {
 175              CASEOK = 0,
 176              CASE1,
 177              CASE2,
 178              CASE3,
 179              CASE4,
 180              CASE5,
 181              CASE6,
 182              CASE7,
 183              CASE8,
 184              CASE9,
 185              CASE10,
 186              CASE11,
 187              CASE12,
 188              CASE13,
 189              CASECBW,
 190              CASECMDFAIL
 191          };
 192          
 193          #define FORMAT_UNIT             0x04
 194          #define INQUIRY                 0x12
 195          #define MODE_SELECT             0x15
 196          #define MODE_SENSE5             0x5A
 197          #define MODE_SENSE              0x1A
 198          #define PER_RES_IN              0x5E
 199          #define PER_RES_OUT             0x5F
 200          #define PRE_OR_MED              0x1E
 201          #define READ                    0x28
 202          #define READ_CAPACITY           0x25
 203          #define RELEASE                 0x17
 204          #define REQUEST_SENSE           0x03
 205          #define RESERVE                 0x16
 206          #define STA_STO_UNIT            0x1B
 207          #define SYN_CACHE               0x35
 208          #define TES_UNIT                0x00
 209          #define VERIFY                  0x2F
 210          #define WRITE                   0x2A
 211          #define WRITE_BUFFER            0x3B
 212          #define FORMATCAP               0x23
 213          #define READTOC                 0x43
 214          #define GET_EVE_STA_NOT         0x4A
 215          #define GET_CONF                0x46
 216          #define PROFILE_LIST                0x46
 217          
 218          
 219          union
 220          {
 221              unsigned long mDataLength;                      // Êï∞ÊçÆÈïøÂ∫¶
 222              unsigned char mdataLen[4];
 223          } LEN;
 224          
 225          MASS_PARA idata MassPara;
 226          unsigned char mdCBWTag[4];                          // dCBWTag
 227          bit CH375BULKUP;                                    // Êï∞ÊçÆ‰∏ä‰º†
 228          bit CH375BULKDOWN;                                  // Êï∞ÊçÆ‰∏ã‰º†
 229          bit CH375CSW;                                       // CSW‰∏ä‰º†Ê†áÂøó
 230          unsigned char BcswStatus;                           // CSWÁä∂ÊÄÅ
 231          unsigned char mSenseKey;
 232          unsigned char mASC;
 233          bit FSTALL;                                         // Êï∞ÊçÆÈîôËØØÊ†áÂøó
 234          bit lastFSTALL;
 235          bit pBuf_ReSelect = 0;
 236          UINT32 Locate_Addr;
 237          unsigned char *pBuf;
 238          
 239          /*******************************************************************************
 240          * Function Name  : USBDeviceCfg()
 241          * Description    : USBËÆæÂ§áÊ®°ÂºèÈÖçÁΩÆ
 242          * Input          : None
 243          * Output         : None
 244          * Return         : None
 245          *******************************************************************************/
 246          void    InitUSB(void)                                    // ÂàùÂßãÂåñUSBËÆæÂ§á
 247          {
 248   1          USB_CTRL = 0x00;                                            // Ê∏ÖÁ©∫USBÊéßÂà∂ÂØÑÂ≠òÂô®
 249   1          USB_CTRL &= ~bUC_HOST_MODE;                                 // ËØ•‰Ωç‰∏∫ÈÄâÊã©ËÆæÂ§áÊ®°Âºè
 250   1          USB_CTRL |=  bUC_DEV_PU_EN | bUC_INT_BUSY | bUC_DMA_EN;     // USBËÆæÂ§áÂíåÂÜÖÈÉ®‰∏äÊãâ‰ΩøËÉΩ,Âú®‰∏≠Êñ≠ÊúüÈó¥‰∏≠Êñ
             -≠Ê†áÂøóÊú™Ê∏ÖÈô§ÂâçËá™Âä®ËøîÂõûNAK
 251   1          USB_DEV_AD = 0x00;                                          // ËÆæÂ§áÂú∞ÂùÄÂàùÂßãÂåñ
 252   1          USB_CTRL &= ~bUC_LOW_SPEED;
 253   1          UDEV_CTRL &= ~bUD_LOW_SPEED;                                // ÈÄâÊã©ÂÖ®ÈÄü12MÊ®°ÂºèÔºåÈªòËÆ§ÊñπÂºè
 254   1          UDEV_CTRL = bUD_PD_DIS;                                     // Á¶ÅÊ≠¢DP/DM‰∏ãÊãâÁîµÈòª
 255   1          UDEV_CTRL |= bUD_PORT_EN;                                   // ‰ΩøËÉΩÁâ©ÁêÜÁ´ØÂè£
 256   1        
 257   1        UEP1_DMA = Ep1Buffer;                                         // Á´ØÁÇπ1 Êï∞ÊçÆ‰º†ËæìÂú∞ÂùÄÔºàUÁõòÔºâ
 258   1          UEP4_1_MOD = 0xC0;                                          // Á´ØÁÇπ1‰∏ä‰∏ã‰º†ÁºìÂÜ≤Âå∫ÔºõÁ´ØÁÇπ0Âçï64Â≠óËäÇÊî∂Âè
             -ëÁºìÂÜ≤Âå∫
 259   1          UEP1_CTRL = bUEP_AUTO_TOG | UEP_T_RES_NAK | UEP_R_RES_ACK;  // Á´ØÁÇπ1Ëá™Âä®ÁøªËΩ¨ÂêåÊ≠•Ê†áÂøó‰ΩçÔºåIN‰∫ãÂä°ËøîÂõû
             -NAKÔºåOUTËøîÂõûACK
 260   1        UEP0_DMA = Ep0Buffer;                                         // Á´ØÁÇπ0Êï∞ÊçÆ‰º†ËæìÂú∞ÂùÄ
 261   1          UEP0_CTRL = UEP_R_RES_ACK | UEP_T_RES_NAK;                  // ÊâãÂä®ÁøªËΩ¨ÔºåOUT‰∫ãÂä°ËøîÂõûACKÔºåIN‰∫ãÂä°ËøîÂõûN
             -AK
 262   1        UEP0_T_LEN = 0;
 263   1          UEP1_T_LEN = 0;                                             // È¢Ñ‰ΩøÁî®ÂèëÈÄÅÈïøÂ∫¶‰∏ÄÂÆöË¶ÅÊ∏ÖÁ©∫
 264   1        UEP2_DMA = Ep2Buffer;                                         // Á´ØÁÇπ2 Êï∞ÊçÆ‰º†ËæìÂú∞ÂùÄÔºàÈîÆÁõòÔºâ
 265   1          UEP2_3_MOD = bUEP2_TX_EN;
 266   1          UEP2_CTRL = bUEP_AUTO_TOG | UEP_T_RES_NAK;
 267   1          UEP2_T_LEN = 0;
 268   1      
 269   1      
 270   1          USB_INT_EN |= bUIE_SUSPEND;                                 // ‰ΩøËÉΩËÆæÂ§áÊåÇËµ∑‰∏≠Êñ≠
 271   1          USB_INT_EN |= bUIE_TRANSFER;                                // ‰ΩøËÉΩUSB‰º†ËæìÂÆåÊàê‰∏≠Êñ≠
 272   1          USB_INT_EN |= bUIE_BUS_RST;                                 // ‰ΩøËÉΩËÆæÂ§áÊ®°ÂºèUSBÊÄªÁ∫øÂ§ç‰Ωç‰∏≠Êñ≠
 273   1          USB_INT_FG |= 0x1F;                                         // Ê∏Ö‰∏≠Êñ≠Ê†áÂøó
 274   1          IE_USB = 1;                                                 // ‰ΩøËÉΩUSB‰∏≠Êñ≠
 275   1          EA = 1;                                                     // ÂÖÅËÆ∏ÂçïÁâáÊú∫‰∏≠Êñ≠
 276   1      }
 277          
 278          
 279          /*******************************************************************************
 280          * Function Name  : HIDSendData
 281          * Description    : Á´ØÁÇπ2ÂèëÈÄÅÊï∞ÊçÆÔºåÂç≥HIDÊï∞ÊçÆ
 282          * Input          : None
 283          * Output         : None
 284          * Return         : None
 285          *******************************************************************************/
 286          void HIDSendData()
 287          {
 288   1        memcpy( Ep2Buffer, HIDData, sizeof(HIDData));
 289   1        UEP2_T_LEN = sizeof(HIDData);
 290   1        UEP2_CTRL = UEP2_CTRL & ~ MASK_UEP_T_RES | UEP_T_RES_ACK;
 291   1      }
 292          
 293          /*******************************************************************************
 294          * Function Name  : SendKey
 295          * Description    : Ê®°ÊãüÈîÆÁõòÊåâ‰∏ãÊüêÈîÆ(Êé•Êî∂HIDÁºñÁ†Å)
 296          * Input          : FunctionKey  ÂäüËÉΩÈîÆ
 297                             Key          ÊôÆÈÄöÊåâÈîÆ
 298                              
 299          * Output         : None
 300          * Return         : None
 301          *******************************************************************************/
 302          void SendKey(UINT8 FunctionKey, UINT8 Key)
 303          {
 304   1        IsHIDDataSent = 0;
 305   1        HIDData[0] = FunctionKey;
 306   1        HIDData[2] = Key;
 307   1        HIDSendData();
 308   1        while(!IsHIDDataSent);
 309   1        mDelaymS(5);
 310   1        
 311   1        IsHIDDataSent = 0;
 312   1        HIDData[0] = KB_NULL;
 313   1        HIDData[2] = KB_NULL; 
 314   1        HIDSendData();
 315   1        while(!IsHIDDataSent);
 316   1        mDelaymS(5);
 317   1      }
 318          
 319          /*******************************************************************************
 320          * Function Name  : SendKey
 321          * Description    : Ê®°ÊãüÈîÆÁõòÊåâ‰∏ãÊüêÈîÆÔºàÊé•Êî∂ÊåâÈîÆÂ≠óÁ¨¶Ôºâ
 322          * Input          : c  ÊåâÈîÆÂ≠óÁ¨¶
 323          * Output         : None
 324          * Return         : None
 325          *******************************************************************************/
 326          void SendChar(UINT8 c)
 327          {
 328   1        if((c>='a')&&(c<='z')){
 329   2          SendKey(KB_NULL,c-'a'+KB_A);
 330   2        }else if((c>='A')&&(c<='Z')){
 331   2          SendKey(KB_LeftShift,c-'A'+KB_A);
 332   2        }else if((c>='1')&&(c<='9')){
 333   2          SendKey(KB_NULL,c-'1'+KB_1);
 334   2        }else{
 335   2          switch(c){
 336   3            case '0':
 337   3              SendKey(KB_NULL,KB_0);
 338   3              break;
 339   3            case ' ':
 340   3              SendKey(KB_NULL,KB_SPACE);
 341   3              break;
 342   3            case '!':
 343   3              SendKey(KB_LeftShift,KB_1);
 344   3              break;
 345   3            case '@':
 346   3              SendKey(KB_LeftShift,KB_2);
 347   3              break;
 348   3            case '#':
 349   3              SendKey(KB_LeftShift,KB_3);
 350   3              break;
 351   3            case '$':
 352   3              SendKey(KB_LeftShift,KB_4);
 353   3              break;
 354   3            case '%':
 355   3              SendKey(KB_LeftShift,KB_5);
 356   3              break;
 357   3            case '^':
 358   3              SendKey(KB_LeftShift,KB_6);
 359   3              break;
 360   3            case '&':
 361   3              SendKey(KB_LeftShift,KB_7);
 362   3              break;
 363   3            case '*':
 364   3              SendKey(KB_LeftShift,KB_8);
 365   3              break;
 366   3            case '(':
 367   3              SendKey(KB_LeftShift,KB_9);
 368   3              break;
 369   3            case ')':
 370   3              SendKey(KB_LeftShift,KB_0);
 371   3              break;
 372   3            case '-':
 373   3              SendKey(KB_NULL,KB_SUB);
 374   3              break;
 375   3            case '_':
 376   3              SendKey(KB_LeftShift,KB_SUB);
 377   3              break;
 378   3            case '=':
 379   3              SendKey(KB_NULL,KB_EQUAL);
 380   3              break;
 381   3            case '+':
 382   3              SendKey(KB_LeftShift,KB_EQUAL);
 383   3              break;
 384   3            case '[':
 385   3              SendKey(KB_NULL,KB_LEFT_BRACKET);
 386   3              break;
 387   3            case '{':
 388   3              SendKey(KB_LeftShift,KB_LEFT_BRACKET);
 389   3              break;
 390   3            case ']':
 391   3              SendKey(KB_NULL,KB_RIGHT_BRACKET);
 392   3              break;
 393   3            case '}':
 394   3              SendKey(KB_LeftShift,KB_RIGHT_BRACKET);
 395   3              break;
 396   3            case '\\':
 397   3              SendKey(KB_NULL,KB_VERTICAL_LINE);
 398   3              break;
 399   3            case '|':
 400   3              SendKey(KB_LeftShift,KB_VERTICAL_LINE);
 401   3              break;
 402   3            case ';':
 403   3              SendKey(KB_NULL,KB_SEMICOLON);
 404   3              break;
 405   3            case ':':
 406   3              SendKey(KB_LeftShift,KB_SEMICOLON);
 407   3              break;
 408   3            case '`':
 409   3              SendKey(KB_NULL,KB_WAVE);
 410   3              break;
 411   3            case '~':
 412   3              SendKey(KB_LeftShift,KB_WAVE);
 413   3              break;
 414   3            case '\'':
 415   3              SendKey(KB_NULL,KB_QUOTE);
 416   3              break;
 417   3            case '"':
 418   3              SendKey(KB_LeftShift,KB_QUOTE);
 419   3              break;
 420   3            case ',':
 421   3              SendKey(KB_NULL,KB_COMMA);
 422   3              break;
 423   3            case '<':
 424   3              SendKey(KB_LeftShift,KB_COMMA);
 425   3              break;
 426   3            case '.':
 427   3              SendKey(KB_NULL,KB_DOT);
 428   3              break;
 429   3            case '>':
 430   3              SendKey(KB_LeftShift,KB_DOT);
 431   3              break;
 432   3            case '/':
 433   3              SendKey(KB_NULL,KB_QUESTION);
 434   3              break;
 435   3            case '?':
 436   3              SendKey(KB_LeftShift,KB_QUESTION);
 437   3              break;
 438   3            case '\t':
 439   3              SendKey(KB_NULL,KB_TAB);
 440   3              break;
 441   3            case '\n':
 442   3              SendKey(KB_NULL,KB_ENTER);
 443   3              break;
 444   3          }
 445   2        }
 446   1      }
 447          
 448          /*******************************************************************************
 449          * Function Name  : SendString
 450          * Description    : Ê®°ÊãüÈîÆÁõòÊåâ‰∏ã‰∏Ä‰∏≤Â≠óÁ¨¶‰∏≤
 451          * Input          : *s   Â≠óÁ¨¶‰∏≤ÂÜÖÂÆπ
 452                             length Â≠óÁ¨¶‰∏≤ÈïøÂ∫¶
 453          * Output         : None
 454          * Return         : None
 455          *******************************************************************************/
 456          void SendString(UINT8 *s,UINT8 length){
 457   1        UINT8 i;
 458   1        for(i=0;i<length;i++){
 459   2          SendChar(s[i]);
 460   2        }
 461   1      }
 462          
 463          
 464          // BLOCK ONLY  The Thirteen Cases
 465          void  BulkThirteen(unsigned char Case)
 466          {
 467   1          switch(Case)
 468   1          {
 469   2              case CASEOK:
 470   2              case CASE1:                                         /* Hn=Dn*/
 471   2              case CASE6:                                         /* Hi=Di*/
 472   2                  BcswStatus = 0;
 473   2                  break;
 474   2              case CASE12:                                        /* Ho=Do*/
 475   2                  BcswStatus = 0;
 476   2                  break;
 477   2              case CASE2:                                         /* Hn<Di*/
 478   2              case CASE3:                                         /* Hn<Do*/
 479   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
 480   2                  FSTALL = 1;
 481   2                  // ËøôÈáå‰∏ä‰º†Á´ØÁÇπËÆæÁΩÆ‰∏Ä‰∏™STALLÔºåÂæÖ‰∏ªÊú∫Ê∏ÖÊéâ // may or may-not
 482   2                  BcswStatus = 2;
 483   2                  break;
 484   2              case CASE4:                                         /* Hi>Dn*/
 485   2              case CASE5:                                         /* Hi>Di*/
 486   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
 487   2                  FSTALL = 1;
 488   2                  // ËøôÈáå‰∏ä‰º†Á´ØÁÇπËÆæÁΩÆ‰∏Ä‰∏™STALLÔºåÂæÖ‰∏ªÊú∫Ê∏ÖÊéâ
 489   2                  BcswStatus = 1;                                 // CSW_GOOD or CSW_FAIL
 490   2                  break;
 491   2              case CASE7:                                         /* Hi<Di*/
 492   2              case CASE8:                                         /* Hi<>Do */
 493   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
 494   2                  FSTALL = 1;
 495   2                  // ËøôÈáå‰∏ä‰º†Á´ØÁÇπËÆæÁΩÆ‰∏Ä‰∏™STALLÔºåÂæÖ‰∏ªÊú∫Ê∏ÖÊéâ
 496   2                  BcswStatus = 2;
 497   2                  break;
 498   2              case CASE9:                                         /* Ho>Dn*/
 499   2              case CASE11:                                        /* Ho>Do*/
 500   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_R_RES ;
 501   2                  FSTALL = 1;
 502   2                  // ËøôÈáå‰∏ä‰º†Á´ØÁÇπËÆæÁΩÆ‰∏Ä‰∏™STALLÔºåÂæÖ‰∏ªÊú∫Ê∏ÖÊéâ
 503   2                  BcswStatus = 1;                                 // CSW_GOOD or CSW_FAIL
 504   2                  break;
 505   2              case CASE10:                                        /* Ho<>Di */
 506   2              case CASE13:                                        /* Ho<Do*/
 507   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
 508   2                  FSTALL = 1;
 509   2                  // ËøôÈáå‰∏ä‰º†Á´ØÁÇπËÆæÁΩÆ‰∏Ä‰∏™STALLÔºåÂæÖ‰∏ªÊú∫Ê∏ÖÊéâ
 510   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_R_RES ;
 511   2                  // ËøôÈáå‰∏ä‰º†Á´ØÁÇπËÆæÁΩÆ‰∏Ä‰∏™STALLÔºåÂæÖ‰∏ªÊú∫Ê∏ÖÊéâ
 512   2                  BcswStatus = 2;
 513   2                  break;
 514   2              case CASECBW:                                       /* invalid CBW */
 515   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
 516   2                  FSTALL = 1;
 517   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_R_RES ;
 518   2                  // ËøôÈáåÁ´ØÁÇπËÆæÁΩÆ‰∏Ä‰∏™STALLÔºåÂæÖ‰∏ªÊú∫Ê∏ÖÊéâ
 519   2                  BcswStatus = 2;
 520   2                  break;
 521   2              case CASECMDFAIL:
 522   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
 523   2                  FSTALL = 1;
 524   2                  // ËøôÈáå‰∏ä‰º†Á´ØÁÇπËÆæÁΩÆ‰∏Ä‰∏™STALLÔºåÂæÖ‰∏ªÊú∫Ê∏ÖÊéâ
 525   2                  BcswStatus = 1;
 526   2                  break;
 527   2              default:
 528   2                  break;
 529   2          }
 530   1      }
 531          
 532          // Êü•ËØ¢UÁõòÂÆπÈáè
 533          void  UFI_readCapacity(void)
 534          {
 535   1          pBuf = DBCAPACITY;
 536   1          if(LEN.mDataLength > sizeof(DBCAPACITY))
 537   1              LEN.mDataLength = sizeof(DBCAPACITY);
 538   1          BcswStatus  = 0;
 539   1          mSenseKey   = 0;
 540   1          mASC        = 0;
 541   1      }
 542          
 543          // Êü•ËØ¢UÁõò‰ø°ÊÅØ
 544          void  UFI_inquiry(void)
 545          {
 546   1        if (AttackEnabled == 0) //ÊîªÂáªÊ®°ÂºèÂÖ≥Èó≠ÔºåÊûö‰∏æ‰∏∫ÊôÆÈÄöUÁõò
 547   1          {  
 548   2              pBuf = DBINQUITY_USB_Drive;
 549   2              if(LEN.mDataLength > sizeof(DBINQUITY_USB_Drive))
 550   2                  LEN.mDataLength = sizeof(DBINQUITY_USB_Drive);
 551   2              BcswStatus  = 0;
 552   2              mSenseKey   = 0;
 553   2              mASC        = 0;
 554   2          }
 555   1          else //ÊîªÂáªÊ®°ÂºèÂÖ≥Èó≠ÔºåÊûö‰∏æ‰∏∫CD-ROM
 556   1          {
 557   2              pBuf = DBINQUITY_CD_ROM;
 558   2              if(LEN.mDataLength > sizeof(DBINQUITY_CD_ROM))
 559   2                  LEN.mDataLength = sizeof(DBINQUITY_CD_ROM);
 560   2              BcswStatus  = 0;
 561   2              mSenseKey   = 0;
 562   2              mASC        = 0;
 563   2          } 
 564   1      }
 565          
 566          // ËØªÂèñÊï∞ÊçÆ
 567          void  UFI_read10(void)
 568          {
 569   1          LEN.mDataLength = (((UINT32)MassPara.cbw.cbwcb.buf1[7] << 8) | (UINT32)MassPara.cbw.cbwcb.buf1[8]) * DISK_SEC_LEN;
 570   1          Locate_Addr = ((UINT32)MassPara.cbw.cbwcb.buf1[2] << 24) | ((UINT32)MassPara.cbw.cbwcb.buf1[3] << 16) | ((UINT32)M
             -assPara.cbw.cbwcb.buf1[4] << 8) | (UINT32)MassPara.cbw.cbwcb.buf1[5];
 571   1          Locate_Addr = Locate_Addr * DISK_SEC_LEN;
 572   1          BcswStatus = 0;
 573   1          mSenseKey = 0;
 574   1          mASC = 0;
 575   1          pBuf_ReSelect = 1;
 576   1      }
 577          
 578          // Ê®°ÂºèËÆ§ËØÜ
 579          void  UFI_modeSense(void)
 580          {
 581   1          if(MassPara.cbw.cbwcb.buf1[2] == 0x3F)
 582   1          {
 583   2              if(LEN.mDataLength > sizeof(modesense3F)) LEN.mDataLength = sizeof(modesense3F);
 584   2              pBuf = modesense3F;
 585   2              BcswStatus = 0;
 586   2              mSenseKey = 0;
 587   2              mASC = 0;
 588   2          }
 589   1          else
 590   1          {
 591   2              CH375BULKUP = 0;
 592   2              mSenseKey = 5;
 593   2              mASC = 0x20;
 594   2              BcswStatus = 1;
 595   2              BulkThirteen(CASECMDFAIL);
 596   2          }
 597   1      }
 598          
 599          // ËØ∑Ê±ÇËÆ§ËØÜ
 600          void  UFI_requestSense(void)
 601          {
 602   1          if(FSTALL | lastFSTALL)
 603   1          {
 604   2              lastFSTALL = FSTALL;
 605   2              FSTALL = 0;
 606   2              MassPara.Sense.ErrorCode = 0x70;
 607   2              MassPara.Sense.Reserved1 = 0;
 608   2              MassPara.Sense.SenseKey = mSenseKey;
 609   2              MassPara.Sense.Information[0] = 0;
 610   2              MassPara.Sense.Information[1] = 0;
 611   2              MassPara.Sense.Information[2] = 0;
 612   2              MassPara.Sense.Information[3] = 0;
 613   2              MassPara.Sense.AddSenseLength = 0x0a;
 614   2              MassPara.Sense.Reserved2[0] = 0;
 615   2              MassPara.Sense.Reserved2[1] = 0;
 616   2              MassPara.Sense.Reserved2[2] = 0;
 617   2              MassPara.Sense.Reserved2[3] = 0;
 618   2              MassPara.Sense.AddSenseCode = mASC;
 619   2              MassPara.Sense.AddSenseCodeQua = 00;
 620   2              MassPara.Sense.Reserved3[0] = 0;
 621   2              MassPara.Sense.Reserved3[1] = 0;
 622   2              MassPara.Sense.Reserved3[2] = 0;
 623   2              MassPara.Sense.Reserved3[3] = 0;
 624   2              pBuf = MassPara.buf;
 625   2              BcswStatus = 0;
 626   2          }
 627   1          else
 628   1          {
 629   2              lastFSTALL = FSTALL;
 630   2              FSTALL = 0;
 631   2              MassPara.Sense.ErrorCode = 0x70;
 632   2              MassPara.Sense.Reserved1 = 0;
 633   2              MassPara.Sense.SenseKey = 0x00;
 634   2              MassPara.Sense.Information[0] = 0;
 635   2              MassPara.Sense.Information[1] = 0;
 636   2              MassPara.Sense.Information[2] = 0;
 637   2              MassPara.Sense.Information[3] = 0;
 638   2              MassPara.Sense.AddSenseLength = 0x0a;
 639   2              MassPara.Sense.Reserved2[0] = 0;
 640   2              MassPara.Sense.Reserved2[1] = 0;
 641   2              MassPara.Sense.Reserved2[2] = 0;
 642   2              MassPara.Sense.Reserved2[3] = 0;
 643   2              MassPara.Sense.AddSenseCode = 0x00;
 644   2              MassPara.Sense.AddSenseCodeQua = 00;
 645   2              MassPara.Sense.Reserved3[0] = 0;
 646   2              MassPara.Sense.Reserved3[1] = 0;
 647   2              MassPara.Sense.Reserved3[2] = 0;
 648   2              MassPara.Sense.Reserved3[3] = 0;
 649   2              pBuf = MassPara.buf;
 650   2              BcswStatus = 0;
 651   2          }
 652   1      }
 653          
 654          // ÊµãËØïUÁõòÊòØÂê¶ÂáÜÂ§áÂ•Ω
 655          void  UFI_testUnit(void)
 656          {
 657   1          CH375BULKDOWN = 0;
 658   1          CH375BULKUP = 0;
 659   1          BcswStatus = 0;
 660   1          mSenseKey = 0;
 661   1          mASC = 0;
 662   1      }
 663          
 664          // ÂÖÅËÆ∏ÁßªÂá∫Á£ÅÁõò
 665          void  UFI_perOrMed(void)
 666          {
 667   1          BcswStatus = 0;
 668   1          mSenseKey = 0;
 669   1          mASC = 0;
 670   1      }
 671          
 672          // ÂÜôÂÖ•Êï∞ÊçÆ
 673          void  UFI_write(void)
 674          {
 675   1          UINT8 i, num;
 676   1      
 677   1          LEN.mDataLength = (((UINT32)MassPara.cbw.cbwcb.buf1[7] << 8) | (UINT32)MassPara.cbw.cbwcb.buf1[8]) * DISK_SEC_LEN;
             -      // ÂÜôÊï∞ÊçÆÈïøÂ∫¶
 678   1          Locate_Addr = ((UINT32)MassPara.cbw.cbwcb.buf1[2] << 24) | ((UINT32)MassPara.cbw.cbwcb.buf1[3] << 16) | ((UINT32)M
             -assPara.cbw.cbwcb.buf1[4] << 8) | (UINT32)MassPara.cbw.cbwcb.buf1[5];
 679   1          Locate_Addr = Locate_Addr * DISK_SEC_LEN;       // ÂÜôÊï∞ÊçÆÂú∞ÂùÄ
 680   1          if (Locate_Addr<(UINT32)(5000000UL))
 681   1          {
 682   2            num = MassPara.cbw.cbwcb.buf1[8];               // ÂæÖÂÜôÊâáÂå∫Êï∞
 683   2            for(i = 0; i < num; i++)
 684   2                EraseFlash(Locate_Addr + i * DISK_SEC_LEN); // Êì¶Èô§ÊâáÂå∫
 685   2          }
 686   1          BcswStatus = 0;
 687   1          mSenseKey = 0;
 688   1          mASC = 0;
 689   1      }
 690          
 691          // ËØ∑Ê±ÇË£ÖËΩΩÂç∏ËΩΩËÆæÂ§á
 692          void  UFI_staStoUnit(void)
 693          {
 694   1          CH375BULKDOWN = 0;
 695   1          CH375BULKUP = 0;
 696   1          BcswStatus = 0;
 697   1          mSenseKey = 0;
 698   1          mASC = 0;
 699   1      }
 700          
 701          // Ê†°È™åÂ≠òÂÇ®Âô®Á©∫Èó¥
 702          void  UFI_verify(void)
 703          {
 704   1          BcswStatus = 0;
 705   1          mSenseKey = 0;
 706   1          mASC = 0;
 707   1          // ËøôÈáåËøôÈáåÂè™ÊòØ‰Ωú‰∏∫ÊºîÁ§∫ÊâÄ‰ª•Ê≤°ÊúâÁúüÊ≠£Ê£ÄÊµãÁâ©ÁêÜÂ≠òÂÇ®Âô®
 708   1          // ‰ΩÜÂÆûÈôÖ‰∏äËøô‰∏ÄÊ≠•‰∏ÄÂÆöË¶ÅÂ§ÑÁêÜ
 709   1      }
 710          
 711          void  UFI_modeSense5(void)
 712          {
 713   1          if(MassPara.cbw.cbwcb.buf1[2] == 0x3F)
 714   1          {
 715   2              if(LEN.mDataLength > sizeof(mode5sense3F))
 716   2                  LEN.mDataLength = sizeof(mode5sense3F);
 717   2              pBuf = mode5sense3F;
 718   2              BcswStatus = 0;
 719   2              mSenseKey = 0;
 720   2              mASC = 0;
 721   2          }
 722   1          else
 723   1          {
 724   2              CH375BULKUP = 0;
 725   2              mSenseKey = 5;
 726   2              mASC = 0x20;
 727   2              BcswStatus = 1;
 728   2              BulkThirteen(CASECMDFAIL);
 729   2          }
 730   1      }
 731          
 732          void  UFI_readTOC(void)
 733          {
 734   1          UINT8C  TOC[] = {
 735   1            0x00,0x12,0x01,0x01,0x00,0x14,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
 736   1            0x14,0xAA,0x00,0x00,0x00,0x0c,0x6c
 737   1          };
 738   1          pBuf = TOC;
 739   1          if(LEN.mDataLength > sizeof(TOC))
 740   1              LEN.mDataLength = sizeof(TOC);
 741   1          BcswStatus  = 0;
 742   1          mSenseKey   = 0;
 743   1          mASC        = 0;
 744   1      }
 745          
 746          void  UFI_GET_EVE_STA_NOT(void)
 747          {
 748   1          UINT8C  TOC[] = {
 749   1                  0x06,
 750   1                  0x01,
 751   1                  0x00,
 752   1                  0x5E,
 753   1                  0x00,
 754   1                  0x00,
 755   1                  0x00,
 756   1                  0x00
 757   1                  };
 758   1          pBuf = TOC;
 759   1          if(LEN.mDataLength > sizeof(TOC))
 760   1              LEN.mDataLength = sizeof(TOC);
 761   1          BcswStatus  = 0;
 762   1          mSenseKey   = 0;
 763   1          mASC        = 0;
 764   1      }
 765          
 766          // UFI CMD
 767          void UFI_Hunding(void)
 768          {
 769   1          switch(MassPara.cbw.cbwcb.buf1[0])
 770   1          {
 771   2              case INQUIRY:
 772   2                  UFI_inquiry();
 773   2                  break;
 774   2              case WRITE:
 775   2                  UFI_write();
 776   2                  break;
 777   2              case TES_UNIT:
 778   2                  UFI_testUnit();
 779   2                  break;
 780   2              case READ:
 781   2                  UFI_read10();
 782   2                  break;
 783   2              case REQUEST_SENSE:
 784   2                  UFI_requestSense();
 785   2                  break;
 786   2              case READ_CAPACITY:
 787   2                  UFI_readCapacity();
 788   2                  break;
 789   2              case VERIFY:
 790   2                  UFI_verify();
 791   2                  break;
 792   2              case FORMATCAP:
 793   2      //            pBuf = DBFORMATCAP;
 794   2      //            if(LEN.mDataLength > sizeof(DBFORMATCAP)) 
 795   2      //                LEN.mDataLength = sizeof(DBFORMATCAP);    
 796   2                  BcswStatus=0;
 797   2                  mSenseKey=0;
 798   2                  mASC=0;     
 799   2                  break;
 800   2      //      case MODE_SELECT:
 801   2      //          UFI_modeSlect();
 802   2      //          break;
 803   2              case MODE_SENSE:
 804   2                  UFI_modeSense();
 805   2                  break;
 806   2              case MODE_SENSE5:
 807   2                  UFI_modeSense5();
 808   2                  break;
 809   2      //      case WRITE_BUFFER:
 810   2      //          UFI_writeBuf();
 811   2      //          break;
 812   2      //      case PREVENT:
 813   2      //          break;
 814   2      //      case FORMAT_UNIT:
 815   2      //          UFI_format();
 816   2      //          break;
 817   2      //      case RELEASE:
 818   2      //          break;
 819   2              case STA_STO_UNIT:
 820   2                  UFI_staStoUnit();
 821   2                  ExecBadUSB=1;
 822   2                  break;
 823   2              case PRE_OR_MED:
 824   2                  UFI_perOrMed();
 825   2                  break;
 826   2              case READTOC:
 827   2                  UFI_readTOC();
 828   2                  break;
 829   2              case GET_EVE_STA_NOT:
 830   2                  UFI_GET_EVE_STA_NOT();
 831   2                  break;
 832   2              default:
 833   2                  mSenseKey = 5;
 834   2                  mASC = 0x20;
 835   2                  BcswStatus = 1;
 836   2                  CH375BULKUP = 0;
 837   2                  BulkThirteen(CASECBW);
 838   2                  break;
 839   2          }
 840   1      }
 841          
 842          void mCH375BulkOnly()
 843          {
 844   1          if(MassPara.buf[0] == 0x55)
 845   1          {
 846   2              if(MassPara.buf[1] == 0x53)
 847   2              {
 848   3                  if(MassPara.buf[2] == 0x42)
 849   3                  {
 850   4                      if(MassPara.buf[3] == 0x43)
 851   4                      {
 852   5      //                  LEN.mDataLength = BIG_ENDIAN(MassPara.cbw.dCBWDatL);            // ÂÅöBOÂçèËÆÆÂ§ÑÁêÜ
 853   5                          LEN.mdataLen[3] = *(unsigned char *)(&MassPara.cbw.dCBWDatL);   /* Â∞ÜPCÊú∫ÁöÑ‰ΩéÂ≠óËäÇÂú®ÂâçÁöÑ16
             -‰ΩçÂ≠óÊï∞ÊçÆËΩ¨Êç¢‰∏∫C51ÁöÑÈ´òÂ≠óËäÇÂú®ÂâçÁöÑÊï∞ÊçÆ */
 854   5                          LEN.mdataLen[2] = *((unsigned char *)(&MassPara.cbw.dCBWDatL) + 1);
 855   5                          LEN.mdataLen[1] = *((unsigned char *)(&MassPara.cbw.dCBWDatL) + 2);
 856   5                          LEN.mdataLen[0] = *((unsigned char *)(&MassPara.cbw.dCBWDatL) + 3);
 857   5                          mdCBWTag[0] = MassPara.buf[4];
 858   5                          mdCBWTag[1] = MassPara.buf[5];
 859   5                          mdCBWTag[2] = MassPara.buf[6];
 860   5                          mdCBWTag[3] = MassPara.buf[7];             
 861   5                                            // ÂèñÂá∫Êï∞ÊçÆÈïøÂ∫¶
 862   5                          if(LEN.mDataLength)
 863   5                          {
 864   6                              CH375BULKDOWN   = (MassPara.cbw.bmCBWFlags & 0x80) ? 0 : 1; // ‰∏ã‰º†Êï∞ÊçÆ(OUT)
 865   6                              CH375BULKUP     = (MassPara.cbw.bmCBWFlags & 0x80) ? 1 : 0; // ‰∏ä‰º†Êï∞ÊçÆ(IN)
 866   6                          }
 867   5                          CH375CSW = 1;
 868   5                          UFI_Hunding();  // Ë∞ÉÁî®UFIÂçèËÆÆÂ§ÑÁêÜ
 869   5                      }
 870   4                      else
 871   4                          UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
 872   4                  }
 873   3                  else
 874   3                      UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
 875   3              }
 876   2              else
 877   2                  UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
 878   2          }
 879   1          else
 880   1              UEP1_CTRL = UEP1_CTRL | MASK_UEP_T_RES ;
 881   1      }
 882          
 883          // ‰∏ä‰º†CSW
 884          void mCH375UpCsw()
 885          {
 886   1          unsigned char i;
 887   1          
 888   1          pBuf = &MassPara.buf[0];
 889   1          CH375CSW = 0;
 890   1          CH375BULKUP = 0;            // ÂèñÊ∂àÊï∞ÊçÆ‰∏ä‰º†
 891   1          MassPara.buf[0] = 0x55;     // dCSWSignature
 892   1          MassPara.buf[1] = 0x53;
 893   1          MassPara.buf[2] = 0x42;
 894   1          MassPara.buf[3] = 0x53;
 895   1          MassPara.buf[4] = mdCBWTag[0];
 896   1          MassPara.buf[5] = mdCBWTag[1];
 897   1          MassPara.buf[6] = mdCBWTag[2];
 898   1          MassPara.buf[7] = mdCBWTag[3];
 899   1          MassPara.buf[8] = 0;
 900   1          MassPara.buf[9] = 0;
 901   1          MassPara.buf[10] = LEN.mdataLen[1];
 902   1          MassPara.buf[11] = LEN.mdataLen[0];
 903   1          MassPara.buf[12] = BcswStatus;
 904   1          for(i = 0; i < 13; i++)
 905   1          {
 906   2              Ep1Buffer[MAX_PACKET_SIZE + i] = *pBuf;
 907   2              pBuf++;
 908   2          }
 909   1          UEP1_T_LEN = 13;
 910   1          UEP1_CTRL = UEP1_CTRL & ~ MASK_UEP_T_RES | UEP_T_RES_ACK;  // ÂÖÅËÆ∏‰∏ä‰º†
 911   1      }
 912          
 913          
 914          // Á´ØÁÇπ1‰∏ä‰º†Êï∞ÊçÆ(IN)
 915          void mCH375bulkUpData()
 916          {
 917   1          unsigned char len, i;
 918   1          if(LEN.mDataLength > 0x40)
 919   1          {
 920   2              len = 0x40;
 921   2              LEN.mDataLength -= 0x40;
 922   2          }
 923   1          else
 924   1          {
 925   2              len = (unsigned char) LEN.mDataLength;
 926   2              LEN.mDataLength = 0;
 927   2              CH375BULKUP = 0;
 928   2          }
 929   1          if(pBuf_ReSelect)
 930   1          {
 931   2              BulkReadFlash(Locate_Addr, len, &Ep1Buffer[MAX_PACKET_SIZE]);
 932   2              Locate_Addr += len;
 933   2              if(LEN.mDataLength == 0)
 934   2                  pBuf_ReSelect = 0;
 935   2          }
 936   1          else
 937   1          {
 938   2              for(i = 0; i < len; i++)
 939   2              {
 940   3                  Ep1Buffer[MAX_PACKET_SIZE + i] = *pBuf;
 941   3                  pBuf++;
 942   3              }
 943   2          }
 944   1          UEP1_T_LEN = len;
 945   1          UEP1_CTRL = UEP1_CTRL & ~ MASK_UEP_T_RES | UEP_T_RES_ACK;  // ÂÖÅËÆ∏‰∏ä‰º†
 946   1      }
 947          
 948          UINT8I buffer[64];
 949          // Á´ØÁÇπ1‰∏ã‰º†Êï∞ÊçÆ(OUT)
 950          void mCH375BulkDownData()
 951          {
 952   1          unsigned char len, i;
 953   1      
 954   1          len = USB_RX_LEN;
 955   1          for(i = 0; i != len; i++)
 956   1              buffer[i] = Ep1Buffer[i];   // Â∞ÜÊï∞ÊçÆËØªÂÖ•Âà∞ÁºìÂÜ≤Âå∫
 957   1          BulkWriteFlash(Locate_Addr, len, &buffer[0]);
 958   1          Locate_Addr += len;
 959   1          LEN.mDataLength -= len;         // ÂÖ®Â±ÄÊï∞ÊçÆÈïøÂ∫¶ÂáèÊéâÂΩìÂâçËé∑ÂæóÁöÑÈïøÂ∫¶
 960   1          if(LEN.mDataLength == 0)        // Â¶ÇÊûúÊï∞ÊçÆ‰∏∫0, Âàô‰º†ÈÄÅCSW
 961   1          {
 962   2              CH375BULKDOWN = 0;          // ‰∏ã‰º†ÂÆåÊàê
 963   2              mCH375UpCsw();              // ‰∏ä‰º†CSW
 964   2          }
 965   1      }
 966          
 967          /*******************************************************************************
 968          * Function Name  : USB_DeviceInterrupt()
 969          * Description    : CH554 USBÊ®°ÊãüËÆæÁΩÆ‰∏≠Êñ≠Â§ÑÁêÜÂáΩÊï∞
 970          *******************************************************************************/
 971          void    USB_DeviceInterrupt(void) interrupt INT_NO_USB using 1                  // USB‰∏≠Êñ≠ÊúçÂä°Á®ãÂ∫è, ‰ΩøÁî®ÂØÑÂ≠ò
             -Âô®ÁªÑ1
 972          {
 973   1          UINT8   len, i;
 974   1          static  UINT8   SetupReqCode, SetupLen;
 975   1          static  PUINT8  pDescr;
 976   1      
 977   1          if(UIF_TRANSFER)                                                            // USB‰º†ËæìÂÆåÊàê
 978   1          {
 979   2              switch(USB_INT_ST & (MASK_UIS_TOKEN | MASK_UIS_ENDP))                   // ÂàÜÊûêÊìç‰Ωú‰ª§ÁâåÂíåÁ´ØÁÇπÂè∑
 980   2              {
 981   3                  case UIS_TOKEN_IN | 1:                                              // endpoint 1# Á´ØÁÇπ‰∏ä‰º†
 982   3                  {
 983   4                      if(CH375BULKUP) mCH375bulkUpData();                             // Ë∞ÉÁî®Êï∞ÊçÆ‰∏ä‰º†
 984   4                      else if(CH375CSW) mCH375UpCsw();                                // ‰∏ä‰º†CSW
 985   4                      else
 986   4                          UEP1_CTRL = UEP1_CTRL & ~ MASK_UEP_T_RES | UEP_T_RES_NAK;   // ÊöÇÂÅú‰∏ä‰º†
 987   4                      break;
 988   4                  }
 989   3                  case UIS_TOKEN_OUT | 1:                                             // endpoint 1# Á´ØÁÇπ‰∏ã‰º†
 990   3                  {
 991   4                      if(U_TOG_OK)                                                    // ‰∏çÂêåÊ≠•ÁöÑÊï∞ÊçÆÂåÖÂ∞Ü‰∏¢ÂºÉ
 992   4                      {
 993   5                          if(CH375BULKDOWN)  mCH375BulkDownData();                    // Â¶ÇÊûú‰∏ä‰º†Êï∞ÊçÆÈò∂ÊÆµÂàôË∞ÉÁî®Êï
             -∞ÊçÆ‰∏ä‰º†
 994   5                          else                                                        // ‰∏çÊòØÊï∞ÊçÆ‰∏ã‰º†ÂàôÂà§Êñ≠ÊòØÂê¶
 995   5                          {
 996   6                              len = USB_RX_LEN;
 997   6                              if(!len)break;                                          // Êï∞ÊçÆÂåÖÈïøÂ∫¶‰∏∫Èõ∂ÂàôË∑≥Âá∫
 998   6                              for(i = 0; i != len; i++)
 999   6                                  MassPara.buf[i] = Ep1Buffer[i];                     // Â∞ÜÊï∞ÊçÆËØªÂÖ•Âà∞ÁºìÂÜ≤Âå∫
1000   6                              mCH375BulkOnly();
1001   6                              if(!CH375BULKDOWN)
1002   6                              {
1003   7                                  if(CH375BULKUP) mCH375bulkUpData();                 // Ë∞ÉÁî®ÊâπÈáèÊï∞ÊçÆ‰∏ä‰º†
1004   7                                  else if(!FSTALL) mCH375UpCsw();                     // Ê≤°ÊúâÊï∞ÊçÆ‰∏ä‰º†Ë∞ÉÁî®CSW‰∏ä‰º†
1005   7                                  // Âú®ËøôÈáåÂÅö‰∏ä‰º†Êï∞ÊçÆË∞ÉÁî®
1006   7                              }
1007   6                          }
1008   5                      }
1009   4                      break;
1010   4                  }
1011   3                  case UIS_TOKEN_IN | 2:                                              // endpoint 2# Á´ØÁÇπ‰∏ä‰º†
1012   3                  {
1013   4                      UEP2_T_LEN = 0;
1014   4                      UEP2_CTRL = UEP2_CTRL & ~ MASK_UEP_T_RES | UEP_T_RES_NAK;   
1015   4                      IsHIDDataSent = 1;   
1016   4                      break;
1017   4                  }
1018   3                  case UIS_TOKEN_SETUP | 0:                                           // endpoint 0# SETUP
1019   3                  {
1020   4                      len = USB_RX_LEN;
1021   4                      if(len == sizeof(USB_SETUP_REQ))                                // SETUPÂåÖÈïøÂ∫¶
1022   4                      {
1023   5                          SetupLen = UsbSetupBuf->wLengthL;
1024   5                          if(UsbSetupBuf->wLengthH || SetupLen > 0x7F)
1025   5                          {
1026   6                              SetupLen = 0x7F;                                        // ÈôêÂà∂ÊÄªÈïøÂ∫¶
1027   6                          }
1028   5                          len = 0;                                                    // ÈªòËÆ§‰∏∫ÊàêÂäüÂπ∂‰∏î‰∏ä‰º†0ÈïøÂ∫¶
1029   5                          if((UsbSetupBuf->bRequestType & USB_REQ_TYP_MASK) != USB_REQ_TYP_STANDARD)  // Á±ªËØ∑Ê±Ç
1030   5                          {
1031   6                              SetupReqCode = UsbSetupBuf->bRequest;
1032   6                              if(SetupReqCode == 0xFE)                                // GET MAX LUN
1033   6                              {
1034   7                                  pDescr = (PUINT8)(&MAX_LUN[0]);
1035   7                                  len = 1;
1036   7                                  if(SetupLen > len)
1037   7                                  {
1038   8                                      SetupLen = len;                                 // ÈôêÂà∂ÊÄªÈïøÂ∫¶
1039   8                                  }
1040   7                                  len = SetupLen >= THIS_ENDP0_SIZE ? THIS_ENDP0_SIZE : SetupLen;  // Êú¨Ê¨°‰º†ËæìÈïøÂ∫¶
1041   7                                  memcpy(Ep0Buffer, pDescr, len);                     // Âä†ËΩΩ‰∏ä‰º†Êï∞ÊçÆ
1042   7                                  SetupLen -= len;
1043   7                                  pDescr += len;
1044   7                                  USBReady = 1;
1045   7                              }
1046   6                          }
1047   5                          else                                                        // Ê†áÂáÜËØ∑Ê±Ç
1048   5                          {
1049   6                              SetupReqCode = UsbSetupBuf->bRequest;
1050   6                              switch(SetupReqCode)                                    // ËØ∑Ê±ÇÁ†Å
1051   6                              {
1052   7                                  case USB_GET_DESCRIPTOR:
1053   7                                      switch(UsbSetupBuf->wValueH)
1054   7                                      {
1055   8                                          case USB_DESCR_TYP_DEVICE:                  // ËÆæÂ§áÊèèËø∞Á¨¶
1056   8                                              pDescr = MyDevDescr;
1057   8                                              len = sizeof(MyDevDescr);
1058   8                                              break;
1059   8                                          case USB_DESCR_TYP_CONFIG:                  // ÈÖçÁΩÆÊèèËø∞Á¨¶
1060   8                                              pDescr = MyCfgDescr;
1061   8                                              len = sizeof(MyCfgDescr);
1062   8                                              break;
1063   8                                          case USB_DESCR_TYP_STRING:                  // Â≠óÁ¨¶‰∏≤ÊèèËø∞Á¨¶
1064   8                                              switch(UsbSetupBuf->wValueL)
1065   8                                              {
1066   9                                                  case 0:
1067   9                                                      pDescr = MyLangDescr;
1068   9                                                      len = sizeof(MyLangDescr);
1069   9                                                      break;
1070   9                                                  case 1:
1071   9                                                      pDescr = MyManuInfo;
1072   9                                                      len = sizeof(MyManuInfo);
1073   9                                                      break;
1074   9                                                  case 2:
1075   9                                                      pDescr = MyProdInfo;
1076   9                                                      len = sizeof(MyProdInfo);
1077   9                                                      break;
1078   9                                                  default:
1079   9                                                      len = 0xFF;                     // ‰∏çÊîØÊåÅÁöÑÂ≠óÁ¨¶‰∏≤ÊèèËø∞Á¨¶
1080   9                                                      break;
1081   9                                              }
1082   8                                              break;
1083   8                                          case USB_DESCR_TYP_REPORT:
1084   8                                              switch(UsbSetupBuf->wValueL)
1085   8                                              {
1086   9                                                  case 0:
1087   9                                                      pDescr = HIDReportDescriptor;   // HIDÊèèËø∞Á¨¶
1088   9                                                      len = sizeof(HIDReportDescriptor);
1089   9                                                      break;
1090   9                                                  default:
1091   9                                                      len = 0xFF;                     // ‰∏çÊîØÊåÅÁöÑÂ≠óÁ¨¶‰∏≤ÊèèËø∞Á¨¶
1092   9                                                      break;
1093   9                                              }
1094   8                                              break;
1095   8                                          default:
1096   8                                              len = 0xFF;                             // ‰∏çÊîØÊåÅÁöÑÊèèËø∞Á¨¶Á±ªÂûã
1097   8                                              break;
1098   8                                      }
1099   7                                      if(SetupLen > len)
1100   7                                      {
1101   8                                          SetupLen = len;                             // ÈôêÂà∂ÊÄªÈïøÂ∫¶
1102   8                                      }
1103   7                                      len = SetupLen >= THIS_ENDP0_SIZE ? THIS_ENDP0_SIZE : SetupLen; // Êú¨Ê¨°‰º†ËæìÈïøÂ∫¶
1104   7                                      memcpy(Ep0Buffer, pDescr, len);                 // Âä†ËΩΩ‰∏ä‰º†Êï∞ÊçÆ
1105   7                                      SetupLen -= len;
1106   7                                      pDescr += len;
1107   7                                      break;
1108   7                                  case USB_SET_ADDRESS:
1109   7                                      SetupLen = UsbSetupBuf->wValueL;                // ÊöÇÂ≠òUSBËÆæÂ§áÂú∞ÂùÄ
1110   7                                      break;
1111   7                                  case USB_GET_CONFIGURATION:
1112   7                                      Ep0Buffer[0] = UsbConfig;
1113   7                                      if(SetupLen >= 1)
1114   7                                      {
1115   8                                          len = 1;
1116   8                                      }
1117   7                                      break;
1118   7                                  case USB_SET_CONFIGURATION:
1119   7                                      UsbConfig = UsbSetupBuf->wValueL;
1120   7                                      printf("Config\n");
1121   7                                      break;
1122   7                                  case USB_CLEAR_FEATURE:
1123   7                                      if((UsbSetupBuf->bRequestType & USB_REQ_RECIP_MASK) == USB_REQ_RECIP_ENDP)  // Á´ØÁÇπ
1124   7                                      {
1125   8                                          switch(UsbSetupBuf->wIndexL)
1126   8                                          {
1127   9                                              case 0x82:
1128   9                                                  UEP2_CTRL = UEP2_CTRL & ~(bUEP_T_TOG | MASK_UEP_T_RES) | UEP_T_RES_NAK;
1129   9                                                  break;
1130   9                                              case 0x02:
1131   9                                                  UEP2_CTRL = UEP2_CTRL & ~(bUEP_R_TOG | MASK_UEP_R_RES) | UEP_R_RES_ACK;
1132   9                                                  break;
1133   9                                              case 0x81:
1134   9                                                  UEP1_CTRL = UEP1_CTRL & ~(bUEP_T_TOG | MASK_UEP_T_RES) | UEP_T_RES_NAK;
1135   9                                                  if(CH375CSW) mCH375UpCsw();
1136   9                                                  lastFSTALL = FSTALL;
1137   9                                                  FSTALL = 0;
1138   9                                                  break;
1139   9                                              case 0x01:
1140   9                                                  UEP1_CTRL = UEP1_CTRL & ~(bUEP_R_TOG | MASK_UEP_R_RES) | UEP_R_RES_ACK;
1141   9                                                  if(CH375CSW) mCH375UpCsw();
1142   9                                                  lastFSTALL = FSTALL;
1143   9                                                  FSTALL = 0;
1144   9                                                  break;
1145   9                                              default:
1146   9                                                  len = 0xFF;                         // ‰∏çÊîØÊåÅÁöÑÁ´ØÁÇπ
1147   9                                                  break;
1148   9                                          }
1149   8                                      }
1150   7                                      else
1151   7                                      {
1152   8                                          len = 0xFF;                                 // ‰∏çÊòØÁ´ØÁÇπ‰∏çÊîØÊåÅ
1153   8                                      }
1154   7                                      break;
1155   7                                  case USB_GET_INTERFACE:
1156   7                                      Ep0Buffer[0] = 0x00;
1157   7                                      if(SetupLen >= 1)
1158   7                                      {
1159   8                                          len = 1;
1160   8                                      }
1161   7                                      break;
1162   7                                  case USB_GET_STATUS:
1163   7                                      Ep0Buffer[0] = 0x00;
1164   7                                      Ep0Buffer[1] = 0x00;
1165   7                                      if(SetupLen >= 2)
1166   7                                      {
1167   8                                          len = 2;
1168   8                                      }
1169   7                                      else
1170   7                                      {
1171   8                                          len = SetupLen;
1172   8                                      }
1173   7                                      break;
1174   7                                  default:
1175   7                                      len = 0xFF;                                     // Êìç‰ΩúÂ§±Ë¥•
1176   7                                      break;
1177   7                              }
1178   6                          }
1179   5                      }
1180   4                      else
1181   4                      {
1182   5                          len = 0xFF;                                                 // SETUPÂåÖÈïøÂ∫¶ÈîôËØØ
1183   5                      }
1184   4                      
1185   4                      if(len == 0xFF)                                                 // Êìç‰ΩúÂ§±Ë¥•
1186   4                      {
1187   5                          SetupReqCode = 0xFF;
1188   5                          UEP0_CTRL = bUEP_R_TOG | bUEP_T_TOG | UEP_R_RES_STALL | UEP_T_RES_STALL;// STALL
1189   5                      }
1190   4                      else if(len <= THIS_ENDP0_SIZE)                                 // ‰∏ä‰º†Êï∞ÊçÆÊàñËÄÖÁä∂ÊÄÅÈò∂ÊÆµËøîÂõ
             -û0ÈïøÂ∫¶ÂåÖ
1191   4                      {
1192   5                          UEP0_T_LEN = len;
1193   5                          UEP0_CTRL = bUEP_R_TOG | bUEP_T_TOG | UEP_R_RES_ACK | UEP_T_RES_ACK;    // ÈªòËÆ§Êï∞ÊçÆÂåÖÊòØDATA1
1194   5                      }
1195   4                      else                                                            // ‰∏ã‰º†Êï∞ÊçÆÊàñÂÖ∂ÂÆÉ
1196   4                      {
1197   5                          UEP0_T_LEN = 0;                                             // ËôΩÁÑ∂Â∞öÊú™Âà∞Áä∂ÊÄÅÈò∂ÊÆµÔºå‰ΩÜÊò
             -ØÊèêÂâçÈ¢ÑÁΩÆ‰∏ä‰º†0ÈïøÂ∫¶Êï∞ÊçÆÂåÖ‰ª•Èò≤‰∏ªÊú∫ÊèêÂâçËøõÂÖ•Áä∂ÊÄÅÈò∂ÊÆµ
1198   5                          UEP0_CTRL = bUEP_R_TOG | bUEP_T_TOG | UEP_R_RES_ACK | UEP_T_RES_ACK;    // ÈªòËÆ§Êï∞ÊçÆÂåÖÊòØDATA1
1199   5                      }
1200   4                      break;
1201   4                  }
1202   3                  case UIS_TOKEN_IN | 0:                                              // endpoint 0# IN
1203   3                  {
1204   4                      switch(SetupReqCode)
1205   4                      {
1206   5                          case USB_GET_DESCRIPTOR:
1207   5                              len = SetupLen >= THIS_ENDP0_SIZE ? THIS_ENDP0_SIZE : SetupLen; // Êú¨Ê¨°‰º†ËæìÈïøÂ∫¶
1208   5                              memcpy(Ep0Buffer, pDescr, len);                         // Âä†ËΩΩ‰∏ä‰º†Êï∞ÊçÆ
1209   5                              SetupLen -= len;
1210   5                              pDescr += len;
1211   5                              UEP0_T_LEN = len;
1212   5                              UEP0_CTRL ^= bUEP_T_TOG;                                // ÁøªËΩ¨
1213   5                              break;
1214   5                          case USB_SET_ADDRESS:
1215   5                              USB_DEV_AD = USB_DEV_AD & bUDA_GP_BIT | SetupLen;
1216   5                              UEP0_CTRL = UEP_R_RES_ACK | UEP_T_RES_NAK;
1217   5                              break;
1218   5                          default:
1219   5                              UEP0_T_LEN = 0;                                         // Áä∂ÊÄÅÈò∂ÊÆµÂÆåÊàê‰∏≠Êñ≠ÊàñËÄÖÊòØÂº
             -∫Âà∂‰∏ä‰º†0ÈïøÂ∫¶Êï∞ÊçÆÂåÖÁªìÊùüÊéßÂà∂‰º†Ëæì
1220   5                              UEP0_CTRL = UEP_R_RES_ACK | UEP_T_RES_NAK;
1221   5                              break;
1222   5                      }
1223   4                      break;
1224   4                  }
1225   3                  case UIS_TOKEN_OUT | 0:                                             // endpoint 0# OUT
1226   3                  {
1227   4                      UEP0_T_LEN = 0;
1228   4                      UEP0_CTRL ^= bUEP_R_TOG;
1229   4                      break;
1230   4                  }
1231   3                  default:
1232   3                      break;
1233   3              }
1234   2              UIF_TRANSFER = 0;                                                       // Ê∏Ö‰∏≠Êñ≠Ê†áÂøó
1235   2          }
1236   1          else if(UIF_BUS_RST)                                                        // USBÊÄªÁ∫øÂ§ç‰Ωç
1237   1          {
1238   2              printf("Reset\n");
1239   2              UEP0_CTRL = UEP_R_RES_ACK | UEP_T_RES_NAK;
1240   2              UEP1_CTRL = bUEP_AUTO_TOG | UEP_R_RES_ACK | UEP_T_RES_NAK;
1241   2              UEP2_CTRL = bUEP_AUTO_TOG | UEP_R_RES_ACK | UEP_T_RES_NAK;
1242   2              USB_DEV_AD = 0x00;
1243   2              UIF_SUSPEND = 0;
1244   2              UIF_TRANSFER = 0;
1245   2              UIF_BUS_RST = 0;                                                        // Ê∏Ö‰∏≠Êñ≠Ê†áÂøó
1246   2              USBReady = 0;
1247   2          }
1248   1          else if(UIF_SUSPEND)                                                        // USBÊÄªÁ∫øÊåÇËµ∑/Âî§ÈÜíÂÆåÊàê
1249   1          {
1250   2              UIF_SUSPEND = 0;
1251   2              if(USB_MIS_ST & bUMS_SUSPEND)                                           // ÊåÇËµ∑
1252   2              {
1253   3                  printf("Suspend\n");                                                // Áù°Áú†Áä∂ÊÄÅ
1254   3              }
1255   2              else                                                                    // Âî§ÈÜí
1256   2              {
1257   3                  printf("Awake\n");
1258   3              }
1259   2          }
1260   1          else
1261   1          {
1262   2              // ÊÑèÂ§ñÁöÑ‰∏≠Êñ≠,‰∏çÂèØËÉΩÂèëÁîüÁöÑÊÉÖÂÜµ
1263   2              USB_INT_FG = 0xFF;                                                      // Ê∏Ö‰∏≠Êñ≠Ê†áÂøó
1264   2          }
1265   1      }
1266          
C51 COMPILER V9.60.0.0   USB                                                                           12/20/2023 01:45:44 PAGE 2   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION InitUSB (BEGIN)
                                           ; SOURCE LINE # 246
                                           ; SOURCE LINE # 247
                                           ; SOURCE LINE # 248
0000 E4                CLR     A
0001 F5E2              MOV     USB_CTRL,A
                                           ; SOURCE LINE # 249
0003 53E27F            ANL     USB_CTRL,#07FH
                                           ; SOURCE LINE # 250
0006 43E229            ORL     USB_CTRL,#029H
                                           ; SOURCE LINE # 251
0009 F5E3              MOV     USB_DEV_AD,A
                                           ; SOURCE LINE # 252
000B 53E2BF            ANL     USB_CTRL,#0BFH
                                           ; SOURCE LINE # 253
000E 53D1FB            ANL     UDEV_CTRL,#0FBH
                                           ; SOURCE LINE # 254
0011 75D180            MOV     UDEV_CTRL,#080H
                                           ; SOURCE LINE # 255
0014 43D101            ORL     UDEV_CTRL,#01H
                                           ; SOURCE LINE # 257
0017 CE                XCH     A,R6
0018 7400        R     MOV     A,#HIGH Ep1Buffer
001A CE                XCH     A,R6
001B CF                XCH     A,R7
001C 7400        R     MOV     A,#LOW Ep1Buffer
001E CF                XCH     A,R7
001F 8EEF              MOV     UEP1_DMA+01H,R6
0021 8FEE              MOV     UEP1_DMA,R7
                                           ; SOURCE LINE # 258
0023 75EAC0            MOV     UEP4_1_MOD,#0C0H
                                           ; SOURCE LINE # 259
0026 75D212            MOV     UEP1_CTRL,#012H
                                           ; SOURCE LINE # 260
0029 CE                XCH     A,R6
002A 7400        R     MOV     A,#HIGH Ep0Buffer
002C CE                XCH     A,R6
002D CF                XCH     A,R7
002E 7400        R     MOV     A,#LOW Ep0Buffer
0030 CF                XCH     A,R7
0031 8EED              MOV     UEP0_DMA+01H,R6
0033 8FEC              MOV     UEP0_DMA,R7
                                           ; SOURCE LINE # 261
0035 75DC02            MOV     UEP0_CTRL,#02H
                                           ; SOURCE LINE # 262
0038 F5DD              MOV     UEP0_T_LEN,A
                                           ; SOURCE LINE # 263
003A F5D3              MOV     UEP1_T_LEN,A
                                           ; SOURCE LINE # 264
003C CE                XCH     A,R6
003D 7400        R     MOV     A,#HIGH Ep2Buffer
003F CE                XCH     A,R6
0040 CF                XCH     A,R7
0041 7400        R     MOV     A,#LOW Ep2Buffer
0043 CF                XCH     A,R7
0044 8EE5              MOV     UEP2_DMA+01H,R6
0046 8FE4              MOV     UEP2_DMA,R7
                                           ; SOURCE LINE # 265
0048 75EB04            MOV     UEP2_3_MOD,#04H
                                           ; SOURCE LINE # 266
004B 75D412            MOV     UEP2_CTRL,#012H
                                           ; SOURCE LINE # 267
004E F5D5              MOV     UEP2_T_LEN,A
                                           ; SOURCE LINE # 270
0050 43E104            ORL     USB_INT_EN,#04H
                                           ; SOURCE LINE # 271
0053 43E102            ORL     USB_INT_EN,#02H
                                           ; SOURCE LINE # 272
0056 43E101            ORL     USB_INT_EN,#01H
                                           ; SOURCE LINE # 273
0059 43D81F            ORL     USB_INT_FG,#01FH
                                           ; SOURCE LINE # 274
005C D2EA              SETB    IE_USB
                                           ; SOURCE LINE # 275
005E D2AF              SETB    EA
                                           ; SOURCE LINE # 276
0060 22                RET     
             ; FUNCTION InitUSB (END)

             ; FUNCTION HIDSendData (BEGIN)
                                           ; SOURCE LINE # 286
                                           ; SOURCE LINE # 287
                                           ; SOURCE LINE # 288
0000 C8                XCH     A,R0
0001 7400        R     MOV     A,#LOW Ep2Buffer
0003 C8                XCH     A,R0
0004 CC                XCH     A,R4
0005 7400        R     MOV     A,#HIGH Ep2Buffer
0007 CC                XCH     A,R4
0008 CD                XCH     A,R5
0009 7401              MOV     A,#01H
000B CD                XCH     A,R5
000C 7B01              MOV     R3,#01H
000E 7A00        R     MOV     R2,#HIGH HIDData
0010 7900        R     MOV     R1,#LOW HIDData
0012 7E00              MOV     R6,#00H
0014 7F08              MOV     R7,#08H
0016 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 289
0019 75D508            MOV     UEP2_T_LEN,#08H
                                           ; SOURCE LINE # 290
001C 53D4FC            ANL     UEP2_CTRL,#0FCH
                                           ; SOURCE LINE # 291
001F 22                RET     
             ; FUNCTION HIDSendData (END)

             ; FUNCTION _SendKey (BEGIN)
                                           ; SOURCE LINE # 302
;---- Variable 'Key' assigned to Register 'R5' ----
;---- Variable 'FunctionKey' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 303
                                           ; SOURCE LINE # 304
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#IsHIDDataSent
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 305
0005 900000      R     MOV     DPTR,#HIDData
0008 EF                MOV     A,R7
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 306
000A CF                XCH     A,R7
000B ED                MOV     A,R5
000C CF                XCH     A,R7
000D 900000      R     MOV     DPTR,#HIDData+02H
0010 EF                MOV     A,R7
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 307
0012 120000      R     LCALL   HIDSendData
0015         ?C0003:
                                           ; SOURCE LINE # 308
0015 900000      R     MOV     DPTR,#IsHIDDataSent
0018 E0                MOVX    A,@DPTR
0019 60FA              JZ      ?C0003
                                           ; SOURCE LINE # 309
001B 7F05              MOV     R7,#05H
001D 7E00              MOV     R6,#00H
001F 120000      E     LCALL   _mDelaymS
                                           ; SOURCE LINE # 311
0022 E4                CLR     A
0023 900000      R     MOV     DPTR,#IsHIDDataSent
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 312
0027 900000      R     MOV     DPTR,#HIDData
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 313
002B 900000      R     MOV     DPTR,#HIDData+02H
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 314
002F 120000      R     LCALL   HIDSendData
0032         ?C0005:
                                           ; SOURCE LINE # 315
0032 900000      R     MOV     DPTR,#IsHIDDataSent
0035 E0                MOVX    A,@DPTR
0036 60FA              JZ      ?C0005
                                           ; SOURCE LINE # 316
0038 7F05              MOV     R7,#05H
003A 7E00              MOV     R6,#00H
003C 020000      E     LJMP    _mDelaymS
             ; FUNCTION _SendKey (END)

             ; FUNCTION _SendChar (BEGIN)
                                           ; SOURCE LINE # 326
0000 900000      R     MOV     DPTR,#c
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 327
                                           ; SOURCE LINE # 328
0005 C3                CLR     C
0006 9461              SUBB    A,#061H
0008 400C              JC      ?C0008
000A E0                MOVX    A,@DPTR
000B FF                MOV     R7,A
000C D3                SETB    C
000D 947A              SUBB    A,#07AH
000F 5005              JNC     ?C0008
                                           ; SOURCE LINE # 329
0011 EF                MOV     A,R7
0012 24A3              ADD     A,#0A3H
                                           ; SOURCE LINE # 330
0014 802A              SJMP    ?C0250
0016         ?C0008:
0016 900000      R     MOV     DPTR,#c
0019 E0                MOVX    A,@DPTR
001A FF                MOV     R7,A
001B C3                CLR     C
001C 9441              SUBB    A,#041H
001E 400D              JC      ?C0010
0020 EF                MOV     A,R7
0021 D3                SETB    C
0022 945A              SUBB    A,#05AH
0024 5007              JNC     ?C0010
                                           ; SOURCE LINE # 331
0026 E0                MOVX    A,@DPTR
0027 24C3              ADD     A,#0C3H
0029 FD                MOV     R5,A
                                           ; SOURCE LINE # 332
002A 020000      R     LJMP    ?C0284
002D         ?C0010:
002D 900000      R     MOV     DPTR,#c
0030 E0                MOVX    A,@DPTR
0031 FF                MOV     R7,A
0032 C3                CLR     C
0033 9431              SUBB    A,#031H
0035 400D              JC      ?C0012
0037 EF                MOV     A,R7
0038 D3                SETB    C
0039 9439              SUBB    A,#039H
003B 5007              JNC     ?C0012
                                           ; SOURCE LINE # 333
003D E0                MOVX    A,@DPTR
003E 24ED              ADD     A,#0EDH
0040         ?C0250:
0040 FD                MOV     R5,A
                                           ; SOURCE LINE # 334
0041 020000      R     LJMP    ?C0285
0044         ?C0012:
                                           ; SOURCE LINE # 335
0044 900000      R     MOV     DPTR,#c
0047 E0                MOVX    A,@DPTR
0048 120000      E     LCALL   ?C?CCASE
004B 0000        R     DW      ?C0049
004D 09                DB      09H
004E 0000        R     DW      ?C0050
0050 0A                DB      0AH
0051 0000        R     DW      ?C0016
0053 20                DB      020H
0054 0000        R     DW      ?C0017
0056 21                DB      021H
0057 0000        R     DW      ?C0042
0059 22                DB      022H
005A 0000        R     DW      ?C0019
005C 23                DB      023H
005D 0000        R     DW      ?C0020
005F 24                DB      024H
0060 0000        R     DW      ?C0021
0062 25                DB      025H
0063 0000        R     DW      ?C0023
0065 26                DB      026H
0066 0000        R     DW      ?C0041
0068 27                DB      027H
0069 0000        R     DW      ?C0025
006B 28                DB      028H
006C 0000        R     DW      ?C0026
006E 29                DB      029H
006F 0000        R     DW      ?C0024
0071 2A                DB      02AH
0072 0000        R     DW      ?C0030
0074 2B                DB      02BH
0075 0000        R     DW      ?C0043
0077 2C                DB      02CH
0078 0000        R     DW      ?C0027
007A 2D                DB      02DH
007B 0000        R     DW      ?C0045
007D 2E                DB      02EH
007E 0000        R     DW      ?C0047
0080 2F                DB      02FH
0081 0000        R     DW      ?C0015
0083 30                DB      030H
0084 0000        R     DW      ?C0038
0086 3A                DB      03AH
0087 0000        R     DW      ?C0037
0089 3B                DB      03BH
008A 0000        R     DW      ?C0044
008C 3C                DB      03CH
008D 0000        R     DW      ?C0029
008F 3D                DB      03DH
0090 0000        R     DW      ?C0046
0092 3E                DB      03EH
0093 0000        R     DW      ?C0048
0095 3F                DB      03FH
0096 0000        R     DW      ?C0018
0098 40                DB      040H
0099 0000        R     DW      ?C0031
009B 5B                DB      05BH
009C 0000        R     DW      ?C0035
009E 5C                DB      05CH
009F 0000        R     DW      ?C0033
00A1 5D                DB      05DH
00A2 0000        R     DW      ?C0022
00A4 5E                DB      05EH
00A5 0000        R     DW      ?C0028
00A7 5F                DB      05FH
00A8 0000        R     DW      ?C0039
00AA 60                DB      060H
00AB 0000        R     DW      ?C0032
00AD 7B                DB      07BH
00AE 0000        R     DW      ?C0036
00B0 7C                DB      07CH
00B1 0000        R     DW      ?C0034
00B3 7D                DB      07DH
00B4 0000        R     DW      ?C0040
00B6 7E                DB      07EH
00B7 0000              DW      00H
00B9 0000        R     DW      ?C0051
                                           ; SOURCE LINE # 336
00BB         ?C0015:
                                           ; SOURCE LINE # 337
00BB 7D27              MOV     R5,#027H
00BD         ?C0252:
                                           ; SOURCE LINE # 338
00BD 020000      R     LJMP    ?C0285
                                           ; SOURCE LINE # 339
00C0         ?C0016:
                                           ; SOURCE LINE # 340
00C0 7D2C              MOV     R5,#02CH
00C2         ?C0253:
                                           ; SOURCE LINE # 341
00C2 020000      R     LJMP    ?C0285
                                           ; SOURCE LINE # 342
00C5         ?C0017:
                                           ; SOURCE LINE # 343
00C5 7D1E              MOV     R5,#01EH
00C7         ?C0251:
                                           ; SOURCE LINE # 344
00C7 807A              SJMP    ?C0284
                                           ; SOURCE LINE # 345
00C9         ?C0018:
                                           ; SOURCE LINE # 346
00C9 7D1F              MOV     R5,#01FH
00CB         ?C0255:
                                           ; SOURCE LINE # 347
00CB 8076              SJMP    ?C0284
                                           ; SOURCE LINE # 348
00CD         ?C0019:
                                           ; SOURCE LINE # 349
00CD 7D20              MOV     R5,#020H
00CF         ?C0256:
                                           ; SOURCE LINE # 350
00CF 8072              SJMP    ?C0284
                                           ; SOURCE LINE # 351
00D1         ?C0020:
                                           ; SOURCE LINE # 352
00D1 7D21              MOV     R5,#021H
00D3         ?C0257:
                                           ; SOURCE LINE # 353
00D3 806E              SJMP    ?C0284
                                           ; SOURCE LINE # 354
00D5         ?C0021:
                                           ; SOURCE LINE # 355
00D5 7D22              MOV     R5,#022H
00D7         ?C0258:
                                           ; SOURCE LINE # 356
00D7 806A              SJMP    ?C0284
                                           ; SOURCE LINE # 357
00D9         ?C0022:
                                           ; SOURCE LINE # 358
00D9 7D23              MOV     R5,#023H
00DB         ?C0259:
                                           ; SOURCE LINE # 359
00DB 8066              SJMP    ?C0284
                                           ; SOURCE LINE # 360
00DD         ?C0023:
                                           ; SOURCE LINE # 361
00DD 7D24              MOV     R5,#024H
00DF         ?C0260:
                                           ; SOURCE LINE # 362
00DF 8062              SJMP    ?C0284
                                           ; SOURCE LINE # 363
00E1         ?C0024:
                                           ; SOURCE LINE # 364
00E1 7D25              MOV     R5,#025H
00E3         ?C0261:
                                           ; SOURCE LINE # 365
00E3 805E              SJMP    ?C0284
                                           ; SOURCE LINE # 366
00E5         ?C0025:
                                           ; SOURCE LINE # 367
00E5 7D26              MOV     R5,#026H
00E7         ?C0262:
                                           ; SOURCE LINE # 368
00E7 805A              SJMP    ?C0284
                                           ; SOURCE LINE # 369
00E9         ?C0026:
                                           ; SOURCE LINE # 370
00E9 7D27              MOV     R5,#027H
00EB         ?C0263:
                                           ; SOURCE LINE # 371
00EB 8056              SJMP    ?C0284
                                           ; SOURCE LINE # 372
00ED         ?C0027:
                                           ; SOURCE LINE # 373
00ED 7D2D              MOV     R5,#02DH
00EF         ?C0254:
                                           ; SOURCE LINE # 374
00EF 8058              SJMP    ?C0285
                                           ; SOURCE LINE # 375
00F1         ?C0028:
                                           ; SOURCE LINE # 376
00F1 7D2D              MOV     R5,#02DH
00F3         ?C0264:
                                           ; SOURCE LINE # 377
00F3 804E              SJMP    ?C0284
                                           ; SOURCE LINE # 378
00F5         ?C0029:
                                           ; SOURCE LINE # 379
00F5 7D2E              MOV     R5,#02EH
00F7         ?C0265:
                                           ; SOURCE LINE # 380
00F7 8050              SJMP    ?C0285
                                           ; SOURCE LINE # 381
00F9         ?C0030:
                                           ; SOURCE LINE # 382
00F9 7D2E              MOV     R5,#02EH
00FB         ?C0266:
                                           ; SOURCE LINE # 383
00FB 8046              SJMP    ?C0284
                                           ; SOURCE LINE # 384
00FD         ?C0031:
                                           ; SOURCE LINE # 385
00FD 7D2F              MOV     R5,#02FH
00FF         ?C0267:
                                           ; SOURCE LINE # 386
00FF 8048              SJMP    ?C0285
                                           ; SOURCE LINE # 387
0101         ?C0032:
                                           ; SOURCE LINE # 388
0101 7D2F              MOV     R5,#02FH
0103         ?C0268:
                                           ; SOURCE LINE # 389
0103 803E              SJMP    ?C0284
                                           ; SOURCE LINE # 390
0105         ?C0033:
                                           ; SOURCE LINE # 391
0105 7D30              MOV     R5,#030H
0107         ?C0269:
                                           ; SOURCE LINE # 392
0107 8040              SJMP    ?C0285
                                           ; SOURCE LINE # 393
0109         ?C0034:
                                           ; SOURCE LINE # 394
0109 7D30              MOV     R5,#030H
010B         ?C0270:
                                           ; SOURCE LINE # 395
010B 8036              SJMP    ?C0284
                                           ; SOURCE LINE # 396
010D         ?C0035:
                                           ; SOURCE LINE # 397
010D 7D31              MOV     R5,#031H
010F         ?C0271:
                                           ; SOURCE LINE # 398
010F 8038              SJMP    ?C0285
                                           ; SOURCE LINE # 399
0111         ?C0036:
                                           ; SOURCE LINE # 400
0111 7D31              MOV     R5,#031H
0113         ?C0272:
                                           ; SOURCE LINE # 401
0113 802E              SJMP    ?C0284
                                           ; SOURCE LINE # 402
0115         ?C0037:
                                           ; SOURCE LINE # 403
0115 7D33              MOV     R5,#033H
0117         ?C0273:
                                           ; SOURCE LINE # 404
0117 8030              SJMP    ?C0285
                                           ; SOURCE LINE # 405
0119         ?C0038:
                                           ; SOURCE LINE # 406
0119 7D33              MOV     R5,#033H
011B         ?C0274:
                                           ; SOURCE LINE # 407
011B 8026              SJMP    ?C0284
                                           ; SOURCE LINE # 408
011D         ?C0039:
                                           ; SOURCE LINE # 409
011D 7D32              MOV     R5,#032H
011F         ?C0275:
                                           ; SOURCE LINE # 410
011F 8028              SJMP    ?C0285
                                           ; SOURCE LINE # 411
0121         ?C0040:
                                           ; SOURCE LINE # 412
0121 7D32              MOV     R5,#032H
0123         ?C0276:
                                           ; SOURCE LINE # 413
0123 801E              SJMP    ?C0284
                                           ; SOURCE LINE # 414
0125         ?C0041:
                                           ; SOURCE LINE # 415
0125 7D34              MOV     R5,#034H
0127         ?C0277:
                                           ; SOURCE LINE # 416
0127 8020              SJMP    ?C0285
                                           ; SOURCE LINE # 417
0129         ?C0042:
                                           ; SOURCE LINE # 418
0129 7D34              MOV     R5,#034H
012B         ?C0278:
                                           ; SOURCE LINE # 419
012B 8016              SJMP    ?C0284
                                           ; SOURCE LINE # 420
012D         ?C0043:
                                           ; SOURCE LINE # 421
012D 7D36              MOV     R5,#036H
012F         ?C0279:
                                           ; SOURCE LINE # 422
012F 8018              SJMP    ?C0285
                                           ; SOURCE LINE # 423
0131         ?C0044:
                                           ; SOURCE LINE # 424
0131 7D36              MOV     R5,#036H
0133         ?C0280:
                                           ; SOURCE LINE # 425
0133 800E              SJMP    ?C0284
                                           ; SOURCE LINE # 426
0135         ?C0045:
                                           ; SOURCE LINE # 427
0135 7D37              MOV     R5,#037H
0137         ?C0281:
                                           ; SOURCE LINE # 428
0137 8010              SJMP    ?C0285
                                           ; SOURCE LINE # 429
0139         ?C0046:
                                           ; SOURCE LINE # 430
0139 7D37              MOV     R5,#037H
013B         ?C0282:
                                           ; SOURCE LINE # 431
013B 8006              SJMP    ?C0284
                                           ; SOURCE LINE # 432
013D         ?C0047:
                                           ; SOURCE LINE # 433
013D 7D38              MOV     R5,#038H
013F         ?C0283:
                                           ; SOURCE LINE # 434
013F 8008              SJMP    ?C0285
                                           ; SOURCE LINE # 435
0141         ?C0048:
                                           ; SOURCE LINE # 436
0141 7D38              MOV     R5,#038H
0143         ?C0284:
0143 7F02              MOV     R7,#02H
                                           ; SOURCE LINE # 437
0145 800A              SJMP    ?C0287
                                           ; SOURCE LINE # 438
0147         ?C0049:
                                           ; SOURCE LINE # 439
0147 7D2B              MOV     R5,#02BH
0149         ?C0285:
0149 E4                CLR     A
014A FF                MOV     R7,A
014B         ?C0286:
                                           ; SOURCE LINE # 440
014B 8004              SJMP    ?C0287
                                           ; SOURCE LINE # 441
014D         ?C0050:
                                           ; SOURCE LINE # 442
014D 7D28              MOV     R5,#028H
014F E4                CLR     A
0150 FF                MOV     R7,A
0151         ?C0287:
0151 120000      R     LCALL   _SendKey
                                           ; SOURCE LINE # 443
                                           ; SOURCE LINE # 444
                                           ; SOURCE LINE # 445
                                           ; SOURCE LINE # 446
0154         ?C0051:
0154 22                RET     
             ; FUNCTION _SendChar (END)

             ; FUNCTION _SendString (BEGIN)
                                           ; SOURCE LINE # 456
0000 900000      R     MOV     DPTR,#s
0003 EB                MOV     A,R3
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EA                MOV     A,R2
0007 F0                MOVX    @DPTR,A
0008 A3                INC     DPTR
0009 E9                MOV     A,R1
000A F0                MOVX    @DPTR,A
000B A3                INC     DPTR
000C ED                MOV     A,R5
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 458
000E E4                CLR     A
000F A3                INC     DPTR
0010 F0                MOVX    @DPTR,A
0011         ?C0052:
0011 900000      R     MOV     DPTR,#length
0014 E0                MOVX    A,@DPTR
0015 FF                MOV     R7,A
0016 A3                INC     DPTR
0017 E0                MOVX    A,@DPTR
0018 FE                MOV     R6,A
0019 C3                CLR     C
001A 9F                SUBB    A,R7
001B 501F              JNC     ?C0055
                                           ; SOURCE LINE # 459
001D 900000      R     MOV     DPTR,#s
0020 E0                MOVX    A,@DPTR
0021 FB                MOV     R3,A
0022 A3                INC     DPTR
0023 E0                MOVX    A,@DPTR
0024 FA                MOV     R2,A
0025 A3                INC     DPTR
0026 E0                MOVX    A,@DPTR
0027 F9                MOV     R1,A
0028 8E82              MOV     DPL,R6
002A 758300            MOV     DPH,#00H
002D 120000      E     LCALL   ?C?CLDOPTR
0030 FF                MOV     R7,A
0031 120000      R     LCALL   _SendChar
                                           ; SOURCE LINE # 460
0034 900000      R     MOV     DPTR,#i
0037 E0                MOVX    A,@DPTR
0038 04                INC     A
0039 F0                MOVX    @DPTR,A
003A 80D5              SJMP    ?C0052
                                           ; SOURCE LINE # 461
003C         ?C0055:
003C 22                RET     
             ; FUNCTION _SendString (END)

             ; FUNCTION L?0312 (BEGIN)
0000 C200        R     CLR     CH375BULKUP
0002 900000      R     MOV     DPTR,#mSenseKey
0005 7405              MOV     A,#05H
0007 F0                MOVX    @DPTR,A
0008 900000      R     MOV     DPTR,#mASC
000B 7420              MOV     A,#020H
000D F0                MOVX    @DPTR,A
000E 900000      R     MOV     DPTR,#BcswStatus
0011 7401              MOV     A,#01H
0013 F0                MOVX    @DPTR,A
0014 7F0F              MOV     R7,#0FH
             ; FUNCTION _BulkThirteen (BEGIN)
                                           ; SOURCE LINE # 465
;---- Variable 'Case' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 466
                                           ; SOURCE LINE # 467
0016 EF                MOV     A,R7
0017 B41000            CJNE    A,#010H,?C0248
001A         ?C0248:
001A 5073              JNC     ?C0074
001C 900000      R     MOV     DPTR,#?C0249
001F F8                MOV     R0,A
0020 28                ADD     A,R0
0021 28                ADD     A,R0
0022 73                JMP     @A+DPTR
0023         ?C0249:
0023 020000      R     LJMP    ?C0059
0026 020000      R     LJMP    ?C0059
0029 020000      R     LJMP    ?C0062
002C 020000      R     LJMP    ?C0062
002F 020000      R     LJMP    ?C0064
0032 020000      R     LJMP    ?C0064
0035 020000      R     LJMP    ?C0059
0038 020000      R     LJMP    ?C0066
003B 020000      R     LJMP    ?C0066
003E 020000      R     LJMP    ?C0068
0041 020000      R     LJMP    ?C0070
0044 020000      R     LJMP    ?C0068
0047 020000      R     LJMP    ?C0060
004A 020000      R     LJMP    ?C0070
004D 020000      R     LJMP    ?C0071
0050 020000      R     LJMP    ?C0064
                                           ; SOURCE LINE # 468
                                           ; SOURCE LINE # 469
                                           ; SOURCE LINE # 470
                                           ; SOURCE LINE # 471
0053         ?C0059:
                                           ; SOURCE LINE # 472
                                           ; SOURCE LINE # 473
0053 8000              SJMP    ?C0288
                                           ; SOURCE LINE # 474
0055         ?C0060:
                                           ; SOURCE LINE # 475
0055         ?C0288:
0055 E4                CLR     A
0056 900000      R     MOV     DPTR,#BcswStatus
0059 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 476
005A 22                RET     
                                           ; SOURCE LINE # 477
                                           ; SOURCE LINE # 478
005B         ?C0062:
                                           ; SOURCE LINE # 479
                                           ; SOURCE LINE # 480
                                           ; SOURCE LINE # 482
                                           ; SOURCE LINE # 483
005B 8002              SJMP    ?C0289
                                           ; SOURCE LINE # 484
                                           ; SOURCE LINE # 485
005D         ?C0064:
                                           ; SOURCE LINE # 486
                                           ; SOURCE LINE # 487
                                           ; SOURCE LINE # 489
                                           ; SOURCE LINE # 490
005D 8025              SJMP    ?C0290
                                           ; SOURCE LINE # 491
                                           ; SOURCE LINE # 492
005F         ?C0066:
                                           ; SOURCE LINE # 493
005F         ?C0289:
005F 43D203            ORL     UEP1_CTRL,#03H
                                           ; SOURCE LINE # 494
0062 D200        R     SETB    FSTALL
                                           ; SOURCE LINE # 496
                                           ; SOURCE LINE # 497
0064 8017              SJMP    ?C0293
                                           ; SOURCE LINE # 498
                                           ; SOURCE LINE # 499
0066         ?C0068:
                                           ; SOURCE LINE # 500
0066 43D20C            ORL     UEP1_CTRL,#0CH
                                           ; SOURCE LINE # 501
                                           ; SOURCE LINE # 503
                                           ; SOURCE LINE # 504
0069 801C              SJMP    ?C0292
                                           ; SOURCE LINE # 505
                                           ; SOURCE LINE # 506
006B         ?C0070:
                                           ; SOURCE LINE # 507
006B 43D203            ORL     UEP1_CTRL,#03H
                                           ; SOURCE LINE # 508
006E D200        R     SETB    FSTALL
                                           ; SOURCE LINE # 510
0070 43D20C            ORL     UEP1_CTRL,#0CH
                                           ; SOURCE LINE # 512
0073         ?C0291:
                                           ; SOURCE LINE # 513
0073 8008              SJMP    ?C0293
                                           ; SOURCE LINE # 514
0075         ?C0071:
                                           ; SOURCE LINE # 515
0075 43D203            ORL     UEP1_CTRL,#03H
                                           ; SOURCE LINE # 516
0078 D200        R     SETB    FSTALL
                                           ; SOURCE LINE # 517
007A 43D20C            ORL     UEP1_CTRL,#0CH
                                           ; SOURCE LINE # 519
007D         ?C0293:
007D 900000      R     MOV     DPTR,#BcswStatus
0080 7402              MOV     A,#02H
0082 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 520
0083 22                RET     
                                           ; SOURCE LINE # 521
0084         ?C0290:
0084 43D203            ORL     UEP1_CTRL,#03H
                                           ; SOURCE LINE # 523
0087         ?C0292:
0087 D200        R     SETB    FSTALL
                                           ; SOURCE LINE # 525
0089 900000      R     MOV     DPTR,#BcswStatus
008C 7401              MOV     A,#01H
008E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 526
                                           ; SOURCE LINE # 527
                                           ; SOURCE LINE # 528
                                           ; SOURCE LINE # 529
                                           ; SOURCE LINE # 530
008F         ?C0074:
008F 22                RET     
             ; FUNCTION _BulkThirteen (END)

             ; FUNCTION UFI_readCapacity (BEGIN)
                                           ; SOURCE LINE # 533
                                           ; SOURCE LINE # 534
                                           ; SOURCE LINE # 535
0000 900000      R     MOV     DPTR,#pBuf
0003 74FF              MOV     A,#0FFH
0005 F0                MOVX    @DPTR,A
0006 A3                INC     DPTR
0007 7400        R     MOV     A,#HIGH DBCAPACITY
0009 F0                MOVX    @DPTR,A
000A A3                INC     DPTR
000B 7400        R     MOV     A,#LOW DBCAPACITY
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 536
000E E4                CLR     A
000F 7F08              MOV     R7,#08H
0011 FE                MOV     R6,A
0012 FD                MOV     R5,A
0013 FC                MOV     R4,A
0014 900000      R     MOV     DPTR,#LEN
0017 E0                MOVX    A,@DPTR
0018 F8                MOV     R0,A
0019 A3                INC     DPTR
001A E0                MOVX    A,@DPTR
001B F9                MOV     R1,A
001C A3                INC     DPTR
001D E0                MOVX    A,@DPTR
001E FA                MOV     R2,A
001F A3                INC     DPTR
0020 E0                MOVX    A,@DPTR
0021 FB                MOV     R3,A
0022 D3                SETB    C
0023 120000      E     LCALL   ?C?ULCMP
0026 400A              JC      ?C0075
                                           ; SOURCE LINE # 537
0028 900000      R     MOV     DPTR,#LEN
002B 120000      E     LCALL   ?C?LSTKXDATA
002E 00                DB      00H
002F 00                DB      00H
0030 00                DB      00H
0031 08                DB      08H
0032         ?C0075:
                                           ; SOURCE LINE # 538
0032 E4                CLR     A
0033 900000      R     MOV     DPTR,#BcswStatus
0036 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 539
0037 900000      R     MOV     DPTR,#mSenseKey
003A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 540
003B 900000      R     MOV     DPTR,#mASC
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 541
003F 22                RET     
             ; FUNCTION UFI_readCapacity (END)

             ; FUNCTION UFI_inquiry (BEGIN)
                                           ; SOURCE LINE # 544
                                           ; SOURCE LINE # 545
                                           ; SOURCE LINE # 546
0000 900000      E     MOV     DPTR,#AttackEnabled
0003 E0                MOVX    A,@DPTR
0004 7034              JNZ     ?C0077
                                           ; SOURCE LINE # 547
                                           ; SOURCE LINE # 548
0006 900000      R     MOV     DPTR,#pBuf
0009 74FF              MOV     A,#0FFH
000B F0                MOVX    @DPTR,A
000C A3                INC     DPTR
000D 7400        R     MOV     A,#HIGH DBINQUITY_USB_Drive
000F F0                MOVX    @DPTR,A
0010 A3                INC     DPTR
0011 7400        R     MOV     A,#LOW DBINQUITY_USB_Drive
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 549
0014 E4                CLR     A
0015 7F24              MOV     R7,#024H
0017 FE                MOV     R6,A
0018 FD                MOV     R5,A
0019 FC                MOV     R4,A
001A 900000      R     MOV     DPTR,#LEN
001D E0                MOVX    A,@DPTR
001E F8                MOV     R0,A
001F A3                INC     DPTR
0020 E0                MOVX    A,@DPTR
0021 F9                MOV     R1,A
0022 A3                INC     DPTR
0023 E0                MOVX    A,@DPTR
0024 FA                MOV     R2,A
0025 A3                INC     DPTR
0026 E0                MOVX    A,@DPTR
0027 FB                MOV     R3,A
0028 D3                SETB    C
0029 120000      E     LCALL   ?C?ULCMP
002C 403E              JC      ?C0294
                                           ; SOURCE LINE # 550
002E 900000      R     MOV     DPTR,#LEN
0031 120000      E     LCALL   ?C?LSTKXDATA
0034 00                DB      00H
0035 00                DB      00H
0036 00                DB      00H
0037 24                DB      024H
0038         ?C0078:
                                           ; SOURCE LINE # 551
                                           ; SOURCE LINE # 552
                                           ; SOURCE LINE # 553
                                           ; SOURCE LINE # 554
0038 8032              SJMP    ?C0294
003A         ?C0077:
                                           ; SOURCE LINE # 556
                                           ; SOURCE LINE # 557
003A 900000      R     MOV     DPTR,#pBuf
003D 74FF              MOV     A,#0FFH
003F F0                MOVX    @DPTR,A
0040 A3                INC     DPTR
0041 7400        R     MOV     A,#HIGH DBINQUITY_CD_ROM
0043 F0                MOVX    @DPTR,A
0044 A3                INC     DPTR
0045 7400        R     MOV     A,#LOW DBINQUITY_CD_ROM
0047 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 558
0048 E4                CLR     A
0049 7F24              MOV     R7,#024H
004B FE                MOV     R6,A
004C FD                MOV     R5,A
004D FC                MOV     R4,A
004E 900000      R     MOV     DPTR,#LEN
0051 E0                MOVX    A,@DPTR
0052 F8                MOV     R0,A
0053 A3                INC     DPTR
0054 E0                MOVX    A,@DPTR
0055 F9                MOV     R1,A
0056 A3                INC     DPTR
0057 E0                MOVX    A,@DPTR
0058 FA                MOV     R2,A
0059 A3                INC     DPTR
005A E0                MOVX    A,@DPTR
005B FB                MOV     R3,A
005C D3                SETB    C
005D 120000      E     LCALL   ?C?ULCMP
0060 400A              JC      ?C0080
                                           ; SOURCE LINE # 559
0062 900000      R     MOV     DPTR,#LEN
0065 120000      E     LCALL   ?C?LSTKXDATA
0068 00                DB      00H
0069 00                DB      00H
006A 00                DB      00H
006B 24                DB      024H
006C         ?C0080:
                                           ; SOURCE LINE # 560
006C         ?C0294:
006C E4                CLR     A
006D 900000      R     MOV     DPTR,#BcswStatus
0070 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 561
0071 900000      R     MOV     DPTR,#mSenseKey
0074 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 562
0075 900000      R     MOV     DPTR,#mASC
0078 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 563
                                           ; SOURCE LINE # 564
0079         ?C0081:
0079 22                RET     
             ; FUNCTION UFI_inquiry (END)

             ; FUNCTION UFI_read10 (BEGIN)
                                           ; SOURCE LINE # 567
                                           ; SOURCE LINE # 568
                                           ; SOURCE LINE # 569
0000 7800        R     MOV     R0,#LOW MassPara+016H
0002 E6                MOV     A,@R0
0003 FF                MOV     R7,A
0004 E4                CLR     A
0005 FC                MOV     R4,A
0006 FD                MOV     R5,A
0007 FE                MOV     R6,A
0008 7808              MOV     R0,#08H
000A 120000      E     LCALL   ?C?LSHL
000D EC                MOV     A,R4
000E C0E0              PUSH    ACC
0010 ED                MOV     A,R5
0011 C0E0              PUSH    ACC
0013 EE                MOV     A,R6
0014 C0E0              PUSH    ACC
0016 EF                MOV     A,R7
0017 C0E0              PUSH    ACC
0019 7800        R     MOV     R0,#LOW MassPara+017H
001B E6                MOV     A,@R0
001C FF                MOV     R7,A
001D D0E0              POP     ACC
001F FB                MOV     R3,A
0020 D0E0              POP     ACC
0022 FA                MOV     R2,A
0023 D0E0              POP     ACC
0025 F9                MOV     R1,A
0026 D0E0              POP     ACC
0028 F8                MOV     R0,A
0029 EB                MOV     A,R3
002A 4F                ORL     A,R7
002B FF                MOV     R7,A
002C EA                MOV     A,R2
002D FE                MOV     R6,A
002E E9                MOV     A,R1
002F FD                MOV     R5,A
0030 E8                MOV     A,R0
0031 FC                MOV     R4,A
0032 E4                CLR     A
0033 FB                MOV     R3,A
0034 7A10              MOV     R2,#010H
0036 F9                MOV     R1,A
0037 F8                MOV     R0,A
0038 120000      E     LCALL   ?C?LMUL
003B 900000      R     MOV     DPTR,#LEN
003E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 570
0041 7800        R     MOV     R0,#LOW MassPara+012H
0043 E6                MOV     A,@R0
0044 FF                MOV     R7,A
0045 E4                CLR     A
0046 FC                MOV     R4,A
0047 FD                MOV     R5,A
0048 FE                MOV     R6,A
0049 7810              MOV     R0,#010H
004B 120000      E     LCALL   ?C?LSHL
004E EC                MOV     A,R4
004F C0E0              PUSH    ACC
0051 ED                MOV     A,R5
0052 C0E0              PUSH    ACC
0054 EE                MOV     A,R6
0055 C0E0              PUSH    ACC
0057 EF                MOV     A,R7
0058 C0E0              PUSH    ACC
005A 7800        R     MOV     R0,#LOW MassPara+011H
005C E6                MOV     A,@R0
005D FF                MOV     R7,A
005E E4                CLR     A
005F FC                MOV     R4,A
0060 FD                MOV     R5,A
0061 FE                MOV     R6,A
0062 7818              MOV     R0,#018H
0064 120000      E     LCALL   ?C?LSHL
0067 D0E0              POP     ACC
0069 FB                MOV     R3,A
006A D0E0              POP     ACC
006C FA                MOV     R2,A
006D D0E0              POP     ACC
006F F9                MOV     R1,A
0070 D0E0              POP     ACC
0072 F8                MOV     R0,A
0073 EF                MOV     A,R7
0074 4B                ORL     A,R3
0075 FF                MOV     R7,A
0076 EE                MOV     A,R6
0077 4A                ORL     A,R2
0078 FE                MOV     R6,A
0079 ED                MOV     A,R5
007A 49                ORL     A,R1
007B FD                MOV     R5,A
007C EC                MOV     A,R4
007D 48                ORL     A,R0
007E C0E0              PUSH    ACC
0080 ED                MOV     A,R5
0081 C0E0              PUSH    ACC
0083 EE                MOV     A,R6
0084 C0E0              PUSH    ACC
0086 EF                MOV     A,R7
0087 C0E0              PUSH    ACC
0089 7800        R     MOV     R0,#LOW MassPara+013H
008B E6                MOV     A,@R0
008C FF                MOV     R7,A
008D E4                CLR     A
008E FC                MOV     R4,A
008F FD                MOV     R5,A
0090 FE                MOV     R6,A
0091 7808              MOV     R0,#08H
0093 120000      E     LCALL   ?C?LSHL
0096 D0E0              POP     ACC
0098 FB                MOV     R3,A
0099 D0E0              POP     ACC
009B FA                MOV     R2,A
009C D0E0              POP     ACC
009E F9                MOV     R1,A
009F D0E0              POP     ACC
00A1 F8                MOV     R0,A
00A2 EF                MOV     A,R7
00A3 4B                ORL     A,R3
00A4 FF                MOV     R7,A
00A5 EE                MOV     A,R6
00A6 4A                ORL     A,R2
00A7 FE                MOV     R6,A
00A8 ED                MOV     A,R5
00A9 49                ORL     A,R1
00AA FD                MOV     R5,A
00AB EC                MOV     A,R4
00AC 48                ORL     A,R0
00AD C0E0              PUSH    ACC
00AF ED                MOV     A,R5
00B0 C0E0              PUSH    ACC
00B2 EE                MOV     A,R6
00B3 C0E0              PUSH    ACC
00B5 EF                MOV     A,R7
00B6 C0E0              PUSH    ACC
00B8 7800        R     MOV     R0,#LOW MassPara+014H
00BA E6                MOV     A,@R0
00BB FF                MOV     R7,A
00BC D0E0              POP     ACC
00BE FB                MOV     R3,A
00BF D0E0              POP     ACC
00C1 FA                MOV     R2,A
00C2 D0E0              POP     ACC
00C4 F9                MOV     R1,A
00C5 D0E0              POP     ACC
00C7 F8                MOV     R0,A
00C8 EB                MOV     A,R3
00C9 4F                ORL     A,R7
00CA FF                MOV     R7,A
00CB EA                MOV     A,R2
00CC FE                MOV     R6,A
00CD E9                MOV     A,R1
00CE FD                MOV     R5,A
00CF E8                MOV     A,R0
00D0 FC                MOV     R4,A
00D1 900000      R     MOV     DPTR,#Locate_Addr
00D4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 571
00D7 900000      R     MOV     DPTR,#Locate_Addr
00DA E0                MOVX    A,@DPTR
00DB FC                MOV     R4,A
00DC A3                INC     DPTR
00DD E0                MOVX    A,@DPTR
00DE FD                MOV     R5,A
00DF A3                INC     DPTR
00E0 E0                MOVX    A,@DPTR
00E1 FE                MOV     R6,A
00E2 A3                INC     DPTR
00E3 E0                MOVX    A,@DPTR
00E4 FF                MOV     R7,A
00E5 E4                CLR     A
00E6 FB                MOV     R3,A
00E7 7A10              MOV     R2,#010H
00E9 F9                MOV     R1,A
00EA F8                MOV     R0,A
00EB 120000      E     LCALL   ?C?LMUL
00EE 900000      R     MOV     DPTR,#Locate_Addr
00F1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 572
00F4 E4                CLR     A
00F5 900000      R     MOV     DPTR,#BcswStatus
00F8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 573
00F9 900000      R     MOV     DPTR,#mSenseKey
00FC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 574
00FD 900000      R     MOV     DPTR,#mASC
0100 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 575
0101 D200        R     SETB    pBuf_ReSelect
                                           ; SOURCE LINE # 576
0103 22                RET     
             ; FUNCTION UFI_read10 (END)

             ; FUNCTION UFI_modeSense (BEGIN)
                                           ; SOURCE LINE # 579
                                           ; SOURCE LINE # 580
                                           ; SOURCE LINE # 581
0000 7800        R     MOV     R0,#LOW MassPara+011H
0002 E6                MOV     A,@R0
0003 643F              XRL     A,#03FH
0005 703F              JNZ     ?C0083
                                           ; SOURCE LINE # 582
                                           ; SOURCE LINE # 583
0007 7F0C              MOV     R7,#0CH
0009 FE                MOV     R6,A
000A FD                MOV     R5,A
000B FC                MOV     R4,A
000C 900000      R     MOV     DPTR,#LEN
000F E0                MOVX    A,@DPTR
0010 F8                MOV     R0,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 F9                MOV     R1,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 FA                MOV     R2,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FB                MOV     R3,A
001A D3                SETB    C
001B 120000      E     LCALL   ?C?ULCMP
001E 400A              JC      ?C0084
0020 900000      R     MOV     DPTR,#LEN
0023 120000      E     LCALL   ?C?LSTKXDATA
0026 00                DB      00H
0027 00                DB      00H
0028 00                DB      00H
0029 0C                DB      0CH
002A         ?C0084:
                                           ; SOURCE LINE # 584
002A 900000      R     MOV     DPTR,#pBuf
002D 74FF              MOV     A,#0FFH
002F F0                MOVX    @DPTR,A
0030 A3                INC     DPTR
0031 7400        R     MOV     A,#HIGH modesense3F
0033 F0                MOVX    @DPTR,A
0034 A3                INC     DPTR
0035 7400        R     MOV     A,#LOW modesense3F
0037 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 585
0038 E4                CLR     A
0039 900000      R     MOV     DPTR,#BcswStatus
003C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 586
003D 900000      R     MOV     DPTR,#mSenseKey
0040 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 587
0041 900000      R     MOV     DPTR,#mASC
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 588
0045 22                RET     
0046         ?C0083:
                                           ; SOURCE LINE # 590
                                           ; SOURCE LINE # 591
                                           ; SOURCE LINE # 592
                                           ; SOURCE LINE # 593
                                           ; SOURCE LINE # 594
                                           ; SOURCE LINE # 595
0046 120000      R     LCALL   L?0312
                                           ; SOURCE LINE # 596
                                           ; SOURCE LINE # 597
0049         ?C0086:
0049 22                RET     
             ; FUNCTION UFI_modeSense (END)

             ; FUNCTION UFI_requestSense (BEGIN)
                                           ; SOURCE LINE # 600
                                           ; SOURCE LINE # 601
                                           ; SOURCE LINE # 602
0000 A200        R     MOV     C,lastFSTALL
0002 7200        R     ORL     C,FSTALL
0004 5030              JNC     ?C0087
                                           ; SOURCE LINE # 603
                                           ; SOURCE LINE # 604
0006 A200        R     MOV     C,FSTALL
0008 9200        R     MOV     lastFSTALL,C
                                           ; SOURCE LINE # 605
000A C200        R     CLR     FSTALL
                                           ; SOURCE LINE # 606
000C 7800        R     MOV     R0,#LOW MassPara
000E 7670              MOV     @R0,#070H
                                           ; SOURCE LINE # 607
0010 E4                CLR     A
0011 08                INC     R0
0012 F6                MOV     @R0,A
                                           ; SOURCE LINE # 608
0013 900000      R     MOV     DPTR,#mSenseKey
0016 E0                MOVX    A,@DPTR
0017 08                INC     R0
0018 F6                MOV     @R0,A
                                           ; SOURCE LINE # 609
0019 E4                CLR     A
001A 08                INC     R0
001B F6                MOV     @R0,A
                                           ; SOURCE LINE # 610
001C 08                INC     R0
001D F6                MOV     @R0,A
                                           ; SOURCE LINE # 611
001E 08                INC     R0
001F F6                MOV     @R0,A
                                           ; SOURCE LINE # 612
0020 08                INC     R0
0021 F6                MOV     @R0,A
                                           ; SOURCE LINE # 613
0022 08                INC     R0
0023 760A              MOV     @R0,#0AH
                                           ; SOURCE LINE # 614
0025 08                INC     R0
0026 F6                MOV     @R0,A
                                           ; SOURCE LINE # 615
0027 08                INC     R0
0028 F6                MOV     @R0,A
                                           ; SOURCE LINE # 616
0029 08                INC     R0
002A F6                MOV     @R0,A
                                           ; SOURCE LINE # 617
002B 08                INC     R0
002C F6                MOV     @R0,A
                                           ; SOURCE LINE # 618
002D 900000      R     MOV     DPTR,#mASC
0030 E0                MOVX    A,@DPTR
0031 08                INC     R0
0032 F6                MOV     @R0,A
                                           ; SOURCE LINE # 619
0033 E4                CLR     A
                                           ; SOURCE LINE # 620
                                           ; SOURCE LINE # 621
                                           ; SOURCE LINE # 622
                                           ; SOURCE LINE # 623
                                           ; SOURCE LINE # 624
                                           ; SOURCE LINE # 625
                                           ; SOURCE LINE # 626
0034 8024              SJMP    ?C0295
0036         ?C0087:
                                           ; SOURCE LINE # 628
                                           ; SOURCE LINE # 629
0036 A200        R     MOV     C,FSTALL
0038 9200        R     MOV     lastFSTALL,C
                                           ; SOURCE LINE # 630
003A C200        R     CLR     FSTALL
                                           ; SOURCE LINE # 631
003C 7800        R     MOV     R0,#LOW MassPara
003E 7670              MOV     @R0,#070H
                                           ; SOURCE LINE # 632
0040 E4                CLR     A
0041 08                INC     R0
0042 F6                MOV     @R0,A
                                           ; SOURCE LINE # 633
0043 08                INC     R0
0044 F6                MOV     @R0,A
                                           ; SOURCE LINE # 634
0045 08                INC     R0
0046 F6                MOV     @R0,A
                                           ; SOURCE LINE # 635
0047 08                INC     R0
0048 F6                MOV     @R0,A
                                           ; SOURCE LINE # 636
0049 08                INC     R0
004A F6                MOV     @R0,A
                                           ; SOURCE LINE # 637
004B 08                INC     R0
004C F6                MOV     @R0,A
                                           ; SOURCE LINE # 638
004D 08                INC     R0
004E 760A              MOV     @R0,#0AH
                                           ; SOURCE LINE # 639
0050 08                INC     R0
0051 F6                MOV     @R0,A
                                           ; SOURCE LINE # 640
0052 08                INC     R0
0053 F6                MOV     @R0,A
                                           ; SOURCE LINE # 641
0054 08                INC     R0
0055 F6                MOV     @R0,A
                                           ; SOURCE LINE # 642
0056 08                INC     R0
0057 F6                MOV     @R0,A
                                           ; SOURCE LINE # 643
0058 08                INC     R0
0059 F6                MOV     @R0,A
                                           ; SOURCE LINE # 644
005A         ?C0295:
005A 08                INC     R0
005B F6                MOV     @R0,A
                                           ; SOURCE LINE # 645
005C 08                INC     R0
005D F6                MOV     @R0,A
                                           ; SOURCE LINE # 646
005E 08                INC     R0
005F F6                MOV     @R0,A
                                           ; SOURCE LINE # 647
0060 08                INC     R0
0061 F6                MOV     @R0,A
                                           ; SOURCE LINE # 648
0062 08                INC     R0
0063 F6                MOV     @R0,A
                                           ; SOURCE LINE # 649
0064 900000      R     MOV     DPTR,#pBuf
0067 F0                MOVX    @DPTR,A
0068 A3                INC     DPTR
0069 7400        R     MOV     A,#HIGH MassPara
006B F0                MOVX    @DPTR,A
006C A3                INC     DPTR
006D 7400        R     MOV     A,#LOW MassPara
006F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 650
0070 E4                CLR     A
0071 900000      R     MOV     DPTR,#BcswStatus
0074 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 651
                                           ; SOURCE LINE # 652
0075         ?C0089:
0075 22                RET     
             ; FUNCTION UFI_requestSense (END)

             ; FUNCTION UFI_testUnit (BEGIN)
                                           ; SOURCE LINE # 655
                                           ; SOURCE LINE # 656
                                           ; SOURCE LINE # 657
0000 C200        R     CLR     CH375BULKDOWN
                                           ; SOURCE LINE # 658
0002 C200        R     CLR     CH375BULKUP
                                           ; SOURCE LINE # 659
0004 E4                CLR     A
0005 900000      R     MOV     DPTR,#BcswStatus
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 660
0009 900000      R     MOV     DPTR,#mSenseKey
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 661
000D 900000      R     MOV     DPTR,#mASC
0010 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 662
0011 22                RET     
             ; FUNCTION UFI_testUnit (END)

             ; FUNCTION UFI_perOrMed (BEGIN)
                                           ; SOURCE LINE # 665
                                           ; SOURCE LINE # 666
                                           ; SOURCE LINE # 667
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#BcswStatus
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 668
0005 900000      R     MOV     DPTR,#mSenseKey
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 669
0009 900000      R     MOV     DPTR,#mASC
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 670
000D 22                RET     
             ; FUNCTION UFI_perOrMed (END)

             ; FUNCTION UFI_write (BEGIN)
                                           ; SOURCE LINE # 673
                                           ; SOURCE LINE # 674
                                           ; SOURCE LINE # 677
0000 7800        R     MOV     R0,#LOW MassPara+016H
0002 E6                MOV     A,@R0
0003 FF                MOV     R7,A
0004 E4                CLR     A
0005 FC                MOV     R4,A
0006 FD                MOV     R5,A
0007 FE                MOV     R6,A
0008 7808              MOV     R0,#08H
000A 120000      E     LCALL   ?C?LSHL
000D EC                MOV     A,R4
000E C0E0              PUSH    ACC
0010 ED                MOV     A,R5
0011 C0E0              PUSH    ACC
0013 EE                MOV     A,R6
0014 C0E0              PUSH    ACC
0016 EF                MOV     A,R7
0017 C0E0              PUSH    ACC
0019 7800        R     MOV     R0,#LOW MassPara+017H
001B E6                MOV     A,@R0
001C FF                MOV     R7,A
001D D0E0              POP     ACC
001F FB                MOV     R3,A
0020 D0E0              POP     ACC
0022 FA                MOV     R2,A
0023 D0E0              POP     ACC
0025 F9                MOV     R1,A
0026 D0E0              POP     ACC
0028 F8                MOV     R0,A
0029 EB                MOV     A,R3
002A 4F                ORL     A,R7
002B FF                MOV     R7,A
002C EA                MOV     A,R2
002D FE                MOV     R6,A
002E E9                MOV     A,R1
002F FD                MOV     R5,A
0030 E8                MOV     A,R0
0031 FC                MOV     R4,A
0032 E4                CLR     A
0033 FB                MOV     R3,A
0034 7A10              MOV     R2,#010H
0036 F9                MOV     R1,A
0037 F8                MOV     R0,A
0038 120000      E     LCALL   ?C?LMUL
003B 900000      R     MOV     DPTR,#LEN
003E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 678
0041 7800        R     MOV     R0,#LOW MassPara+012H
0043 E6                MOV     A,@R0
0044 FF                MOV     R7,A
0045 E4                CLR     A
0046 FC                MOV     R4,A
0047 FD                MOV     R5,A
0048 FE                MOV     R6,A
0049 7810              MOV     R0,#010H
004B 120000      E     LCALL   ?C?LSHL
004E EC                MOV     A,R4
004F C0E0              PUSH    ACC
0051 ED                MOV     A,R5
0052 C0E0              PUSH    ACC
0054 EE                MOV     A,R6
0055 C0E0              PUSH    ACC
0057 EF                MOV     A,R7
0058 C0E0              PUSH    ACC
005A 7800        R     MOV     R0,#LOW MassPara+011H
005C E6                MOV     A,@R0
005D FF                MOV     R7,A
005E E4                CLR     A
005F FC                MOV     R4,A
0060 FD                MOV     R5,A
0061 FE                MOV     R6,A
0062 7818              MOV     R0,#018H
0064 120000      E     LCALL   ?C?LSHL
0067 D0E0              POP     ACC
0069 FB                MOV     R3,A
006A D0E0              POP     ACC
006C FA                MOV     R2,A
006D D0E0              POP     ACC
006F F9                MOV     R1,A
0070 D0E0              POP     ACC
0072 F8                MOV     R0,A
0073 EF                MOV     A,R7
0074 4B                ORL     A,R3
0075 FF                MOV     R7,A
0076 EE                MOV     A,R6
0077 4A                ORL     A,R2
0078 FE                MOV     R6,A
0079 ED                MOV     A,R5
007A 49                ORL     A,R1
007B FD                MOV     R5,A
007C EC                MOV     A,R4
007D 48                ORL     A,R0
007E C0E0              PUSH    ACC
0080 ED                MOV     A,R5
0081 C0E0              PUSH    ACC
0083 EE                MOV     A,R6
0084 C0E0              PUSH    ACC
0086 EF                MOV     A,R7
0087 C0E0              PUSH    ACC
0089 7800        R     MOV     R0,#LOW MassPara+013H
008B E6                MOV     A,@R0
008C FF                MOV     R7,A
008D E4                CLR     A
008E FC                MOV     R4,A
008F FD                MOV     R5,A
0090 FE                MOV     R6,A
0091 7808              MOV     R0,#08H
0093 120000      E     LCALL   ?C?LSHL
0096 D0E0              POP     ACC
0098 FB                MOV     R3,A
0099 D0E0              POP     ACC
009B FA                MOV     R2,A
009C D0E0              POP     ACC
009E F9                MOV     R1,A
009F D0E0              POP     ACC
00A1 F8                MOV     R0,A
00A2 EF                MOV     A,R7
00A3 4B                ORL     A,R3
00A4 FF                MOV     R7,A
00A5 EE                MOV     A,R6
00A6 4A                ORL     A,R2
00A7 FE                MOV     R6,A
00A8 ED                MOV     A,R5
00A9 49                ORL     A,R1
00AA FD                MOV     R5,A
00AB EC                MOV     A,R4
00AC 48                ORL     A,R0
00AD C0E0              PUSH    ACC
00AF ED                MOV     A,R5
00B0 C0E0              PUSH    ACC
00B2 EE                MOV     A,R6
00B3 C0E0              PUSH    ACC
00B5 EF                MOV     A,R7
00B6 C0E0              PUSH    ACC
00B8 7800        R     MOV     R0,#LOW MassPara+014H
00BA E6                MOV     A,@R0
00BB FF                MOV     R7,A
00BC D0E0              POP     ACC
00BE FB                MOV     R3,A
00BF D0E0              POP     ACC
00C1 FA                MOV     R2,A
00C2 D0E0              POP     ACC
00C4 F9                MOV     R1,A
00C5 D0E0              POP     ACC
00C7 F8                MOV     R0,A
00C8 EB                MOV     A,R3
00C9 4F                ORL     A,R7
00CA FF                MOV     R7,A
00CB EA                MOV     A,R2
00CC FE                MOV     R6,A
00CD E9                MOV     A,R1
00CE FD                MOV     R5,A
00CF E8                MOV     A,R0
00D0 FC                MOV     R4,A
00D1 900000      R     MOV     DPTR,#Locate_Addr
00D4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 679
00D7 900000      R     MOV     DPTR,#Locate_Addr
00DA E0                MOVX    A,@DPTR
00DB FC                MOV     R4,A
00DC A3                INC     DPTR
00DD E0                MOVX    A,@DPTR
00DE FD                MOV     R5,A
00DF A3                INC     DPTR
00E0 E0                MOVX    A,@DPTR
00E1 FE                MOV     R6,A
00E2 A3                INC     DPTR
00E3 E0                MOVX    A,@DPTR
00E4 FF                MOV     R7,A
00E5 E4                CLR     A
00E6 FB                MOV     R3,A
00E7 7A10              MOV     R2,#010H
00E9 F9                MOV     R1,A
00EA F8                MOV     R0,A
00EB 120000      E     LCALL   ?C?LMUL
00EE 900000      R     MOV     DPTR,#Locate_Addr
00F1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 680
00F4 7F40              MOV     R7,#040H
00F6 7E4B              MOV     R6,#04BH
00F8 7D4C              MOV     R5,#04CH
00FA 7C00              MOV     R4,#00H
00FC 900000      R     MOV     DPTR,#Locate_Addr
00FF E0                MOVX    A,@DPTR
0100 F8                MOV     R0,A
0101 A3                INC     DPTR
0102 E0                MOVX    A,@DPTR
0103 F9                MOV     R1,A
0104 A3                INC     DPTR
0105 E0                MOVX    A,@DPTR
0106 FA                MOV     R2,A
0107 A3                INC     DPTR
0108 E0                MOVX    A,@DPTR
0109 FB                MOV     R3,A
010A C3                CLR     C
010B 120000      E     LCALL   ?C?ULCMP
010E 5048              JNC     ?C0092
                                           ; SOURCE LINE # 681
                                           ; SOURCE LINE # 682
0110 7800        R     MOV     R0,#LOW MassPara+017H
0112 E6                MOV     A,@R0
0113 900000      R     MOV     DPTR,#num
0116 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 683
0117 E4                CLR     A
0118 900000      R     MOV     DPTR,#i
011B F0                MOVX    @DPTR,A
011C         ?C0093:
011C 900000      R     MOV     DPTR,#num
011F E0                MOVX    A,@DPTR
0120 FF                MOV     R7,A
0121 900000      R     MOV     DPTR,#i
0124 E0                MOVX    A,@DPTR
0125 FE                MOV     R6,A
0126 C3                CLR     C
0127 9F                SUBB    A,R7
0128 502E              JNC     ?C0092
                                           ; SOURCE LINE # 684
012A EE                MOV     A,R6
012B FF                MOV     R7,A
012C 7E00              MOV     R6,#00H
012E 7C10              MOV     R4,#010H
0130 7D00              MOV     R5,#00H
0132 120000      E     LCALL   ?C?LIMUL
0135 900000      R     MOV     DPTR,#Locate_Addr
0138 E0                MOVX    A,@DPTR
0139 F8                MOV     R0,A
013A A3                INC     DPTR
013B E0                MOVX    A,@DPTR
013C F9                MOV     R1,A
013D A3                INC     DPTR
013E E0                MOVX    A,@DPTR
013F FA                MOV     R2,A
0140 A3                INC     DPTR
0141 E0                MOVX    A,@DPTR
0142 2F                ADD     A,R7
0143 FF                MOV     R7,A
0144 EA                MOV     A,R2
0145 3E                ADDC    A,R6
0146 FE                MOV     R6,A
0147 E9                MOV     A,R1
0148 3D                ADDC    A,R5
0149 FD                MOV     R5,A
014A E8                MOV     A,R0
014B 3C                ADDC    A,R4
014C FC                MOV     R4,A
014D 120000      E     LCALL   _EraseFlash
0150 900000      R     MOV     DPTR,#i
0153 E0                MOVX    A,@DPTR
0154 04                INC     A
0155 F0                MOVX    @DPTR,A
0156 80C4              SJMP    ?C0093
                                           ; SOURCE LINE # 685
0158         ?C0092:
                                           ; SOURCE LINE # 686
0158 E4                CLR     A
0159 900000      R     MOV     DPTR,#BcswStatus
015C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 687
015D 900000      R     MOV     DPTR,#mSenseKey
0160 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 688
0161 900000      R     MOV     DPTR,#mASC
0164 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 689
0165 22                RET     
             ; FUNCTION UFI_write (END)

             ; FUNCTION UFI_staStoUnit (BEGIN)
                                           ; SOURCE LINE # 692
                                           ; SOURCE LINE # 693
                                           ; SOURCE LINE # 694
0000 C200        R     CLR     CH375BULKDOWN
                                           ; SOURCE LINE # 695
0002 C200        R     CLR     CH375BULKUP
                                           ; SOURCE LINE # 696
0004 E4                CLR     A
0005 900000      R     MOV     DPTR,#BcswStatus
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 697
0009 900000      R     MOV     DPTR,#mSenseKey
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 698
000D 900000      R     MOV     DPTR,#mASC
0010 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 699
0011 22                RET     
             ; FUNCTION UFI_staStoUnit (END)

             ; FUNCTION UFI_verify (BEGIN)
                                           ; SOURCE LINE # 702
                                           ; SOURCE LINE # 703
                                           ; SOURCE LINE # 704
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#BcswStatus
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 705
0005 900000      R     MOV     DPTR,#mSenseKey
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 706
0009 900000      R     MOV     DPTR,#mASC
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 709
000D 22                RET     
             ; FUNCTION UFI_verify (END)

             ; FUNCTION UFI_modeSense5 (BEGIN)
                                           ; SOURCE LINE # 711
                                           ; SOURCE LINE # 712
                                           ; SOURCE LINE # 713
0000 7800        R     MOV     R0,#LOW MassPara+011H
0002 E6                MOV     A,@R0
0003 643F              XRL     A,#03FH
0005 703F              JNZ     ?C0099
                                           ; SOURCE LINE # 714
                                           ; SOURCE LINE # 715
0007 7F10              MOV     R7,#010H
0009 FE                MOV     R6,A
000A FD                MOV     R5,A
000B FC                MOV     R4,A
000C 900000      R     MOV     DPTR,#LEN
000F E0                MOVX    A,@DPTR
0010 F8                MOV     R0,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 F9                MOV     R1,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 FA                MOV     R2,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FB                MOV     R3,A
001A D3                SETB    C
001B 120000      E     LCALL   ?C?ULCMP
001E 400A              JC      ?C0100
                                           ; SOURCE LINE # 716
0020 900000      R     MOV     DPTR,#LEN
0023 120000      E     LCALL   ?C?LSTKXDATA
0026 00                DB      00H
0027 00                DB      00H
0028 00                DB      00H
0029 10                DB      010H
002A         ?C0100:
                                           ; SOURCE LINE # 717
002A 900000      R     MOV     DPTR,#pBuf
002D 74FF              MOV     A,#0FFH
002F F0                MOVX    @DPTR,A
0030 A3                INC     DPTR
0031 7400        R     MOV     A,#HIGH mode5sense3F
0033 F0                MOVX    @DPTR,A
0034 A3                INC     DPTR
0035 7400        R     MOV     A,#LOW mode5sense3F
0037 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 718
0038 E4                CLR     A
0039 900000      R     MOV     DPTR,#BcswStatus
003C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 719
003D 900000      R     MOV     DPTR,#mSenseKey
0040 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 720
0041 900000      R     MOV     DPTR,#mASC
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 721
0045 22                RET     
0046         ?C0099:
                                           ; SOURCE LINE # 723
                                           ; SOURCE LINE # 724
                                           ; SOURCE LINE # 725
                                           ; SOURCE LINE # 726
                                           ; SOURCE LINE # 727
                                           ; SOURCE LINE # 728
0046 120000      R     LCALL   L?0312
                                           ; SOURCE LINE # 729
                                           ; SOURCE LINE # 730
0049         ?C0102:
0049 22                RET     
             ; FUNCTION UFI_modeSense5 (END)

             ; FUNCTION UFI_readTOC (BEGIN)
                                           ; SOURCE LINE # 732
                                           ; SOURCE LINE # 733
                                           ; SOURCE LINE # 734
0000 C8                XCH     A,R0
0001 7400        R     MOV     A,#LOW TOC
0003 C8                XCH     A,R0
0004 CC                XCH     A,R4
0005 7400        R     MOV     A,#HIGH TOC
0007 CC                XCH     A,R4
0008 CD                XCH     A,R5
0009 7401              MOV     A,#01H
000B CD                XCH     A,R5
000C 7BFF              MOV     R3,#0FFH
000E 7A00        R     MOV     R2,#HIGH _?ix1000
0010 7900        R     MOV     R1,#LOW _?ix1000
0012 7E00              MOV     R6,#00H
0014 7F14              MOV     R7,#014H
0016 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 738
0019 900000      R     MOV     DPTR,#pBuf
001C 7401              MOV     A,#01H
001E F0                MOVX    @DPTR,A
001F A3                INC     DPTR
0020 7400        R     MOV     A,#HIGH TOC
0022 F0                MOVX    @DPTR,A
0023 A3                INC     DPTR
0024 7400        R     MOV     A,#LOW TOC
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 739
0027 E4                CLR     A
0028 7F14              MOV     R7,#014H
002A FE                MOV     R6,A
002B FD                MOV     R5,A
002C FC                MOV     R4,A
002D 900000      R     MOV     DPTR,#LEN
0030 E0                MOVX    A,@DPTR
0031 F8                MOV     R0,A
0032 A3                INC     DPTR
0033 E0                MOVX    A,@DPTR
0034 F9                MOV     R1,A
0035 A3                INC     DPTR
0036 E0                MOVX    A,@DPTR
0037 FA                MOV     R2,A
0038 A3                INC     DPTR
0039 E0                MOVX    A,@DPTR
003A FB                MOV     R3,A
003B D3                SETB    C
003C 120000      E     LCALL   ?C?ULCMP
003F 400A              JC      ?C0103
                                           ; SOURCE LINE # 740
0041 900000      R     MOV     DPTR,#LEN
0044 120000      E     LCALL   ?C?LSTKXDATA
0047 00                DB      00H
0048 00                DB      00H
0049 00                DB      00H
004A 14                DB      014H
004B         ?C0103:
                                           ; SOURCE LINE # 741
004B E4                CLR     A
004C 900000      R     MOV     DPTR,#BcswStatus
004F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 742
0050 900000      R     MOV     DPTR,#mSenseKey
0053 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 743
0054 900000      R     MOV     DPTR,#mASC
0057 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 744
0058 22                RET     
             ; FUNCTION UFI_readTOC (END)

             ; FUNCTION UFI_GET_EVE_STA_NOT (BEGIN)
                                           ; SOURCE LINE # 746
                                           ; SOURCE LINE # 747
                                           ; SOURCE LINE # 748
0000 C8                XCH     A,R0
0001 7400        R     MOV     A,#LOW TOC
0003 C8                XCH     A,R0
0004 CC                XCH     A,R4
0005 7400        R     MOV     A,#HIGH TOC
0007 CC                XCH     A,R4
0008 CD                XCH     A,R5
0009 7401              MOV     A,#01H
000B CD                XCH     A,R5
000C 7BFF              MOV     R3,#0FFH
000E 7A00        R     MOV     R2,#HIGH _?ix1001
0010 7900        R     MOV     R1,#LOW _?ix1001
0012 7E00              MOV     R6,#00H
0014 7F08              MOV     R7,#08H
0016 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 758
0019 900000      R     MOV     DPTR,#pBuf
001C 7401              MOV     A,#01H
001E F0                MOVX    @DPTR,A
001F A3                INC     DPTR
0020 7400        R     MOV     A,#HIGH TOC
0022 F0                MOVX    @DPTR,A
0023 A3                INC     DPTR
0024 7400        R     MOV     A,#LOW TOC
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 759
0027 E4                CLR     A
0028 7F08              MOV     R7,#08H
002A FE                MOV     R6,A
002B FD                MOV     R5,A
002C FC                MOV     R4,A
002D 900000      R     MOV     DPTR,#LEN
0030 E0                MOVX    A,@DPTR
0031 F8                MOV     R0,A
0032 A3                INC     DPTR
0033 E0                MOVX    A,@DPTR
0034 F9                MOV     R1,A
0035 A3                INC     DPTR
0036 E0                MOVX    A,@DPTR
0037 FA                MOV     R2,A
0038 A3                INC     DPTR
0039 E0                MOVX    A,@DPTR
003A FB                MOV     R3,A
003B D3                SETB    C
003C 120000      E     LCALL   ?C?ULCMP
003F 400A              JC      ?C0105
                                           ; SOURCE LINE # 760
0041 900000      R     MOV     DPTR,#LEN
0044 120000      E     LCALL   ?C?LSTKXDATA
0047 00                DB      00H
0048 00                DB      00H
0049 00                DB      00H
004A 08                DB      08H
004B         ?C0105:
                                           ; SOURCE LINE # 761
004B E4                CLR     A
004C 900000      R     MOV     DPTR,#BcswStatus
004F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 762
0050 900000      R     MOV     DPTR,#mSenseKey
0053 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 763
0054 900000      R     MOV     DPTR,#mASC
0057 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 764
0058 22                RET     
             ; FUNCTION UFI_GET_EVE_STA_NOT (END)

             ; FUNCTION UFI_Hunding (BEGIN)
                                           ; SOURCE LINE # 767
                                           ; SOURCE LINE # 768
                                           ; SOURCE LINE # 769
0000 7800        R     MOV     R0,#LOW MassPara+0FH
0002 E6                MOV     A,@R0
0003 120000      E     LCALL   ?C?CCASE
0006 0000        R     DW      ?C0110
0008 00                DB      00H
0009 0000        R     DW      ?C0112
000B 03                DB      03H
000C 0000        R     DW      ?C0108
000E 12                DB      012H
000F 0000        R     DW      ?C0116
0011 1A                DB      01AH
0012 0000        R     DW      ?C0118
0014 1B                DB      01BH
0015 0000        R     DW      ?C0119
0017 1E                DB      01EH
0018 0000        R     DW      ?C0115
001A 23                DB      023H
001B 0000        R     DW      ?C0113
001D 25                DB      025H
001E 0000        R     DW      ?C0111
0020 28                DB      028H
0021 0000        R     DW      ?C0109
0023 2A                DB      02AH
0024 0000        R     DW      ?C0114
0026 2F                DB      02FH
0027 0000        R     DW      ?C0120
0029 43                DB      043H
002A 0000        R     DW      ?C0121
002C 4A                DB      04AH
002D 0000        R     DW      ?C0117
002F 5A                DB      05AH
0030 0000              DW      00H
0032 0000        R     DW      ?C0122
                                           ; SOURCE LINE # 770
                                           ; SOURCE LINE # 771
0034         ?C0108:
                                           ; SOURCE LINE # 772
0034 020000      R     LJMP    UFI_inquiry
                                           ; SOURCE LINE # 773
                                           ; SOURCE LINE # 774
0037         ?C0109:
                                           ; SOURCE LINE # 775
0037 020000      R     LJMP    UFI_write
                                           ; SOURCE LINE # 776
                                           ; SOURCE LINE # 777
003A         ?C0110:
                                           ; SOURCE LINE # 778
003A 020000      R     LJMP    UFI_testUnit
                                           ; SOURCE LINE # 779
                                           ; SOURCE LINE # 780
003D         ?C0111:
                                           ; SOURCE LINE # 781
003D 020000      R     LJMP    UFI_read10
                                           ; SOURCE LINE # 782
                                           ; SOURCE LINE # 783
0040         ?C0112:
                                           ; SOURCE LINE # 784
0040 020000      R     LJMP    UFI_requestSense
                                           ; SOURCE LINE # 785
                                           ; SOURCE LINE # 786
0043         ?C0113:
                                           ; SOURCE LINE # 787
0043 020000      R     LJMP    UFI_readCapacity
                                           ; SOURCE LINE # 788
                                           ; SOURCE LINE # 789
0046         ?C0114:
                                           ; SOURCE LINE # 790
0046 020000      R     LJMP    UFI_verify
                                           ; SOURCE LINE # 791
                                           ; SOURCE LINE # 792
0049         ?C0115:
                                           ; SOURCE LINE # 796
0049 E4                CLR     A
004A 900000      R     MOV     DPTR,#BcswStatus
004D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 797
004E 900000      R     MOV     DPTR,#mSenseKey
0051 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 798
0052 900000      R     MOV     DPTR,#mASC
0055 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 799
0056 22                RET     
                                           ; SOURCE LINE # 803
0057         ?C0116:
                                           ; SOURCE LINE # 804
0057 020000      R     LJMP    UFI_modeSense
                                           ; SOURCE LINE # 805
                                           ; SOURCE LINE # 806
005A         ?C0117:
                                           ; SOURCE LINE # 807
005A 020000      R     LJMP    UFI_modeSense5
                                           ; SOURCE LINE # 808
                                           ; SOURCE LINE # 819
005D         ?C0118:
                                           ; SOURCE LINE # 820
005D 120000      R     LCALL   UFI_staStoUnit
                                           ; SOURCE LINE # 821
0060 900000      E     MOV     DPTR,#ExecBadUSB
0063 7401              MOV     A,#01H
0065 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 822
0066 22                RET     
                                           ; SOURCE LINE # 823
0067         ?C0119:
                                           ; SOURCE LINE # 824
0067 020000      R     LJMP    UFI_perOrMed
                                           ; SOURCE LINE # 825
                                           ; SOURCE LINE # 826
006A         ?C0120:
                                           ; SOURCE LINE # 827
006A 020000      R     LJMP    UFI_readTOC
                                           ; SOURCE LINE # 828
                                           ; SOURCE LINE # 829
006D         ?C0121:
                                           ; SOURCE LINE # 830
006D 020000      R     LJMP    UFI_GET_EVE_STA_NOT
                                           ; SOURCE LINE # 831
                                           ; SOURCE LINE # 832
0070         ?C0122:
                                           ; SOURCE LINE # 833
0070 900000      R     MOV     DPTR,#mSenseKey
0073 7405              MOV     A,#05H
0075 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 834
0076 900000      R     MOV     DPTR,#mASC
0079 7420              MOV     A,#020H
007B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 835
007C 900000      R     MOV     DPTR,#BcswStatus
007F 7401              MOV     A,#01H
0081 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 836
0082 C200        R     CLR     CH375BULKUP
                                           ; SOURCE LINE # 837
0084 7F0E              MOV     R7,#0EH
0086 120000      R     LCALL   _BulkThirteen
                                           ; SOURCE LINE # 838
                                           ; SOURCE LINE # 839
                                           ; SOURCE LINE # 840
0089         ?C0123:
0089 22                RET     
             ; FUNCTION UFI_Hunding (END)

             ; FUNCTION mCH375BulkOnly (BEGIN)
                                           ; SOURCE LINE # 842
                                           ; SOURCE LINE # 843
                                           ; SOURCE LINE # 844
0000 7800        R     MOV     R0,#LOW MassPara
0002 E6                MOV     A,@R0
0003 6455              XRL     A,#055H
0005 706F              JNZ     ?C0124
                                           ; SOURCE LINE # 845
                                           ; SOURCE LINE # 846
0007 08                INC     R0
0008 E6                MOV     A,@R0
0009 6453              XRL     A,#053H
000B 7067              JNZ     ?C0125
                                           ; SOURCE LINE # 847
                                           ; SOURCE LINE # 848
000D 08                INC     R0
000E E6                MOV     A,@R0
000F 6442              XRL     A,#042H
0011 705F              JNZ     ?C0126
                                           ; SOURCE LINE # 849
                                           ; SOURCE LINE # 850
0013 08                INC     R0
0014 E6                MOV     A,@R0
0015 6443              XRL     A,#043H
0017 705D              JNZ     ?C0298
                                           ; SOURCE LINE # 851
                                           ; SOURCE LINE # 853
0019 7800        R     MOV     R0,#LOW MassPara+08H
001B E6                MOV     A,@R0
001C 900000      R     MOV     DPTR,#LEN+03H
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 854
0020 08                INC     R0
0021 E6                MOV     A,@R0
0022 900000      R     MOV     DPTR,#LEN+02H
0025 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 855
0026 08                INC     R0
0027 E6                MOV     A,@R0
0028 900000      R     MOV     DPTR,#LEN+01H
002B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 856
002C 08                INC     R0
002D E6                MOV     A,@R0
002E 900000      R     MOV     DPTR,#LEN
0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 857
0032 7800        R     MOV     R0,#LOW MassPara+04H
0034 E6                MOV     A,@R0
0035 900000      R     MOV     DPTR,#mdCBWTag
0038 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 858
0039 08                INC     R0
003A E6                MOV     A,@R0
003B A3                INC     DPTR
003C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 859
003D 08                INC     R0
003E E6                MOV     A,@R0
003F A3                INC     DPTR
0040 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 860
0041 08                INC     R0
0042 E6                MOV     A,@R0
0043 A3                INC     DPTR
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 862
0045 900000      R     MOV     DPTR,#LEN
0048 E0                MOVX    A,@DPTR
0049 FC                MOV     R4,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
004C FD                MOV     R5,A
004D A3                INC     DPTR
004E E0                MOVX    A,@DPTR
004F FE                MOV     R6,A
0050 A3                INC     DPTR
0051 E0                MOVX    A,@DPTR
0052 FF                MOV     R7,A
0053 EC                MOV     A,R4
0054 4D                ORL     A,R5
0055 4E                ORL     A,R6
0056 4F                ORL     A,R7
0057 6014              JZ      ?C0128
                                           ; SOURCE LINE # 863
                                           ; SOURCE LINE # 864
0059 7800        R     MOV     R0,#LOW MassPara+0CH
005B E6                MOV     A,@R0
005C D3                SETB    C
005D 30E701            JNB     ACC.7,?C0129
0060 C3                CLR     C
0061         ?C0129:
0061         ?C0130:
0061 9200        R     MOV     CH375BULKDOWN,C
                                           ; SOURCE LINE # 865
0063 7800        R     MOV     R0,#LOW MassPara+0CH
0065 E6                MOV     A,@R0
0066 C3                CLR     C
0067 30E701            JNB     ACC.7,?C0131
006A D3                SETB    C
006B         ?C0131:
006B         ?C0132:
006B 9200        R     MOV     CH375BULKUP,C
                                           ; SOURCE LINE # 866
006D         ?C0128:
                                           ; SOURCE LINE # 867
006D D200        R     SETB    CH375CSW
                                           ; SOURCE LINE # 868
006F 020000      R     LJMP    UFI_Hunding
                                           ; SOURCE LINE # 869
0072         ?C0126:
                                           ; SOURCE LINE # 874
0072         ?C0296:
                                           ; SOURCE LINE # 875
0072 8002              SJMP    ?C0298
0074         ?C0125:
                                           ; SOURCE LINE # 877
0074         ?C0297:
                                           ; SOURCE LINE # 878
0074 8000              SJMP    ?C0298
0076         ?C0124:
                                           ; SOURCE LINE # 880
0076         ?C0298:
0076 43D203            ORL     UEP1_CTRL,#03H
                                           ; SOURCE LINE # 881
0079         ?C0137:
0079 22                RET     
             ; FUNCTION mCH375BulkOnly (END)

             ; FUNCTION mCH375UpCsw (BEGIN)
                                           ; SOURCE LINE # 884
                                           ; SOURCE LINE # 885
                                           ; SOURCE LINE # 888
0000 900000      R     MOV     DPTR,#pBuf
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 7400        R     MOV     A,#HIGH MassPara
0008 F0                MOVX    @DPTR,A
0009 A3                INC     DPTR
000A 7400        R     MOV     A,#LOW MassPara
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 889
000D C200        R     CLR     CH375CSW
                                           ; SOURCE LINE # 890
000F C200        R     CLR     CH375BULKUP
                                           ; SOURCE LINE # 891
0011 F8                MOV     R0,A
0012 7655              MOV     @R0,#055H
                                           ; SOURCE LINE # 892
0014 08                INC     R0
0015 7653              MOV     @R0,#053H
                                           ; SOURCE LINE # 893
0017 08                INC     R0
0018 7642              MOV     @R0,#042H
                                           ; SOURCE LINE # 894
001A 08                INC     R0
001B 7653              MOV     @R0,#053H
                                           ; SOURCE LINE # 895
001D 900000      R     MOV     DPTR,#mdCBWTag
0020 E0                MOVX    A,@DPTR
0021 08                INC     R0
0022 F6                MOV     @R0,A
                                           ; SOURCE LINE # 896
0023 A3                INC     DPTR
0024 E0                MOVX    A,@DPTR
0025 08                INC     R0
0026 F6                MOV     @R0,A
                                           ; SOURCE LINE # 897
0027 A3                INC     DPTR
0028 E0                MOVX    A,@DPTR
0029 08                INC     R0
002A F6                MOV     @R0,A
                                           ; SOURCE LINE # 898
002B A3                INC     DPTR
002C E0                MOVX    A,@DPTR
002D 08                INC     R0
002E F6                MOV     @R0,A
                                           ; SOURCE LINE # 899
002F E4                CLR     A
0030 08                INC     R0
0031 F6                MOV     @R0,A
                                           ; SOURCE LINE # 900
0032 08                INC     R0
0033 F6                MOV     @R0,A
                                           ; SOURCE LINE # 901
0034 900000      R     MOV     DPTR,#LEN+01H
0037 E0                MOVX    A,@DPTR
0038 08                INC     R0
0039 F6                MOV     @R0,A
                                           ; SOURCE LINE # 902
003A 900000      R     MOV     DPTR,#LEN
003D E0                MOVX    A,@DPTR
003E 08                INC     R0
003F F6                MOV     @R0,A
                                           ; SOURCE LINE # 903
0040 900000      R     MOV     DPTR,#BcswStatus
0043 E0                MOVX    A,@DPTR
0044 08                INC     R0
0045 F6                MOV     @R0,A
                                           ; SOURCE LINE # 904
;---- Variable 'i' assigned to Register 'R7' ----
0046 E4                CLR     A
0047 FF                MOV     R7,A
0048         ?C0138:
0048 EF                MOV     A,R7
0049 C3                CLR     C
004A 940D              SUBB    A,#0DH
004C 7480              MOV     A,#080H
004E 9480              SUBB    A,#080H
0050 5028              JNC     ?C0139
                                           ; SOURCE LINE # 905
                                           ; SOURCE LINE # 906
0052 900000      R     MOV     DPTR,#pBuf
0055 E0                MOVX    A,@DPTR
0056 FB                MOV     R3,A
0057 A3                INC     DPTR
0058 E0                MOVX    A,@DPTR
0059 FA                MOV     R2,A
005A A3                INC     DPTR
005B E0                MOVX    A,@DPTR
005C F9                MOV     R1,A
005D 120000      E     LCALL   ?C?CLDPTR
0060 FE                MOV     R6,A
0061 7400        R     MOV     A,#LOW Ep1Buffer+040H
0063 2F                ADD     A,R7
0064 F582              MOV     DPL,A
0066 E4                CLR     A
0067 3400        R     ADDC    A,#HIGH Ep1Buffer+040H
0069 F583              MOV     DPH,A
006B EE                MOV     A,R6
006C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 907
006D 900000      R     MOV     DPTR,#pBuf+01H
0070 E4                CLR     A
0071 75F001            MOV     B,#01H
0074 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 908
0077 0F                INC     R7
0078 80CE              SJMP    ?C0138
007A         ?C0139:
                                           ; SOURCE LINE # 909
007A 75D30D            MOV     UEP1_T_LEN,#0DH
                                           ; SOURCE LINE # 910
007D 53D2FC            ANL     UEP1_CTRL,#0FCH
                                           ; SOURCE LINE # 911
0080 22                RET     
             ; FUNCTION mCH375UpCsw (END)

             ; FUNCTION mCH375bulkUpData (BEGIN)
                                           ; SOURCE LINE # 915
                                           ; SOURCE LINE # 916
                                           ; SOURCE LINE # 918
0000 E4                CLR     A
0001 7F40              MOV     R7,#040H
0003 FE                MOV     R6,A
0004 FD                MOV     R5,A
0005 FC                MOV     R4,A
0006 900000      R     MOV     DPTR,#LEN
0009 E0                MOVX    A,@DPTR
000A F8                MOV     R0,A
000B A3                INC     DPTR
000C E0                MOVX    A,@DPTR
000D F9                MOV     R1,A
000E A3                INC     DPTR
000F E0                MOVX    A,@DPTR
0010 FA                MOV     R2,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 FB                MOV     R3,A
0014 D3                SETB    C
0015 120000      E     LCALL   ?C?ULCMP
0018 402A              JC      ?C0142
                                           ; SOURCE LINE # 919
                                           ; SOURCE LINE # 920
001A 900000      R     MOV     DPTR,#len
001D 7440              MOV     A,#040H
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 921
0020 900000      R     MOV     DPTR,#LEN
0023 E0                MOVX    A,@DPTR
0024 FC                MOV     R4,A
0025 A3                INC     DPTR
0026 E0                MOVX    A,@DPTR
0027 FD                MOV     R5,A
0028 A3                INC     DPTR
0029 E0                MOVX    A,@DPTR
002A FE                MOV     R6,A
002B A3                INC     DPTR
002C E0                MOVX    A,@DPTR
002D 9440              SUBB    A,#040H
002F FF                MOV     R7,A
0030 EE                MOV     A,R6
0031 9400              SUBB    A,#00H
0033 FE                MOV     R6,A
0034 ED                MOV     A,R5
0035 9400              SUBB    A,#00H
0037 FD                MOV     R5,A
0038 EC                MOV     A,R4
0039 9400              SUBB    A,#00H
003B FC                MOV     R4,A
003C 900000      R     MOV     DPTR,#LEN
003F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 922
0042 8017              SJMP    ?C0143
0044         ?C0142:
                                           ; SOURCE LINE # 924
                                           ; SOURCE LINE # 925
0044 900000      R     MOV     DPTR,#LEN
0047 A3                INC     DPTR
0048 A3                INC     DPTR
0049 A3                INC     DPTR
004A E0                MOVX    A,@DPTR
004B 900000      R     MOV     DPTR,#len
004E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 926
004F 900000      R     MOV     DPTR,#LEN
0052 120000      E     LCALL   ?C?LSTKXDATA
0055 00                DB      00H
0056 00                DB      00H
0057 00                DB      00H
0058 00                DB      00H
                                           ; SOURCE LINE # 927
0059 C200        R     CLR     CH375BULKUP
                                           ; SOURCE LINE # 928
005B         ?C0143:
                                           ; SOURCE LINE # 929
005B 300070            JNB     pBuf_ReSelect,?C0144
                                           ; SOURCE LINE # 930
                                           ; SOURCE LINE # 931
005E 900000      R     MOV     DPTR,#Locate_Addr
0061 E0                MOVX    A,@DPTR
0062 FC                MOV     R4,A
0063 A3                INC     DPTR
0064 E0                MOVX    A,@DPTR
0065 FD                MOV     R5,A
0066 A3                INC     DPTR
0067 E0                MOVX    A,@DPTR
0068 FE                MOV     R6,A
0069 A3                INC     DPTR
006A E0                MOVX    A,@DPTR
006B FF                MOV     R7,A
006C 900000      R     MOV     DPTR,#len
006F E0                MOVX    A,@DPTR
0070 FB                MOV     R3,A
0071 900000      E     MOV     DPTR,#?_BulkReadFlash?BYTE+04H
0074 E4                CLR     A
0075 F0                MOVX    @DPTR,A
0076 A3                INC     DPTR
0077 EB                MOV     A,R3
0078 F0                MOVX    @DPTR,A
0079 A3                INC     DPTR
007A 7401              MOV     A,#01H
007C F0                MOVX    @DPTR,A
007D A3                INC     DPTR
007E 7400        R     MOV     A,#HIGH Ep1Buffer+040H
0080 F0                MOVX    @DPTR,A
0081 A3                INC     DPTR
0082 7400        R     MOV     A,#LOW Ep1Buffer+040H
0084 F0                MOVX    @DPTR,A
0085 120000      E     LCALL   _BulkReadFlash
                                           ; SOURCE LINE # 932
0088 900000      R     MOV     DPTR,#Locate_Addr
008B E0                MOVX    A,@DPTR
008C F8                MOV     R0,A
008D A3                INC     DPTR
008E E0                MOVX    A,@DPTR
008F F9                MOV     R1,A
0090 A3                INC     DPTR
0091 E0                MOVX    A,@DPTR
0092 FA                MOV     R2,A
0093 A3                INC     DPTR
0094 E0                MOVX    A,@DPTR
0095 FB                MOV     R3,A
0096 900000      R     MOV     DPTR,#len
0099 E0                MOVX    A,@DPTR
009A FF                MOV     R7,A
009B E4                CLR     A
009C FC                MOV     R4,A
009D FD                MOV     R5,A
009E FE                MOV     R6,A
009F EB                MOV     A,R3
00A0 2F                ADD     A,R7
00A1 FF                MOV     R7,A
00A2 EE                MOV     A,R6
00A3 3A                ADDC    A,R2
00A4 FE                MOV     R6,A
00A5 ED                MOV     A,R5
00A6 39                ADDC    A,R1
00A7 FD                MOV     R5,A
00A8 EC                MOV     A,R4
00A9 38                ADDC    A,R0
00AA FC                MOV     R4,A
00AB 900000      R     MOV     DPTR,#Locate_Addr
00AE 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 933
00B1 E4                CLR     A
00B2 FF                MOV     R7,A
00B3 FE                MOV     R6,A
00B4 FD                MOV     R5,A
00B5 FC                MOV     R4,A
00B6 900000      R     MOV     DPTR,#LEN
00B9 E0                MOVX    A,@DPTR
00BA F8                MOV     R0,A
00BB A3                INC     DPTR
00BC E0                MOVX    A,@DPTR
00BD F9                MOV     R1,A
00BE A3                INC     DPTR
00BF E0                MOVX    A,@DPTR
00C0 FA                MOV     R2,A
00C1 A3                INC     DPTR
00C2 E0                MOVX    A,@DPTR
00C3 FB                MOV     R3,A
00C4 C3                CLR     C
00C5 120000      E     LCALL   ?C?ULCMP
00C8 7038              JNZ     ?C0146
                                           ; SOURCE LINE # 934
00CA C200        R     CLR     pBuf_ReSelect
                                           ; SOURCE LINE # 935
00CC 8034              SJMP    ?C0146
00CE         ?C0144:
                                           ; SOURCE LINE # 937
                                           ; SOURCE LINE # 938
;---- Variable 'i' assigned to Register 'R7' ----
00CE E4                CLR     A
00CF FF                MOV     R7,A
00D0         ?C0147:
00D0 900000      R     MOV     DPTR,#len
00D3 E0                MOVX    A,@DPTR
00D4 FE                MOV     R6,A
00D5 EF                MOV     A,R7
00D6 C3                CLR     C
00D7 9E                SUBB    A,R6
00D8 5028              JNC     ?C0146
                                           ; SOURCE LINE # 939
                                           ; SOURCE LINE # 940
00DA 900000      R     MOV     DPTR,#pBuf
00DD E0                MOVX    A,@DPTR
00DE FB                MOV     R3,A
00DF A3                INC     DPTR
00E0 E0                MOVX    A,@DPTR
00E1 FA                MOV     R2,A
00E2 A3                INC     DPTR
00E3 E0                MOVX    A,@DPTR
00E4 F9                MOV     R1,A
00E5 120000      E     LCALL   ?C?CLDPTR
00E8 FE                MOV     R6,A
00E9 7400        R     MOV     A,#LOW Ep1Buffer+040H
00EB 2F                ADD     A,R7
00EC F582              MOV     DPL,A
00EE E4                CLR     A
00EF 3400        R     ADDC    A,#HIGH Ep1Buffer+040H
00F1 F583              MOV     DPH,A
00F3 EE                MOV     A,R6
00F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 941
00F5 900000      R     MOV     DPTR,#pBuf+01H
00F8 E4                CLR     A
00F9 75F001            MOV     B,#01H
00FC 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 942
00FF 0F                INC     R7
0100 80CE              SJMP    ?C0147
                                           ; SOURCE LINE # 943
0102         ?C0146:
                                           ; SOURCE LINE # 944
0102 900000      R     MOV     DPTR,#len
0105 E0                MOVX    A,@DPTR
0106 F5D3              MOV     UEP1_T_LEN,A
                                           ; SOURCE LINE # 945
0108 53D2FC            ANL     UEP1_CTRL,#0FCH
                                           ; SOURCE LINE # 946
010B 22                RET     
             ; FUNCTION mCH375bulkUpData (END)

             ; FUNCTION mCH375BulkDownData (BEGIN)
                                           ; SOURCE LINE # 950
                                           ; SOURCE LINE # 951
                                           ; SOURCE LINE # 954
0000 900000      R     MOV     DPTR,#len
0003 E5DB              MOV     A,USB_RX_LEN
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 955
;---- Variable 'i' assigned to Register 'R7' ----
0006 E4                CLR     A
0007 FF                MOV     R7,A
0008         ?C0151:
0008 900000      R     MOV     DPTR,#len
000B E0                MOVX    A,@DPTR
000C FB                MOV     R3,A
000D 6F                XRL     A,R7
000E 6015              JZ      ?C0152
                                           ; SOURCE LINE # 956
0010 7400        R     MOV     A,#LOW Ep1Buffer
0012 2F                ADD     A,R7
0013 F582              MOV     DPL,A
0015 E4                CLR     A
0016 3400        R     ADDC    A,#HIGH Ep1Buffer
0018 F583              MOV     DPH,A
001A E0                MOVX    A,@DPTR
001B FE                MOV     R6,A
001C 7400        R     MOV     A,#LOW buffer
001E 2F                ADD     A,R7
001F F8                MOV     R0,A
0020 EE                MOV     A,R6
0021 F6                MOV     @R0,A
0022 0F                INC     R7
0023 80E3              SJMP    ?C0151
0025         ?C0152:
                                           ; SOURCE LINE # 957
0025 900000      R     MOV     DPTR,#Locate_Addr
0028 E0                MOVX    A,@DPTR
0029 FC                MOV     R4,A
002A A3                INC     DPTR
002B E0                MOVX    A,@DPTR
002C FD                MOV     R5,A
002D A3                INC     DPTR
002E E0                MOVX    A,@DPTR
002F FE                MOV     R6,A
0030 A3                INC     DPTR
0031 E0                MOVX    A,@DPTR
0032 FF                MOV     R7,A
0033 900000      E     MOV     DPTR,#?_BulkWriteFlash?BYTE+04H
0036 E4                CLR     A
0037 F0                MOVX    @DPTR,A
0038 A3                INC     DPTR
0039 EB                MOV     A,R3
003A F0                MOVX    @DPTR,A
003B A3                INC     DPTR
003C E4                CLR     A
003D F0                MOVX    @DPTR,A
003E A3                INC     DPTR
003F 7400        R     MOV     A,#HIGH buffer
0041 F0                MOVX    @DPTR,A
0042 A3                INC     DPTR
0043 7400        R     MOV     A,#LOW buffer
0045 F0                MOVX    @DPTR,A
0046 120000      E     LCALL   _BulkWriteFlash
                                           ; SOURCE LINE # 958
0049 900000      R     MOV     DPTR,#Locate_Addr
004C E0                MOVX    A,@DPTR
004D F8                MOV     R0,A
004E A3                INC     DPTR
004F E0                MOVX    A,@DPTR
0050 F9                MOV     R1,A
0051 A3                INC     DPTR
0052 E0                MOVX    A,@DPTR
0053 FA                MOV     R2,A
0054 A3                INC     DPTR
0055 E0                MOVX    A,@DPTR
0056 FB                MOV     R3,A
0057 900000      R     MOV     DPTR,#len
005A E0                MOVX    A,@DPTR
005B FF                MOV     R7,A
005C E4                CLR     A
005D FC                MOV     R4,A
005E FD                MOV     R5,A
005F FE                MOV     R6,A
0060 EB                MOV     A,R3
0061 2F                ADD     A,R7
0062 FF                MOV     R7,A
0063 EE                MOV     A,R6
0064 3A                ADDC    A,R2
0065 FE                MOV     R6,A
0066 ED                MOV     A,R5
0067 39                ADDC    A,R1
0068 FD                MOV     R5,A
0069 EC                MOV     A,R4
006A 38                ADDC    A,R0
006B FC                MOV     R4,A
006C 900000      R     MOV     DPTR,#Locate_Addr
006F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 959
0072 900000      R     MOV     DPTR,#LEN
0075 E0                MOVX    A,@DPTR
0076 FC                MOV     R4,A
0077 A3                INC     DPTR
0078 E0                MOVX    A,@DPTR
0079 FD                MOV     R5,A
007A A3                INC     DPTR
007B E0                MOVX    A,@DPTR
007C FE                MOV     R6,A
007D A3                INC     DPTR
007E E0                MOVX    A,@DPTR
007F FF                MOV     R7,A
0080 EC                MOV     A,R4
0081 C0E0              PUSH    ACC
0083 ED                MOV     A,R5
0084 C0E0              PUSH    ACC
0086 EE                MOV     A,R6
0087 C0E0              PUSH    ACC
0089 EF                MOV     A,R7
008A C0E0              PUSH    ACC
008C 900000      R     MOV     DPTR,#len
008F E0                MOVX    A,@DPTR
0090 FF                MOV     R7,A
0091 CB                XCH     A,R3
0092 EF                MOV     A,R7
0093 CB                XCH     A,R3
0094 D0E0              POP     ACC
0096 FF                MOV     R7,A
0097 D0E0              POP     ACC
0099 FE                MOV     R6,A
009A D0E0              POP     ACC
009C FD                MOV     R5,A
009D D0E0              POP     ACC
009F FC                MOV     R4,A
00A0 C3                CLR     C
00A1 EF                MOV     A,R7
00A2 9B                SUBB    A,R3
00A3 FF                MOV     R7,A
00A4 EE                MOV     A,R6
00A5 9400              SUBB    A,#00H
00A7 FE                MOV     R6,A
00A8 ED                MOV     A,R5
00A9 9400              SUBB    A,#00H
00AB FD                MOV     R5,A
00AC EC                MOV     A,R4
00AD 9400              SUBB    A,#00H
00AF FC                MOV     R4,A
00B0 900000      R     MOV     DPTR,#LEN
00B3 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 960
00B6 E4                CLR     A
00B7 FF                MOV     R7,A
00B8 FE                MOV     R6,A
00B9 FD                MOV     R5,A
00BA FC                MOV     R4,A
00BB 900000      R     MOV     DPTR,#LEN
00BE E0                MOVX    A,@DPTR
00BF F8                MOV     R0,A
00C0 A3                INC     DPTR
00C1 E0                MOVX    A,@DPTR
00C2 F9                MOV     R1,A
00C3 A3                INC     DPTR
00C4 E0                MOVX    A,@DPTR
00C5 FA                MOV     R2,A
00C6 A3                INC     DPTR
00C7 E0                MOVX    A,@DPTR
00C8 FB                MOV     R3,A
00C9 C3                CLR     C
00CA 120000      E     LCALL   ?C?ULCMP
00CD 7005              JNZ     ?C0155
                                           ; SOURCE LINE # 961
                                           ; SOURCE LINE # 962
00CF C200        R     CLR     CH375BULKDOWN
                                           ; SOURCE LINE # 963
00D1 120000      R     LCALL   mCH375UpCsw
                                           ; SOURCE LINE # 964
                                           ; SOURCE LINE # 965
00D4         ?C0155:
00D4 22                RET     
             ; FUNCTION mCH375BulkDownData (END)

             ; FUNCTION USB_DeviceInterrupt (BEGIN)
0000 C0E0              PUSH    ACC
0002 C0F0              PUSH    B
0004 C083              PUSH    DPH
0006 C082              PUSH    DPL
0008 C0D0              PUSH    PSW
000A 75D008            MOV     PSW,#08H
                                           ; SOURCE LINE # 971
                                           ; SOURCE LINE # 977
000D 20D903            JB      UIF_TRANSFER,$ + 6H
0010 020000      R     LJMP    ?C0156
                                           ; SOURCE LINE # 978
                                           ; SOURCE LINE # 979
0013 E5D9              MOV     A,USB_INT_ST
0015 543F              ANL     A,#03FH
0017 7003              JNZ     $ + 5H
0019 020000      R     LJMP    ?C0238
001C 14                DEC     A
001D 602E              JZ      ?C0163
001F 24E1              ADD     A,#0E1H
0021 7003              JNZ     $ + 5H
0023 020000      R     LJMP    ?C0231
0026 24FE              ADD     A,#0FEH
0028 607A              JZ      ?C0175
002A 24F2              ADD     A,#0F2H
002C 7003              JNZ     $ + 5H
002E 020000      R     LJMP    ?C0176
0031 240F              ADD     A,#0FH
0033 6003              JZ      $ + 5H
0035 020000      R     LJMP    ?C0157
                                           ; SOURCE LINE # 980
                                           ; SOURCE LINE # 981
0038         ?C0158:
                                           ; SOURCE LINE # 982
                                           ; SOURCE LINE # 983
0038 300002            JNB     CH375BULKUP,?C0159
003B 8055              SJMP    ?C0299
003D         ?C0159:
                                           ; SOURCE LINE # 984
003D 300002            JNB     CH375CSW,?C0161
0040 805C              SJMP    ?C0300
0042         ?C0161:
                                           ; SOURCE LINE # 986
0042 E5D2              MOV     A,UEP1_CTRL
0044 54FC              ANL     A,#0FCH
0046 4402              ORL     A,#02H
0048 F5D2              MOV     UEP1_CTRL,A
                                           ; SOURCE LINE # 987
004A 020000      R     LJMP    ?C0157
                                           ; SOURCE LINE # 988
                                           ; SOURCE LINE # 989
004D         ?C0163:
                                           ; SOURCE LINE # 990
                                           ; SOURCE LINE # 991
004D 20DE03            JB      U_TOG_OK,$ + 6H
0050 020000      R     LJMP    ?C0157
                                           ; SOURCE LINE # 992
                                           ; SOURCE LINE # 993
0053 300006            JNB     CH375BULKDOWN,?C0165
0056 120000      R     LCALL   mCH375BulkDownData
0059 020000      R     LJMP    ?C0157
005C         ?C0165:
                                           ; SOURCE LINE # 995
                                           ; SOURCE LINE # 996
005C 900000      R     MOV     DPTR,#len
005F E5DB              MOV     A,USB_RX_LEN
0061 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 997
0062 E0                MOVX    A,@DPTR
0063 7003              JNZ     $ + 5H
0065 020000      R     LJMP    ?C0157
                                           ; SOURCE LINE # 998
;---- Variable 'i' assigned to Register 'R7' ----
0068 E4                CLR     A
0069 FF                MOV     R7,A
006A         ?C0168:
006A 900000      R     MOV     DPTR,#len
006D E0                MOVX    A,@DPTR
006E 6F                XRL     A,R7
006F 6015              JZ      ?C0169
                                           ; SOURCE LINE # 999
0071 7400        R     MOV     A,#LOW Ep1Buffer
0073 2F                ADD     A,R7
0074 F582              MOV     DPL,A
0076 E4                CLR     A
0077 3400        R     ADDC    A,#HIGH Ep1Buffer
0079 F583              MOV     DPH,A
007B E0                MOVX    A,@DPTR
007C FE                MOV     R6,A
007D 7400        R     MOV     A,#LOW MassPara
007F 2F                ADD     A,R7
0080 F8                MOV     R0,A
0081 EE                MOV     A,R6
0082 F6                MOV     @R0,A
0083 0F                INC     R7
0084 80E4              SJMP    ?C0168
0086         ?C0169:
                                           ; SOURCE LINE # 1000
0086 120000      R     LCALL   mCH375BulkOnly
                                           ; SOURCE LINE # 1001
0089 300003      R     JNB     CH375BULKDOWN,$ + 6H
008C 020000      R     LJMP    ?C0157
                                           ; SOURCE LINE # 1002
                                           ; SOURCE LINE # 1003
008F 300006            JNB     CH375BULKUP,?C0172
0092         ?C0299:
0092 120000      R     LCALL   mCH375bulkUpData
0095 020000      R     LJMP    ?C0157
0098         ?C0172:
                                           ; SOURCE LINE # 1004
0098 300003      R     JNB     FSTALL,$ + 6H
009B 020000      R     LJMP    ?C0157
009E         ?C0300:
009E 120000      R     LCALL   mCH375UpCsw
                                           ; SOURCE LINE # 1006
                                           ; SOURCE LINE # 1007
                                           ; SOURCE LINE # 1008
                                           ; SOURCE LINE # 1009
00A1 020000      R     LJMP    ?C0157
                                           ; SOURCE LINE # 1010
                                           ; SOURCE LINE # 1011
00A4         ?C0175:
                                           ; SOURCE LINE # 1012
                                           ; SOURCE LINE # 1013
00A4 75D500            MOV     UEP2_T_LEN,#00H
                                           ; SOURCE LINE # 1014
00A7 E5D4              MOV     A,UEP2_CTRL
00A9 54FC              ANL     A,#0FCH
00AB 4402              ORL     A,#02H
00AD F5D4              MOV     UEP2_CTRL,A
                                           ; SOURCE LINE # 1015
00AF 900000      R     MOV     DPTR,#IsHIDDataSent
00B2 7401              MOV     A,#01H
00B4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1016
00B5 020000      R     LJMP    ?C0157
                                           ; SOURCE LINE # 1017
                                           ; SOURCE LINE # 1018
00B8         ?C0176:
                                           ; SOURCE LINE # 1019
                                           ; SOURCE LINE # 1020
00B8 900000      R     MOV     DPTR,#len
00BB E5DB              MOV     A,USB_RX_LEN
00BD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1021
00BE E0                MOVX    A,@DPTR
00BF 6408              XRL     A,#08H
00C1 6003              JZ      $ + 5H
00C3 020000      R     LJMP    ?C0177
                                           ; SOURCE LINE # 1022
                                           ; SOURCE LINE # 1023
00C6 900000      R     MOV     DPTR,#Ep0Buffer+06H
00C9 E0                MOVX    A,@DPTR
00CA 900000      R     MOV     DPTR,#SetupLen
00CD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1024
00CE 900000      R     MOV     DPTR,#Ep0Buffer+07H
00D1 E0                MOVX    A,@DPTR
00D2 700D              JNZ     ?C0179
00D4 900000      R     MOV     DPTR,#SetupLen
00D7 E0                MOVX    A,@DPTR
00D8 D3                SETB    C
00D9 947F              SUBB    A,#07FH
00DB 7480              MOV     A,#080H
00DD 9480              SUBB    A,#080H
00DF 4006              JC      ?C0178
00E1         ?C0179:
                                           ; SOURCE LINE # 1025
                                           ; SOURCE LINE # 1026
00E1 900000      R     MOV     DPTR,#SetupLen
00E4 747F              MOV     A,#07FH
00E6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1027
00E7         ?C0178:
                                           ; SOURCE LINE # 1028
00E7 900000      R     MOV     DPTR,#len
00EA E4                CLR     A
00EB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1029
00EC 900000      R     MOV     DPTR,#Ep0Buffer
00EF E0                MOVX    A,@DPTR
00F0 5460              ANL     A,#060H
00F2 7003              JNZ     $ + 5H
00F4 020000      R     LJMP    ?C0180
                                           ; SOURCE LINE # 1030
                                           ; SOURCE LINE # 1031
00F7 A3                INC     DPTR
00F8 E0                MOVX    A,@DPTR
00F9 900000      R     MOV     DPTR,#SetupReqCode
00FC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1032
00FD 64FE              XRL     A,#0FEH
00FF 6003              JZ      $ + 5H
0101 020000      R     LJMP    ?C0226
                                           ; SOURCE LINE # 1033
                                           ; SOURCE LINE # 1034
0104 900000      R     MOV     DPTR,#pDescr
0107 74FF              MOV     A,#0FFH
0109 F0                MOVX    @DPTR,A
010A A3                INC     DPTR
010B 7400        R     MOV     A,#HIGH MAX_LUN
010D F0                MOVX    @DPTR,A
010E A3                INC     DPTR
010F 7400        R     MOV     A,#LOW MAX_LUN
0111 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1035
0112 900000      R     MOV     DPTR,#len
0115 7401              MOV     A,#01H
0117 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1036
0118 900000      R     MOV     DPTR,#SetupLen
011B E0                MOVX    A,@DPTR
011C D3                SETB    C
011D 9401              SUBB    A,#01H
011F 4008              JC      ?C0182
                                           ; SOURCE LINE # 1037
                                           ; SOURCE LINE # 1038
0121 900000      R     MOV     DPTR,#len
0124 E0                MOVX    A,@DPTR
0125 900000      R     MOV     DPTR,#SetupLen
0128 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1039
0129         ?C0182:
                                           ; SOURCE LINE # 1040
0129 900000      R     MOV     DPTR,#SetupLen
012C E0                MOVX    A,@DPTR
012D FF                MOV     R7,A
012E C3                CLR     C
012F 9408              SUBB    A,#08H
0131 7480              MOV     A,#080H
0133 9480              SUBB    A,#080H
0135 4007              JC      ?C0183
0137 7E08              MOV     R6,#08H
0139 CF                XCH     A,R7
013A EE                MOV     A,R6
013B CF                XCH     A,R7
013C 8000              SJMP    ?C0184
013E         ?C0183:
013E         ?C0184:
013E 900000      R     MOV     DPTR,#len
0141 EF                MOV     A,R7
0142 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1041
0143 7E00              MOV     R6,#00H
0145 C8                XCH     A,R0
0146 7400        R     MOV     A,#LOW Ep0Buffer
0148 C8                XCH     A,R0
0149 CC                XCH     A,R4
014A 7400        R     MOV     A,#HIGH Ep0Buffer
014C CC                XCH     A,R4
014D CD                XCH     A,R5
014E 7401              MOV     A,#01H
0150 CD                XCH     A,R5
0151 900000      R     MOV     DPTR,#pDescr
0154 E0                MOVX    A,@DPTR
0155 FB                MOV     R3,A
0156 A3                INC     DPTR
0157 E0                MOVX    A,@DPTR
0158 FA                MOV     R2,A
0159 A3                INC     DPTR
015A E0                MOVX    A,@DPTR
015B F9                MOV     R1,A
015C 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 1042
015F 900000      R     MOV     DPTR,#SetupLen
0162 E0                MOVX    A,@DPTR
0163 FF                MOV     R7,A
0164 900000      R     MOV     DPTR,#len
0167 E0                MOVX    A,@DPTR
0168 FE                MOV     R6,A
0169 C3                CLR     C
016A EF                MOV     A,R7
016B 9E                SUBB    A,R6
016C 900000      R     MOV     DPTR,#SetupLen
016F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1043
0170 EE                MOV     A,R6
0171 FF                MOV     R7,A
0172 900000      R     MOV     DPTR,#pDescr+01H
0175 E4                CLR     A
0176 8FF0              MOV     B,R7
0178 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 1044
017B 900000      E     MOV     DPTR,#USBReady
                                           ; SOURCE LINE # 1045
                                           ; SOURCE LINE # 1046
017E 020000      R     LJMP    ?C0304
0181         ?C0180:
                                           ; SOURCE LINE # 1048
                                           ; SOURCE LINE # 1049
0181 900000      R     MOV     DPTR,#Ep0Buffer+01H
0184 E0                MOVX    A,@DPTR
0185 900000      R     MOV     DPTR,#SetupReqCode
0188 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1050
0189 7003              JNZ     $ + 5H
018B 020000      R     LJMP    ?C0222
018E 14                DEC     A
018F 7003              JNZ     $ + 5H
0191 020000      R     LJMP    ?C0209
0194 24FC              ADD     A,#0FCH
0196 7003              JNZ     $ + 5H
0198 020000      R     LJMP    ?C0205
019B 24FD              ADD     A,#0FDH
019D 7003              JNZ     $ + 5H
019F 020000      R     LJMP    ?C0206
01A2 14                DEC     A
01A3 7003              JNZ     $ + 5H
01A5 020000      R     LJMP    ?C0208
01A8 14                DEC     A
01A9 7003              JNZ     $ + 5H
01AB 020000      R     LJMP    ?C0220
01AE 2404              ADD     A,#04H
01B0 6003              JZ      $ + 5H
01B2 020000      R     LJMP    ?C0225
                                           ; SOURCE LINE # 1051
                                           ; SOURCE LINE # 1052
01B5         ?C0187:
                                           ; SOURCE LINE # 1053
01B5 900000      R     MOV     DPTR,#Ep0Buffer+03H
01B8 E0                MOVX    A,@DPTR
01B9 24FE              ADD     A,#0FEH
01BB 6028              JZ      ?C0190
01BD 14                DEC     A
01BE 603B              JZ      ?C0191
01C0 24E1              ADD     A,#0E1H
01C2 7003              JNZ     $ + 5H
01C4 020000      R     LJMP    ?C0197
01C7 2421              ADD     A,#021H
01C9 6003              JZ      $ + 5H
01CB 020000      R     LJMP    ?C0201
                                           ; SOURCE LINE # 1054
                                           ; SOURCE LINE # 1055
01CE         ?C0189:
                                           ; SOURCE LINE # 1056
01CE 900000      R     MOV     DPTR,#pDescr
01D1 74FF              MOV     A,#0FFH
01D3 F0                MOVX    @DPTR,A
01D4 A3                INC     DPTR
01D5 7400        R     MOV     A,#HIGH MyDevDescr
01D7 F0                MOVX    @DPTR,A
01D8 A3                INC     DPTR
01D9 7400        R     MOV     A,#LOW MyDevDescr
01DB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1057
01DC 900000      R     MOV     DPTR,#len
01DF 7412              MOV     A,#012H
01E1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1058
01E2 020000      R     LJMP    ?C0188
                                           ; SOURCE LINE # 1059
01E5         ?C0190:
                                           ; SOURCE LINE # 1060
01E5 900000      R     MOV     DPTR,#pDescr
01E8 74FF              MOV     A,#0FFH
01EA F0                MOVX    @DPTR,A
01EB A3                INC     DPTR
01EC 7400        R     MOV     A,#HIGH MyCfgDescr
01EE F0                MOVX    @DPTR,A
01EF A3                INC     DPTR
01F0 7400        R     MOV     A,#LOW MyCfgDescr
01F2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1061
01F3 900000      R     MOV     DPTR,#len
01F6 7439              MOV     A,#039H
01F8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1062
01F9 8074              SJMP    ?C0188
                                           ; SOURCE LINE # 1063
01FB         ?C0191:
                                           ; SOURCE LINE # 1064
01FB 900000      R     MOV     DPTR,#Ep0Buffer+02H
01FE E0                MOVX    A,@DPTR
01FF 14                DEC     A
0200 601D              JZ      ?C0194
0202 14                DEC     A
0203 6030              JZ      ?C0195
0205 2402              ADD     A,#02H
0207 7060              JNZ     ?C0303
                                           ; SOURCE LINE # 1065
                                           ; SOURCE LINE # 1066
0209         ?C0193:
                                           ; SOURCE LINE # 1067
0209 900000      R     MOV     DPTR,#pDescr
020C 74FF              MOV     A,#0FFH
020E F0                MOVX    @DPTR,A
020F A3                INC     DPTR
0210 7400        R     MOV     A,#HIGH MyLangDescr
0212 F0                MOVX    @DPTR,A
0213 A3                INC     DPTR
0214 7400        R     MOV     A,#LOW MyLangDescr
0216 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1068
0217 900000      R     MOV     DPTR,#len
021A 7404              MOV     A,#04H
021C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1069
021D 8050              SJMP    ?C0188
                                           ; SOURCE LINE # 1070
021F         ?C0194:
                                           ; SOURCE LINE # 1071
021F 900000      R     MOV     DPTR,#pDescr
0222 74FF              MOV     A,#0FFH
0224 F0                MOVX    @DPTR,A
0225 A3                INC     DPTR
0226 7400        R     MOV     A,#HIGH MyManuInfo
0228 F0                MOVX    @DPTR,A
0229 A3                INC     DPTR
022A 7400        R     MOV     A,#LOW MyManuInfo
022C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1072
022D 900000      R     MOV     DPTR,#len
0230 740E              MOV     A,#0EH
0232 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1073
0233 803A              SJMP    ?C0188
                                           ; SOURCE LINE # 1074
0235         ?C0195:
                                           ; SOURCE LINE # 1075
0235 900000      R     MOV     DPTR,#pDescr
0238 74FF              MOV     A,#0FFH
023A F0                MOVX    @DPTR,A
023B A3                INC     DPTR
023C 7400        R     MOV     A,#HIGH MyProdInfo
023E F0                MOVX    @DPTR,A
023F A3                INC     DPTR
0240 7400        R     MOV     A,#LOW MyProdInfo
0242 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1076
0243 900000      R     MOV     DPTR,#len
0246 740C              MOV     A,#0CH
0248 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1077
0249 8024              SJMP    ?C0188
                                           ; SOURCE LINE # 1078
                                           ; SOURCE LINE # 1081
                                           ; SOURCE LINE # 1082
                                           ; SOURCE LINE # 1083
024B         ?C0197:
                                           ; SOURCE LINE # 1084
024B 900000      R     MOV     DPTR,#Ep0Buffer+02H
024E E0                MOVX    A,@DPTR
024F 7016              JNZ     ?C0200
                                           ; SOURCE LINE # 1085
                                           ; SOURCE LINE # 1086
0251         ?C0199:
                                           ; SOURCE LINE # 1087
0251 900000      R     MOV     DPTR,#pDescr
0254 74FF              MOV     A,#0FFH
0256 F0                MOVX    @DPTR,A
0257 A3                INC     DPTR
0258 7400        R     MOV     A,#HIGH HIDReportDescriptor
025A F0                MOVX    @DPTR,A
025B A3                INC     DPTR
025C 7400        R     MOV     A,#LOW HIDReportDescriptor
025E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1088
025F 900000      R     MOV     DPTR,#len
0262 743F              MOV     A,#03FH
0264 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1089
0265 8008              SJMP    ?C0188
                                           ; SOURCE LINE # 1090
0267         ?C0200:
                                           ; SOURCE LINE # 1091
0267         ?C0302:
                                           ; SOURCE LINE # 1092
0267 8000              SJMP    ?C0303
                                           ; SOURCE LINE # 1093
                                           ; SOURCE LINE # 1094
                                           ; SOURCE LINE # 1095
0269         ?C0201:
                                           ; SOURCE LINE # 1096
0269         ?C0303:
0269 900000      R     MOV     DPTR,#len
026C 74FF              MOV     A,#0FFH
026E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1097
                                           ; SOURCE LINE # 1098
026F         ?C0188:
                                           ; SOURCE LINE # 1099
026F 900000      R     MOV     DPTR,#len
0272 E0                MOVX    A,@DPTR
0273 FF                MOV     R7,A
0274 900000      R     MOV     DPTR,#SetupLen
0277 E0                MOVX    A,@DPTR
0278 D3                SETB    C
0279 9F                SUBB    A,R7
027A 4002              JC      ?C0202
                                           ; SOURCE LINE # 1100
                                           ; SOURCE LINE # 1101
027C EF                MOV     A,R7
027D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1102
027E         ?C0202:
                                           ; SOURCE LINE # 1103
027E 900000      R     MOV     DPTR,#SetupLen
0281 E0                MOVX    A,@DPTR
0282 FF                MOV     R7,A
0283 C3                CLR     C
0284 9408              SUBB    A,#08H
0286 7480              MOV     A,#080H
0288 9480              SUBB    A,#080H
028A 4007              JC      ?C0203
028C 7E08              MOV     R6,#08H
028E CF                XCH     A,R7
028F EE                MOV     A,R6
0290 CF                XCH     A,R7
0291 8000              SJMP    ?C0204
0293         ?C0203:
0293         ?C0204:
0293 900000      R     MOV     DPTR,#len
0296 EF                MOV     A,R7
0297 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1104
0298 7E00              MOV     R6,#00H
029A C8                XCH     A,R0
029B 7400        R     MOV     A,#LOW Ep0Buffer
029D C8                XCH     A,R0
029E CC                XCH     A,R4
029F 7400        R     MOV     A,#HIGH Ep0Buffer
02A1 CC                XCH     A,R4
02A2 CD                XCH     A,R5
02A3 7401              MOV     A,#01H
02A5 CD                XCH     A,R5
02A6 900000      R     MOV     DPTR,#pDescr
02A9 E0                MOVX    A,@DPTR
02AA FB                MOV     R3,A
02AB A3                INC     DPTR
02AC E0                MOVX    A,@DPTR
02AD FA                MOV     R2,A
02AE A3                INC     DPTR
02AF E0                MOVX    A,@DPTR
02B0 F9                MOV     R1,A
02B1 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 1105
02B4 900000      R     MOV     DPTR,#SetupLen
02B7 E0                MOVX    A,@DPTR
02B8 FF                MOV     R7,A
02B9 900000      R     MOV     DPTR,#len
02BC E0                MOVX    A,@DPTR
02BD FE                MOV     R6,A
02BE C3                CLR     C
02BF EF                MOV     A,R7
02C0 9E                SUBB    A,R6
02C1 900000      R     MOV     DPTR,#SetupLen
02C4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1106
02C5 EE                MOV     A,R6
02C6 FF                MOV     R7,A
02C7 900000      R     MOV     DPTR,#pDescr+01H
02CA E4                CLR     A
02CB 8FF0              MOV     B,R7
02CD 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 1107
02D0 020000      R     LJMP    ?C0226
                                           ; SOURCE LINE # 1108
02D3         ?C0205:
                                           ; SOURCE LINE # 1109
02D3 900000      R     MOV     DPTR,#Ep0Buffer+02H
02D6 E0                MOVX    A,@DPTR
02D7 900000      R     MOV     DPTR,#SetupLen
02DA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1110
02DB 020000      R     LJMP    ?C0226
                                           ; SOURCE LINE # 1111
02DE         ?C0206:
                                           ; SOURCE LINE # 1112
02DE 900000      R     MOV     DPTR,#UsbConfig
02E1 E0                MOVX    A,@DPTR
02E2 900000      R     MOV     DPTR,#Ep0Buffer
02E5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1113
02E6 900000      R     MOV     DPTR,#SetupLen
02E9 E0                MOVX    A,@DPTR
02EA C3                CLR     C
02EB 9401              SUBB    A,#01H
02ED 7480              MOV     A,#080H
02EF 9480              SUBB    A,#080H
02F1 5003              JNC     $ + 5H
02F3 020000      R     LJMP    ?C0226
                                           ; SOURCE LINE # 1114
                                           ; SOURCE LINE # 1115
02F6 900000      R     MOV     DPTR,#len
02F9         ?C0301:
                                           ; SOURCE LINE # 1116
                                           ; SOURCE LINE # 1117
02F9 8076              SJMP    ?C0304
                                           ; SOURCE LINE # 1118
02FB         ?C0208:
                                           ; SOURCE LINE # 1119
02FB 900000      R     MOV     DPTR,#Ep0Buffer+02H
02FE E0                MOVX    A,@DPTR
02FF 900000      R     MOV     DPTR,#UsbConfig
0302 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1120
0303 7BFF              MOV     R3,#0FFH
0305 7A00        R     MOV     R2,#HIGH ?SC_0
0307 7900        R     MOV     R1,#LOW ?SC_0
0309 120000      E     LCALL   _printf
                                           ; SOURCE LINE # 1121
030C 020000      R     LJMP    ?C0226
                                           ; SOURCE LINE # 1122
030F         ?C0209:
                                           ; SOURCE LINE # 1123
030F 900000      R     MOV     DPTR,#Ep0Buffer
0312 E0                MOVX    A,@DPTR
0313 541F              ANL     A,#01FH
0315 6402              XRL     A,#02H
0317 7041              JNZ     ?C0210
                                           ; SOURCE LINE # 1124
                                           ; SOURCE LINE # 1125
0319 900000      R     MOV     DPTR,#Ep0Buffer+04H
031C E0                MOVX    A,@DPTR
031D 14                DEC     A
031E 6029              JZ      ?C0216
0320 14                DEC     A
0321 6011              JZ      ?C0213
0323 2481              ADD     A,#081H
0325 6012              JZ      ?C0214
0327 14                DEC     A
0328 7030              JNZ     ?C0306
                                           ; SOURCE LINE # 1126
                                           ; SOURCE LINE # 1127
032A         ?C0212:
                                           ; SOURCE LINE # 1128
032A E5D4              MOV     A,UEP2_CTRL
032C 54BC              ANL     A,#0BCH
032E 4402              ORL     A,#02H
0330 F5D4              MOV     UEP2_CTRL,A
                                           ; SOURCE LINE # 1129
0332 806B              SJMP    ?C0226
                                           ; SOURCE LINE # 1130
0334         ?C0213:
                                           ; SOURCE LINE # 1131
0334 53D473            ANL     UEP2_CTRL,#073H
                                           ; SOURCE LINE # 1132
0337 8066              SJMP    ?C0226
                                           ; SOURCE LINE # 1133
0339         ?C0214:
                                           ; SOURCE LINE # 1134
0339 E5D2              MOV     A,UEP1_CTRL
033B 54BC              ANL     A,#0BCH
033D 4402              ORL     A,#02H
033F F5D2              MOV     UEP1_CTRL,A
                                           ; SOURCE LINE # 1135
0341 30000E            JNB     CH375CSW,?C0305
0344 120000      R     LCALL   mCH375UpCsw
0347         ?C0215:
                                           ; SOURCE LINE # 1136
                                           ; SOURCE LINE # 1137
                                           ; SOURCE LINE # 1138
0347 8009              SJMP    ?C0305
                                           ; SOURCE LINE # 1139
0349         ?C0216:
                                           ; SOURCE LINE # 1140
0349 53D273            ANL     UEP1_CTRL,#073H
                                           ; SOURCE LINE # 1141
034C 300003            JNB     CH375CSW,?C0217
034F 120000      R     LCALL   mCH375UpCsw
0352         ?C0217:
                                           ; SOURCE LINE # 1142
0352         ?C0305:
0352 A200        R     MOV     C,FSTALL
0354 9200        R     MOV     lastFSTALL,C
                                           ; SOURCE LINE # 1143
0356 C200        R     CLR     FSTALL
                                           ; SOURCE LINE # 1144
0358 8045              SJMP    ?C0226
                                           ; SOURCE LINE # 1145
                                           ; SOURCE LINE # 1148
                                           ; SOURCE LINE # 1149
035A         ?C0210:
                                           ; SOURCE LINE # 1151
                                           ; SOURCE LINE # 1152
035A         ?C0306:
                                           ; SOURCE LINE # 1153
                                           ; SOURCE LINE # 1154
035A 803D              SJMP    ?C0308
                                           ; SOURCE LINE # 1155
035C         ?C0220:
                                           ; SOURCE LINE # 1156
035C 900000      R     MOV     DPTR,#Ep0Buffer
035F E4                CLR     A
0360 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1157
0361 900000      R     MOV     DPTR,#SetupLen
0364 E0                MOVX    A,@DPTR
0365 C3                CLR     C
0366 9401              SUBB    A,#01H
0368 7480              MOV     A,#080H
036A 9480              SUBB    A,#080H
036C 4031              JC      ?C0226
                                           ; SOURCE LINE # 1158
                                           ; SOURCE LINE # 1159
036E 900000      R     MOV     DPTR,#len
0371         ?C0304:
0371 7401              MOV     A,#01H
0373 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1160
                                           ; SOURCE LINE # 1161
0374 8029              SJMP    ?C0226
                                           ; SOURCE LINE # 1162
0376         ?C0222:
                                           ; SOURCE LINE # 1163
0376 900000      R     MOV     DPTR,#Ep0Buffer
0379 E4                CLR     A
037A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1164
037B A3                INC     DPTR
037C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1165
037D 900000      R     MOV     DPTR,#SetupLen
0380 E0                MOVX    A,@DPTR
0381 FF                MOV     R7,A
0382 C3                CLR     C
0383 9402              SUBB    A,#02H
0385 7480              MOV     A,#080H
0387 9480              SUBB    A,#080H
0389 900000      R     MOV     DPTR,#len
038C 4005              JC      ?C0223
                                           ; SOURCE LINE # 1166
                                           ; SOURCE LINE # 1167
038E 7402              MOV     A,#02H
0390 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1168
0391 800C              SJMP    ?C0226
0393         ?C0223:
                                           ; SOURCE LINE # 1170
                                           ; SOURCE LINE # 1171
0393 EF                MOV     A,R7
0394 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1172
                                           ; SOURCE LINE # 1173
0395 8008              SJMP    ?C0226
                                           ; SOURCE LINE # 1174
0397         ?C0225:
                                           ; SOURCE LINE # 1175
0397         ?C0307:
                                           ; SOURCE LINE # 1176
0397 8000              SJMP    ?C0308
                                           ; SOURCE LINE # 1177
                                           ; SOURCE LINE # 1178
                                           ; SOURCE LINE # 1179
0399         ?C0177:
                                           ; SOURCE LINE # 1181
                                           ; SOURCE LINE # 1182
0399         ?C0308:
0399 900000      R     MOV     DPTR,#len
039C 74FF              MOV     A,#0FFH
039E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1183
039F         ?C0226:
                                           ; SOURCE LINE # 1185
039F 900000      R     MOV     DPTR,#len
03A2 E0                MOVX    A,@DPTR
03A3 FF                MOV     R7,A
03A4 7E00              MOV     R6,#00H
03A6 F4                CPL     A
03A7 700C              JNZ     ?C0227
                                           ; SOURCE LINE # 1186
                                           ; SOURCE LINE # 1187
03A9 900000      R     MOV     DPTR,#SetupReqCode
03AC 74FF              MOV     A,#0FFH
03AE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1188
03AF 75DCCF            MOV     UEP0_CTRL,#0CFH
                                           ; SOURCE LINE # 1189
03B2 020000      R     LJMP    ?C0157
03B5         ?C0227:
                                           ; SOURCE LINE # 1190
03B5 D3                SETB    C
03B6 EF                MOV     A,R7
03B7 9408              SUBB    A,#08H
03B9 EE                MOV     A,R6
03BA 6480              XRL     A,#080H
03BC 9480              SUBB    A,#080H
03BE 5008              JNC     ?C0229
                                           ; SOURCE LINE # 1191
                                           ; SOURCE LINE # 1192
03C0 900000      R     MOV     DPTR,#len
03C3 E0                MOVX    A,@DPTR
03C4 F5DD              MOV     UEP0_T_LEN,A
                                           ; SOURCE LINE # 1193
                                           ; SOURCE LINE # 1194
03C6 8003              SJMP    ?C0309
03C8         ?C0229:
                                           ; SOURCE LINE # 1196
                                           ; SOURCE LINE # 1197
03C8 75DD00            MOV     UEP0_T_LEN,#00H
                                           ; SOURCE LINE # 1198
03CB         ?C0309:
03CB 75DCC0            MOV     UEP0_CTRL,#0C0H
                                           ; SOURCE LINE # 1199
                                           ; SOURCE LINE # 1200
03CE 020000      R     LJMP    ?C0157
                                           ; SOURCE LINE # 1201
                                           ; SOURCE LINE # 1202
03D1         ?C0231:
                                           ; SOURCE LINE # 1203
                                           ; SOURCE LINE # 1204
03D1 900000      R     MOV     DPTR,#SetupReqCode
03D4 E0                MOVX    A,@DPTR
03D5 24FB              ADD     A,#0FBH
03D7 6060              JZ      ?C0236
03D9 14                DEC     A
03DA 706B              JNZ     ?C0237
                                           ; SOURCE LINE # 1205
                                           ; SOURCE LINE # 1206
03DC         ?C0233:
                                           ; SOURCE LINE # 1207
03DC 900000      R     MOV     DPTR,#SetupLen
03DF E0                MOVX    A,@DPTR
03E0 FF                MOV     R7,A
03E1 C3                CLR     C
03E2 9408              SUBB    A,#08H
03E4 7480              MOV     A,#080H
03E6 9480              SUBB    A,#080H
03E8 4007              JC      ?C0234
03EA 7E08              MOV     R6,#08H
03EC CF                XCH     A,R7
03ED EE                MOV     A,R6
03EE CF                XCH     A,R7
03EF 8000              SJMP    ?C0235
03F1         ?C0234:
03F1         ?C0235:
03F1 900000      R     MOV     DPTR,#len
03F4 EF                MOV     A,R7
03F5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1208
03F6 7E00              MOV     R6,#00H
03F8 C8                XCH     A,R0
03F9 7400        R     MOV     A,#LOW Ep0Buffer
03FB C8                XCH     A,R0
03FC CC                XCH     A,R4
03FD 7400        R     MOV     A,#HIGH Ep0Buffer
03FF CC                XCH     A,R4
0400 CD                XCH     A,R5
0401 7401              MOV     A,#01H
0403 CD                XCH     A,R5
0404 900000      R     MOV     DPTR,#pDescr
0407 E0                MOVX    A,@DPTR
0408 FB                MOV     R3,A
0409 A3                INC     DPTR
040A E0                MOVX    A,@DPTR
040B FA                MOV     R2,A
040C A3                INC     DPTR
040D E0                MOVX    A,@DPTR
040E F9                MOV     R1,A
040F 120000      E     LCALL   ?C?COPY
                                           ; SOURCE LINE # 1209
0412 900000      R     MOV     DPTR,#SetupLen
0415 E0                MOVX    A,@DPTR
0416 FF                MOV     R7,A
0417 900000      R     MOV     DPTR,#len
041A E0                MOVX    A,@DPTR
041B FE                MOV     R6,A
041C C3                CLR     C
041D EF                MOV     A,R7
041E 9E                SUBB    A,R6
041F 900000      R     MOV     DPTR,#SetupLen
0422 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1210
0423 EE                MOV     A,R6
0424 FF                MOV     R7,A
0425 900000      R     MOV     DPTR,#pDescr+01H
0428 E4                CLR     A
0429 8FF0              MOV     B,R7
042B 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 1211
042E 900000      R     MOV     DPTR,#len
0431 E0                MOVX    A,@DPTR
0432 F5DD              MOV     UEP0_T_LEN,A
                                           ; SOURCE LINE # 1212
0434 63DC40            XRL     UEP0_CTRL,#040H
                                           ; SOURCE LINE # 1213
0437 801C              SJMP    ?C0157
                                           ; SOURCE LINE # 1214
0439         ?C0236:
                                           ; SOURCE LINE # 1215
0439 E5E3              MOV     A,USB_DEV_AD
043B 5480              ANL     A,#080H
043D FF                MOV     R7,A
043E 900000      R     MOV     DPTR,#SetupLen
0441 E0                MOVX    A,@DPTR
0442 4F                ORL     A,R7
0443 F5E3              MOV     USB_DEV_AD,A
                                           ; SOURCE LINE # 1216
                                           ; SOURCE LINE # 1217
0445 8003              SJMP    ?C0310
                                           ; SOURCE LINE # 1218
0447         ?C0237:
                                           ; SOURCE LINE # 1219
0447 75DD00            MOV     UEP0_T_LEN,#00H
                                           ; SOURCE LINE # 1220
044A         ?C0310:
044A 75DC02            MOV     UEP0_CTRL,#02H
                                           ; SOURCE LINE # 1221
044D 8006              SJMP    ?C0157
                                           ; SOURCE LINE # 1222
                                           ; SOURCE LINE # 1223
                                           ; SOURCE LINE # 1224
                                           ; SOURCE LINE # 1225
044F         ?C0238:
                                           ; SOURCE LINE # 1226
                                           ; SOURCE LINE # 1227
044F 75DD00            MOV     UEP0_T_LEN,#00H
                                           ; SOURCE LINE # 1228
0452 63DC80            XRL     UEP0_CTRL,#080H
                                           ; SOURCE LINE # 1229
                                           ; SOURCE LINE # 1230
                                           ; SOURCE LINE # 1231
                                           ; SOURCE LINE # 1232
                                           ; SOURCE LINE # 1233
0455         ?C0157:
                                           ; SOURCE LINE # 1234
0455 C2D9              CLR     UIF_TRANSFER
                                           ; SOURCE LINE # 1235
0457 8043              SJMP    ?C0247
0459         ?C0156:
                                           ; SOURCE LINE # 1236
0459 30D822            JNB     UIF_BUS_RST,?C0241
                                           ; SOURCE LINE # 1237
                                           ; SOURCE LINE # 1238
045C 7BFF              MOV     R3,#0FFH
045E 7A00        R     MOV     R2,#HIGH ?SC_8
0460 7900        R     MOV     R1,#LOW ?SC_8
0462 120000      E     LCALL   _printf
                                           ; SOURCE LINE # 1239
0465 75DC02            MOV     UEP0_CTRL,#02H
                                           ; SOURCE LINE # 1240
0468 75D212            MOV     UEP1_CTRL,#012H
                                           ; SOURCE LINE # 1241
046B 75D412            MOV     UEP2_CTRL,#012H
                                           ; SOURCE LINE # 1242
046E 75E300            MOV     USB_DEV_AD,#00H
                                           ; SOURCE LINE # 1243
0471 C2DA              CLR     UIF_SUSPEND
                                           ; SOURCE LINE # 1244
0473 C2D9              CLR     UIF_TRANSFER
                                           ; SOURCE LINE # 1245
0475 C2D8              CLR     UIF_BUS_RST
                                           ; SOURCE LINE # 1246
0477 900000      E     MOV     DPTR,#USBReady
047A E4                CLR     A
047B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1247
047C 801E              SJMP    ?C0247
047E         ?C0241:
                                           ; SOURCE LINE # 1248
047E 30DA18            JNB     UIF_SUSPEND,?C0243
                                           ; SOURCE LINE # 1249
                                           ; SOURCE LINE # 1250
0481 C2DA              CLR     UIF_SUSPEND
                                           ; SOURCE LINE # 1251
0483 E5DA              MOV     A,USB_MIS_ST
0485 7BFF              MOV     R3,#0FFH
0487 30E206            JNB     ACC.2,?C0244
                                           ; SOURCE LINE # 1252
                                           ; SOURCE LINE # 1253
048A 7A00        R     MOV     R2,#HIGH ?SC_15
048C 7900        R     MOV     R1,#LOW ?SC_15
                                           ; SOURCE LINE # 1254
048E 8004              SJMP    ?C0311
0490         ?C0244:
                                           ; SOURCE LINE # 1256
                                           ; SOURCE LINE # 1257
0490 7A00        R     MOV     R2,#HIGH ?SC_24
0492 7900        R     MOV     R1,#LOW ?SC_24
0494         ?C0311:
0494 120000      E     LCALL   _printf
                                           ; SOURCE LINE # 1258
                                           ; SOURCE LINE # 1259
0497 8003              SJMP    ?C0247
0499         ?C0243:
                                           ; SOURCE LINE # 1261
                                           ; SOURCE LINE # 1263
0499 75D8FF            MOV     USB_INT_FG,#0FFH
                                           ; SOURCE LINE # 1264
                                           ; SOURCE LINE # 1265
049C         ?C0247:
049C D0D0              POP     PSW
049E D082              POP     DPL
04A0 D083              POP     DPH
04A2 D0F0              POP     B
04A4 D0E0              POP     ACC
04A6 32                RETI    
             ; FUNCTION USB_DeviceInterrupt (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   4114    ----
   CONSTANT SIZE    =    336    ----
   XDATA SIZE       =     33      39
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =    128    ----
   BIT SIZE         =      6    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
